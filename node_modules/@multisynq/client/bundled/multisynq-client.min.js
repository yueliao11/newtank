// (C) 2025 Croquet Labs
// Multisynq Client v1.0.4
// Using Croquet v2.0.4
// Built on 2025-06-09T15:55:07.724Z

"use strict";var Multisynq=(()=>{var bl=Object.create;var Ys=Object.defineProperty;var yl=Object.getOwnPropertyDescriptor;var gl=Object.getOwnPropertyNames;var wl=Object.getPrototypeOf,Zl=Object.prototype.hasOwnProperty;var Hs=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),vl=(s,e)=>{for(var t in e)Ys(s,t,{get:e[t],enumerable:!0})},nr=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of gl(e))!Zl.call(s,i)&&i!==t&&Ys(s,i,{get:()=>e[i],enumerable:!(n=yl(e,i))||n.enumerable});return s};var Xl=(s,e,t)=>(t=s!=null?bl(wl(s)):{},nr(e||!s||!s.__esModule?Ys(t,"default",{value:s,enumerable:!0}):t,s)),Ll=s=>nr(Ys({},"__esModule",{value:!0}),s);var rr=Hs((ir,Ks)=>{(function(s,e){typeof Ks=="object"&&Ks.exports?Ks.exports=e():s.Toastify=e()})(ir,function(s){var e=function(r){return new e.lib.init(r)},t="1.12.0";e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:t,constructor:e,init:function(r){return r||(r={}),this.options={},this.toastElement=null,this.options.text=r.text||e.defaults.text,this.options.node=r.node||e.defaults.node,this.options.duration=r.duration===0?0:r.duration||e.defaults.duration,this.options.selector=r.selector||e.defaults.selector,this.options.callback=r.callback||e.defaults.callback,this.options.destination=r.destination||e.defaults.destination,this.options.newWindow=r.newWindow||e.defaults.newWindow,this.options.close=r.close||e.defaults.close,this.options.gravity=r.gravity==="bottom"?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=r.positionLeft||e.defaults.positionLeft,this.options.position=r.position||e.defaults.position,this.options.backgroundColor=r.backgroundColor||e.defaults.backgroundColor,this.options.avatar=r.avatar||e.defaults.avatar,this.options.className=r.className||e.defaults.className,this.options.stopOnFocus=r.stopOnFocus===void 0?e.defaults.stopOnFocus:r.stopOnFocus,this.options.onClick=r.onClick||e.defaults.onClick,this.options.offset=r.offset||e.defaults.offset,this.options.escapeMarkup=r.escapeMarkup!==void 0?r.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=r.ariaLive||e.defaults.ariaLive,this.options.style=r.style||e.defaults.style,r.backgroundColor&&(this.options.style.background=r.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var r=document.createElement("div");r.className="toastify on "+this.options.className,this.options.position?r.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(r.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):r.className+=" toastify-right",r.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var o in this.options.style)r.style[o]=this.options.style[o];if(this.options.ariaLive&&r.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)r.appendChild(this.options.node);else if(this.options.escapeMarkup?r.innerText=this.options.text:r.innerHTML=this.options.text,this.options.avatar!==""){var a=document.createElement("img");a.src=this.options.avatar,a.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?r.appendChild(a):r.insertAdjacentElement("afterbegin",a)}if(this.options.close===!0){var c=document.createElement("button");c.type="button",c.setAttribute("aria-label","Close"),c.className="toast-close",c.innerHTML="&#10006;",c.addEventListener("click",function(G){G.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var l=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&l>360?r.insertAdjacentElement("afterbegin",c):r.appendChild(c)}if(this.options.stopOnFocus&&this.options.duration>0){var d=this;r.addEventListener("mouseover",function(G){window.clearTimeout(r.timeOutValue)}),r.addEventListener("mouseleave",function(){r.timeOutValue=window.setTimeout(function(){d.removeElement(r)},d.options.duration)})}if(typeof this.options.destination<"u"&&r.addEventListener("click",function(G){G.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&r.addEventListener("click",function(G){G.stopPropagation(),this.options.onClick()}.bind(this)),typeof this.options.offset=="object"){var p=n("x",this.options),f=n("y",this.options),h=this.options.position=="left"?p:"-"+p,v=this.options.gravity=="toastify-top"?f:"-"+f;r.style.transform="translate("+h+","+v+")"}return r},showToast:function(){this.toastElement=this.buildToast();var r;if(typeof this.options.selector=="string"?r=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?r=this.options.selector:r=document.body,!r)throw"Root element is not defined";var o=e.defaults.oldestFirst?r.firstChild:r.lastChild;return r.insertBefore(this.toastElement,o),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(r){r.className=r.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),r.parentNode&&r.parentNode.removeChild(r),this.options.callback.call(r),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var r={top:15,bottom:15},o={top:15,bottom:15},a={top:15,bottom:15},c=document.getElementsByClassName("toastify"),l,d=0;d<c.length;d++){i(c[d],"toastify-top")===!0?l="toastify-top":l="toastify-bottom";var p=c[d].offsetHeight;l=l.substr(9,l.length-1);var f=15,h=window.innerWidth>0?window.innerWidth:screen.width;h<=360?(c[d].style[l]=a[l]+"px",a[l]+=p+f):i(c[d],"toastify-left")===!0?(c[d].style[l]=r[l]+"px",r[l]+=p+f):(c[d].style[l]=o[l]+"px",o[l]+=p+f)}return this};function n(r,o){return o.offset[r]?isNaN(o.offset[r])?o.offset[r]:o.offset[r]+"px":"0px"}function i(r,o){return!r||typeof o!="string"?!1:!!(r.className&&r.className.trim().split(/\s+/gi).indexOf(o)>-1)}return e.lib.init.prototype=e.lib,e})});var ar=Hs((ou,or)=>{"use strict";or.exports=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(r){return function(o){return function(a,c){var l={key:a,value:o[a]},d={key:c,value:o[c]};return r(l,d)}}}(e.cmp),i=[];return function r(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=r(o[a])||"null";return c+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,d=Object.keys(o).sort(n&&n(o));for(c="",a=0;a<d.length;a++){var p=d[a],f=r(o[p]);f&&(c&&(c+=","),c+=JSON.stringify(p)+":"+f)}return i.splice(l,1),"{"+c+"}"}}(s)}});var cr=Hs((au,lr)=>{"use strict";var xl=function(s,e){return s<e};function q(s){if(!(this instanceof q))return new q(s);this.array=[],this.size=0,this.compare=s||xl}q.prototype.clone=function(){var s=new q(this.compare);return s.size=this.size,s.array=this.array.slice(0,this.size),s};q.prototype.add=function(s){var e=this.size;this.array[this.size]=s,this.size+=1;for(var t,n;e>0&&(t=e-1>>1,n=this.array[t],!!this.compare(s,n));)this.array[e]=n,e=t;this.array[e]=s};q.prototype.heapify=function(s){this.array=s,this.size=s.length;var e;for(e=this.size>>1;e>=0;e--)this._percolateDown(e)};q.prototype._percolateUp=function(s,e){for(var t=this.array[s],n,i;s>0&&(n=s-1>>1,i=this.array[n],!(!e&&!this.compare(t,i)));)this.array[s]=i,s=n;this.array[s]=t};q.prototype._percolateDown=function(s){for(var e=this.size,t=this.size>>>1,n=this.array[s],i,r,o;s<t&&(i=(s<<1)+1,r=i+1,o=this.array[i],r<e&&this.compare(this.array[r],o)&&(i=r,o=this.array[r]),!!this.compare(o,n));)this.array[s]=o,s=i;this.array[s]=n};q.prototype._removeAt=function(s){if(!(s>this.size-1||s<0))return this._percolateUp(s,!0),this.poll()};q.prototype.remove=function(s){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],s)&&!this.compare(s,this.array[e]))return this._removeAt(e),!0;return!1};q.prototype.removeOne=function(s){if(typeof s=="function"){for(var e=0;e<this.size;e++)if(s(this.array[e]))return this._removeAt(e)}};q.prototype.removeMany=function(s,e){if(typeof s!="function"||this.size<1)return[];e=e?Math.min(e,this.size):this.size;for(var t=0,n=new Array(e),i=0,r=new Array(this.size);t<e&&!this.isEmpty();){var o=this.poll();s(o)?n[t++]=o:r[i++]=o}n.length=t;for(var a=0;a<i;)this.add(r[a++]);return n};q.prototype.peek=function(){if(this.size!=0)return this.array[0]};q.prototype.poll=function(){if(this.size!=0){var s=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,s}};q.prototype.replaceTop=function(s){if(this.size!=0){var e=this.array[0];return this.array[0]=s,this._percolateDown(0),e}};q.prototype.trim=function(){this.array=this.array.slice(0,this.size)};q.prototype.isEmpty=function(){return this.size===0};q.prototype.forEach=function(s){if(!(this.isEmpty()||typeof s!="function"))for(var e=0,t=this.clone();!t.isEmpty();)s(t.poll(),e++)};q.prototype.kSmallest=function(s){if(this.size==0||s<=0)return[];s=Math.min(this.size,s);let e=Math.min(this.size,2**(s-1)+1);if(e<2)return[this.peek()];let t=new q(this.compare);t.size=e,t.array=this.array.slice(0,e);let n=new Array(s);for(let i=0;i<s;i++)n[i]=t.poll();return n};lr.exports=q});var pl=Hs(je=>{"use strict";var Sl=rr(),Xt=ar(),Gl=cr(),kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Tl(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return s[n]}})}),t}var dr,Wl={exports:{}};dr||(dr=1,function(s){var e=function(t){var n,i=Object.prototype,r=i.hasOwnProperty,o=Object.defineProperty||function(I,x,T){I[x]=T.value},a=typeof Symbol=="function"?Symbol:{},c=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function p(I,x,T){return Object.defineProperty(I,x,{value:T,enumerable:!0,configurable:!0,writable:!0}),I[x]}try{p({},"")}catch{p=function(x,T,k){return x[T]=k}}function f(I,x,T,k){var C=x&&x.prototype instanceof S?x:S,E=Object.create(C.prototype),te=new O(k||[]);return o(E,"_invoke",{value:M(I,T,te)}),E}function h(I,x,T){try{return{type:"normal",arg:I.call(x,T)}}catch(k){return{type:"throw",arg:k}}}t.wrap=f;var v="suspendedStart",G="suspendedYield",y="executing",X="completed",L={};function S(){}function Z(){}function u(){}var m={};p(m,c,function(){return this});var b=Object.getPrototypeOf,g=b&&b(b(A([])));g&&g!==i&&r.call(g,c)&&(m=g);var w=u.prototype=S.prototype=Object.create(m);function W(I){["next","throw","return"].forEach(function(x){p(I,x,function(T){return this._invoke(x,T)})})}function R(I,x){function T(C,E,te,me){var pe=h(I[C],I,E);if(pe.type!=="throw"){var Wt=pe.arg,Ot=Wt.value;return Ot&&typeof Ot=="object"&&r.call(Ot,"__await")?x.resolve(Ot.__await).then(function(ht){T("next",ht,te,me)},function(ht){T("throw",ht,te,me)}):x.resolve(Ot).then(function(ht){Wt.value=ht,te(Wt)},function(ht){return T("throw",ht,te,me)})}me(pe.arg)}var k;o(this,"_invoke",{value:function(C,E){function te(){return new x(function(me,pe){T(C,E,me,pe)})}return k=k?k.then(te,te):te()}})}function M(I,x,T){var k=v;return function(C,E){if(k===y)throw new Error("Generator is already running");if(k===X){if(C==="throw")throw E;return{value:n,done:!0}}for(T.method=C,T.arg=E;;){var te=T.delegate;if(te){var me=K(te,T);if(me){if(me===L)continue;return me}}if(T.method==="next")T.sent=T._sent=T.arg;else if(T.method==="throw"){if(k===v)throw k=X,T.arg;T.dispatchException(T.arg)}else T.method==="return"&&T.abrupt("return",T.arg);k=y;var pe=h(I,x,T);if(pe.type==="normal"){if(k=T.done?X:G,pe.arg===L)continue;return{value:pe.arg,done:T.done}}pe.type==="throw"&&(k=X,T.method="throw",T.arg=pe.arg)}}}function K(I,x){var T=x.method,k=I.iterator[T];if(k===n)return x.delegate=null,T==="throw"&&I.iterator.return&&(x.method="return",x.arg=n,K(I,x),x.method==="throw")||T!=="return"&&(x.method="throw",x.arg=new TypeError("The iterator does not provide a '"+T+"' method")),L;var C=h(k,I.iterator,x.arg);if(C.type==="throw")return x.method="throw",x.arg=C.arg,x.delegate=null,L;var E=C.arg;return E?E.done?(x[I.resultName]=E.value,x.next=I.nextLoc,x.method!=="return"&&(x.method="next",x.arg=n),x.delegate=null,L):E:(x.method="throw",x.arg=new TypeError("iterator result is not an object"),x.delegate=null,L)}function N(I){var x={tryLoc:I[0]};1 in I&&(x.catchLoc=I[1]),2 in I&&(x.finallyLoc=I[2],x.afterLoc=I[3]),this.tryEntries.push(x)}function H(I){var x=I.completion||{};x.type="normal",delete x.arg,I.completion=x}function O(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(N,this),this.reset(!0)}function A(I){if(I!=null){var x=I[c];if(x)return x.call(I);if(typeof I.next=="function")return I;if(!isNaN(I.length)){var T=-1,k=function C(){for(;++T<I.length;)if(r.call(I,T))return C.value=I[T],C.done=!1,C;return C.value=n,C.done=!0,C};return k.next=k}}throw new TypeError(typeof I+" is not iterable")}return Z.prototype=u,o(w,"constructor",{value:u,configurable:!0}),o(u,"constructor",{value:Z,configurable:!0}),Z.displayName=p(u,d,"GeneratorFunction"),t.isGeneratorFunction=function(I){var x=typeof I=="function"&&I.constructor;return!!x&&(x===Z||(x.displayName||x.name)==="GeneratorFunction")},t.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,u):(I.__proto__=u,p(I,d,"GeneratorFunction")),I.prototype=Object.create(w),I},t.awrap=function(I){return{__await:I}},W(R.prototype),p(R.prototype,l,function(){return this}),t.AsyncIterator=R,t.async=function(I,x,T,k,C){C===void 0&&(C=Promise);var E=new R(f(I,x,T,k),C);return t.isGeneratorFunction(x)?E:E.next().then(function(te){return te.done?te.value:E.next()})},W(w),p(w,d,"Generator"),p(w,c,function(){return this}),p(w,"toString",function(){return"[object Generator]"}),t.keys=function(I){var x=Object(I),T=[];for(var k in x)T.push(k);return T.reverse(),function C(){for(;T.length;){var E=T.pop();if(E in x)return C.value=E,C.done=!1,C}return C.done=!0,C}},t.values=A,O.prototype={constructor:O,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(H),!I)for(var x in this)x.charAt(0)==="t"&&r.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=n)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if(I.type==="throw")throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var x=this;function T(pe,Wt){return E.type="throw",E.arg=I,x.next=pe,Wt&&(x.method="next",x.arg=n),!!Wt}for(var k=this.tryEntries.length-1;k>=0;--k){var C=this.tryEntries[k],E=C.completion;if(C.tryLoc==="root")return T("end");if(C.tryLoc<=this.prev){var te=r.call(C,"catchLoc"),me=r.call(C,"finallyLoc");if(te&&me){if(this.prev<C.catchLoc)return T(C.catchLoc,!0);if(this.prev<C.finallyLoc)return T(C.finallyLoc)}else if(te){if(this.prev<C.catchLoc)return T(C.catchLoc,!0)}else{if(!me)throw new Error("try statement without catch or finally");if(this.prev<C.finallyLoc)return T(C.finallyLoc)}}}},abrupt:function(I,x){for(var T=this.tryEntries.length-1;T>=0;--T){var k=this.tryEntries[T];if(k.tryLoc<=this.prev&&r.call(k,"finallyLoc")&&this.prev<k.finallyLoc){var C=k;break}}C&&(I==="break"||I==="continue")&&C.tryLoc<=x&&x<=C.finallyLoc&&(C=null);var E=C?C.completion:{};return E.type=I,E.arg=x,C?(this.method="next",this.next=C.finallyLoc,L):this.complete(E)},complete:function(I,x){if(I.type==="throw")throw I.arg;return I.type==="break"||I.type==="continue"?this.next=I.arg:I.type==="return"?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):I.type==="normal"&&x&&(this.next=x),L},finish:function(I){for(var x=this.tryEntries.length-1;x>=0;--x){var T=this.tryEntries[x];if(T.finallyLoc===I)return this.complete(T.completion,T.afterLoc),H(T),L}},catch:function(I){for(var x=this.tryEntries.length-1;x>=0;--x){var T=this.tryEntries[x];if(T.tryLoc===I){var k=T.completion;if(k.type==="throw"){var C=k.arg;H(T)}return C}}throw new Error("illegal catch attempt")},delegateYield:function(I,x,T){return this.delegate={iterator:A(I),resultName:x,nextLoc:T},this.method==="next"&&(this.arg=n),L}},t}(s.exports);try{globalThis.regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(Wl));var Ln={CROQUET_VERSION:"2.0.4"},Ns=window&&window.location.hostname.endsWith("croquet.studio"),hr="",Ct="";function ur(s,e){if(e)for(let t of e.split("&")){let n=t.split("="),i=n[0],r=!0;if(n.length>1&&(r=decodeURIComponent(n.slice(1).join("=")),r.match(/^(true|false|null|[0-9.]*|["[{].*)$/)))try{r=JSON.parse(r)}catch{r[0]==="["&&(r=r.slice(1,-1).split(","))}s[i]=r}}var Y=new class{constructor(){this.getSession(),ur(this,window.location.search.slice(1)),ur(this,Ns?window.location.hash.slice(1):Ct),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];typeof t=="string"&&(t=this.isHost(t));let n=this[s];if(typeof n!="string")return t;let i=n.split(",");return t===!0&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes(`${e}s`)?!t:t}getSession(){if(Ns){let s=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(s);if(e)return hr=e[1],e[2]}else{let s=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(s);if(e)return e[1].includes("=")?(Ct=`${e[1]}&${e[2]}`,""):(Ct=e[2],e[1])}return typeof this.session=="string"?(Ct=window.location.hash.slice(1),this.session):""}setSession(s){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];Ns==null&&this.getSession();let{search:t,hash:n}=window.location,i=Ns?`/${hr}/${s}${t}${n}`:`#${s}${Ct?"&"+Ct:""}`;e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(s){let e=window.location.hostname;return e===s?!0:s!=="localhost"?!1:e.endsWith(".ngrok.io")||e==="croquet.io"&&window.location.pathname.match(/^\/(dev|files)\//)?!0:window.location.protocol==="file:"||["127.0.0.1","[::1]"].includes(e)}isLocalhost(){return this.isHost("localhost")}},It,ft=256,Cl=Math.pow(ft,6),la=Math.pow(2,52),kl=2*la,bt=255;function dn(s,e){var t=[];if((e=e||{}).entropy)throw new Error("this version of seedrandom does not support entropy");if(s==null&&!e.state)throw new Error("this version of seedrandom requires a seed");(function(r,o){for(var a,c=r+"",l=0;l<c.length;)o[bt&l]=bt&(a^=19*o[bt&l])+c.charCodeAt(l++);return d=o,String.fromCharCode.apply(0,d);var d})(ca(s,3),t);var n=new Pl(t),i=function(){for(var r=n.g(6),o=Cl,a=0;r<la;)r=(r+a)*ft,o*=ft,a=n.g(1);for(;r>=kl;)r/=2,o/=2,a>>>=1;return(r+a)/o};return i.int32=function(){return 0|n.g(4)},i.quick=function(){return n.g(4)/4294967296},i.double=i,(e.pass||function(r,o){return o&&(o.S&&mr(o,n),r.state=function(){return mr(n,{})}),r})(i,e.state)}function Pl(s){var e,t=s.length,n=this,i=0,r=n.i=n.j=0,o=n.S=[];for(t||(s=[t++]);i<ft;)o[i]=i++;for(i=0;i<ft;i++)o[i]=o[r=bt&r+s[i%t]+(e=o[i])],o[r]=e;(n.g=function(a){for(var c,l=0,d=n.i,p=n.j,f=n.S;a--;)c=f[d=bt&d+1],l=l*ft+f[bt&(f[d]=f[p=bt&p+c])+(f[p]=c)];return n.i=d,n.j=p,l})(ft)}function mr(s,e){return e.i=s.i,e.j=s.j,e.S=s.S.slice(),e}function ca(s,e){var t,n=[],i=typeof s;if(e&&i=="object")for(t in s)try{n.push(ca(s[t],e-1))}catch{}return n.length?n:i=="string"?s:s+"\0"}(function(){function s(u){this.mode=t.MODE_8BIT_BYTE,this.data=u,this.parsedData=[];for(var m=0,b=this.data.length;m<b;m++){var g=[],w=this.data.charCodeAt(m);w>65536?(g[0]=240|(1835008&w)>>>18,g[1]=128|(258048&w)>>>12,g[2]=128|(4032&w)>>>6,g[3]=128|63&w):w>2048?(g[0]=224|(61440&w)>>>12,g[1]=128|(4032&w)>>>6,g[2]=128|63&w):w>128?(g[0]=192|(1984&w)>>>6,g[1]=128|63&w):g[0]=w,this.parsedData.push(g)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(u,m){this.typeNumber=u,this.errorCorrectLevel=m,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}s.prototype={getLength:function(u){return this.parsedData.length},write:function(u){for(var m=0,b=this.parsedData.length;m<b;m++)u.put(this.parsedData[m],8)}},e.prototype={addData:function(u){var m=new s(u);this.dataList.push(m),this.dataCache=null},isDark:function(u,m){if(u<0||this.moduleCount<=u||m<0||this.moduleCount<=m)throw new Error(u+","+m);return this.modules[u][m]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(u,m){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++){this.modules[b]=new Array(this.moduleCount);for(var g=0;g<this.moduleCount;g++)this.modules[b][g]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(u,m),this.typeNumber>=7&&this.setupTypeNumber(u),this.dataCache==null&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,m)},setupPositionProbePattern:function(u,m){for(var b=-1;b<=7;b++)if(!(u+b<=-1||this.moduleCount<=u+b))for(var g=-1;g<=7;g++)m+g<=-1||this.moduleCount<=m+g||(this.modules[u+b][m+g]=0<=b&&b<=6&&(g==0||g==6)||0<=g&&g<=6&&(b==0||b==6)||2<=b&&b<=4&&2<=g&&g<=4)},getBestMaskPattern:function(){for(var u=0,m=0,b=0;b<8;b++){this.makeImpl(!0,b);var g=f.getLostPoint(this);(b==0||u>g)&&(u=g,m=b)}return m},createMovieClip:function(u,m,b){var g=u.createEmptyMovieClip(m,b);this.make();for(var w=0;w<this.modules.length;w++)for(var W=1*w,R=0;R<this.modules[w].length;R++){var M=1*R;this.modules[w][R]&&(g.beginFill(0,100),g.moveTo(M,W),g.lineTo(M+1,W),g.lineTo(M+1,W+1),g.lineTo(M,W+1),g.endFill())}return g},setupTimingPattern:function(){for(var u=8;u<this.moduleCount-8;u++)this.modules[u][6]==null&&(this.modules[u][6]=u%2==0);for(var m=8;m<this.moduleCount-8;m++)this.modules[6][m]==null&&(this.modules[6][m]=m%2==0)},setupPositionAdjustPattern:function(){for(var u=f.getPatternPosition(this.typeNumber),m=0;m<u.length;m++)for(var b=0;b<u.length;b++){var g=u[m],w=u[b];if(this.modules[g][w]==null)for(var W=-2;W<=2;W++)for(var R=-2;R<=2;R++)this.modules[g+W][w+R]=W==-2||W==2||R==-2||R==2||W==0&&R==0}},setupTypeNumber:function(u){for(var m=f.getBCHTypeNumber(this.typeNumber),b=0;b<18;b++){var g=!u&&(m>>b&1)==1;this.modules[Math.floor(b/3)][b%3+this.moduleCount-8-3]=g}for(b=0;b<18;b++)g=!u&&(m>>b&1)==1,this.modules[b%3+this.moduleCount-8-3][Math.floor(b/3)]=g},setupTypeInfo:function(u,m){for(var b=this.errorCorrectLevel<<3|m,g=f.getBCHTypeInfo(b),w=0;w<15;w++){var W=!u&&(g>>w&1)==1;w<6?this.modules[w][8]=W:w<8?this.modules[w+1][8]=W:this.modules[this.moduleCount-15+w][8]=W}for(w=0;w<15;w++)W=!u&&(g>>w&1)==1,w<8?this.modules[8][this.moduleCount-w-1]=W:w<9?this.modules[8][15-w-1+1]=W:this.modules[8][15-w-1]=W;this.modules[this.moduleCount-8][8]=!u},mapData:function(u,m){for(var b=-1,g=this.moduleCount-1,w=7,W=0,R=this.moduleCount-1;R>0;R-=2)for(R==6&&R--;;){for(var M=0;M<2;M++)if(this.modules[g][R-M]==null){var K=!1;W<u.length&&(K=(u[W]>>>w&1)==1),f.getMask(m,g,R-M)&&(K=!K),this.modules[g][R-M]=K,--w==-1&&(W++,w=7)}if((g+=b)<0||this.moduleCount<=g){g-=b,b=-b;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(u,m,b){for(var g=y.getRSBlocks(u,m),w=new X,W=0;W<b.length;W++){var R=b[W];w.put(R.mode,4),w.put(R.getLength(),f.getLengthInBits(R.mode,u)),R.write(w)}var M=0;for(W=0;W<g.length;W++)M+=g[W].dataCount;if(w.getLengthInBits()>8*M)throw new Error("code length overflow. ("+w.getLengthInBits()+">"+8*M+")");for(w.getLengthInBits()+4<=8*M&&w.put(0,4);w.getLengthInBits()%8!=0;)w.putBit(!1);for(;!(w.getLengthInBits()>=8*M||(w.put(e.PAD0,8),w.getLengthInBits()>=8*M));)w.put(e.PAD1,8);return e.createBytes(w,g)},e.createBytes=function(u,m){for(var b=0,g=0,w=0,W=new Array(m.length),R=new Array(m.length),M=0;M<m.length;M++){var K=m[M].dataCount,N=m[M].totalCount-K;g=Math.max(g,K),w=Math.max(w,N),W[M]=new Array(K);for(var H=0;H<W[M].length;H++)W[M][H]=255&u.buffer[H+b];b+=K;var O=f.getErrorCorrectPolynomial(N),A=new G(W[M],O.getLength()-1).mod(O);for(R[M]=new Array(O.getLength()-1),H=0;H<R[M].length;H++){var I=H+A.getLength()-R[M].length;R[M][H]=I>=0?A.get(I):0}}var x=0;for(H=0;H<m.length;H++)x+=m[H].totalCount;var T=new Array(x),k=0;for(H=0;H<g;H++)for(M=0;M<m.length;M++)H<W[M].length&&(T[k++]=W[M][H]);for(H=0;H<w;H++)for(M=0;M<m.length;M++)H<R[M].length&&(T[k++]=R[M][H]);return T};for(var t={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},i=0,r=1,o=2,a=3,c=4,l=5,d=6,p=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var m=u<<10;f.getBCHDigit(m)-f.getBCHDigit(f.G15)>=0;)m^=f.G15<<f.getBCHDigit(m)-f.getBCHDigit(f.G15);return(u<<10|m)^f.G15_MASK},getBCHTypeNumber:function(u){for(var m=u<<12;f.getBCHDigit(m)-f.getBCHDigit(f.G18)>=0;)m^=f.G18<<f.getBCHDigit(m)-f.getBCHDigit(f.G18);return u<<12|m},getBCHDigit:function(u){for(var m=0;u!=0;)m++,u>>>=1;return m},getPatternPosition:function(u){return f.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,m,b){switch(u){case i:return(m+b)%2==0;case r:return m%2==0;case o:return b%3==0;case a:return(m+b)%3==0;case c:return(Math.floor(m/2)+Math.floor(b/3))%2==0;case l:return m*b%2+m*b%3==0;case d:return(m*b%2+m*b%3)%2==0;case p:return(m*b%3+(m+b)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var m=new G([1],0),b=0;b<u;b++)m=m.multiply(new G([1,h.gexp(b)],0));return m},getLengthInBits:function(u,m){if(1<=m&&m<10)switch(u){case t.MODE_NUMBER:return 10;case t.MODE_ALPHA_NUM:return 9;case t.MODE_8BIT_BYTE:case t.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(m<27)switch(u){case t.MODE_NUMBER:return 12;case t.MODE_ALPHA_NUM:return 11;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else{if(!(m<41))throw new Error("type:"+m);switch(u){case t.MODE_NUMBER:return 14;case t.MODE_ALPHA_NUM:return 13;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}}},getLostPoint:function(u){for(var m=u.getModuleCount(),b=0,g=0;g<m;g++)for(var w=0;w<m;w++){for(var W=0,R=u.isDark(g,w),M=-1;M<=1;M++)if(!(g+M<0||m<=g+M))for(var K=-1;K<=1;K++)w+K<0||m<=w+K||M==0&&K==0||R==u.isDark(g+M,w+K)&&W++;W>5&&(b+=3+W-5)}for(g=0;g<m-1;g++)for(w=0;w<m-1;w++){var N=0;u.isDark(g,w)&&N++,u.isDark(g+1,w)&&N++,u.isDark(g,w+1)&&N++,u.isDark(g+1,w+1)&&N++,N!=0&&N!=4||(b+=3)}for(g=0;g<m;g++)for(w=0;w<m-6;w++)u.isDark(g,w)&&!u.isDark(g,w+1)&&u.isDark(g,w+2)&&u.isDark(g,w+3)&&u.isDark(g,w+4)&&!u.isDark(g,w+5)&&u.isDark(g,w+6)&&(b+=40);for(w=0;w<m;w++)for(g=0;g<m-6;g++)u.isDark(g,w)&&!u.isDark(g+1,w)&&u.isDark(g+2,w)&&u.isDark(g+3,w)&&u.isDark(g+4,w)&&!u.isDark(g+5,w)&&u.isDark(g+6,w)&&(b+=40);var H=0;for(w=0;w<m;w++)for(g=0;g<m;g++)u.isDark(g,w)&&H++;return b+=10*(Math.abs(100*H/m/m-50)/5)}},h={glog:function(u){if(u<1)throw new Error("glog("+u+")");return h.LOG_TABLE[u]},gexp:function(u){for(;u<0;)u+=255;for(;u>=256;)u-=255;return h.EXP_TABLE[u]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},v=0;v<8;v++)h.EXP_TABLE[v]=1<<v;for(v=8;v<256;v++)h.EXP_TABLE[v]=h.EXP_TABLE[v-4]^h.EXP_TABLE[v-5]^h.EXP_TABLE[v-6]^h.EXP_TABLE[v-8];for(v=0;v<255;v++)h.LOG_TABLE[h.EXP_TABLE[v]]=v;function G(u,m){if(u.length==null)throw new Error(u.length+"/"+m);for(var b=0;b<u.length&&u[b]==0;)b++;this.num=new Array(u.length-b+m);for(var g=0;g<u.length-b;g++)this.num[g]=u[g+b]}function y(u,m){this.totalCount=u,this.dataCount=m}function X(){this.buffer=[],this.length=0}G.prototype={get:function(u){return this.num[u]},getLength:function(){return this.num.length},multiply:function(u){for(var m=new Array(this.getLength()+u.getLength()-1),b=0;b<this.getLength();b++)for(var g=0;g<u.getLength();g++)m[b+g]^=h.gexp(h.glog(this.get(b))+h.glog(u.get(g)));return new G(m,0)},mod:function(u){if(this.getLength()-u.getLength()<0)return this;for(var m=h.glog(this.get(0))-h.glog(u.get(0)),b=new Array(this.getLength()),g=0;g<this.getLength();g++)b[g]=this.get(g);for(g=0;g<u.getLength();g++)b[g]^=h.gexp(h.glog(u.get(g))+m);return new G(b,0).mod(u)}},y.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],y.getRSBlocks=function(u,m){var b=y.getRsBlockTable(u,m);if(b==null)throw new Error("bad rs block @ typeNumber:"+u+"/errorCorrectLevel:"+m);for(var g=b.length/3,w=[],W=0;W<g;W++)for(var R=b[3*W+0],M=b[3*W+1],K=b[3*W+2],N=0;N<R;N++)w.push(new y(M,K));return w},y.getRsBlockTable=function(u,m){switch(m){case n.L:return y.RS_BLOCK_TABLE[4*(u-1)+0];case n.M:return y.RS_BLOCK_TABLE[4*(u-1)+1];case n.Q:return y.RS_BLOCK_TABLE[4*(u-1)+2];case n.H:return y.RS_BLOCK_TABLE[4*(u-1)+3];default:return}},X.prototype={get:function(u){var m=Math.floor(u/8);return(this.buffer[m]>>>7-u%8&1)==1},put:function(u,m){for(var b=0;b<m;b++)this.putBit((u>>>m-b-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(u){var m=Math.floor(this.length/8);this.buffer.length<=m&&this.buffer.push(0),u&&(this.buffer[m]|=128>>>this.length%8),this.length++}};var L=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],S=function(){var u=function(m,b){this._bIsPainted=!1,this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,m.appendChild(this._elCanvas),this._el=m,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return u.prototype.draw=function(m){var b=this._oContext,g=this._htOption,w=m.getModuleCount(),W=g.width/w,R=g.height/w,M=Math.round(W),K=Math.round(R);this.clear();for(var N=0;N<w;N++)for(var H=0;H<w;H++){var O=m.isDark(N,H),A=H*W,I=N*R;b.strokeStyle=O?g.colorDark:g.colorLight,b.lineWidth=1,b.fillStyle=O?g.colorDark:g.colorLight,b.fillRect(A,I,W,R),b.strokeRect(Math.floor(A)+.5,Math.floor(I)+.5,M,K),b.strokeRect(Math.ceil(A)-.5,Math.ceil(I)-.5,M,K)}this._bIsPainted=!0},u.prototype.isPainted=function(){return this._bIsPainted},u.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},u.prototype.round=function(m){return m&&Math.floor(1e3*m)/1e3},u}();function Z(u,m){for(var b=1,g=function(M){var K=encodeURI(M).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return K.length+(K.length!=M?3:0)}(u),w=0,W=L.length;w<=W;w++){var R=0;switch(m){case n.L:R=L[w][0];break;case n.M:R=L[w][1];break;case n.Q:R=L[w][2];break;case n.H:R=L[w][3]}if(g<=R)break;b++}if(b>L.length)throw new Error("Too long data");return b}It=function(u,m){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},typeof m=="string"&&(m={text:m}),m)for(var b in m)this._htOption[b]=m[b];typeof u=="string"&&(u=document.getElementById(u)),this._htOption.useSVG&&(S=svgDrawer),this._el=u,this._oQRCode=null,this._oDrawing=new S(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},It.prototype.makeCode=function(u){this._oQRCode=new e(Z(u,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(u),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},It.prototype.clear=function(){this._oDrawing.clear()},It.prototype.getCanvas=function(){for(let u=0;u<this._el.children.length;u++){let m=this._el.children[u];if(m.tagName==="CANVAS")return m}return null},It.CorrectLevel=n})();var pr=It,fr={exports:{}},br,yr={exports:{}},Il=Tl(Object.freeze({__proto__:null,default:{}}));function Ze(){return br||(br=1,yr.exports=(s=s||function(e,t){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&kn!==void 0&&kn.crypto&&(n=kn.crypto),!n)try{n=Il}catch{}var i=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function y(){}return function(X){var L;return y.prototype=X,L=new y,y.prototype=null,L}}(),o={},a=o.lib={},c=a.Base={extend:function(y){var X=r(this);return y&&X.mixIn(y),X.hasOwnProperty("init")&&this.init!==X.init||(X.init=function(){X.$super.init.apply(this,arguments)}),X.init.prototype=X,X.$super=this,X},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var X in y)y.hasOwnProperty(X)&&(this[X]=y[X]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}},l=a.WordArray=c.extend({init:function(y,X){y=this.words=y||[],this.sigBytes=X!=t?X:4*y.length},toString:function(y){return(y||p).stringify(this)},concat:function(y){var X=this.words,L=y.words,S=this.sigBytes,Z=y.sigBytes;if(this.clamp(),S%4)for(var u=0;u<Z;u++){var m=L[u>>>2]>>>24-u%4*8&255;X[S+u>>>2]|=m<<24-(S+u)%4*8}else for(var b=0;b<Z;b+=4)X[S+b>>>2]=L[b>>>2];return this.sigBytes+=Z,this},clamp:function(){var y=this.words,X=this.sigBytes;y[X>>>2]&=4294967295<<32-X%4*8,y.length=e.ceil(X/4)},clone:function(){var y=c.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var X=[],L=0;L<y;L+=4)X.push(i());return new l.init(X,y)}}),d=o.enc={},p=d.Hex={stringify:function(y){for(var X=y.words,L=y.sigBytes,S=[],Z=0;Z<L;Z++){var u=X[Z>>>2]>>>24-Z%4*8&255;S.push((u>>>4).toString(16)),S.push((15&u).toString(16))}return S.join("")},parse:function(y){for(var X=y.length,L=[],S=0;S<X;S+=2)L[S>>>3]|=parseInt(y.substr(S,2),16)<<24-S%8*4;return new l.init(L,X/2)}},f=d.Latin1={stringify:function(y){for(var X=y.words,L=y.sigBytes,S=[],Z=0;Z<L;Z++){var u=X[Z>>>2]>>>24-Z%4*8&255;S.push(String.fromCharCode(u))}return S.join("")},parse:function(y){for(var X=y.length,L=[],S=0;S<X;S++)L[S>>>2]|=(255&y.charCodeAt(S))<<24-S%4*8;return new l.init(L,X)}},h=d.Utf8={stringify:function(y){try{return decodeURIComponent(escape(f.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return f.parse(unescape(encodeURIComponent(y)))}},v=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=h.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var X,L=this._data,S=L.words,Z=L.sigBytes,u=this.blockSize,m=Z/(4*u),b=(m=y?e.ceil(m):e.max((0|m)-this._minBufferSize,0))*u,g=e.min(4*b,Z);if(b){for(var w=0;w<b;w+=u)this._doProcessBlock(S,w);X=S.splice(0,b),L.sigBytes-=g}return new l.init(X,g)},clone:function(){var y=c.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0});a.Hasher=v.extend({cfg:c.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){return y&&this._append(y),this._doFinalize()},blockSize:16,_createHelper:function(y){return function(X,L){return new y.init(L).finalize(X)}},_createHmacHelper:function(y){return function(X,L){return new G.HMAC.init(y,L).finalize(X)}}});var G=o.algo={};return o}(Math),s)),yr.exports;var s}var gr,Pn,wr,Rl=(gr||(gr=1,fr.exports=(Pn=Ze(),function(){if(typeof ArrayBuffer=="function"){var s=Pn.lib.WordArray,e=s.init,t=s.init=function(n){if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),(n instanceof Int8Array||typeof Uint8ClampedArray<"u"&&n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array)&&(n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),n instanceof Uint8Array){for(var i=n.byteLength,r=[],o=0;o<i;o++)r[o>>>2]|=n[o]<<24-o%4*8;e.call(this,r,i)}else e.apply(this,arguments)};t.prototype=s}}(),Pn.lib.WordArray)),fr.exports),yt=Tt(Rl),Zr={exports:{}};function Ei(){return wr||(wr=1,Zr.exports=function(s){return function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=[],c=[];(function(){function p(G){for(var y=e.sqrt(G),X=2;X<=y;X++)if(!(G%X))return!1;return!0}function f(G){return 4294967296*(G-(0|G))|0}for(var h=2,v=0;v<64;)p(h)&&(v<8&&(a[v]=f(e.pow(h,.5))),c[v]=f(e.pow(h,1/3)),v++),h++})();var l=[],d=o.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(p,f){for(var h=this._hash.words,v=h[0],G=h[1],y=h[2],X=h[3],L=h[4],S=h[5],Z=h[6],u=h[7],m=0;m<64;m++){if(m<16)l[m]=0|p[f+m];else{var b=l[m-15],g=(b<<25|b>>>7)^(b<<14|b>>>18)^b>>>3,w=l[m-2],W=(w<<15|w>>>17)^(w<<13|w>>>19)^w>>>10;l[m]=g+l[m-7]+W+l[m-16]}var R=v&G^v&y^G&y,M=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),K=u+((L<<26|L>>>6)^(L<<21|L>>>11)^(L<<7|L>>>25))+(L&S^~L&Z)+c[m]+l[m];u=Z,Z=S,S=L,L=X+K|0,X=y,y=G,G=v,v=K+(M+R)|0}h[0]=h[0]+v|0,h[1]=h[1]+G|0,h[2]=h[2]+y|0,h[3]=h[3]+X|0,h[4]=h[4]+L|0,h[5]=h[5]+S|0,h[6]=h[6]+Z|0,h[7]=h[7]+u|0},_doFinalize:function(){var p=this._data,f=p.words,h=8*this._nDataBytes,v=8*p.sigBytes;return f[v>>>5]|=128<<24-v%32,f[14+(v+64>>>9<<4)]=e.floor(h/4294967296),f[15+(v+64>>>9<<4)]=h,p.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var p=r.clone.call(this);return p._hash=this._hash.clone(),p}});t.SHA256=r._createHelper(d),t.HmacSHA256=r._createHmacHelper(d)}(Math),s.SHA256}(Ze())),Zr.exports}var da=Tt(Ei()),Vl=Ln.CROQUET_PLATFORM==="node",ha;function ua(s){let e=s.sigBytes,t=s.words,n=new Uint8Array(e),i=0,r=0;for(;i<e;){let o=t[r++];if(n[i++]=(4278190080&o)>>>24,i===e||(n[i++]=(16711680&o)>>>16,i===e)||(n[i++]=(65280&o)>>>8,i===e))break;n[i++]=255&o}return n}function ma(s){function e(n){let i=n.indexOf("{"),r=n.lastIndexOf("}");if(i===-1||r===-1||r<i)return n;let o=n.slice(0,i).replace(/\s+/g," ").replace(/\s\(/,"("),a=n.slice(i+1,r);return`${o.trim()}{${a.trim()}}`}let t=e(""+s);if(!t.startsWith("class")){let n=s.prototype;n&&(t+=Object.getOwnPropertyNames(n).map(i=>`${i}:${e(""+n[i])}`).join(""))}return t}function pa(s){return btoa(String.fromCharCode(...new Uint8Array(s))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function vr(){return Y.has("debug","hashing",!1)}ha=globalThis.crypto&&globalThis.crypto.subtle&&typeof globalThis.crypto.subtle.digest=="function"?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(s,e)=>{if(s!=="SHA-256")throw Error(`${P.libName}: only SHA-256 available`);let t=yt.create(e);return ua(da(t)).buffer};var Re={},Ml=new TextEncoder;async function Yt(s){let e=Ml.encode(s),t=await async function(n){return n.length===0?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":pa(await ha("SHA-256",n))}(e);return Re[t]={string:s,buffer:e},t}var ji=[],Xr={},Lr=new Set,Yl=Date.now();typeof performance>"u"&&(window.performance={now:()=>Date.now()-Yl});var Hl=["simulate","update","render","snapshot"],on={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"},Ht,Rt,hn=null,le=null,B=null,In=0,Xe=null,Je=null;function Kl(s){for(hn=s;s.firstChild;)s.removeChild(s.firstChild);s.style.background="#faf0dc",Xe=document.createElement("canvas"),Je=Xe.getContext("2d"),Xe.id="text_stats",Xe.width=Math.min(140,window.innerWidth),Xe.height=36,Xe.style.width=Xe.width,Xe.style.height=Xe.height,Je.font="9.5pt sans-serif",s.appendChild(Xe),s.title=Object.entries(on).map(t=>{let[n,i]=t;return`${i}: ${n}`}).join(`
`),le=document.createElement("canvas"),le.width=Math.min(125,window.innerWidth),le.height=125,le.style.width="100%";let e=document.createElement("div");e.id="innerDiv",s.appendChild(e),e.appendChild(le),B=le.getContext("2d")}var Fe=[],xr=0,an=!1,$=fa(0),Ji=1e3/60;function Vt(s){return 20*(1-s/Ji)+60}function Nl(s){Ht=function(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.width="100%",t.style.position="absolute",t.style.left="0px",hn.querySelector("#innerDiv").appendChild(t),t}(s),Rt=Ht.getContext("2d"),Rt.strokeStyle="rgba(255, 255, 255, 0.5)";for(let e=0;e<60;e+=Ji){let t=Vt(e);Rt.moveTo(0,t),Rt.lineTo(Ht.width,t),Rt.stroke()}}function fa(s){return{start:s,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:an}}function zl(s){$.total=s-$.start;let e=Math.min(120,window.innerWidth);if(Fe.length>=e&&Fe.splice(0,Fe.length-e+1),Fe.push($),Fe.length<=1||!hn||hn.offsetHeight===0)return;let t=Fe.slice(1).filter(o=>o.total),n=t.map(o=>o.total).reduce((o,a)=>o+a,0)/t.length,i=Math.max(...t.map(o=>o.total));Math.max(...t.map(o=>Math.max(o.backlog,o.network))),xr=1e3,function(o,a){Je.globalCompositeOperation="copy",Je.fillStyle="rgb(255, 255, 255, 0)",Je.fillRect(0,0,Xe.width,Xe.height),Je.fillStyle="rgb(0, 0, 0, 1)",Je.globalCompositeOperation="source-over";let c=`${$.users} users, ${Math.round(1e3/o)} fps`;a>70&&(c+=` ${Math.ceil(a).toLocaleString()}ms`),Je.fillText(c,2,15),c=$.backlog<100&&$.activity<1e3?`latency: ${$.latency} ms`:`backlog: ${$.backlog<100?"0.0":($.backlog/1e3).toFixed(1)} s`,Je.fillText(c,2,33)}(n,i),Ht||Nl(le),In===le.width?(B.globalCompositeOperation="copy",B.drawImage(le,1,0,le.width-1,le.height,0,0,le.width-1,le.height),B.globalCompositeOperation="source-over",B.fillStyle="transparent",B.fillRect(le.width-1,0,1,le.height)):In++;let r=o=>Vt(o/xr*-2*Ji)+5;{let o=Fe[Fe.length-1],a=In-.5,c=Vt(0);B.beginPath(),B.moveTo(a,c),B.lineTo(a,Vt(o.total)),B.strokeStyle=on[o.connected?"total":"network"],B.stroke(),B.beginPath(),B.moveTo(a,c),c=Vt(o.total);let l=0;for(let d of Hl)o.items[d]&&(l+=o.items[d],c=Vt(l),B.lineTo(a,c),B.strokeStyle=on[d],B.stroke(),B.beginPath(),B.moveTo(a,c));o.network&&(B.beginPath(),B.moveTo(a,r(0)),B.lineTo(a,r(o.network)),B.strokeStyle=on.network,B.stroke())}}var kt=[],ut={},Pe={},_={frames:Fe,animationFrame(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};zl(s),$=fa(s);for(let[t,n]of Object.entries(e))this[t](n)},begin(s){let e=performance.now();$.items[s]=($.items[s]||0)-e;let t=kt[kt.length-1];return t&&($.items[t]+=e),kt.push(s),e},end(s){let e=performance.now();$.items[s]+=e;let t=kt.pop();if(t!==s)throw Error(`Unmatched stats calls: expected end("${t}"), got end("${s}")`);let n=kt[kt.length-1];return n&&($.items[n]-=e),e},backlog(s){$.backlog=Math.max(s,$.backlog)},starvation(s){$.network=s},latency(s){$.latency=s},activity(s){$.activity=s},users(s){$.users=s},connected(s){let e=an;$.connected=an=s,e&&!an&&Ht&&(Ht.remove(),Rt=null)},networkTraffic:ut,addNetworkTraffic(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];ut[s]=(ut[s]||0)+e,t&&(ut[`audit_${s}`]=(ut[`audit_${s}`]||0)+e)},resetAuditStats(){for(let s in ut)s.startsWith("audit_")&&(ut[s]=0)},perSecondTally(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(window.logMessageStats)for(let[e,t]of Object.entries(s))Pe[e]=(Pe[e]||0)+t},stepSession(s){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=Math.floor(Date.now()/1e3);if(!window.logMessageStats)return Pe={second:t},null;let n=null;if(t!==Pe.second){if(Pe.second&&e&&(Pe.requestedMessages||Pe.sentMessagesTotal)){n={...Pe};let i=t-Pe.second;i!==1&&(n.sampleSeconds=i),n.sentBundles&&(n.averageDelay=Math.round(10*n.sendDelay/n.sentMessagesTotal)/10,n.averageBundlePayload=Math.round(n.sentBundlePayload/n.sentBundles)),delete n.second,delete n.sendDelay,delete n.sentBundlePayload}Pe={second:t}}return n}};globalThis.CROQUETSTATS=_;var Nt="ontouchstart"in document.documentElement,ba=window&&window.parent!==window,yi=Nt?20:12,Sr=Nt?0:15,Gr=!1,Tr=!1,Oe,Wr=!1;function nt(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return s&&P.showMessage(s,{...e,level:"warning"})}function ya(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return s&&P.showMessage(s,{...e,level:"status"})}function ae(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"error";console.error(`Error during ${s}`,e);let n=(e.stack||"").split(`
`).filter(i=>!i.match(/croquet-.*\.min.js/)).join(`
`);P.showMessage(`Error during ${s}: ${e.message}

${n}`,{level:t,duration:t==="error"?1e4:void 0,stopOnFocus:!0})}try{if(Oe=window.localStorage,Oe["croquet-debug-persist-allowed"]="true",Oe["croquet-debug-persist-allowed"]!=="true")throw Error("localStorage not persisted");delete Oe["croquet-debug-persist-allowed"]}catch{console.warn("localStorage not allowed"),Oe={}}var ve={get pinned(){return Oe[window.location.pathname+"/croquet-debug-ui-pinned"]==="true"},set pinned(s){Oe[window.location.pathname+"/croquet-debug-ui-pinned"]=!!s},get activePage(){return Oe[window.location.pathname+"/croquet-debug-ui-activePage"]},set activePage(s){Oe[window.location.pathname+"/croquet-debug-ui-activePage"]=s}},et=s=>{s.preventDefault(),s.stopPropagation()};function Rn(s,e,t){let n=document.createElement("canvas"),i=n.width=40*yi/12,r=n.height=60,o=n.getContext("2d");o.font="36px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="black",o.fillText(s,i/2,.55*r);let a=document.createElement("button");a.id=e,a.className="croquet_dock_button";let c=l=>{l.preventDefault(),l.stopPropagation(),t()};return Nt?(a.ontouchstart=c,a.ontouchend=et,a.onpointerdown=et,a.onpointerup=et):(a.onclick=c,a.onpointerdown=et,a.onpointerup=et),a.appendChild(n),a}function _l(s,e){if(P.badge===!1)return;let t=function(c){let l=new dn(c),d=["bcdfghjklmnpqrstvwxyz","aeiou"],p="";for(let f=0;f<5;f++)p+=d[f%2][l.quick()*d[f%2].length|0];return p}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+t;s.firstChild;)s.removeChild(s.firstChild);let n=document.createElement("canvas"),i=n.width=120,r=n.height=40;n.style.width="100%",s.appendChild(n);let o=n.getContext("2d"),a=function(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=new dn(c),p=[];for(let f=0;f<l;f++)p.push(`hsl(${360*d.quick()}, 50%, 70%)`);return p}(e,2);o.fillStyle=a[0],o.beginPath(),o.moveTo(0,0),o.lineTo(0,r),o.lineTo(i,0),o.closePath(),o.fill(),o.fillStyle=a[1],o.beginPath(),o.moveTo(i,r),o.lineTo(i,0),o.lineTo(0,r),o.closePath(),o.fill(),o.font="30px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="black",o.fillText(t,i/2,r/2)}function ga(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(;s.firstChild;)s.removeChild(s.firstChild);return new pr(s,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:pr.CorrectLevel.L,...t})}function Cr(){if(P.root===!1||P.qrcode===!1||Y.noqr)return;let s=P.sessionURL;if(!s)return void console.warn("App.sessionURL is not set");let e=Mt(P.qrcode);e&&(Nt||(e.onclick=t=>{t.preventDefault(),t.stopPropagation(),t.shiftKey?function(){let n=document.getElementById("croquet_dock");n&&n.classList.toggle("debug")}():window.open(s)}),ga(e,s).getCanvas().style.width="100%")}var Ge,mt,zs=0;function Fl(){(function(){if(Tr)return;Tr=!0;let t=`
        ${ba?"body { min-height: 100vh }":""}
        #croquet_spinnerOverlay {
            z-index: 1000;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color:#333;
            opacity:0.9;
            display:flex;
            align-items:center;
            justify-content:center;
            transition: opacity 1.0s ease-out;
        }
        /* https://github.com/lukehaas/css-loaders */
        @keyframes croquet_dots {
            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }
            40% { box-shadow: 0 2.5em 0 0; }
        }
        #croquet_loader,
        #croquet_loader::before,
        #croquet_loader::after {
          border-radius: 50%;
          width: 2.5em;
          height: 2.5em;
          animation: croquet_dots 1.8s infinite ease-in-out;
        }
        #croquet_loader {
          color: #fff;
          font-size: 10px;
          margin: 80px auto;
          position: relative;
          text-indent: -9999em;
          animation-delay: -0.16s;
        }
        #croquet_loader::before,
        #croquet_loader::after {
          content: '';
          position: absolute;
          top: 0;
        }
        #croquet_loader::before { left: -3.5em; animation-delay: -0.32s; }
        #croquet_loader::after { left: 3.5em; }
        #croquet_spinnerOverlay.croquet_error>*,
        #croquet_spinnerOverlay.croquet_error>*::before,
        #croquet_spinnerOverlay.croquet_error>*::after {
            color: #f00;
        }
        #croquet_spinnerOverlay.croquet_fatal>*,
        #croquet_spinnerOverlay.croquet_fatal>*::before,
        #croquet_spinnerOverlay.croquet_fatal>*::after {
            color: #f00;
            box-shadow: 0 2.5em 0 0 !important;
            animation: none !important;
        }
`,n=document.createElement("style");n.innerHTML=t,document.head.insertBefore(n,document.head.querySelector("style,link[rel=stylesheet]"))})();let s=document.createElement("div");s.id="croquet_spinnerOverlay";let e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",s.appendChild(e),s}function Mt(s,e){if(s===!1)return!1;if(s instanceof Element)return s;if(typeof s=="string"){let t=document.getElementById(s);if(t)return t}return e?e():null}function kr(){let s=new Uint8Array(arguments.length>0&&arguments[0]!==void 0?arguments[0]:16);return window.crypto.getRandomValues(s),pa(s.buffer)}var Pr=new Set,Ir=function(){let s=null,e=document.getElementsByTagName("link");for(let t of e)if(t.getAttribute("rel")==="canonical"){s=t.getAttribute("href");break}return s||window.location.href}(),P={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},get sessionURL(){return Ir},set sessionURL(s){Ir=s,Cr()},root:null,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Y.nodock)return;let e=s.debug||Y.debug,t=document.getElementById("croquet_dock");t&&t.parentElement.removeChild(t);let n=Mt(P.root,()=>document.body);if(!n)return;(function(){if(Gr)return;Gr=!0;let G=`
        #croquet_dock { position: fixed; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 36px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all 0.3s ease; }
        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }
        #croquet_dock.debug { width: 84px; }
        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }

        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }
        #croquet_dock.active #croquet_badge { left: 2%; }
        #croquet_dock:not(.debug) #croquet_badge { display: none; }

        .croquet_dock_button { position: absolute; width: ${yi}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }
        .croquet_dock_button:focus { outline: 0; }
        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }
        #croquet_dock:not(.active) .croquet_dock_button { display: none; }
        #croquet_dock_left { right: ${2+Sr+yi+2}% }
        #croquet_dock:not(.debug) #croquet_dock_left { display: none; }
        #croquet_dock_right { right: ${2+Sr}%; }
        #croquet_dock:not(.debug) #croquet_dock_right { display: none; }
        #croquet_dock_pin { right: 2%; }
        #croquet_dock_pin.pinned { background: #cce6ff; }

        #croquet_dock_content { position: absolute; left: 2px; top: 2px; right: 2px; bottom: 2px; background: white; overflow: hidden; }
        #croquet_dock.debug:not(.active) #croquet_dock_content { display: none; }
        #croquet_dock.debug:not(.active) #croquet_dock_content div { display: none; }

        #croquet_qrcode { position: absolute; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }
        #croquet_dock.active #croquet_qrcode { border: 6px solid white; }
        #croquet_dock.debug #croquet_qrcode:not(.active) { display: none; }
        #croquet_qrcode canvas { image-rendering: pixelated; }

        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }
        #croquet_stats:not(.active) { display: none; }
`,y=document.createElement("style");y.innerHTML=G,document.head.insertBefore(y,document.head.querySelector("style,link[rel=stylesheet]"))})();let i=document.createElement("div");i.id="croquet_dock",e&&i.classList.add("debug"),ba&&s.iframe===!1&&(i.style.display="none"),n.appendChild(i);let r=document.createElement("div"),o;r.id="croquet_dock_bar",i.appendChild(r),s.badge!==!1&&(o=document.createElement("div"),o.id="croquet_badge",r.appendChild(o),P.badge=o);let a=document.createElement("div");a.id="croquet_dock_content",i.appendChild(a);let c=[],l,d;if(s.qrcode!==!1&&P.sessionURL&&(l=document.createElement("div"),l.id="croquet_qrcode",a.appendChild(l),c.push(l.id),P.qrcode=l,e||(ve.activePage=l.id)),s.stats!==!1&&(d=document.createElement("div"),d.id="croquet_stats",a.appendChild(d),c.push(d.id),P.stats=d),c.length){let G=function(y){let X=c.length,L,S=0;if(ve.activePage){let m=c.indexOf(ve.activePage);m>=0?(S=m,L=document.getElementById(ve.activePage)):ve.activePage=null}let Z=c[(S+X+y)%X],u;Z===ve.activePage?u=L:(L&&L.classList.remove("active"),u=document.getElementById(Z)),u&&u.classList.add("active"),ve.activePage=Z};c.length>1&&(r.appendChild(Rn("<","croquet_dock_left",()=>G(-1))),r.appendChild(Rn(">","croquet_dock_right",()=>G(1)))),G(0)}if(!Nt&&!s.alwaysPinned){let G=Rn("\u{1F4CC}","croquet_dock_pin",()=>{ve.pinned=!ve.pinned,y()}),y=()=>{ve.pinned?G.classList.add("pinned"):G.classList.remove("pinned")};y(),r.appendChild(G)}let p=G=>{i.style.width=`${G}px`;let y=1.18*G;i.style.height=`${y}px`;let X=18*G/100;r.style.height=`${X}px`,a.style.top=`${X+2}px`,o&&(o.style.height=.9*X+"px",o.style.width=.9*X*3+"px"),l&&(l.style.border=8*G/200+"px solid white")},f=s.fixedSize||200,h=()=>{i.classList.add("active"),p(f),setTimeout(()=>i.style.transition="none",300)},v=()=>{i.style.transition="",i.classList.remove("active"),i.style.width=i.style.height="",r.style.height="",a.style.top="",o&&(o.style.height=o.style.width=""),l&&(l.style.border="")};if(Nt)v(),i.ontouchstart=G=>{G.preventDefault(),G.stopPropagation(),i.classList.contains("active")?v():h()},i.ontouchend=et,i.onpointerdown=et,i.onpointerup=et;else if(s.alwaysPinned?h():(ve.pinned?h():v(),i.onmouseenter=h,i.onmouseleave=()=>{ve.pinned||v()}),!s.fixedSize){let G=0;i.addEventListener("wheel",y=>{y.stopPropagation();let X=Date.now();if(X-G<100)return;G=X;let{deltaY:L}=y;L=Math.sign(L)*Math.min(5,Math.abs(L));let S=.8*Math.min(window.innerWidth,window.innerHeight);f=Math.max(166,Math.min(S,i.offsetWidth/1.05**L)),p(f)},{passive:!0})}},makeSessionWidgets:function(s){(function(e){if(!e||P.root===!1)return;let t=Mt(P.badge);t&&_l(t,e)})(s),Cr(),function(){if(P.root===!1||Y.nostats)return;let e=Mt(P.stats);e&&Kl(e)}()},makeQRCanvas(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!P.sessionURL)return null;let e=ga(document.createElement("div"),P.sessionURL,s);return e&&e.getCanvas()},clearSessionMoniker:function(){P.badge!==!1&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(s){P.root===!1?s=!1:Ge||(Ge=Fl()),function(e){if(mt!==e&&(typeof mt!="string"||e!==!0))if(P.sync===!1&&(e=!1),mt=e,e)clearTimeout(zs),zs=setTimeout(()=>{mt&&(Mt(P.root,()=>document.body).appendChild(Ge),Ge.style.opacity=.9,Ge.className=mt==="error"?"croquet_error":mt==="fatal"?"croquet_fatal":"")},500);else{if(!Ge)return;clearTimeout(zs),Ge.style.opacity=0,Ge.className="",zs=setTimeout(()=>{mt||Ge.parentElement&&Ge.parentElement.removeChild(Ge)},500)}}(s)},messageFunction:function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.level,n;return t==="error"?(n="orangered,red",console.error(s)):t==="warning"?(n="gold,orange",console.warn(s)):n="silver,gray",function(i,r){let o=Mt(P.root,()=>document.body);if(o===!1)return null;(function(){if(Wr)return;Wr=!0;let l=`/*!
        * Toastify js 1.5.0
        * https://github.com/apvarun/toastify-js
        * @license MIT licensed
        *
        * Copyright (C) 2018 Varun A P
        */
        .toastify {
            padding: 12px 20px;
            color: #ffffff;
            display: inline-block;
            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);
            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);
            background: linear-gradient(135deg, #73a5ff, #5477f5);
            position: fixed;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            border-radius: 2px;
            cursor: pointer;
            text-decoration: none;
            max-width: calc(50% - 20px);
            z-index: 2147483647;
        }
        .toastify.on {
            opacity: 1;
        }
        .toast-close {
            opacity: 0.4;
            padding: 0 5px;
        }
        .toastify-right {
            right: 15px;
        }
        .toastify-left {
            left: 15px;
        }
        .toastify-top {
            top: -150px;
        }
        .toastify-bottom {
            bottom: -150px;
        }
        .toastify-rounded {
            border-radius: 25px;
        }
        .toastify-avatar {
            width: 1.5em;
            height: 1.5em;
            margin: 0 5px;
            border-radius: 2px;
        }
        @media only screen and (max-width: 360px) {
            .toastify-right, .toastify-left {
                margin-left: auto;
                margin-right: auto;
                left: 0;
                right: 0;
                max-width: fit-content;
            }
        }
`;l+=`
        .toastify {
            font-family: sans-serif;
            border-radius: 8px;
        }

        .toastify-center {
            margin-left: auto;
            margin-right: auto;
            left: 0;
            right: 0;
            max-width: fit-content;
            max-width: -moz-fit-content;
        }
`;let d=document.createElement("style");d.innerHTML=`/*!
        * Toastify js 1.5.0
        * https://github.com/apvarun/toastify-js
        * @license MIT licensed
        *
        * Copyright (C) 2018 Varun A P
        */
        .toastify {
            padding: 12px 20px;
            color: #ffffff;
            display: inline-block;
            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);
            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);
            background: linear-gradient(135deg, #73a5ff, #5477f5);
            position: fixed;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            border-radius: 2px;
            cursor: pointer;
            text-decoration: none;
            max-width: calc(50% - 20px);
            z-index: 2147483647;
        }
        .toastify.on {
            opacity: 1;
        }
        .toast-close {
            opacity: 0.4;
            padding: 0 5px;
        }
        .toastify-right {
            right: 15px;
        }
        .toastify-left {
            left: 15px;
        }
        .toastify-top {
            top: -150px;
        }
        .toastify-bottom {
            bottom: -150px;
        }
        .toastify-rounded {
            border-radius: 25px;
        }
        .toastify-avatar {
            width: 1.5em;
            height: 1.5em;
            margin: 0 5px;
            border-radius: 2px;
        }
        @media only screen and (max-width: 360px) {
            .toastify-right, .toastify-left {
                margin-left: auto;
                margin-right: auto;
                left: 0;
                right: 0;
                max-width: fit-content;
            }
        }

        .toastify {
            font-family: sans-serif;
            border-radius: 8px;
        }

        .toastify-center {
            margin-left: auto;
            margin-right: auto;
            left: 0;
            right: 0;
            max-width: fit-content;
            max-width: -moz-fit-content;
        }
`,document.head.insertBefore(d,document.head.querySelector("style,link[rel=stylesheet]"))})();let a={text:i,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,...r},c;return o instanceof Element&&o!==document.body?(c=o.id,c||(o.id=c="_croquetToastParent")):typeof o=="string"&&(c=o),c&&(a.selector=c),Sl(a).showToast()}(s,{style:{background:`linear-gradient(90deg,${n})`},...e})},showMessage(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.only==="once"){if(Pr.has(s))return null;Pr.add(s)}return e.level==="fatal"&&(e.level="error",e.showSyncWait="fatal"),e.showSyncWait&&(e.showSyncWait!=="fatal"||e.duration||(e.duration=-1),P.showSyncWait(e.showSyncWait)),Y.nomessages||P.root===!1||P.messages===!1||!P.messageFunction?(e.level==="warning"&&console.warn(s),e.level==="error"&&console.error(s),null):P.messageFunction(s,e)},isCroquetHost:s=>s.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(s)||s.endsWith("ngrok.io"),referrerURL(){let s=new URL(P.sessionURL),e=this.isCroquetHost(s.hostname);return`${s.protocol}//${s.host}${s.pathname}${e?s.search:""}`},autoSession(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{key:"q",force:!1,default:"",keyless:!1};typeof s=="string"&&(s={key:s}),s||(s={});let e=s.key||"q",t=new URL(P.sessionURL),n="";if(!s.force){let r=t.search.slice(1).split("&"),o=r.find(a=>a.split("=")[0]===e);o?n=o.replace(/[^=]*=/,""):s.keyless&&(n=r.find(a=>!a.includes("=")),n||(n=t.hash.slice(1),n&&(t.hash="",t.search?t.searchParams.set(e,n):t.search=n)))}if(n)try{n=decodeURIComponent(n)}catch{}else n=s.default?s.default:this.randomSession(),t.searchParams.set(e,n);if(P.sessionURL=t.href,window.location.href!==t.href)try{window.history.replaceState({},"",t.href)}catch(r){P.showMessage(`Setting address bar to ${t.href}`,{only:"once"}),P.showMessage(`Failed to change address bar: ${r.message}`,{level:"warning",only:"once"})}Y.has("debug","session")&&console.log(`${P.libName}.App.autoSession: "${n}"`);let i=Promise.resolve(n);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${P.libName}.App.autoSession() return value used directly. It returns a promise now!`),n),i},autoPassword(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{key:"pw",default:"",force:!1,scrub:!1,keyless:!1};typeof s=="string"&&(s={key:s});let e=s.key||"pw",t=s.scrub&&!Y.has("debug","password"),n=s.keyless,i=new URL(P.sessionURL),r="",o=s.force?"":i.hash.slice(1);if(o){let c=o.split("&"),l=c.find(d=>d.split("=")[0]===e);l?(r=l.replace(/[^=]*=/,""),r&&t&&(i.hash=c.filter(d=>d.split("=")[0]!==e).join("&"))):n&&(r=c.find(d=>!d.includes("=")),r&&t&&(i.hash=c.filter(d=>d!==r).join("&")))}if(r||(r=s.default?s.default:this.randomPassword(),i.hash=o?`${o}&${e}=${r}`:n?r:`${e}=${r}`,P.sessionURL=i.href,t&&(i.hash=n?"":o)),Y.has("debug","session")&&console.log(`${P.libName}.App.sessionUrl: ${P.sessionURL}`),window.location.href!==i.href)try{window.history.replaceState({},"",i.href)}catch(c){P.showMessage(`Setting address bar to ${i.href}`,{only:"once"}),P.showMessage(`Failed to change address bar: ${c.message}`,{level:"warning",only:"once"})}if(r)try{r=decodeURIComponent(r)}catch{}Y.has("debug","session")&&console.log(`${P.libName}.App.autoPassword: "${r}"`);let a=Promise.resolve(r);return a[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${P.libName}.App.autoPassword() return value used directly. It returns a promise now!`),r),a},randomSession(){return kr(arguments.length>0&&arguments[0]!==void 0?arguments[0]:10)},randomPassword(){return kr(arguments.length>0&&arguments[0]!==void 0?arguments[0]:16)}},Vn="#__vote";function Rr(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n="none";for(let i of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(let r of s[i])r.for===e?t===null||r.unbound===t?s[i].delete(r):n="subscriber":n==="none"&&(n="others");return n}var oe=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(s){return"V"+ ++this.subscriberIds}deregister(s){}addSubscription(s,e,t,n,i){if(s.includes(":"))throw Error(`Invalid subscription scope "${s}" (must not contain ':')`);if(i==="vote")return void this.addSubscription(s,e+Vn,t,n,"immediate");s!=="*"&&e!=="*"||(this.genericSubscriptions=!0);let r=s+":"+e,o=n;o.for=t;let a=this.subscriptions[r];if(a||(a=this.subscriptions[r]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(o);let c=this.subscribers.get(t);c||this.subscribers.set(t,c=new Set),c.add(r)}removeSubscription(s,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=s+":"+e,r=this.subscriptions[i];if(r){let o=Rr(r,t,n);if(o==="none"&&delete this.subscriptions[i],o!=="subscriber"){let a=this.subscribers.get(t);a&&(a.delete(i),a.size===0&&this.subscribers.delete(t))}}e.endsWith(Vn)||this.removeSubscription(s,e+Vn,t)}removeAllSubscriptionsFor(s){let e=this.subscribers.get(s);if(e){for(let t of e){let n=this.subscriptions[t];n?Rr(n,s)==="none"&&delete this.subscriptions[t]:console.error(`${P.libName}: topic ${t} not found in subscriptions table for ${s} during removeAllSubscriptionsFor()`)}this.subscribers.delete(s)}}subscriptionsFor(s){let e=this.subscriptions[s];if(!e&&!this.genericSubscriptions)return null;let t=[],n=!!e;if(this.genericSubscriptions){let[i,r]=s.split(":");if(!(i.startsWith("__")&&i.endsWith("__")||r.startsWith("__")&&r.endsWith("__")))for(let a of["*:*",i+":*","*:"+r]){let c=this.subscriptions[a];c&&(t.push([c,a]),!n&&this.hasUserSubcription(c)&&(n=!0))}let o=!n;if(o)for(let a of t)a.push(o)}return e&&t.push([e,s]),t.length===0?null:t}hasUserSubcription(s){for(let e of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(let t of s[e])if(!t.unbound.__CROQUET__)return!0;return!1}handleEvent(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=this.subscriptionsFor(s);if(!n)return;let i=!!t,r=0,o=0,a=0;for(let[c,l,d]of n)r+=c.queued.size,o+=c.oncePerFrame.size,a+=c.oncePerFrameWhileSynced.size,c.immediate.size>0&&(t||(t=p=>p()),t(()=>{for(let p of c.immediate){let f=this.currentEvent,h=this.currentEventFromModel,v=this.currentEventOnlyGeneric;this.currentEvent=s,this.currentEventFromModel=i,this.currentEventOnlyGeneric=d;try{p(e)}catch(G){console.error(G),console.warn(`${P.libName}: error "${G.message}" in "immediate" subscription ${l}`)}this.currentEvent=f,this.currentEventFromModel=h,this.currentEventOnlyGeneric=v}}));r>0&&this.queuedEvents.push({topic:s,data:e,fromModel:i}),o>0&&this.perFrameEvents.set(s,{data:e,fromModel:i}),a>0&&this.perSyncedFrameEvents.set(s,{data:e,fromModel:i})}processFrameEvents(s,e){let t=0,n=(i,r,o,a)=>{let c=this.subscriptionsFor(r);if(!c)return;let l=this.currentEvent,d=this.currentEventFromModel;this.currentEvent=r,this.currentEventFromModel=a;for(let[p,f,h]of c){let v=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=h;for(let G of p[i]){try{G(o)}catch(y){console.error(y),console.warn(`${P.libName}: error "${y.message}" in "${i}" subscription ${r}`)}t++}this.currentEventOnlyGeneric=v}this.currentEvent=l,this.currentEventFromModel=d};for(let{topic:i,data:r,fromModel:o}of this.queuedEvents)n("queued",i,r,o);if(this.queuedEvents.length=0,s){for(let[i,{data:r,fromModel:o}]of this.perFrameEvents)n("oncePerFrame",i,r,o);if(this.perFrameEvents.clear(),e){for(let[i,{data:r,fromModel:o}]of this.perSyncedFrameEvents)n("oncePerFrameWhileSynced",i,r,o);this.perSyncedFrameEvents.clear()}for(let{topic:i,data:r,fromModel:o}of this.queuedEvents)n("queued",i,r,o);this.queuedEvents.length=0}return t}},it={get subscribe(){return it={subscribe:Y.has("debug","subscribe",!1)},it.subscribe}},gi=class s{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,n){this.vm.publishFromModel(n,e,t)}subscribe(e,t,n,i){return it.subscribe&&console.log(`Model.subscribe("${t}:${n}", ${e} ${(""+i).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(e,t,n,i)}unsubscribe(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*";it.subscribe&&console.log(`Model.unsubscribe(${t}:${n}", ${e} ${(""+i).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(e,t,n,i)}unsubscribeAll(e){it.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,n,i){if(we&&we.equal(this))return this.vm.future(e,t,n,i);throw Error(`Model.future() called from outside: ${e}`)}cancelFuture(e,t){if(we&&we.equal(this))return this.vm.cancelFuture(e,t);throw Error(`Model.cancelFuture() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof s&&e.vm===this.vm}isViewRealm(){return!1}},wi=class s{constructor(e){this.vd=oe,this.vm=e,this.controller=e.controller}valid(){return this.vm===this.controller.vm}register(e){return oe.register(e)}deregister(e){oe.deregister(e)}publish(e,t,n){this.vm.publishFromView(n,e,t)}subscribe(e,t,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"queued";it.subscribe&&console.log(`View[${t}].subscribe("${i}:${e}" ${n?n.name||(""+n).replace(/\([\s\S]*/,""):""+n} [${r}])`),oe.addSubscription(i,e,t,n,r)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0;it.subscribe&&console.log(`View[${t}].unsubscribe("${i}:${e}" ${n?n.name||(""+n).replace(/\([\s\S]*/,""):"*"})`),oe.removeSubscription(i,e,t,n)}unsubscribeAll(e){it.subscribe&&console.log(`View[${e}].unsubscribeAll()`),oe.removeAllSubscriptionsFor(e)}future(e,t){let n=this.vm;return new Proxy(e,{get(i,r){if(typeof e[r]=="function")return new Proxy(e[r],{apply(o,a,c){setTimeout(()=>{e.id&&xs(n,()=>e[r](...c),!0)},t)}});throw Error("Tried to call "+r+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(e){return e instanceof s&&e.vm===this.vm}isViewRealm(){return!0}},we=null;function Ue(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Tried to execute code that requires realm outside of realm.";if(!we&&s)throw Error(s);return we}function wa(s,e){if(we!==null)throw Error("Can't switch realms from inside realm");try{return we=new gi(s),e()}finally{we=null}}function xs(s,e){if(we!==null&&!(arguments.length>2&&arguments[2]!==void 0&&arguments[2]))throw Error("Can't switch realms from inside realm");let t=we;try{return we=new wi(s),e()}finally{we=t}}var ne=function(s){return s!=s},zt=Math.sqrt,Ss=.7853981633974483,El=function(s){var e,t;return s===0?.16666666666666713:((s<0?-s:s)<=1?(e=s*(19.562619833175948+s*(s*(5.444622390564711+s*(.004253011369004428*s-.6019598008014124))-16.262479672107002))-8.198089802484825,t=s*(139.51056146574857+s*(s*(70.49610280856842+s*(1*s-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(s=1/s)*(s*(5.444622390564711+s*(s*(19.562619833175948+-8.198089802484825*s)-16.262479672107002))-.6019598008014124),t=1+s*(s*(70.49610280856842+s*(s*(139.51056146574857+-49.18853881490881*s)-147.1791292232726))-14.740913729888538)),e/t)},jl=function(s){var e,t;return s===0?.08333333333333809:((s<0?-s:s)<=1?(e=28.536655482610616+s*(s*(6.968710824104713+s*(.002967721961301243*s-.5634242780008963))-25.56901049652825),t=342.43986579130785+s*(s*(147.0656354026815+s*(1*s-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(s=1/s)*(s*(6.968710824104713+s*(28.536655482610616*s-25.56901049652825))-.5634242780008963),t=1+s*(s*(147.0656354026815+s*(342.43986579130785*s-383.8770957603691))-21.947795316429207)),e/t)},Zi=function(s){var e,t,n,i,r;if(ne(s))return NaN;if(s>0?n=s:(e=!0,n=-s),n>1)return NaN;if(n>.625)i=(t=1-n)*jl(t),t=zt(t+t),r=Ss-t,r-=t=t*i-6123233995736766e-32,r+=Ss;else{if(n<1e-8)return s;r=n*(r=(t=n*n)*El(t))+n}return e?-r:r},Jl=function(s){var e;return ne(s)||s<-1||s>1?NaN:s>.5?2*Zi(zt(.5-.5*s)):(e=Ss-Zi(s),e+=6123233995736766e-32,e+=Ss)},Ql=function(){return typeof Symbol=="function"&&typeof Symbol("foo")=="symbol"}(),Ul=function(){return Ql&&typeof Symbol.toStringTag=="symbol"},ln=Object.prototype.toString,Dl=function(s){return ln.call(s)},Ol=Object.prototype.hasOwnProperty,Bl=function(s,e){return s!=null&&Ol.call(s,e)},Bt=typeof Symbol=="function"?Symbol.toStringTag:"",Al=function(s){var e,t,n;if(s==null)return ln.call(s);t=s[Bt],e=Bl(s,Bt);try{s[Bt]=void 0}catch{return ln.call(s)}return n=ln.call(s),e?s[Bt]=t:delete s[Bt],n},xn=Ul()?Al:Dl,$l=typeof Uint32Array=="function",ql=function(s){return $l&&s instanceof Uint32Array||xn(s)==="[object Uint32Array]"},Mn=4294967295,Vr=typeof Uint32Array=="function"?Uint32Array:null,ec=function(){var s,e;if(typeof Vr!="function")return!1;try{e=new Vr(e=[1,3.14,-3.14,Mn+1,Mn+2]),s=ql(e)&&e[0]===1&&e[1]===3&&e[2]===Mn-2&&e[3]===0&&e[4]===1}catch{s=!1}return s},tc=typeof Uint32Array=="function"?Uint32Array:null,sc=function(){throw new Error("not implemented")},Jt=ec()?tc:sc,nc=typeof Float64Array=="function",ic=function(s){return nc&&s instanceof Float64Array||xn(s)==="[object Float64Array]"},Mr=typeof Float64Array=="function"?Float64Array:null,rc=function(){var s,e;if(typeof Mr!="function")return!1;try{e=new Mr([1,3.14,-3.14,NaN]),s=ic(e)&&e[0]===1&&e[1]===3.14&&e[2]===-3.14&&e[3]!=e[3]}catch{s=!1}return s},oc=typeof Float64Array=="function"?Float64Array:null,ac=function(){throw new Error("not implemented")},Qt=rc()?oc:ac,lc=typeof Uint8Array=="function",cc=function(s){return lc&&s instanceof Uint8Array||xn(s)==="[object Uint8Array]"},Yr=typeof Uint8Array=="function"?Uint8Array:null,dc=function(){var s,e;if(typeof Yr!="function")return!1;try{e=new Yr(e=[1,3.14,-3.14,256,257]),s=cc(e)&&e[0]===1&&e[1]===3&&e[2]===253&&e[3]===0&&e[4]===1}catch{s=!1}return s},hc=typeof Uint8Array=="function"?Uint8Array:null,uc=function(){throw new Error("not implemented")},mc=dc()?hc:uc,pc=typeof Uint16Array=="function",fc=function(s){return pc&&s instanceof Uint16Array||xn(s)==="[object Uint16Array]"},Hr=typeof Uint16Array=="function"?Uint16Array:null,bc=function(){var s,e;if(typeof Hr!="function")return!1;try{e=new Hr(e=[1,3.14,-3.14,65536,65537]),s=fc(e)&&e[0]===1&&e[1]===3&&e[2]===65533&&e[3]===0&&e[4]===1}catch{s=!1}return s},yc=typeof Uint16Array=="function"?Uint16Array:null,Za,gc=function(){throw new Error("not implemented")},va={uint16:bc()?yc:gc,uint8:mc};(Za=new va.uint16(1))[0]=4660;var Ut=new va.uint8(Za.buffer)[0]===52,wc=Ut===!0?1:0,Xa=new Qt(1),Zc=new Jt(Xa.buffer),U=function(s){return Xa[0]=s,Zc[wc]},vc=Ut===!0?1:0,vi=new Qt(1),Xc=new Jt(vi.buffer),Lc=function(s,e){return vi[0]=s,Xc[vc]=e>>>0,vi[0]},Me=Lc,Ce=Number.POSITIVE_INFINITY,ke=Number.NEGATIVE_INFINITY,dt=1023,xc=function(s){return s===0?.6666666666666735:.6666666666666735+s*(.3999999999940942+s*(.2857142874366239+s*(.22222198432149784+s*(.1818357216161805+s*(.15313837699209373+.14798198605116586*s)))))},Yn=.6931471803691238,Hn=19082149292705877e-26,Gs=function(s){var e,t,n,i,r,o,a,c,l,d;if(s<-1||ne(s))return NaN;if(s===-1)return ke;if(s===Ce||s===0)return s;if(d=1,(n=s<0?-s:s)<.41421356237309503){if(n<1862645149230957e-24)return n<5551115123125783e-32?s:s-s*s*.5;s>-.2928932188134525&&(d=0,i=s,t=1)}return d!==0&&(n<9007199254740992?(r=(d=((t=U(l=1+s))>>20)-dt)>0?1-(l-s):s-(l-1),r/=l):(d=((t=U(l=s))>>20)-dt,r=0),(t&=1048575)<434334?l=Me(l,1072693248|t):(d+=1,l=Me(l,1071644672|t),t=1048576-t>>2),i=l-1),e=.5*i*i,t===0?i===0?d*Yn+(r+=d*Hn):d*Yn-((c=e*(1-.6666666666666666*i))-(d*Hn+r)-i):(c=(a=(o=i/(2+i))*o)*xc(a),d===0?i-(e-o*(e+c)):d*Yn-(e-(o*(e+c)+(d*Hn+r))-i))},Sn=.6931471805599453,Sc=function(s){return s===0?.3999999999940942:.3999999999940942+s*(.22222198432149784+.15313837699209373*s)},Gc=function(s){return s===0?.6666666666666735:.6666666666666735+s*(.2857142874366239+s*(.1818357216161805+.14798198605116586*s))},_s=.6931471803691238,Fs=19082149292705877e-26,Kr=1048575,Ts=function(s){var e,t,n,i,r,o,a,c,l,d,p;return s===0?ke:ne(s)||s<0?NaN:(i=0,(t=U(s))<1048576&&(i-=54,t=U(s*=0x40000000000000)),t>=2146435072?s+s:(i+=(t>>20)-dt|0,i+=(a=(t&=Kr)+614244&1048576)>>20,o=(s=Me(s,t|1072693248^a))-1,(Kr&2+t)<3?o===0?i===0?0:i*_s+i*Fs:(r=o*o*(.5-.3333333333333333*o),i===0?o-r:i*_s-(r-i*Fs-o)):(a=t-398458|0,c=440401-t|0,n=(d=(p=(l=o/(2+o))*l)*p)*Sc(d),r=p*Gc(d)+n,(a|=c)>0?(e=.5*o*o,i===0?o-(e-l*(e+r)):i*_s-(e-(l*(e+r)+i*Fs)-o)):i===0?o-l*(o-r):i*_s-(l*(o-r)-i*Fs-o))))},Tc=function(s){var e;return ne(s)||s<1?NaN:s===1?0:s>=268435456?Ts(s)+Sn:s>2?Ts(2*s-1/(s+zt(s*s-1))):Gs((e=s-1)+zt(2*e+e*e))},st=function(s){return s===Ce||s===ke},Wc=1/(1<<28),Cc=function(s){var e,t,n;return ne(s)||st(s)?s:(s<0&&(s=-s,e=!0),n=s<Wc?s:s>268435456?Ts(s)+Sn:s>2?Ts(2*s+1/(zt(s*s+1)+s)):Gs(s+(t=s*s)/(1+zt(1+t))),e?-n:n)},Nr=1.5707963267948966,kc=function(s){return s===0?-64.85021904942025:s*(s*(s*(-.8750608600031904*s-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025},Pc=function(s){return s===0?194.5506571482614:194.5506571482614+s*(485.3903996359137+s*(432.88106049129027+s*(165.02700983169885+s*(24.858464901423062+1*s))))},zr=6123233995736766e-32,La=function(s){var e,t,n,i;return ne(s)||s===0?s:s===Ce?Nr:s===ke?-1.5707963267948966:(s<0&&(t=!0,s=-s),e=0,s>2.414213562373095?(n=Nr,e=1,s=-1/s):s<=.66?n=0:(n=Ss,e=2,s=(s-1)/(s+1)),i=s*(i=(i=s*s)*kc(i)/Pc(i))+s,e===2?i+=.5*zr:e===1&&(i+=zr),n+=i,t?-n:n)},Ic=1/(1<<28),Xi,Li,Rc=function(s){var e,t;return ne(s)||s<-1||s>1?NaN:s===1?Ce:s===-1?ke:(s<0&&(e=!0,s=-s),s<Ic?e?-s:s:(t=s<.5?.5*Gs((t=s+s)+t*s/(1-s)):.5*Gs((s+s)/(1-s)),e?-t:t))};Ut===!0?(Xi=1,Li=0):(Xi=0,Li=1);var xa={HIGH:Xi,LOW:Li},Sa=new Qt(1),_r=new Jt(Sa.buffer),Vc=xa.HIGH,Mc=xa.LOW,Fr=function(s,e){return Sa[0]=e,s[0]=_r[Vc],s[1]=_r[Mc],s},xi,Si,Qi=function(s,e){return arguments.length===1?Fr([0,0],s):Fr(s,e)};Ut===!0?(xi=1,Si=0):(xi=0,Si=1);var Ga={HIGH:xi,LOW:Si},Ta=new Qt(1),Er=new Jt(Ta.buffer),Yc=Ga.HIGH,Hc=Ga.LOW,Kc=function(s,e){return Er[Yc]=s,Er[Hc]=e,Ta[0]},Ws=Kc,Kn=[0,0],Ee=function(s,e){var t,n;return Qi(Kn,s),t=Kn[0],t&=2147483647,n=U(e),Ws(t|=n&=2147483648,Kn[1])},Nc=function(s){return!!(U(s)>>>31)},Be=3.141592653589793,zc=function(s,e){var t;return ne(e)||ne(s)?NaN:st(e)?e===Ce?st(s)?Ee(Be/4,s):Ee(0,s):st(s)?Ee(3*Be/4,s):Ee(Be,s):st(s)?Ee(Be/2,s):s===0?e>=0&&!Nc(e)?Ee(0,s):Ee(Be,s):e===0?Ee(Be/2,s):(t=La(s/e),e<0?t<=0?t+Be:t-Be:t)},Wa=22250738585072014e-324,_c=function(s){return s===0?1.87595182427177:1.87595182427177+s*(s*(1.6214297201053545+s*(.14599619288661245*s-.758397934778766))-1.8849797954337717)},jr=2147483647,Fc=function(s){var e,t,n,i,r;return ne(s)||st(s)||s===0?s:(t=-2147483648&(n=U(s)),n&=jr,r=0,s<Wa?(r=0x40000000000000,e=U(r*=s),r=Ws(t|(e=(e&jr)/3+696219795),0)):r=Me(r,t|(e=n/3+715094163)),r*=_c(i=r*r*(r/s)),e=U(r),r=Ws(e+1,0),r+=r*(i=((i=s/(r*r))-r)/(r+r+i)))},Ec=Fc,jc=function(s){return s===0?.0416666666666666:.0416666666666666+s*(2480158728947673e-20*s-.001388888888887411)},Jc=function(s){return s===0?-27557314351390663e-23:s*(2087572321298175e-24+-11359647557788195e-27*s)-27557314351390663e-23},cs=function(s,e){var t,n,i,r;return i=(r=s*s)*r,n=r*jc(r),n+=i*i*Jc(r),(i=1-(t=.5*r))+(1-i-t+(r*n-s*e))},Jr=-.16666666666666632,ds=function(s,e){var t,n,i;return t=.00833333333332249+(i=s*s)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(158969099521155e-24*i-25050760253406863e-24),n=i*s,e===0?s+n*(Jr+i*t):s-(i*(.5*e-n*t)-e-n*Jr)},Qc=Ut===!0?0:1,Ca=new Qt(1),Uc=new Jt(Ca.buffer),Dc=function(s){return Ca[0]=s,Uc[Qc]},ka=Math.floor,Ui=function(s){return s<0?-s:s===0?0:s},Qr=function(s,e){return ne(e)||st(e)?(s[0]=e,s[1]=0,s):e!==0&&Ui(e)<Wa?(s[0]=4503599627370496*e,s[1]=-52,s):(s[0]=e,s[1]=0,s)},Oc=function(s,e){return arguments.length===1?Qr([0,0],s):Qr(s,e)},Bc=function(s){var e=U(s);return(e=(2146435072&e)>>>20)-dt|0},Ac=Bc,Nn=[0,0],zn=[0,0],$c=function(s,e){var t,n;return s===0||ne(s)||st(s)?s:(Oc(Nn,s),e+=Nn[1],(e+=Ac(s=Nn[0]))<-1074?Ee(0,s):e>1023?s<0?ke:Ce:(e<=-1023?(e+=52,n=2220446049250313e-31):n=1,Qi(zn,s),t=zn[0],t&=2148532223,n*Ws(t|=e+dt<<20,zn[1])))},os=$c,Pa=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],qc=[1.570796251296997,7549789415861596e-23,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],_n=16777216,Fn=5960464477539063e-23,En=Gn(new Array(20)),Ur=Gn(new Array(20)),Es=Gn(new Array(20)),ie=Gn(new Array(20));function Gn(s){var e,t=s.length;for(e=0;e<t;e++)s[e]=0;return s}function Ia(s,e,t,n,i,r,o,a,c){var l,d,p,f,h,v,G,y,X;for(f=r,X=n[t],y=t,h=0;y>0;h++)d=Fn*X|0,ie[h]=X-_n*d|0,X=n[y-1]+d,y-=1;if(X=os(X,i),X-=8*ka(.125*X),X-=G=0|X,p=0,i>0?(G+=h=ie[t-1]>>24-i,ie[t-1]-=h<<24-i,p=ie[t-1]>>23-i):i===0?p=ie[t-1]>>23:X>=.5&&(p=2),p>0){for(G+=1,l=0,h=0;h<t;h++)y=ie[h],l===0?y!==0&&(l=1,ie[h]=16777216-y):ie[h]=16777215-y;if(i>0)switch(i){case 1:ie[t-1]&=8388607;break;case 2:ie[t-1]&=4194303}p===2&&(X=1-X,l!==0&&(X-=os(1,i)))}if(X===0){for(y=0,h=t-1;h>=r;h--)y|=ie[h];if(y===0){for(v=1;ie[r-v]===0;v++);for(h=t+1;h<=t+v;h++){for(c[a+h]=Pa[o+h],d=0,y=0;y<=a;y++)d+=s[y]*c[a+(h-y)];n[h]=d}return Ia(s,e,t+=v,n,i,r,o,a,c)}}if(X===0)for(t-=1,i-=24;ie[t]===0;)t-=1,i-=24;else(X=os(X,-i))>=_n?(d=Fn*X|0,ie[t]=X-_n*d|0,i+=24,ie[t+=1]=d):ie[t]=0|X;for(d=os(1,i),h=t;h>=0;h--)n[h]=d*ie[h],d*=Fn;for(h=t;h>=0;h--){for(d=0,v=0;v<=f&&v<=t-h;v++)d+=qc[v]*n[h+v];Es[t-h]=d}for(d=0,h=t;h>=0;h--)d+=Es[h];for(e[0]=p===0?d:-d,d=Es[0]-d,h=1;h<=t;h++)d+=Es[h];return e[1]=p===0?d:-d,7&G}var ed=function(s,e,t,n){var i,r,o,a,c,l,d;for((r=(t-3)/24|0)<0&&(r=0),a=t-24*(r+1),l=r-(o=n-1),d=o+4,c=0;c<=d;c++)En[c]=l<0?0:Pa[l],l+=1;for(c=0;c<=4;c++){for(i=0,l=0;l<=o;l++)i+=s[l]*En[o+(c-l)];Ur[c]=i}return Ia(s,e,4,Ur,a,4,r,o,En)},td=Math.round,js=function(s,e,t){var n,i,r,o,a;return r=s-1.5707963267341256*(n=td(.6366197723675814*s)),o=6077100506506192e-26*n,a=e>>20,t[0]=r-o,a-(U(t[0])>>20&2047)>16&&(o=20222662487959506e-37*n-((i=r)-(r=i-(o=6077100506303966e-26*n))-o),t[0]=r-o,a-(U(t[0])>>20&2047)>49&&(o=84784276603689e-45*n-((i=r)-(r=i-(o=20222662487111665e-37*n))-o),t[0]=r-o)),t[1]=r-t[0]-o,n},Ae=1.5707963267341256,gt=6077100506506192e-26,Js=2*gt,Qs=3*gt,Us=4*gt,At=new Array(3),$t=new Array(2),sd=function(s,e){var t,n,i,r,o,a,c;if((i=2147483647&U(s))<=1072243195)return e[0]=s,e[1]=0,0;if(i<=1074752122)return(1048575&i)==598523?js(s,i,e):i<=1073928572?s>0?(c=s-Ae,e[0]=c-gt,e[1]=c-e[0]-gt,1):(c=s+Ae,e[0]=c+gt,e[1]=c-e[0]+gt,-1):s>0?(c=s-2*Ae,e[0]=c-Js,e[1]=c-e[0]-Js,2):(c=s+2*Ae,e[0]=c+Js,e[1]=c-e[0]+Js,-2);if(i<=1075594811)return i<=1075183036?i===1074977148?js(s,i,e):s>0?(c=s-3*Ae,e[0]=c-Qs,e[1]=c-e[0]-Qs,3):(c=s+3*Ae,e[0]=c+Qs,e[1]=c-e[0]+Qs,-3):i===1075388923?js(s,i,e):s>0?(c=s-4*Ae,e[0]=c-Us,e[1]=c-e[0]-Us,4):(c=s+4*Ae,e[0]=c+Us,e[1]=c-e[0]+Us,-4);if(i<1094263291)return js(s,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(t=Dc(s),c=Ws(i-((n=(i>>20)-1046)<<20),t),o=0;o<2;o++)At[o]=0|c,c=16777216*(c-At[o]);for(At[2]=c,r=3;At[r-1]===0;)r-=1;return a=ed(At,$t,n,r),s<0?(e[0]=-$t[0],e[1]=-$t[1],-a):(e[0]=$t[0],e[1]=$t[1],a)},Di=sd,Ke=[0,0],nd=function(s){var e;if(e=U(s),(e&=2147483647)<=1072243195)return e<1044381696?1:cs(s,0);if(e>=2146435072)return NaN;switch(3&Di(s,Ke)){case 0:return cs(Ke[0],Ke[1]);case 1:return-ds(Ke[0],Ke[1]);case 2:return-cs(Ke[0],Ke[1]);default:return ds(Ke[0],Ke[1])}},id=Math.ceil,rd=function(s){return s<0?id(s):ka(s)},od=function(s){return s===0?.16666666666666602:.16666666666666602+s*(s*(6613756321437934e-20+s*(41381367970572385e-24*s-16533902205465252e-22))-.0027777777777015593)},ad=function(s,e,t){var n,i,r;return r=(n=s-e)-(i=n*n)*od(i),os(1-(e-n*r/(2-r)-s),t)},Dr=1.4426950408889634,ld=1/(1<<28),Lt=function(s){var e;return ne(s)||s===Ce?s:s===ke?0:s>709.782712893384?Ce:s<-745.1332191019411?0:s>-3725290298461914e-24&&s<ld?1+s:(e=rd(s<0?Dr*s-.5:Dr*s+.5),ad(s-.6931471803691238*e,19082149292705877e-26*e,e))},cd=function(s){return ne(s)?s:(s<0&&(s=-s),s>21?Lt(s)/2:(Lt(s)+Lt(-s))/2)},dd=function(s){return s===0?-.03333333333333313:s*(.0015873015872548146+s*(s*(4008217827329362e-21+-20109921818362437e-23*s)-793650757867488e-19))-.03333333333333313},jn=.6931471803691238,Or=19082149292705877e-26,Br=1.4426950408889634,hd=function(s){var e,t,n,i,r,o,a,c,l,d,p,f;if(s===Ce||ne(s))return s;if(s===ke)return-1;if(s===0)return s;if(s<0?(t=!0,a=-s):(t=!1,a=s),a>=38.816242111356935){if(t)return-1;if(a>=709.782712893384)return Ce}if(r=0|U(a),a>.34657359027997264)a<1.0397207708399179?t?(n=s+jn,i=-19082149292705877e-26,f=-1):(n=s-jn,i=Or,f=1):(f=t?Br*s-.5:Br*s+.5,n=s-(d=f|=0)*jn,i=d*Or),l=n-(s=n-i)-i;else{if(r<1016070144)return s;f=0}return p=(c=s*(e=.5*s))*(((o=1+c*dd(c))-(d=3-o*e))/(6-s*d)),f===0?s-(s*p-c):(p=s*(p-l)-l,p-=c,f===-1?.5*(s-p)-.5:f===1?s<-.25?-2*(p-(s+.5)):1+2*(s-p):f<=-2||f>56?(n=U(a=1-(p-s))+(f<<20)|0,(a=Me(a,n))-1):(d=1,f<20?a=(d=Me(d,n=1072693248-(2097152>>f)|0))-(p-s):(a=s-(p+(d=Me(d,n=dt-f<<20))),a+=1),n=U(a)+(f<<20)|0,Me(a,n)))},ud=Ut===!0?0:1,Gi=new Qt(1),md=new Jt(Gi.buffer),pd=function(s,e){return Gi[0]=s,md[ud]=e>>>0,Gi[0]},un=pd,fd=function(s){return s===0?.3999999999940942:.3999999999940942+s*(.22222198432149784+.15313837699209373*s)},bd=function(s){return s===0?.6666666666666735:.6666666666666735+s*(.2857142874366239+s*(.1818357216161805+.14798198605116586*s))},Ar=1048575,yd=function(s){var e,t,n,i,r,o,a,c,l,d;return n=U(s),i=s-1,(Ar&2+n)<3?i===0?0:i*i*(.3333333333333333*i-.5):(l=(n&=Ar)-398458|0,d=440401-n|0,t=(c=(o=(r=i/(2+i))*r)*o)*fd(c),a=o*bd(c)+t,(l|=d)>0?r*((e=.5*i*i)+a)-e:r*(a-i))},$r=.4342944818781689,gd=function(s){var e,t,n,i,r,o,a;return ne(s)||s<0?NaN:s===0?ke:(r=0,(t=U(s))<1048576&&(r-=54,t=U(s*=0x40000000000000)),t>=2146435072?s+s:(r+=(t>>20)-dt|0,s=Me(s,(t&=1048575)|1072693248^(i=t+614244&1048576)),o=r+=i>>20,n=yd(s),a=3694239077158931e-28*o+25082946711645275e-27*((s-=1)+n),(a+=(s-(e=un(s,0))+n)*$r+e*$r)+.30102999566361177*o))},wd=function(s){return s===0?.3999999999940942:.3999999999940942+s*(.22222198432149784+.15313837699209373*s)},Zd=function(s){return s===0?.6666666666666735:.6666666666666735+s*(.2857142874366239+s*(.1818357216161805+.14798198605116586*s))},qr=1048575,vd=function(s){var e,t,n,i,r,o,a,c,l,d;return n=U(s),i=s-1,(qr&2+n)<3?i===0?0:i*i*(.3333333333333333*i-.5):(l=(n&=qr)-398458|0,d=440401-n|0,t=(c=(o=(r=i/(2+i))*r)*o)*wd(c),a=o*Zd(c)+t,(l|=d)>0?r*((e=.5*i*i)+a)-e:r*(a-i))},eo=1.4426950407214463,Jn=[0,0],Xd=function(s){var e,t,n,i,r;if(ne(s)||s<0)return NaN;if(Qi(Jn,s),r=0,(t=Jn[0])<1048576){if(!(2147483647&t|Jn[1]))return ke;r-=54,t=U(s*=0x40000000000000)}return t>=2146435072?s+s:(r+=(t>>20)-dt|0,s=Me(s,(t&=1048575)|1072693248^(i=t+614244&1048576)),r+=i>>20,n=vd(s),16751713164886512e-26*((s-=1)+n)+(s-(e=un(s,0))+n)*eo+e*eo+r)},Ne=[0,0],Ld=function(s){var e;if(e=U(s),(e&=2147483647)<=1072243195)return e<1045430272?s:ds(s,0);if(e>=2146435072)return NaN;switch(3&Di(s,Ne)){case 0:return ds(Ne[0],Ne[1]);case 1:return cs(Ne[0],Ne[1]);case 2:return-ds(Ne[0],Ne[1]);default:return-cs(Ne[0],Ne[1])}},xd=function(s){var e,t;return s===0?.16666666666666666:((s<0?-s:s)<=1?(e=s*(s*(-.789474443963537*s-163.72585752598383)-11561.443576500522)-351754.9648081514,t=s*(36157.827983443196+s*(1*s-277.7110814206028))-2.1105297888489086e6):(e=(s=1/s)*(s*(-351754.9648081514*s-11561.443576500522)-163.72585752598383)-.789474443963537,t=1+s*(s*(36157.827983443196+-2.1105297888489086e6*s)-277.7110814206028)),e/t)},Ra=709.782712893384,Sd=Ra+Sn,Gd=Ra-Sn,Td=function(s){var e;return s===0?s:(e=Ui(s),s>Sd||s<-709.089565712824?s>0?Ce:ke:e>1?e>=Gd?(e=Lt(.5*e),e*=.5*e,s<0&&(e=-e),e):(e=.5*(e=Lt(e))-.5/e,s<0&&(e=-e),e):s+s*(e*=e)*xd(e))},Wd=function(s){return s===0?.13333333333320124:.13333333333320124+s*(.021869488294859542+s*(.0035920791075913124+s*(.0005880412408202641+s*(7817944429395571e-20+-18558637485527546e-21*s))))},Cd=function(s){return s===0?.05396825397622605:.05396825397622605+s*(.0088632398235993+s*(.0014562094543252903+s*(.0002464631348184699+s*(7140724913826082e-20+2590730518636337e-20*s))))},to=function(s,e,t){var n,i,r,o,a,c,l,d,p;return(i=2147483647&(n=U(s)))>=1072010280&&(s<0&&(s=-s,e=-e),s=(p=.7853981633974483-s)+(d=3061616997868383e-32-e),e=0),o=e+(p=s*s)*((a=p*s)*((o=Wd(d=p*p))+(l=p*Cd(d)))+e),d=s+(o+=.3333333333333341*a),i>=1072010280?(1-(n>>30&2))*((l=t)-2*(s-(d*d/(d+l)-o))):t===1?d:(un(p=d,0),l=o-(p-s),un(c=r=-1/d,0),c+r*((a=1+c*p)+c*l))},Qn=[0,0],kd=function(s){var e,t;return e=U(s),(e&=2147483647)<=1072243195?e<1044381696?s:to(s,0,1):e>=2146435072?NaN:(t=Di(s,Qn),to(Qn[0],Qn[1],1-((1&t)<<1)))},Pd=function(s){var e,t;return s===0?-.3333333333333332:((s<0?-s:s)<=1?(e=s*(s*(0*s-.9643991794250523)-99.28772310019185)-1614.6876844170845,t=4844.063053251255+s*(2235.4883906010045+s*(112.81167849163293+1*s))):(e=0+(s=1/s)*(s*(-1614.6876844170845*s-99.28772310019185)-.9643991794250523),t=1+s*(112.81167849163293+s*(2235.4883906010045+4844.063053251255*s))),e/t)},Id=function(s){var e,t;if((t=Ui(s))>44.014845965556525)return s<0?-1:1;if(t>=.625)t=1-2/((e=Lt(2*t))+1),s<0&&(t=-t);else{if(s===0)return s;t=s+s*(e=s*s)*Pd(e)}return t};globalThis.CroquetMath===void 0&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:Jl,acosh:Tc,asin:Zi,asinh:Cc,atan:La,atanh:Rc,atan2:zc,cbrt:Ec,cos:nd,cosh:cd,exp:Lt,expm1:hd,log:Ts,log1p:Gs,log10:gd,log2:Xd,sin:Ld,sinh:Td,tan:kd,tanh:Id});var Un=Math.pow;function so(s){return s===1/0||s===-1/0}globalThis.CroquetMath.pow=(s,e)=>{if(isNaN(s)||isNaN(e))return NaN;if(so(s)||so(e)||s===0||e===0)return Un(s,e);if(s<0&&!function(n){return Number.isInteger(n)}(e))return NaN;if(e===1)return s;if(e===2)return s*s;if(e===3)return s*s*s;if(e===4)return s*s*s*s;let t=1;return s<0&&(s*=-1,t=Un(-1,e)),globalThis.CroquetMath.exp(globalThis.CroquetMath.log(s)*e)*t};var Ti=class extends Gl{poll(){let e=super.poll();return this.array[this.size]=null,e}asArray(){let e=[];return this.forEach(t=>e.push(t)),e}asUnsortedArray(){return this.array.slice(0,this.size)}},no,io={exports:{}};function Va(){return no||(no=1,io.exports=function(s){return function(){var e=s,t=e.lib.WordArray;function n(i,r,o){for(var a=[],c=0,l=0;l<r;l++)if(l%4){var d=o[i.charCodeAt(l-1)]<<l%4*2|o[i.charCodeAt(l)]>>>6-l%4*2;a[c>>>2]|=d<<24-c%4*8,c++}return t.create(a,c)}e.enc.Base64={stringify:function(i){var r=i.words,o=i.sigBytes,a=this._map;i.clamp();for(var c=[],l=0;l<o;l+=3)for(var d=(r[l>>>2]>>>24-l%4*8&255)<<16|(r[l+1>>>2]>>>24-(l+1)%4*8&255)<<8|r[l+2>>>2]>>>24-(l+2)%4*8&255,p=0;p<4&&l+.75*p<o;p++)c.push(a.charAt(d>>>6*(3-p)&63));var f=a.charAt(64);if(f)for(;c.length%4;)c.push(f);return c.join("")},parse:function(i){var r=i.length,o=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var c=0;c<o.length;c++)a[o.charCodeAt(c)]=c}var l=o.charAt(64);if(l){var d=i.indexOf(l);d!==-1&&(r=d)}return n(i,r,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),s.enc.Base64}(Ze())),io.exports}var ro,ye=Tt(Va()),oo=Ze(),ao={exports:{}},lo,Rd=(ro||(ro=1,ao.exports=function(s){return s.enc.Utf8}(Ze())),ao.exports),Vd=Tt(Rd),co={exports:{}},ho={exports:{}};function Oi(){return lo||(lo=1,ho.exports=function(s){(function(){var e=s,t=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(i,r){i=this._hasher=new i.init,typeof r=="string"&&(r=n.parse(r));var o=i.blockSize,a=4*o;r.sigBytes>a&&(r=i.finalize(r)),r.clamp();for(var c=this._oKey=r.clone(),l=this._iKey=r.clone(),d=c.words,p=l.words,f=0;f<o;f++)d[f]^=1549556828,p[f]^=909522486;c.sigBytes=l.sigBytes=a,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var r=this._hasher,o=r.finalize(i);return r.reset(),r.finalize(this._oKey.clone().concat(o))}})})()}(Ze())),ho.exports}var uo,mo,Md=(uo||(uo=1,co.exports=function(s){return function(){var e=s,t=e.lib,n=t.Base,i=t.WordArray,r=e.algo,o=r.SHA256,a=r.HMAC,c=r.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:25e4}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,d){for(var p=this.cfg,f=a.create(p.hasher,l),h=i.create(),v=i.create([1]),G=h.words,y=v.words,X=p.keySize,L=p.iterations;G.length<X;){var S=f.update(d).finalize(v);f.reset();for(var Z=S.words,u=Z.length,m=S,b=1;b<L;b++){m=f.finalize(m),f.reset();for(var g=m.words,w=0;w<u;w++)Z[w]^=g[w]}h.concat(S),y[0]++}return h.sigBytes=4*X,h}});e.PBKDF2=function(l,d,p){return c.create(p).compute(l,d)}}(),s.PBKDF2}(Ze(),Ei(),Oi())),co.exports),po=Tt(Md),fo={exports:{}},bo={exports:{}};function Yd(){return mo||(mo=1,bo.exports=function(s){return function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=[];(function(){for(var h=0;h<64;h++)a[h]=4294967296*e.abs(e.sin(h+1))|0})();var c=o.MD5=r.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,v){for(var G=0;G<16;G++){var y=v+G,X=h[y];h[y]=16711935&(X<<8|X>>>24)|4278255360&(X<<24|X>>>8)}var L=this._hash.words,S=h[v+0],Z=h[v+1],u=h[v+2],m=h[v+3],b=h[v+4],g=h[v+5],w=h[v+6],W=h[v+7],R=h[v+8],M=h[v+9],K=h[v+10],N=h[v+11],H=h[v+12],O=h[v+13],A=h[v+14],I=h[v+15],x=L[0],T=L[1],k=L[2],C=L[3];x=l(x,T,k,C,S,7,a[0]),C=l(C,x,T,k,Z,12,a[1]),k=l(k,C,x,T,u,17,a[2]),T=l(T,k,C,x,m,22,a[3]),x=l(x,T,k,C,b,7,a[4]),C=l(C,x,T,k,g,12,a[5]),k=l(k,C,x,T,w,17,a[6]),T=l(T,k,C,x,W,22,a[7]),x=l(x,T,k,C,R,7,a[8]),C=l(C,x,T,k,M,12,a[9]),k=l(k,C,x,T,K,17,a[10]),T=l(T,k,C,x,N,22,a[11]),x=l(x,T,k,C,H,7,a[12]),C=l(C,x,T,k,O,12,a[13]),k=l(k,C,x,T,A,17,a[14]),x=d(x,T=l(T,k,C,x,I,22,a[15]),k,C,Z,5,a[16]),C=d(C,x,T,k,w,9,a[17]),k=d(k,C,x,T,N,14,a[18]),T=d(T,k,C,x,S,20,a[19]),x=d(x,T,k,C,g,5,a[20]),C=d(C,x,T,k,K,9,a[21]),k=d(k,C,x,T,I,14,a[22]),T=d(T,k,C,x,b,20,a[23]),x=d(x,T,k,C,M,5,a[24]),C=d(C,x,T,k,A,9,a[25]),k=d(k,C,x,T,m,14,a[26]),T=d(T,k,C,x,R,20,a[27]),x=d(x,T,k,C,O,5,a[28]),C=d(C,x,T,k,u,9,a[29]),k=d(k,C,x,T,W,14,a[30]),x=p(x,T=d(T,k,C,x,H,20,a[31]),k,C,g,4,a[32]),C=p(C,x,T,k,R,11,a[33]),k=p(k,C,x,T,N,16,a[34]),T=p(T,k,C,x,A,23,a[35]),x=p(x,T,k,C,Z,4,a[36]),C=p(C,x,T,k,b,11,a[37]),k=p(k,C,x,T,W,16,a[38]),T=p(T,k,C,x,K,23,a[39]),x=p(x,T,k,C,O,4,a[40]),C=p(C,x,T,k,S,11,a[41]),k=p(k,C,x,T,m,16,a[42]),T=p(T,k,C,x,w,23,a[43]),x=p(x,T,k,C,M,4,a[44]),C=p(C,x,T,k,H,11,a[45]),k=p(k,C,x,T,I,16,a[46]),x=f(x,T=p(T,k,C,x,u,23,a[47]),k,C,S,6,a[48]),C=f(C,x,T,k,W,10,a[49]),k=f(k,C,x,T,A,15,a[50]),T=f(T,k,C,x,g,21,a[51]),x=f(x,T,k,C,H,6,a[52]),C=f(C,x,T,k,m,10,a[53]),k=f(k,C,x,T,K,15,a[54]),T=f(T,k,C,x,Z,21,a[55]),x=f(x,T,k,C,R,6,a[56]),C=f(C,x,T,k,I,10,a[57]),k=f(k,C,x,T,w,15,a[58]),T=f(T,k,C,x,O,21,a[59]),x=f(x,T,k,C,b,6,a[60]),C=f(C,x,T,k,N,10,a[61]),k=f(k,C,x,T,u,15,a[62]),T=f(T,k,C,x,M,21,a[63]),L[0]=L[0]+x|0,L[1]=L[1]+T|0,L[2]=L[2]+k|0,L[3]=L[3]+C|0},_doFinalize:function(){var h=this._data,v=h.words,G=8*this._nDataBytes,y=8*h.sigBytes;v[y>>>5]|=128<<24-y%32;var X=e.floor(G/4294967296),L=G;v[15+(y+64>>>9<<4)]=16711935&(X<<8|X>>>24)|4278255360&(X<<24|X>>>8),v[14+(y+64>>>9<<4)]=16711935&(L<<8|L>>>24)|4278255360&(L<<24|L>>>8),h.sigBytes=4*(v.length+1),this._process();for(var S=this._hash,Z=S.words,u=0;u<4;u++){var m=Z[u];Z[u]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}return S},clone:function(){var h=r.clone.call(this);return h._hash=this._hash.clone(),h}});function l(h,v,G,y,X,L,S){var Z=h+(v&G|~v&y)+X+S;return(Z<<L|Z>>>32-L)+v}function d(h,v,G,y,X,L,S){var Z=h+(v&y|G&~y)+X+S;return(Z<<L|Z>>>32-L)+v}function p(h,v,G,y,X,L,S){var Z=h+(v^G^y)+X+S;return(Z<<L|Z>>>32-L)+v}function f(h,v,G,y,X,L,S){var Z=h+(G^(v|~y))+X+S;return(Z<<L|Z>>>32-L)+v}t.MD5=r._createHelper(c),t.HmacMD5=r._createHmacHelper(c)}(Math),s.MD5}(Ze())),bo.exports}var yo,go={exports:{}},wo={exports:{}};function Hd(){return yo||(yo=1,wo.exports=function(s){return function(){var e=s,t=e.lib,n=t.WordArray,i=t.Hasher,r=e.algo,o=[],a=r.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,l){for(var d=this._hash.words,p=d[0],f=d[1],h=d[2],v=d[3],G=d[4],y=0;y<80;y++){if(y<16)o[y]=0|c[l+y];else{var X=o[y-3]^o[y-8]^o[y-14]^o[y-16];o[y]=X<<1|X>>>31}var L=(p<<5|p>>>27)+G+o[y];L+=y<20?1518500249+(f&h|~f&v):y<40?1859775393+(f^h^v):y<60?(f&h|f&v|h&v)-1894007588:(f^h^v)-899497514,G=v,v=h,h=f<<30|f>>>2,f=p,p=L}d[0]=d[0]+p|0,d[1]=d[1]+f|0,d[2]=d[2]+h|0,d[3]=d[3]+v|0,d[4]=d[4]+G|0},_doFinalize:function(){var c=this._data,l=c.words,d=8*this._nDataBytes,p=8*c.sigBytes;return l[p>>>5]|=128<<24-p%32,l[14+(p+64>>>9<<4)]=Math.floor(d/4294967296),l[15+(p+64>>>9<<4)]=d,c.sigBytes=4*l.length,this._process(),this._hash},clone:function(){var c=i.clone.call(this);return c._hash=this._hash.clone(),c}});e.SHA1=i._createHelper(a),e.HmacSHA1=i._createHmacHelper(a)}(),s.SHA1}(Ze())),wo.exports}var Zo;function vo(){return Zo||(Zo=1,go.exports=function(s){return function(){var e=s,t=e.lib,n=t.Base,i=t.WordArray,r=e.algo,o=r.MD5,a=r.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,l){for(var d,p=this.cfg,f=p.hasher.create(),h=i.create(),v=h.words,G=p.keySize,y=p.iterations;v.length<G;){d&&f.update(d),d=f.update(c).finalize(l),f.reset();for(var X=1;X<y;X++)d=f.finalize(d),f.reset();h.concat(d)}return h.sigBytes=4*G,h}});e.EvpKDF=function(c,l,d){return a.create(d).compute(c,l)}}(),s.EvpKDF}(Ze(),Hd(),Oi())),go.exports}var Xo,Kd={exports:{}},Lo,xo,Nd=(Lo||(Lo=1,fo.exports=function(s){return function(){var e=s,t=e.lib.BlockCipher,n=e.algo,i=[],r=[],o=[],a=[],c=[],l=[],d=[],p=[],f=[],h=[];(function(){for(var y=[],X=0;X<256;X++)y[X]=X<128?X<<1:X<<1^283;var L=0,S=0;for(X=0;X<256;X++){var Z=S^S<<1^S<<2^S<<3^S<<4;Z=Z>>>8^255&Z^99,i[L]=Z,r[Z]=L;var u=y[L],m=y[u],b=y[m],g=257*y[Z]^16843008*Z;o[L]=g<<24|g>>>8,a[L]=g<<16|g>>>16,c[L]=g<<8|g>>>24,l[L]=g,g=16843009*b^65537*m^257*u^16843008*L,d[Z]=g<<24|g>>>8,p[Z]=g<<16|g>>>16,f[Z]=g<<8|g>>>24,h[Z]=g,L?(L=u^y[y[y[b^u]]],S^=y[y[S]]):L=S=1}})();var v=[0,1,2,4,8,16,32,64,128,27,54],G=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var y=this._keyPriorReset=this._key,X=y.words,L=y.sigBytes/4,S=4*((this._nRounds=L+6)+1),Z=this._keySchedule=[],u=0;u<S;u++)u<L?Z[u]=X[u]:(g=Z[u-1],u%L?L>6&&u%L==4&&(g=i[g>>>24]<<24|i[g>>>16&255]<<16|i[g>>>8&255]<<8|i[255&g]):(g=i[(g=g<<8|g>>>24)>>>24]<<24|i[g>>>16&255]<<16|i[g>>>8&255]<<8|i[255&g],g^=v[u/L|0]<<24),Z[u]=Z[u-L]^g);for(var m=this._invKeySchedule=[],b=0;b<S;b++){if(u=S-b,b%4)var g=Z[u];else g=Z[u-4];m[b]=b<4||u<=4?g:d[i[g>>>24]]^p[i[g>>>16&255]]^f[i[g>>>8&255]]^h[i[255&g]]}}},encryptBlock:function(y,X){this._doCryptBlock(y,X,this._keySchedule,o,a,c,l,i)},decryptBlock:function(y,X){var L=y[X+1];y[X+1]=y[X+3],y[X+3]=L,this._doCryptBlock(y,X,this._invKeySchedule,d,p,f,h,r),L=y[X+1],y[X+1]=y[X+3],y[X+3]=L},_doCryptBlock:function(y,X,L,S,Z,u,m,b){for(var g=this._nRounds,w=y[X]^L[0],W=y[X+1]^L[1],R=y[X+2]^L[2],M=y[X+3]^L[3],K=4,N=1;N<g;N++){var H=S[w>>>24]^Z[W>>>16&255]^u[R>>>8&255]^m[255&M]^L[K++],O=S[W>>>24]^Z[R>>>16&255]^u[M>>>8&255]^m[255&w]^L[K++],A=S[R>>>24]^Z[M>>>16&255]^u[w>>>8&255]^m[255&W]^L[K++],I=S[M>>>24]^Z[w>>>16&255]^u[W>>>8&255]^m[255&R]^L[K++];w=H,W=O,R=A,M=I}H=(b[w>>>24]<<24|b[W>>>16&255]<<16|b[R>>>8&255]<<8|b[255&M])^L[K++],O=(b[W>>>24]<<24|b[R>>>16&255]<<16|b[M>>>8&255]<<8|b[255&w])^L[K++],A=(b[R>>>24]<<24|b[M>>>16&255]<<16|b[w>>>8&255]<<8|b[255&W])^L[K++],I=(b[M>>>24]<<24|b[w>>>16&255]<<16|b[W>>>8&255]<<8|b[255&R])^L[K++],y[X]=H,y[X+1]=O,y[X+2]=A,y[X+3]=I},keySize:8});e.AES=t._createHelper(G)}(),s.AES}(Ze(),Va(),Yd(),vo(),Xo||(Xo=1,Kd.exports=function(s){s.lib.Cipher||function(e){var t=s,n=t.lib,i=n.Base,r=n.WordArray,o=n.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var c=a.Base64,l=t.algo.EvpKDF,d=n.Cipher=o.extend({cfg:i.extend(),createEncryptor:function(Z,u){return this.create(this._ENC_XFORM_MODE,Z,u)},createDecryptor:function(Z,u){return this.create(this._DEC_XFORM_MODE,Z,u)},init:function(Z,u,m){this.cfg=this.cfg.extend(m),this._xformMode=Z,this._key=u,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(Z){return this._append(Z),this._process()},finalize:function(Z){return Z&&this._append(Z),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function Z(u){return typeof u=="string"?S:X}return function(u){return{encrypt:function(m,b,g){return Z(b).encrypt(u,m,b,g)},decrypt:function(m,b,g){return Z(b).decrypt(u,m,b,g)}}}}()});n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var p=t.mode={},f=n.BlockCipherMode=i.extend({createEncryptor:function(Z,u){return this.Encryptor.create(Z,u)},createDecryptor:function(Z,u){return this.Decryptor.create(Z,u)},init:function(Z,u){this._cipher=Z,this._iv=u}}),h=p.CBC=function(){var Z=f.extend();function u(m,b,g){var w,W=this._iv;W?(w=W,this._iv=e):w=this._prevBlock;for(var R=0;R<g;R++)m[b+R]^=w[R]}return Z.Encryptor=Z.extend({processBlock:function(m,b){var g=this._cipher,w=g.blockSize;u.call(this,m,b,w),g.encryptBlock(m,b),this._prevBlock=m.slice(b,b+w)}}),Z.Decryptor=Z.extend({processBlock:function(m,b){var g=this._cipher,w=g.blockSize,W=m.slice(b,b+w);g.decryptBlock(m,b),u.call(this,m,b,w),this._prevBlock=W}}),Z}(),v=(t.pad={}).Pkcs7={pad:function(Z,u){for(var m=4*u,b=m-Z.sigBytes%m,g=b<<24|b<<16|b<<8|b,w=[],W=0;W<b;W+=4)w.push(g);var R=r.create(w,b);Z.concat(R)},unpad:function(Z){var u=255&Z.words[Z.sigBytes-1>>>2];Z.sigBytes-=u}};n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:h,padding:v}),reset:function(){var Z;d.reset.call(this);var u=this.cfg,m=u.iv,b=u.mode;this._xformMode==this._ENC_XFORM_MODE?Z=b.createEncryptor:(Z=b.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==Z?this._mode.init(this,m&&m.words):(this._mode=Z.call(b,this,m&&m.words),this._mode.__creator=Z)},_doProcessBlock:function(Z,u){this._mode.processBlock(Z,u)},_doFinalize:function(){var Z,u=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(u.pad(this._data,this.blockSize),Z=this._process(!0)):(Z=this._process(!0),u.unpad(Z)),Z},blockSize:4});var G=n.CipherParams=i.extend({init:function(Z){this.mixIn(Z)},toString:function(Z){return(Z||this.formatter).stringify(this)}}),y=(t.format={}).OpenSSL={stringify:function(Z){var u=Z.ciphertext,m=Z.salt;return(m?r.create([1398893684,1701076831]).concat(m).concat(u):u).toString(c)},parse:function(Z){var u,m=c.parse(Z),b=m.words;return b[0]==1398893684&&b[1]==1701076831&&(u=r.create(b.slice(2,4)),b.splice(0,4),m.sigBytes-=16),G.create({ciphertext:m,salt:u})}},X=n.SerializableCipher=i.extend({cfg:i.extend({format:y}),encrypt:function(Z,u,m,b){b=this.cfg.extend(b);var g=Z.createEncryptor(m,b),w=g.finalize(u),W=g.cfg;return G.create({ciphertext:w,key:m,iv:W.iv,algorithm:Z,mode:W.mode,padding:W.padding,blockSize:Z.blockSize,formatter:b.format})},decrypt:function(Z,u,m,b){return b=this.cfg.extend(b),u=this._parse(u,b.format),Z.createDecryptor(m,b).finalize(u.ciphertext)},_parse:function(Z,u){return typeof Z=="string"?u.parse(Z,this):Z}}),L=(t.kdf={}).OpenSSL={execute:function(Z,u,m,b,g){if(b||(b=r.random(8)),g)w=l.create({keySize:u+m,hasher:g}).compute(Z,b);else var w=l.create({keySize:u+m}).compute(Z,b);var W=r.create(w.words.slice(u),4*m);return w.sigBytes=4*u,G.create({key:w,iv:W,salt:b})}},S=n.PasswordBasedCipher=X.extend({cfg:X.cfg.extend({kdf:L}),encrypt:function(Z,u,m,b){var g=(b=this.cfg.extend(b)).kdf.execute(m,Z.keySize,Z.ivSize,b.salt,b.hasher);b.iv=g.iv;var w=X.encrypt.call(this,Z,u,g.key,b);return w.mixIn(g),w},decrypt:function(Z,u,m,b){b=this.cfg.extend(b),u=this._parse(u,b.format);var g=b.kdf.execute(m,Z.keySize,Z.ivSize,u.salt,b.hasher);return b.iv=g.iv,X.decrypt.call(this,Z,u,g.key,b)}})}()}(Ze(),vo())))),fo.exports),Ds=Tt(Nd),So={exports:{}},zd=(xo||(xo=1,So.exports=function(s){return s.HmacSHA256}(Ze(),Ei(),Oi())),So.exports),Dn=Tt(zd);function Dt(s){let e=s.length;for(;--e>=0;)s[e]=0}var Bi=256,Ma=286,hs=30,us=15,Wi=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),cn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Go=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qe=new Array(576);Dt(Qe);var ms=new Array(60);Dt(ms);var Cs=new Array(512);Dt(Cs);var ps=new Array(256);Dt(ps);var Ai=new Array(29);Dt(Ai);var mn=new Array(hs);function On(s,e,t,n,i){this.static_tree=s,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=s&&s.length}var To,Wo,Co;function Bn(s,e){this.dyn_tree=s,this.max_code=0,this.stat_desc=e}Dt(mn);var Ya=s=>s<256?Cs[s]:Cs[256+(s>>>7)],ks=(s,e)=>{s.pending_buf[s.pending++]=255&e,s.pending_buf[s.pending++]=e>>>8&255},he=(s,e,t)=>{s.bi_valid>16-t?(s.bi_buf|=e<<s.bi_valid&65535,ks(s,s.bi_buf),s.bi_buf=e>>16-s.bi_valid,s.bi_valid+=t-16):(s.bi_buf|=e<<s.bi_valid&65535,s.bi_valid+=t)},Ve=(s,e,t)=>{he(s,t[2*e],t[2*e+1])},Ha=(s,e)=>{let t=0;do t|=1&s,s>>>=1,t<<=1;while(--e>0);return t>>>1},Ka=(s,e,t)=>{let n=new Array(16),i,r,o=0;for(i=1;i<=us;i++)o=o+t[i-1]<<1,n[i]=o;for(r=0;r<=e;r++){let a=s[2*r+1];a!==0&&(s[2*r]=Ha(n[a]++,a))}},Na=s=>{let e;for(e=0;e<Ma;e++)s.dyn_ltree[2*e]=0;for(e=0;e<hs;e++)s.dyn_dtree[2*e]=0;for(e=0;e<19;e++)s.bl_tree[2*e]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},za=s=>{s.bi_valid>8?ks(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},ko=(s,e,t,n)=>{let i=2*e,r=2*t;return s[i]<s[r]||s[i]===s[r]&&n[e]<=n[t]},An=(s,e,t)=>{let n=s.heap[t],i=t<<1;for(;i<=s.heap_len&&(i<s.heap_len&&ko(e,s.heap[i+1],s.heap[i],s.depth)&&i++,!ko(e,n,s.heap[i],s.depth));)s.heap[t]=s.heap[i],t=i,i<<=1;s.heap[t]=n},Po=(s,e,t)=>{let n,i,r,o,a=0;if(s.sym_next!==0)do n=255&s.pending_buf[s.sym_buf+a++],n+=(255&s.pending_buf[s.sym_buf+a++])<<8,i=s.pending_buf[s.sym_buf+a++],n===0?Ve(s,i,e):(r=ps[i],Ve(s,r+Bi+1,e),o=Wi[r],o!==0&&(i-=Ai[r],he(s,i,o)),n--,r=Ya(n),Ve(s,r,t),o=cn[r],o!==0&&(n-=mn[r],he(s,n,o)));while(a<s.sym_next);Ve(s,256,e)},$n=(s,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,r=e.stat_desc.elems,o,a,c,l=-1;for(s.heap_len=0,s.heap_max=573,o=0;o<r;o++)t[2*o]!==0?(s.heap[++s.heap_len]=l=o,s.depth[o]=0):t[2*o+1]=0;for(;s.heap_len<2;)c=s.heap[++s.heap_len]=l<2?++l:0,t[2*c]=1,s.depth[c]=0,s.opt_len--,i&&(s.static_len-=n[2*c+1]);for(e.max_code=l,o=s.heap_len>>1;o>=1;o--)An(s,t,o);c=r;do o=s.heap[1],s.heap[1]=s.heap[s.heap_len--],An(s,t,1),a=s.heap[1],s.heap[--s.heap_max]=o,s.heap[--s.heap_max]=a,t[2*c]=t[2*o]+t[2*a],s.depth[c]=(s.depth[o]>=s.depth[a]?s.depth[o]:s.depth[a])+1,t[2*o+1]=t[2*a+1]=c,s.heap[1]=c++,An(s,t,1);while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((d,p)=>{let f=p.dyn_tree,h=p.max_code,v=p.stat_desc.static_tree,G=p.stat_desc.has_stree,y=p.stat_desc.extra_bits,X=p.stat_desc.extra_base,L=p.stat_desc.max_length,S,Z,u,m,b,g,w=0;for(m=0;m<=us;m++)d.bl_count[m]=0;for(f[2*d.heap[d.heap_max]+1]=0,S=d.heap_max+1;S<573;S++)Z=d.heap[S],m=f[2*f[2*Z+1]+1]+1,m>L&&(m=L,w++),f[2*Z+1]=m,Z>h||(d.bl_count[m]++,b=0,Z>=X&&(b=y[Z-X]),g=f[2*Z],d.opt_len+=g*(m+b),G&&(d.static_len+=g*(v[2*Z+1]+b)));if(w!==0){do{for(m=L-1;d.bl_count[m]===0;)m--;d.bl_count[m]--,d.bl_count[m+1]+=2,d.bl_count[L]--,w-=2}while(w>0);for(m=L;m!==0;m--)for(Z=d.bl_count[m];Z!==0;)u=d.heap[--S],u>h||(f[2*u+1]!==m&&(d.opt_len+=(m-f[2*u+1])*f[2*u],f[2*u+1]=m),Z--)}})(s,e),Ka(t,l,s.bl_count)},Io=(s,e,t)=>{let n,i,r=-1,o=e[1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[2*(t+1)+1]=65535,n=0;n<=t;n++)i=o,o=e[2*(n+1)+1],++a<c&&i===o||(a<l?s.bl_tree[2*i]+=a:i!==0?(i!==r&&s.bl_tree[2*i]++,s.bl_tree[32]++):a<=10?s.bl_tree[34]++:s.bl_tree[36]++,a=0,r=i,o===0?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))},Ro=(s,e,t)=>{let n,i,r=-1,o=e[1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),n=0;n<=t;n++)if(i=o,o=e[2*(n+1)+1],!(++a<c&&i===o)){if(a<l)do Ve(s,i,s.bl_tree);while(--a!=0);else i!==0?(i!==r&&(Ve(s,i,s.bl_tree),a--),Ve(s,16,s.bl_tree),he(s,a-3,2)):a<=10?(Ve(s,17,s.bl_tree),he(s,a-3,3)):(Ve(s,18,s.bl_tree),he(s,a-11,7));a=0,r=i,o===0?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}},Vo=!1,_a=(s,e,t,n)=>{he(s,0+(n?1:0),3),za(s),ks(s,t),ks(s,~t),t&&s.pending_buf.set(s.window.subarray(e,e+t),s.pending),s.pending+=t},Fd=(s,e,t,n)=>{let i,r,o=0;s.level>0?(s.strm.data_type===2&&(s.strm.data_type=(a=>{let c,l=4093624447;for(c=0;c<=31;c++,l>>>=1)if(1&l&&a.dyn_ltree[2*c]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(c=32;c<Bi;c++)if(a.dyn_ltree[2*c]!==0)return 1;return 0})(s)),$n(s,s.l_desc),$n(s,s.d_desc),o=(a=>{let c;for(Io(a,a.dyn_ltree,a.l_desc.max_code),Io(a,a.dyn_dtree,a.d_desc.max_code),$n(a,a.bl_desc),c=18;c>=3&&a.bl_tree[2*Go[c]+1]===0;c--);return a.opt_len+=3*(c+1)+5+5+4,c})(s),i=s.opt_len+3+7>>>3,r=s.static_len+3+7>>>3,r<=i&&(i=r)):i=r=t+5,t+4<=i&&e!==-1?_a(s,e,t,n):s.strategy===4||r===i?(he(s,2+(n?1:0),3),Po(s,Qe,ms)):(he(s,4+(n?1:0),3),((a,c,l,d)=>{let p;for(he(a,c-257,5),he(a,l-1,5),he(a,d-4,4),p=0;p<d;p++)he(a,a.bl_tree[2*Go[p]+1],3);Ro(a,a.dyn_ltree,c-1),Ro(a,a.dyn_dtree,l-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,o+1),Po(s,s.dyn_ltree,s.dyn_dtree)),Na(s),n&&za(s)},Ed={_tr_init:s=>{Vo||((()=>{let e,t,n,i,r,o=new Array(16);for(n=0,i=0;i<28;i++)for(Ai[i]=n,e=0;e<1<<Wi[i];e++)ps[n++]=i;for(ps[n-1]=i,r=0,i=0;i<16;i++)for(mn[i]=r,e=0;e<1<<cn[i];e++)Cs[r++]=i;for(r>>=7;i<hs;i++)for(mn[i]=r<<7,e=0;e<1<<cn[i]-7;e++)Cs[256+r++]=i;for(t=0;t<=us;t++)o[t]=0;for(e=0;e<=143;)Qe[2*e+1]=8,e++,o[8]++;for(;e<=255;)Qe[2*e+1]=9,e++,o[9]++;for(;e<=279;)Qe[2*e+1]=7,e++,o[7]++;for(;e<=287;)Qe[2*e+1]=8,e++,o[8]++;for(Ka(Qe,287,o),e=0;e<hs;e++)ms[2*e+1]=5,ms[2*e]=Ha(e,5);To=new On(Qe,Wi,257,Ma,us),Wo=new On(ms,cn,0,hs,us),Co=new On(new Array(0),_d,0,19,7)})(),Vo=!0),s.l_desc=new Bn(s.dyn_ltree,To),s.d_desc=new Bn(s.dyn_dtree,Wo),s.bl_desc=new Bn(s.bl_tree,Co),s.bi_buf=0,s.bi_valid=0,Na(s)},_tr_stored_block:_a,_tr_flush_block:Fd,_tr_tally:(s,e,t)=>(s.pending_buf[s.sym_buf+s.sym_next++]=e,s.pending_buf[s.sym_buf+s.sym_next++]=e>>8,s.pending_buf[s.sym_buf+s.sym_next++]=t,e===0?s.dyn_ltree[2*t]++:(s.matches++,e--,s.dyn_ltree[2*(ps[t]+Bi+1)]++,s.dyn_dtree[2*Ya(e)]++),s.sym_next===s.sym_end),_tr_align:s=>{he(s,2,3),Ve(s,256,Qe),(e=>{e.bi_valid===16?(ks(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(s)}},Ps=(s,e,t,n)=>{let i=65535&s,r=s>>>16&65535,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,r=r+i|0;while(--o);i%=65521,r%=65521}return i|r<<16},jd=new Uint32Array((()=>{let s,e=[];for(var t=0;t<256;t++){s=t;for(var n=0;n<8;n++)s=1&s?3988292384^s>>>1:s>>>1;e[t]=s}return e})()),se=(s,e,t,n)=>{let i=jd,r=n+t;s^=-1;for(let o=n;o<r;o++)s=s>>>8^i[255&(s^e[o])];return~s},Gt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ms={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Jd,_tr_stored_block:Ci,_tr_flush_block:Qd,_tr_tally:rt,_tr_align:Ud}=Ed,{Z_NO_FLUSH:ot,Z_PARTIAL_FLUSH:Dd,Z_FULL_FLUSH:Od,Z_FINISH:Le,Z_BLOCK:Mo,Z_OK:re,Z_STREAM_END:Yo,Z_STREAM_ERROR:Ye,Z_DATA_ERROR:Bd,Z_BUF_ERROR:qn,Z_DEFAULT_COMPRESSION:Ad,Z_FILTERED:$d,Z_HUFFMAN_ONLY:Os,Z_RLE:qd,Z_FIXED:eh,Z_DEFAULT_STRATEGY:th,Z_UNKNOWN:sh,Z_DEFLATED:Tn}=Ms,wt=258,He=262,_t=42,Zt=113,as=666,vt=(s,e)=>(s.msg=Gt[e],e),Ho=s=>2*s-(s>4?9:0),tt=s=>{let e=s.length;for(;--e>=0;)s[e]=0},nh=s=>{let e,t,n,i=s.w_size;e=s.hash_size,n=e;do t=s.head[--n],s.head[n]=t>=i?t-i:0;while(--e);e=i,n=e;do t=s.prev[--n],s.prev[n]=t>=i?t-i:0;while(--e)},at=(s,e,t)=>(e<<s.hash_shift^t)&s.hash_mask,be=s=>{let e=s.state,t=e.pending;t>s.avail_out&&(t=s.avail_out),t!==0&&(s.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),s.next_out),s.next_out+=t,e.pending_out+=t,s.total_out+=t,s.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},ge=(s,e)=>{Qd(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,e),s.block_start=s.strstart,be(s.strm)},F=(s,e)=>{s.pending_buf[s.pending++]=e},qt=(s,e)=>{s.pending_buf[s.pending++]=e>>>8&255,s.pending_buf[s.pending++]=255&e},ki=(s,e,t,n)=>{let i=s.avail_in;return i>n&&(i=n),i===0?0:(s.avail_in-=i,e.set(s.input.subarray(s.next_in,s.next_in+i),t),s.state.wrap===1?s.adler=Ps(s.adler,e,i,t):s.state.wrap===2&&(s.adler=se(s.adler,e,i,t)),s.next_in+=i,s.total_in+=i,i)},Fa=(s,e)=>{let t,n,i=s.max_chain_length,r=s.strstart,o=s.prev_length,a=s.nice_match,c=s.strstart>s.w_size-He?s.strstart-(s.w_size-He):0,l=s.window,d=s.w_mask,p=s.prev,f=s.strstart+wt,h=l[r+o-1],v=l[r+o];s.prev_length>=s.good_match&&(i>>=2),a>s.lookahead&&(a=s.lookahead);do if(t=e,l[t+o]===v&&l[t+o-1]===h&&l[t]===l[r]&&l[++t]===l[r+1]){r+=2,t++;do;while(l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&l[++r]===l[++t]&&r<f);if(n=wt-(f-r),r=f-wt,n>o){if(s.match_start=e,o=n,n>=a)break;h=l[r+o-1],v=l[r+o]}}while((e=p[e&d])>c&&--i!=0);return o<=s.lookahead?o:s.lookahead},Ft=s=>{let e=s.w_size,t,n,i;do{if(n=s.window_size-s.lookahead-s.strstart,s.strstart>=e+(e-He)&&(s.window.set(s.window.subarray(e,e+e-n),0),s.match_start-=e,s.strstart-=e,s.block_start-=e,s.insert>s.strstart&&(s.insert=s.strstart),nh(s),n+=e),s.strm.avail_in===0)break;if(t=ki(s.strm,s.window,s.strstart+s.lookahead,n),s.lookahead+=t,s.lookahead+s.insert>=3)for(i=s.strstart-s.insert,s.ins_h=s.window[i],s.ins_h=at(s,s.ins_h,s.window[i+1]);s.insert&&(s.ins_h=at(s,s.ins_h,s.window[i+3-1]),s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<He&&s.strm.avail_in!==0)},Ea=(s,e)=>{let t,n,i,r=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,o=0,a=s.strm.avail_in;do{if(t=65535,i=s.bi_valid+42>>3,s.strm.avail_out<i||(i=s.strm.avail_out-i,n=s.strstart-s.block_start,t>n+s.strm.avail_in&&(t=n+s.strm.avail_in),t>i&&(t=i),t<r&&(t===0&&e!==Le||e===ot||t!==n+s.strm.avail_in)))break;o=e===Le&&t===n+s.strm.avail_in?1:0,Ci(s,0,0,o),s.pending_buf[s.pending-4]=t,s.pending_buf[s.pending-3]=t>>8,s.pending_buf[s.pending-2]=~t,s.pending_buf[s.pending-1]=~t>>8,be(s.strm),n&&(n>t&&(n=t),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+n),s.strm.next_out),s.strm.next_out+=n,s.strm.avail_out-=n,s.strm.total_out+=n,s.block_start+=n,t-=n),t&&(ki(s.strm,s.strm.output,s.strm.next_out,t),s.strm.next_out+=t,s.strm.avail_out-=t,s.strm.total_out+=t)}while(o===0);return a-=s.strm.avail_in,a&&(a>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=a&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-a,s.strm.next_in),s.strstart),s.strstart+=a,s.insert+=a>s.w_size-s.insert?s.w_size-s.insert:a),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),o?4:e!==ot&&e!==Le&&s.strm.avail_in===0&&s.strstart===s.block_start?2:(i=s.window_size-s.strstart,s.strm.avail_in>i&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,i+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),i>s.strm.avail_in&&(i=s.strm.avail_in),i&&(ki(s.strm,s.window,s.strstart,i),s.strstart+=i,s.insert+=i>s.w_size-s.insert?s.w_size-s.insert:i),s.high_water<s.strstart&&(s.high_water=s.strstart),i=s.bi_valid+42>>3,i=s.pending_buf_size-i>65535?65535:s.pending_buf_size-i,r=i>s.w_size?s.w_size:i,n=s.strstart-s.block_start,(n>=r||(n||e===Le)&&e!==ot&&s.strm.avail_in===0&&n<=i)&&(t=n>i?i:n,o=e===Le&&s.strm.avail_in===0&&t===n?1:0,Ci(s,s.block_start,t,o),s.block_start+=t,be(s.strm)),o?3:1)},ei=(s,e)=>{let t,n;for(;;){if(s.lookahead<He){if(Ft(s),s.lookahead<He&&e===ot)return 1;if(s.lookahead===0)break}if(t=0,s.lookahead>=3&&(s.ins_h=at(s,s.ins_h,s.window[s.strstart+3-1]),t=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),t!==0&&s.strstart-t<=s.w_size-He&&(s.match_length=Fa(s,t)),s.match_length>=3)if(n=rt(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do s.strstart++,s.ins_h=at(s,s.ins_h,s.window[s.strstart+3-1]),t=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart;while(--s.match_length!=0);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=at(s,s.ins_h,s.window[s.strstart+1]);else n=rt(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(n&&(ge(s,!1),s.strm.avail_out===0))return 1}return s.insert=s.strstart<2?s.strstart:2,e===Le?(ge(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ge(s,!1),s.strm.avail_out===0)?1:2},Pt=(s,e)=>{let t,n,i;for(;;){if(s.lookahead<He){if(Ft(s),s.lookahead<He&&e===ot)return 1;if(s.lookahead===0)break}if(t=0,s.lookahead>=3&&(s.ins_h=at(s,s.ins_h,s.window[s.strstart+3-1]),t=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,t!==0&&s.prev_length<s.max_lazy_match&&s.strstart-t<=s.w_size-He&&(s.match_length=Fa(s,t),s.match_length<=5&&(s.strategy===$d||s.match_length===3&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){i=s.strstart+s.lookahead-3,n=rt(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do++s.strstart<=i&&(s.ins_h=at(s,s.ins_h,s.window[s.strstart+3-1]),t=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart);while(--s.prev_length!=0);if(s.match_available=0,s.match_length=2,s.strstart++,n&&(ge(s,!1),s.strm.avail_out===0))return 1}else if(s.match_available){if(n=rt(s,0,s.window[s.strstart-1]),n&&ge(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(n=rt(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,e===Le?(ge(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ge(s,!1),s.strm.avail_out===0)?1:2};function Ie(s,e,t,n,i){this.good_length=s,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var ls=[new Ie(0,0,0,0,Ea),new Ie(4,4,8,4,ei),new Ie(4,5,16,8,ei),new Ie(4,6,32,32,ei),new Ie(4,4,16,16,Pt),new Ie(8,16,32,32,Pt),new Ie(8,16,128,128,Pt),new Ie(8,32,128,256,Pt),new Ie(32,128,258,1024,Pt),new Ie(32,258,258,4096,Pt)];function ih(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Tn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),tt(this.dyn_ltree),tt(this.dyn_dtree),tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),tt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var fs=s=>{if(!s)return 1;let e=s.state;return!e||e.strm!==s||e.status!==_t&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Zt&&e.status!==as?1:0},ja=s=>{if(fs(s))return vt(s,Ye);s.total_in=s.total_out=0,s.data_type=sh;let e=s.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?_t:Zt,s.adler=e.wrap===2?0:1,e.last_flush=-2,Jd(e),re},Ja=s=>{let e=ja(s);var t;return e===re&&((t=s.state).window_size=2*t.w_size,tt(t.head),t.max_lazy_match=ls[t.level].max_lazy,t.good_match=ls[t.level].good_length,t.nice_match=ls[t.level].nice_length,t.max_chain_length=ls[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},Ko=(s,e,t,n,i,r)=>{if(!s)return Ye;let o=1;if(e===Ad&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||t!==Tn||n<8||n>15||e<0||e>9||r<0||r>eh||n===8&&o!==1)return vt(s,Ye);n===8&&(n=9);let a=new ih;return s.state=a,a.strm=s,a.status=_t,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=r,a.method=t,Ja(s)},rh=(s,e)=>{if(fs(s)||e>Mo||e<0)return s?vt(s,Ye):Ye;let t=s.state;if(!s.output||s.avail_in!==0&&!s.input||t.status===as&&e!==Le)return vt(s,s.avail_out===0?qn:Ye);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(be(s),s.avail_out===0)return t.last_flush=-1,re}else if(s.avail_in===0&&Ho(e)<=Ho(n)&&e!==Le)return vt(s,qn);if(t.status===as&&s.avail_in!==0)return vt(s,qn);if(t.status===_t&&t.wrap===0&&(t.status=Zt),t.status===_t){let i=Tn+(t.w_bits-8<<4)<<8,r=-1;if(r=t.strategy>=Os||t.level<2?0:t.level<6?1:t.level===6?2:3,i|=r<<6,t.strstart!==0&&(i|=32),i+=31-i%31,qt(t,i),t.strstart!==0&&(qt(t,s.adler>>>16),qt(t,65535&s.adler)),s.adler=1,t.status=Zt,be(s),t.pending!==0)return t.last_flush=-1,re}if(t.status===57){if(s.adler=0,F(t,31),F(t,139),F(t,8),t.gzhead)F(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),F(t,255&t.gzhead.time),F(t,t.gzhead.time>>8&255),F(t,t.gzhead.time>>16&255),F(t,t.gzhead.time>>24&255),F(t,t.level===9?2:t.strategy>=Os||t.level<2?4:0),F(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(F(t,255&t.gzhead.extra.length),F(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(s.adler=se(s.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(F(t,0),F(t,0),F(t,0),F(t,0),F(t,0),F(t,t.level===9?2:t.strategy>=Os||t.level<2?4:0),F(t,3),t.status=Zt,be(s),t.pending!==0)return t.last_flush=-1,re}if(t.status===69){if(t.gzhead.extra){let i=t.pending,r=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>i&&(s.adler=se(s.adler,t.pending_buf,t.pending-i,i)),t.gzindex+=a,be(s),t.pending!==0)return t.last_flush=-1,re;i=0,r-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>i&&(s.adler=se(s.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let i,r=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(s.adler=se(s.adler,t.pending_buf,t.pending-r,r)),be(s),t.pending!==0)return t.last_flush=-1,re;r=0}i=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,F(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>r&&(s.adler=se(s.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let i,r=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(s.adler=se(s.adler,t.pending_buf,t.pending-r,r)),be(s),t.pending!==0)return t.last_flush=-1,re;r=0}i=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,F(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>r&&(s.adler=se(s.adler,t.pending_buf,t.pending-r,r))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(be(s),t.pending!==0))return t.last_flush=-1,re;F(t,255&s.adler),F(t,s.adler>>8&255),s.adler=0}if(t.status=Zt,be(s),t.pending!==0)return t.last_flush=-1,re}if(s.avail_in!==0||t.lookahead!==0||e!==ot&&t.status!==as){let i=t.level===0?Ea(t,e):t.strategy===Os?((r,o)=>{let a;for(;;){if(r.lookahead===0&&(Ft(r),r.lookahead===0)){if(o===ot)return 1;break}if(r.match_length=0,a=rt(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,a&&(ge(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Le?(ge(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(ge(r,!1),r.strm.avail_out===0)?1:2})(t,e):t.strategy===qd?((r,o)=>{let a,c,l,d,p=r.window;for(;;){if(r.lookahead<=wt){if(Ft(r),r.lookahead<=wt&&o===ot)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(l=r.strstart-1,c=p[l],c===p[++l]&&c===p[++l]&&c===p[++l])){d=r.strstart+wt;do;while(c===p[++l]&&c===p[++l]&&c===p[++l]&&c===p[++l]&&c===p[++l]&&c===p[++l]&&c===p[++l]&&c===p[++l]&&l<d);r.match_length=wt-(d-l),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(a=rt(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(a=rt(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),a&&(ge(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Le?(ge(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(ge(r,!1),r.strm.avail_out===0)?1:2})(t,e):ls[t.level].func(t,e);if(i!==3&&i!==4||(t.status=as),i===1||i===3)return s.avail_out===0&&(t.last_flush=-1),re;if(i===2&&(e===Dd?Ud(t):e!==Mo&&(Ci(t,0,0,!1),e===Od&&(tt(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),be(s),s.avail_out===0))return t.last_flush=-1,re}return e!==Le?re:t.wrap<=0?Yo:(t.wrap===2?(F(t,255&s.adler),F(t,s.adler>>8&255),F(t,s.adler>>16&255),F(t,s.adler>>24&255),F(t,255&s.total_in),F(t,s.total_in>>8&255),F(t,s.total_in>>16&255),F(t,s.total_in>>24&255)):(qt(t,s.adler>>>16),qt(t,65535&s.adler)),be(s),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?re:Yo)},bs={deflateInit:(s,e)=>Ko(s,e,Tn,15,8,th),deflateInit2:Ko,deflateReset:Ja,deflateResetKeep:ja,deflateSetHeader:(s,e)=>fs(s)||s.state.wrap!==2?Ye:(s.state.gzhead=e,re),deflate:rh,deflateEnd:s=>{if(fs(s))return Ye;let e=s.state.status;return s.state=null,e===Zt?vt(s,Bd):re},deflateSetDictionary:(s,e)=>{let t=e.length;if(fs(s))return Ye;let n=s.state,i=n.wrap;if(i===2||i===1&&n.status!==_t||n.lookahead)return Ye;if(i===1&&(s.adler=Ps(s.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(tt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}let r=s.avail_in,o=s.next_in,a=s.input;for(s.avail_in=t,s.next_in=0,s.input=e,Ft(n);n.lookahead>=3;){let c=n.strstart,l=n.lookahead-2;do n.ins_h=at(n,n.ins_h,n.window[c+3-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=2,Ft(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,s.next_in=o,s.input=a,s.avail_in=r,n.wrap=i,re},deflateInfo:"pako deflate (from Nodeca project)"},oh=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),Qa=function(s){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)oh(t,n)&&(s[n]=t[n])}}return s},Ua=s=>{let e=0;for(let n=0,i=s.length;n<i;n++)e+=s[n].length;let t=new Uint8Array(e);for(let n=0,i=0,r=s.length;n<r;n++){let o=s[n];t.set(o,i),i+=o.length}return t},Da=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Da=!1}var Is=new Uint8Array(256);for(let s=0;s<256;s++)Is[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Is[254]=Is[254]=1;var $i=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let e,t,n,i,r,o=s.length,a=0;for(i=0;i<o;i++)t=s.charCodeAt(i),(64512&t)==55296&&i+1<o&&(n=s.charCodeAt(i+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),r=0,i=0;r<a;i++)t=s.charCodeAt(i),(64512&t)==55296&&i+1<o&&(n=s.charCodeAt(i+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[r++]=t:t<2048?(e[r++]=192|t>>>6,e[r++]=128|63&t):t<65536?(e[r++]=224|t>>>12,e[r++]=128|t>>>6&63,e[r++]=128|63&t):(e[r++]=240|t>>>18,e[r++]=128|t>>>12&63,e[r++]=128|t>>>6&63,e[r++]=128|63&t);return e},ah=(s,e)=>{let t=e||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,e));let n,i,r=new Array(2*t);for(i=0,n=0;n<t;){let o=s[n++];if(o<128){r[i++]=o;continue}let a=Is[o];if(a>4)r[i++]=65533,n+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|63&s[n++],a--;a>1?r[i++]=65533:o<65536?r[i++]=o:(o-=65536,r[i++]=55296|o>>10&1023,r[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Da)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let c="";for(let l=0;l<a;l++)c+=String.fromCharCode(o[l]);return c})(r,i)},lh=(s,e)=>{(e=e||s.length)>s.length&&(e=s.length);let t=e-1;for(;t>=0&&(192&s[t])==128;)t--;return t<0||t===0?e:t+Is[s[t]]>e?t:e},Oa=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ba=Object.prototype.toString,{Z_NO_FLUSH:ch,Z_SYNC_FLUSH:dh,Z_FULL_FLUSH:hh,Z_FINISH:uh,Z_OK:pn,Z_STREAM_END:mh,Z_DEFAULT_COMPRESSION:ph,Z_DEFAULT_STRATEGY:fh,Z_DEFLATED:bh}=Ms;function ys(s){this.options=Qa({level:ph,method:bh,chunkSize:16384,windowBits:15,memLevel:8,strategy:fh},s||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Oa,this.strm.avail_out=0;let t=bs.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==pn)throw new Error(Gt[t]);if(e.header&&bs.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(n=typeof e.dictionary=="string"?$i(e.dictionary):Ba.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=bs.deflateSetDictionary(this.strm,n),t!==pn)throw new Error(Gt[t]);this._dict_set=!0}}function ti(s,e){let t=new ys(e);if(t.push(s,!0),t.err)throw t.msg||Gt[t.err];return t.result}ys.prototype.push=function(s,e){let t=this.strm,n=this.options.chunkSize,i,r;if(this.ended)return!1;for(r=e===~~e?e:e===!0?uh:ch,typeof s=="string"?t.input=$i(s):Ba.call(s)==="[object ArrayBuffer]"?t.input=new Uint8Array(s):t.input=s,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(r===dh||r===hh)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(i=bs.deflate(t,r),i===mh)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=bs.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===pn;if(t.avail_out!==0){if(r>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},ys.prototype.onData=function(s){this.chunks.push(s)},ys.prototype.onEnd=function(s){s===pn&&(this.result=Ua(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var yh={Deflate:ys,deflate:ti,deflateRaw:function(s,e){return(e=e||{}).raw=!0,ti(s,e)},gzip:function(s,e){return(e=e||{}).gzip=!0,ti(s,e)}},Bs=16209,gh=function(s,e){let t,n,i,r,o,a,c,l,d,p,f,h,v,G,y,X,L,S,Z,u,m,b,g,w,W=s.state;t=s.next_in,g=s.input,n=t+(s.avail_in-5),i=s.next_out,w=s.output,r=i-(e-s.avail_out),o=i+(s.avail_out-257),a=W.dmax,c=W.wsize,l=W.whave,d=W.wnext,p=W.window,f=W.hold,h=W.bits,v=W.lencode,G=W.distcode,y=(1<<W.lenbits)-1,X=(1<<W.distbits)-1;e:do{h<15&&(f+=g[t++]<<h,h+=8,f+=g[t++]<<h,h+=8),L=v[f&y];t:for(;;){if(S=L>>>24,f>>>=S,h-=S,S=L>>>16&255,S===0)w[i++]=65535&L;else{if(!(16&S)){if(64&S){if(32&S){W.mode=16191;break e}s.msg="invalid literal/length code",W.mode=Bs;break e}L=v[(65535&L)+(f&(1<<S)-1)];continue t}for(Z=65535&L,S&=15,S&&(h<S&&(f+=g[t++]<<h,h+=8),Z+=f&(1<<S)-1,f>>>=S,h-=S),h<15&&(f+=g[t++]<<h,h+=8,f+=g[t++]<<h,h+=8),L=G[f&X];;){if(S=L>>>24,f>>>=S,h-=S,S=L>>>16&255,16&S){if(u=65535&L,S&=15,h<S&&(f+=g[t++]<<h,h+=8,h<S&&(f+=g[t++]<<h,h+=8)),u+=f&(1<<S)-1,u>a){s.msg="invalid distance too far back",W.mode=Bs;break e}if(f>>>=S,h-=S,S=i-r,u>S){if(S=u-S,S>l&&W.sane){s.msg="invalid distance too far back",W.mode=Bs;break e}if(m=0,b=p,d===0){if(m+=c-S,S<Z){Z-=S;do w[i++]=p[m++];while(--S);m=i-u,b=w}}else if(d<S){if(m+=c+d-S,S-=d,S<Z){Z-=S;do w[i++]=p[m++];while(--S);if(m=0,d<Z){S=d,Z-=S;do w[i++]=p[m++];while(--S);m=i-u,b=w}}}else if(m+=d-S,S<Z){Z-=S;do w[i++]=p[m++];while(--S);m=i-u,b=w}for(;Z>2;)w[i++]=b[m++],w[i++]=b[m++],w[i++]=b[m++],Z-=3;Z&&(w[i++]=b[m++],Z>1&&(w[i++]=b[m++]))}else{m=i-u;do w[i++]=w[m++],w[i++]=w[m++],w[i++]=w[m++],Z-=3;while(Z>2);Z&&(w[i++]=w[m++],Z>1&&(w[i++]=w[m++]))}break}if(64&S){s.msg="invalid distance code",W.mode=Bs;break e}L=G[(65535&L)+(f&(1<<S)-1)]}}break}}while(t<n&&i<o);Z=h>>3,t-=Z,h-=Z<<3,f&=(1<<h)-1,s.next_in=t,s.next_out=i,s.avail_in=t<n?n-t+5:5-(t-n),s.avail_out=i<o?o-i+257:257-(i-o),W.hold=f,W.bits=h},As=15,wh=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zh=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vh=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xh=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),gs=(s,e,t,n,i,r,o,a)=>{let c=a.bits,l,d,p,f,h,v,G=0,y=0,X=0,L=0,S=0,Z=0,u=0,m=0,b=0,g=0,w=null,W=new Uint16Array(16),R=new Uint16Array(16),M,K,N,H=null;for(G=0;G<=As;G++)W[G]=0;for(y=0;y<n;y++)W[e[t+y]]++;for(S=c,L=As;L>=1&&W[L]===0;L--);if(S>L&&(S=L),L===0)return i[r++]=20971520,i[r++]=20971520,a.bits=1,0;for(X=1;X<L&&W[X]===0;X++);for(S<X&&(S=X),m=1,G=1;G<=As;G++)if(m<<=1,m-=W[G],m<0)return-1;if(m>0&&(s===0||L!==1))return-1;for(R[1]=0,G=1;G<As;G++)R[G+1]=R[G]+W[G];for(y=0;y<n;y++)e[t+y]!==0&&(o[R[e[t+y]]++]=y);if(s===0?(w=H=o,v=20):s===1?(w=wh,H=Zh,v=257):(w=vh,H=Xh,v=0),g=0,y=0,G=X,h=r,Z=S,u=0,p=-1,b=1<<S,f=b-1,s===1&&b>852||s===2&&b>592)return 1;for(;;){M=G-u,o[y]+1<v?(K=0,N=o[y]):o[y]>=v?(K=H[o[y]-v],N=w[o[y]-v]):(K=96,N=0),l=1<<G-u,d=1<<Z,X=d;do d-=l,i[h+(g>>u)+d]=M<<24|K<<16|N;while(d!==0);for(l=1<<G-1;g&l;)l>>=1;if(l!==0?(g&=l-1,g+=l):g=0,y++,--W[G]==0){if(G===L)break;G=e[t+o[y]]}if(G>S&&(g&f)!==p){for(u===0&&(u=S),h+=X,Z=G-u,m=1<<Z;Z+u<L&&(m-=W[Z+u],!(m<=0));)Z++,m<<=1;if(b+=1<<Z,s===1&&b>852||s===2&&b>592)return 1;p=g&f,i[p]=S<<24|Z<<16|h-r}}return g!==0&&(i[h+g]=G-u<<24|64<<16),a.bits=S,0},{Z_FINISH:No,Z_BLOCK:Lh,Z_TREES:$s,Z_OK:xt,Z_STREAM_END:xh,Z_NEED_DICT:Sh,Z_STREAM_ERROR:xe,Z_DATA_ERROR:Aa,Z_MEM_ERROR:$a,Z_BUF_ERROR:Gh,Z_DEFLATED:zo}=Ms,Wn=16180,fn=16190,ze=16191,si=16192,ni=16194,qs=16199,en=16200,ii=16206,D=16209,_o=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function Th(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var St=s=>{if(!s)return 1;let e=s.state;return!e||e.strm!==s||e.mode<Wn||e.mode>16211?1:0},qa=s=>{if(St(s))return xe;let e=s.state;return s.total_in=s.total_out=e.total=0,s.msg="",e.wrap&&(s.adler=1&e.wrap),e.mode=Wn,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,xt},el=s=>{if(St(s))return xe;let e=s.state;return e.wsize=0,e.whave=0,e.wnext=0,qa(s)},tl=(s,e)=>{let t;if(St(s))return xe;let n=s.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?xe:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,el(s))},Fo=(s,e)=>{if(!s)return xe;let t=new Th;s.state=t,t.strm=s,t.window=null,t.mode=Wn;let n=tl(s,e);return n!==xt&&(s.state=null),n},ri,oi,Eo=!0,Wh=s=>{if(Eo){ri=new Int32Array(512),oi=new Int32Array(32);let e=0;for(;e<144;)s.lens[e++]=8;for(;e<256;)s.lens[e++]=9;for(;e<280;)s.lens[e++]=7;for(;e<288;)s.lens[e++]=8;for(gs(1,s.lens,0,288,ri,0,s.work,{bits:9}),e=0;e<32;)s.lens[e++]=5;gs(2,s.lens,0,32,oi,0,s.work,{bits:5}),Eo=!1}s.lencode=ri,s.lenbits=9,s.distcode=oi,s.distbits=5},sl=(s,e,t,n)=>{let i,r=s.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(e.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(i=r.wsize-r.wnext,i>n&&(i=n),r.window.set(e.subarray(t-n,t-n+i),r.wnext),(n-=i)?(r.window.set(e.subarray(t-n,t),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0},Ch=(s,e)=>{let t,n,i,r,o,a,c,l,d,p,f,h,v,G,y,X,L,S,Z,u,m,b,g=0,w=new Uint8Array(4),W,R,M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(St(s)||!s.output||!s.input&&s.avail_in!==0)return xe;t=s.state,t.mode===ze&&(t.mode=si),o=s.next_out,i=s.output,c=s.avail_out,r=s.next_in,n=s.input,a=s.avail_in,l=t.hold,d=t.bits,p=a,f=c,b=xt;e:for(;;)switch(t.mode){case Wn:if(t.wrap===0){t.mode=si;break}for(;d<16;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(2&t.wrap&&l===35615){t.wbits===0&&(t.wbits=15),t.check=0,w[0]=255&l,w[1]=l>>>8&255,t.check=se(t.check,w,2,0),l=0,d=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&l)<<8)+(l>>8))%31){s.msg="incorrect header check",t.mode=D;break}if((15&l)!==zo){s.msg="unknown compression method",t.mode=D;break}if(l>>>=4,d-=4,m=8+(15&l),t.wbits===0&&(t.wbits=m),m>15||m>t.wbits){s.msg="invalid window size",t.mode=D;break}t.dmax=1<<t.wbits,t.flags=0,s.adler=t.check=1,t.mode=512&l?16189:ze,l=0,d=0;break;case 16181:for(;d<16;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(t.flags=l,(255&t.flags)!==zo){s.msg="unknown compression method",t.mode=D;break}if(57344&t.flags){s.msg="unknown header flags set",t.mode=D;break}t.head&&(t.head.text=l>>8&1),512&t.flags&&4&t.wrap&&(w[0]=255&l,w[1]=l>>>8&255,t.check=se(t.check,w,2,0)),l=0,d=0,t.mode=16182;case 16182:for(;d<32;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.head&&(t.head.time=l),512&t.flags&&4&t.wrap&&(w[0]=255&l,w[1]=l>>>8&255,w[2]=l>>>16&255,w[3]=l>>>24&255,t.check=se(t.check,w,4,0)),l=0,d=0,t.mode=16183;case 16183:for(;d<16;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.head&&(t.head.xflags=255&l,t.head.os=l>>8),512&t.flags&&4&t.wrap&&(w[0]=255&l,w[1]=l>>>8&255,t.check=se(t.check,w,2,0)),l=0,d=0,t.mode=16184;case 16184:if(1024&t.flags){for(;d<16;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.length=l,t.head&&(t.head.extra_len=l),512&t.flags&&4&t.wrap&&(w[0]=255&l,w[1]=l>>>8&255,t.check=se(t.check,w,2,0)),l=0,d=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&t.flags&&(h=t.length,h>a&&(h=a),h&&(t.head&&(m=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(r,r+h),m)),512&t.flags&&4&t.wrap&&(t.check=se(t.check,n,h,r)),a-=h,r+=h,t.length-=h),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&t.flags){if(a===0)break e;h=0;do m=n[r+h++],t.head&&m&&t.length<65536&&(t.head.name+=String.fromCharCode(m));while(m&&h<a);if(512&t.flags&&4&t.wrap&&(t.check=se(t.check,n,h,r)),a-=h,r+=h,m)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&t.flags){if(a===0)break e;h=0;do m=n[r+h++],t.head&&m&&t.length<65536&&(t.head.comment+=String.fromCharCode(m));while(m&&h<a);if(512&t.flags&&4&t.wrap&&(t.check=se(t.check,n,h,r)),a-=h,r+=h,m)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&t.flags){for(;d<16;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(4&t.wrap&&l!==(65535&t.check)){s.msg="header crc mismatch",t.mode=D;break}l=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),s.adler=t.check=0,t.mode=ze;break;case 16189:for(;d<32;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}s.adler=t.check=_o(l),l=0,d=0,t.mode=fn;case fn:if(t.havedict===0)return s.next_out=o,s.avail_out=c,s.next_in=r,s.avail_in=a,t.hold=l,t.bits=d,Sh;s.adler=t.check=1,t.mode=ze;case ze:if(e===Lh||e===$s)break e;case si:if(t.last){l>>>=7&d,d-=7&d,t.mode=ii;break}for(;d<3;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}switch(t.last=1&l,l>>>=1,d-=1,3&l){case 0:t.mode=16193;break;case 1:if(Wh(t),t.mode=qs,e===$s){l>>>=2,d-=2;break e}break;case 2:t.mode=16196;break;case 3:s.msg="invalid block type",t.mode=D}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){s.msg="invalid stored block lengths",t.mode=D;break}if(t.length=65535&l,l=0,d=0,t.mode=ni,e===$s)break e;case ni:t.mode=16195;case 16195:if(h=t.length,h){if(h>a&&(h=a),h>c&&(h=c),h===0)break e;i.set(n.subarray(r,r+h),o),a-=h,r+=h,c-=h,o+=h,t.length-=h;break}t.mode=ze;break;case 16196:for(;d<14;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(t.nlen=257+(31&l),l>>>=5,d-=5,t.ndist=1+(31&l),l>>>=5,d-=5,t.ncode=4+(15&l),l>>>=4,d-=4,t.nlen>286||t.ndist>30){s.msg="too many length or distance symbols",t.mode=D;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;d<3;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.lens[M[t.have++]]=7&l,l>>>=3,d-=3}for(;t.have<19;)t.lens[M[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,W={bits:t.lenbits},b=gs(0,t.lens,0,19,t.lencode,0,t.work,W),t.lenbits=W.bits,b){s.msg="invalid code lengths set",t.mode=D;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[l&(1<<t.lenbits)-1],y=g>>>24,X=g>>>16&255,L=65535&g,!(y<=d);){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(L<16)l>>>=y,d-=y,t.lens[t.have++]=L;else{if(L===16){for(R=y+2;d<R;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(l>>>=y,d-=y,t.have===0){s.msg="invalid bit length repeat",t.mode=D;break}m=t.lens[t.have-1],h=3+(3&l),l>>>=2,d-=2}else if(L===17){for(R=y+3;d<R;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}l>>>=y,d-=y,m=0,h=3+(7&l),l>>>=3,d-=3}else{for(R=y+7;d<R;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}l>>>=y,d-=y,m=0,h=11+(127&l),l>>>=7,d-=7}if(t.have+h>t.nlen+t.ndist){s.msg="invalid bit length repeat",t.mode=D;break}for(;h--;)t.lens[t.have++]=m}}if(t.mode===D)break;if(t.lens[256]===0){s.msg="invalid code -- missing end-of-block",t.mode=D;break}if(t.lenbits=9,W={bits:t.lenbits},b=gs(1,t.lens,0,t.nlen,t.lencode,0,t.work,W),t.lenbits=W.bits,b){s.msg="invalid literal/lengths set",t.mode=D;break}if(t.distbits=6,t.distcode=t.distdyn,W={bits:t.distbits},b=gs(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,W),t.distbits=W.bits,b){s.msg="invalid distances set",t.mode=D;break}if(t.mode=qs,e===$s)break e;case qs:t.mode=en;case en:if(a>=6&&c>=258){s.next_out=o,s.avail_out=c,s.next_in=r,s.avail_in=a,t.hold=l,t.bits=d,gh(s,f),o=s.next_out,i=s.output,c=s.avail_out,r=s.next_in,n=s.input,a=s.avail_in,l=t.hold,d=t.bits,t.mode===ze&&(t.back=-1);break}for(t.back=0;g=t.lencode[l&(1<<t.lenbits)-1],y=g>>>24,X=g>>>16&255,L=65535&g,!(y<=d);){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(X&&!(240&X)){for(S=y,Z=X,u=L;g=t.lencode[u+((l&(1<<S+Z)-1)>>S)],y=g>>>24,X=g>>>16&255,L=65535&g,!(S+y<=d);){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}l>>>=S,d-=S,t.back+=S}if(l>>>=y,d-=y,t.back+=y,t.length=L,X===0){t.mode=16205;break}if(32&X){t.back=-1,t.mode=ze;break}if(64&X){s.msg="invalid literal/length code",t.mode=D;break}t.extra=15&X,t.mode=16201;case 16201:if(t.extra){for(R=t.extra;d<R;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;g=t.distcode[l&(1<<t.distbits)-1],y=g>>>24,X=g>>>16&255,L=65535&g,!(y<=d);){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(!(240&X)){for(S=y,Z=X,u=L;g=t.distcode[u+((l&(1<<S+Z)-1)>>S)],y=g>>>24,X=g>>>16&255,L=65535&g,!(S+y<=d);){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}l>>>=S,d-=S,t.back+=S}if(l>>>=y,d-=y,t.back+=y,64&X){s.msg="invalid distance code",t.mode=D;break}t.offset=L,t.extra=15&X,t.mode=16203;case 16203:if(t.extra){for(R=t.extra;d<R;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){s.msg="invalid distance too far back",t.mode=D;break}t.mode=16204;case 16204:if(c===0)break e;if(h=f-c,t.offset>h){if(h=t.offset-h,h>t.whave&&t.sane){s.msg="invalid distance too far back",t.mode=D;break}h>t.wnext?(h-=t.wnext,v=t.wsize-h):v=t.wnext-h,h>t.length&&(h=t.length),G=t.window}else G=i,v=o-t.offset,h=t.length;h>c&&(h=c),c-=h,t.length-=h;do i[o++]=G[v++];while(--h);t.length===0&&(t.mode=en);break;case 16205:if(c===0)break e;i[o++]=t.length,c--,t.mode=en;break;case ii:if(t.wrap){for(;d<32;){if(a===0)break e;a--,l|=n[r++]<<d,d+=8}if(f-=c,s.total_out+=f,t.total+=f,4&t.wrap&&f&&(s.adler=t.check=t.flags?se(t.check,i,f,o-f):Ps(t.check,i,f,o-f)),f=c,4&t.wrap&&(t.flags?l:_o(l))!==t.check){s.msg="incorrect data check",t.mode=D;break}l=0,d=0}t.mode=16207;case 16207:if(t.wrap&&t.flags){for(;d<32;){if(a===0)break e;a--,l+=n[r++]<<d,d+=8}if(4&t.wrap&&l!==(4294967295&t.total)){s.msg="incorrect length check",t.mode=D;break}l=0,d=0}t.mode=16208;case 16208:b=xh;break e;case D:b=Aa;break e;case 16210:return $a;default:return xe}return s.next_out=o,s.avail_out=c,s.next_in=r,s.avail_in=a,t.hold=l,t.bits=d,(t.wsize||f!==s.avail_out&&t.mode<D&&(t.mode<ii||e!==No))&&sl(s,s.output,s.next_out,f-s.avail_out),p-=s.avail_in,f-=s.avail_out,s.total_in+=p,s.total_out+=f,t.total+=f,4&t.wrap&&f&&(s.adler=t.check=t.flags?se(t.check,i,f,s.next_out-f):Ps(t.check,i,f,s.next_out-f)),s.data_type=t.bits+(t.last?64:0)+(t.mode===ze?128:0)+(t.mode===qs||t.mode===ni?256:0),(p===0&&f===0||e===No)&&b===xt&&(b=Gh),b},De={inflateReset:el,inflateReset2:tl,inflateResetKeep:qa,inflateInit:s=>Fo(s,15),inflateInit2:Fo,inflate:Ch,inflateEnd:s=>{if(St(s))return xe;let e=s.state;return e.window&&(e.window=null),s.state=null,xt},inflateGetHeader:(s,e)=>{if(St(s))return xe;let t=s.state;return 2&t.wrap?(t.head=e,e.done=!1,xt):xe},inflateSetDictionary:(s,e)=>{let t=e.length,n,i,r;return St(s)?xe:(n=s.state,n.wrap!==0&&n.mode!==fn?xe:n.mode===fn&&(i=1,i=Ps(i,e,t,0),i!==n.check)?Aa:(r=sl(s,e,t,t),r?(n.mode=16210,$a):(n.havedict=1,xt)))},inflateInfo:"pako inflate (from Nodeca project)"},kh=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},nl=Object.prototype.toString,{Z_NO_FLUSH:Ph,Z_FINISH:Ih,Z_OK:ws,Z_STREAM_END:ai,Z_NEED_DICT:li,Z_STREAM_ERROR:Rh,Z_DATA_ERROR:jo,Z_MEM_ERROR:Vh}=Ms;function Zs(s){this.options=Qa({chunkSize:65536,windowBits:15,to:""},s||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||s&&s.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Oa,this.strm.avail_out=0;let t=De.inflateInit2(this.strm,e.windowBits);if(t!==ws)throw new Error(Gt[t]);if(this.header=new kh,De.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=$i(e.dictionary):nl.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=De.inflateSetDictionary(this.strm,e.dictionary),t!==ws)))throw new Error(Gt[t])}function ci(s,e){let t=new Zs(e);if(t.push(s),t.err)throw t.msg||Gt[t.err];return t.result}Zs.prototype.push=function(s,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,r,o,a;if(this.ended)return!1;for(o=e===~~e?e:e===!0?Ih:Ph,nl.call(s)==="[object ArrayBuffer]"?t.input=new Uint8Array(s):t.input=s,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),r=De.inflate(t,o),r===li&&i&&(r=De.inflateSetDictionary(t,i),r===ws?r=De.inflate(t,o):r===jo&&(r=li));t.avail_in>0&&r===ai&&t.state.wrap>0&&s[t.next_in]!==0;)De.inflateReset(t),r=De.inflate(t,o);switch(r){case Rh:case jo:case li:case Vh:return this.onEnd(r),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||r===ai))if(this.options.to==="string"){let c=lh(t.output,t.next_out),l=t.next_out-c,d=ah(t.output,c);t.next_out=l,t.avail_out=n-l,l&&t.output.set(t.output.subarray(c,c+l),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(r!==ws||a!==0){if(r===ai)return r=De.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Zs.prototype.onData=function(s){this.chunks.push(s)},Zs.prototype.onEnd=function(s){s===ws&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ua(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var Mh={Inflate:Zs,inflate:ci,inflateRaw:function(s,e){return(e=e||{}).raw=!0,ci(s,e)},ungzip:ci},{Deflate:Yh,deflate:Hh,deflateRaw:Kh,gzip:Nh}=yh,{Inflate:zh,inflate:_h,inflateRaw:Fh,ungzip:Eh}=Mh,jh={Deflate:Yh,deflate:Hh,deflateRaw:Kh,gzip:Nh,Inflate:zh,inflate:_h,inflateRaw:Fh,ungzip:Eh,constants:Ms},Pi=class{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout(()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()},50),this.start=Date.now()}send(e){let{id:t,action:n,args:i}=JSON.parse(e);switch(n){case"JOIN":return this.id=t,this.ticks=i.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:i.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[i.user],active:1,total:1}]),void this.tick();case"SEND":{let r=[...i];return r[0]=this.time,r[1]=++this.seq,void this.reply("RECV",r)}case"PULSE":return;default:throw Error("Offline unhandled "+n)}}close(e,t){this.readyState=WebSocket.CLOSING,setTimeout(()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:e,reason:t})},50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval(()=>{this.reply("TICK",{time:this.time})},this.ticks)}reply(e,t){setTimeout(()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:e,args:t})})},50)}},Jh=!!globalThis.navigator?.userAgent.toLowerCase().includes("firefox"),Q={get connection(){return Q={connection:Y.has("debug","connection",!1)},Q.connection}},Ii=class{static get name(){return`${P.libName}WebRTCConnection`}constructor(e){var t;this.clientId=(t=4,Math.random().toString(36).substring(2,2+t)),Q.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(e)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(e){try{await this.openSignalingChannel(e),Q.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),Q.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),Q.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=i=>this.onDataChannelOpen(i),this.dataChannel.onmessage=i=>this.onDataChannelMessage(i),this.dataChannel.onclosing=i=>this.onDataChannelClosing(i),this.dataChannel.onclose=i=>this.onDataChannelClose(i),this.dataChannel.onerror=i=>this.onDataChannelError(i);let t=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN||(this.negotiationTimeout=setTimeout(()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||(Q.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")},15e3),this.signalToSessionRunner({type:"offer",sdp:t.sdp}),await this.pc.setLocalDescription(t),!this.pc.sctp))return;let n=this.pc.sctp.transport.iceTransport;n.onselectedcandidatepairchange=i=>{Q.connection&&console.log(`${this.clientId} ICE candidate pair changed`);let r=n.getSelectedCandidatePair();this.connectionTypes.local=r.local.type,this.connectionTypes.remote=r.remote.type,this.logConnectionState()}}catch(t){this.synchronizerDisconnected(t.code||4003,t.message)}}openSignalingChannel(e){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise(t=>{this.signaling=new WebSocket(e),this.signaling.onopen=()=>{Q.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=n=>{let i=JSON.parse(n.data);if(i.what==="READY")return this.clientId+=`_${i.id}`,this.iceServers=i.iceServers,void t();if(i.what!=="ERROR")if(i.type)switch(Q.connection&&console.log(`${this.clientId} received signal of type "${i.type}"`),i.type){case"answer":this.handleAnswer(i);break;case"candidate":this.handleCandidate(i);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:Q.connection&&console.log(`${this.clientId} unhandled: ${i.type}`)}else console.error(`${this.clientId} unexpected message: ${n.data}`);else console.error(`${this.clientId} registry error: ${i.reason}`)},this.signaling.onclose=n=>{Q.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${n.code})`),this.synchronizerDisconnected(n.code,n.reason)},this.signaling.onerror=n=>{Q.connection&&console.log(`${this.clientId} signaling socket error`,n),this.synchronizerError()}}))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(e){let t=JSON.stringify(e);try{this.signaling.send(t)}catch(n){console.error(`${this.clientId} WebRTC signaling send error`,n)}}async logConnectionState(){if(Jh&&this.pc)try{let n=await this.pc.getStats();if(n){let i=null;for(let o of n.values())if(o.type==="transport"){i=o.selectedCandidatePairId;break}let r=n.get(i);if(!r){for(let o of n.values())if(o.type==="candidate-pair"&&o.selected){r=o;break}}r&&(this.connectionTypes.local=n.get(r.localCandidateId).candidateType,this.connectionTypes.remote=n.get(r.remoteCandidateId).candidateType)}}catch{}let e=this.connectionTypes.local||"",t=this.connectionTypes.remote||"";if(Q.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${e}"; synchronizer connection="${t}")`),this.signaling?.readyState===WebSocket.OPEN){let n={type:"selectedCandidatePair",clientType:e,syncType:t};this.signalToSessionRunner(n)}}close(e,t){this.cleanUpConnection()}synchronizerDisconnected(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1006,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"connection to synchronizer lost";this.synchronizerCloseReason&&(e=this.synchronizerCloseReason[0],t=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:e,reason:t})}synchronizerError(e){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,e)}cleanUpConnection(){this.closeSignalingChannel();let{pc:e}=this;e&&(this.pc=null,e.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){let{iceServers:e}=this,t=new Set,n=this.pc=new globalThis.RTCPeerConnection({iceServers:e});n.onnegotiationneeded=i=>{n===this.pc&&Q.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},n.onsignalingstatechange=i=>{n===this.pc&&Q.connection&&console.log(`${this.clientId} signaling state: "${n.signalingState}"`)},n.onconnectionstatechange=i=>{if(n!==this.pc)return;let{connectionState:r,iceConnectionState:o}=n;Q.connection&&console.log(`${this.clientId} connection state: "${r}" (cf. ICE connection state: "${o}")`),r!=="disconnected"&&r!=="failed"||this.synchronizerDisconnected()},n.oniceconnectionstatechange=i=>{if(n!==this.pc)return;let r=n.iceConnectionState,o=this.dataChannel.readyState;Q.connection&&console.log(`${this.clientId} ICE connection state: "${r}"; data channel: "${o}"`),r==="failed"&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},n.onicegatheringstatechange=i=>{if(n!==this.pc)return;let r=n.iceGatheringState;Q.connection&&console.log(`${this.clientId} ICE gathering state: "${r}"`),r==="complete"&&(this.localGatheringComplete=!0)},n.onicecandidate=i=>{if(n===this.pc)if(i.candidate){if(this.signaling?.readyState===WebSocket.OPEN){let r={type:"candidate",candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex};this.signalToSessionRunner(r)}}else this.localGatheringComplete=!0},n.onicecandidateerror=i=>{if(n===this.pc&&Q.connection){let r=`${i.errorCode}|${i.url}`;t.has(r)||(i.errorCode===701?console.log(`${this.clientId} ICE 701 warning on ${i.url}`):console.log(`${this.clientId} ICE error from ${i.url}: ${i.errorCode} ${i.errorText}`),t.add(r))}}}async handleAnswer(e){this.pc?await this.pc.setRemoteDescription(e):console.error("no peerconnection")}async handleCandidate(e){this.pc?e.candidate?await this.pc.addIceCandidate(e):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(e){this.dataChannel?this.dataChannel.send(e):console.warn(`${this.clientId} no data channel to send: ${e}`)}onDataChannelOpen(e){Q.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(e){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());let t=e.data;if(t.startsWith("!ping"))this.send(t.replace("ping","pong"));else if(t.startsWith("!close")){let n=t.split("|");this.synchronizerCloseReason=[Number(n[1]),n[2]]}else this.onmessage(e)}onDataChannelError(e){console.error(`${this.clientId} RTCDataChannel error`,e),this.synchronizerError(e.errorDetail)}onDataChannelClosing(e){this.pc&&(Q.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(e){this.pc&&(Q.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,Q.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);let{signalingKey:e}=this;setTimeout(()=>{e===this.signalingKey&&(Q.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())},1e3)}async defunct_readConnectionType(){let e=await this.pc.getStats();if(e){let t=null;for(let[i,r]of e)if(r.type==="transport"){t=r.selectedCandidatePairId;break}let n=e.get(t);if(!n){for(let[i,r]of e)if(r.type==="candidate-pair"&&r.selected){n=r;break}}if(n){for(let[i,r]of e)if(i===n.remoteCandidateId)return r.candidateType}}return""}};function Qh(s,e,t){var n=function(a){return atob(a)}(s),i=n.indexOf(`
`,10)+1,r=n.substring(i)+"",o=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(o)}function Uh(s,e,t){var n;return function(i){return n=n||Qh(s),new Worker(n,i)}}var Dh=Uh("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI1CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjUtMDYtMDkKICogVmVyc2lvbjogMi4wLjQKICovCgohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiBlKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJkZWZhdWx0Iik/dC5kZWZhdWx0OnR9ZnVuY3Rpb24gcih0KXtpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiX19lc01vZHVsZSIpKXJldHVybiB0O3ZhciBlPXQuZGVmYXVsdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSl7dmFyIHI9ZnVuY3Rpb24gdCgpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgdD9SZWZsZWN0LmNvbnN0cnVjdChlLGFyZ3VtZW50cyx0aGlzLmNvbnN0cnVjdG9yKTplLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ci5wcm90b3R5cGU9ZS5wcm90b3R5cGV9ZWxzZSByPXt9O3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LGUpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShyLGUsbi5nZXQ/bjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdFtlXX19KX0pKSxyfXZhciBuLGk9e2V4cG9ydHM6e319O258fChuPTEsZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7dmFyIGUscj1PYmplY3QucHJvdG90eXBlLG49ci5oYXNPd25Qcm9wZXJ0eSxpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eXx8ZnVuY3Rpb24odCxlLHIpe3RbZV09ci52YWx1ZX0sYT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxzPWEuaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixvPWEuYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIsbD1hLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gaCh0LGUscil7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KSx0W2VdfXRyeXtoKHt9LCIiKX1jYXRjaCh0KXtoPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdFtlXT1yfX1mdW5jdGlvbiBjKHQsZSxyLG4pe3ZhciBhPWUmJmUucHJvdG90eXBlIGluc3RhbmNlb2YgeT9lOnkscz1PYmplY3QuY3JlYXRlKGEucHJvdG90eXBlKSxvPW5ldyBMKG58fFtdKTtyZXR1cm4gaShzLCJfaW52b2tlIix7dmFsdWU6RSh0LHIsbyl9KSxzfWZ1bmN0aW9uIHUodCxlLHIpe3RyeXtyZXR1cm57dHlwZToibm9ybWFsIixhcmc6dC5jYWxsKGUscil9fWNhdGNoKHQpe3JldHVybnt0eXBlOiJ0aHJvdyIsYXJnOnR9fX10LndyYXA9Yzt2YXIgXz0ic3VzcGVuZGVkU3RhcnQiLGQ9InN1c3BlbmRlZFlpZWxkIixmPSJleGVjdXRpbmciLHA9ImNvbXBsZXRlZCIsZz17fTtmdW5jdGlvbiB5KCl7fWZ1bmN0aW9uIHcoKXt9ZnVuY3Rpb24gdigpe312YXIgbT17fTtoKG0scywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKTt2YXIgYj1PYmplY3QuZ2V0UHJvdG90eXBlT2YseD1iJiZiKGIoUihbXSkpKTt4JiZ4IT09ciYmbi5jYWxsKHgscykmJihtPXgpO3ZhciBrPXYucHJvdG90eXBlPXkucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobSk7ZnVuY3Rpb24geih0KXtbIm5leHQiLCJ0aHJvdyIsInJldHVybiJdLmZvckVhY2goKGZ1bmN0aW9uKGUpe2godCxlLChmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faW52b2tlKGUsdCl9KSl9KSl9ZnVuY3Rpb24gQSh0LGUpe2Z1bmN0aW9uIHIoaSxhLHMsbyl7dmFyIGw9dSh0W2ldLHQsYSk7aWYoInRocm93IiE9PWwudHlwZSl7dmFyIGg9bC5hcmcsYz1oLnZhbHVlO3JldHVybiBjJiYib2JqZWN0Ij09dHlwZW9mIGMmJm4uY2FsbChjLCJfX2F3YWl0Iik/ZS5yZXNvbHZlKGMuX19hd2FpdCkudGhlbigoZnVuY3Rpb24odCl7cigibmV4dCIsdCxzLG8pfSksKGZ1bmN0aW9uKHQpe3IoInRocm93Iix0LHMsbyl9KSk6ZS5yZXNvbHZlKGMpLnRoZW4oKGZ1bmN0aW9uKHQpe2gudmFsdWU9dCxzKGgpfSksKGZ1bmN0aW9uKHQpe3JldHVybiByKCJ0aHJvdyIsdCxzLG8pfSkpfW8obC5hcmcpfXZhciBhO2kodGhpcywiX2ludm9rZSIse3ZhbHVlOmZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gaSgpe3JldHVybiBuZXcgZSgoZnVuY3Rpb24oZSxpKXtyKHQsbixlLGkpfSkpfXJldHVybiBhPWE/YS50aGVuKGksaSk6aSgpfX0pfWZ1bmN0aW9uIEUodCxyLG4pe3ZhciBpPV87cmV0dXJuIGZ1bmN0aW9uKGEscyl7aWYoaT09PWYpdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYoaT09PXApe2lmKCJ0aHJvdyI9PT1hKXRocm93IHM7cmV0dXJue3ZhbHVlOmUsZG9uZTohMH19Zm9yKG4ubWV0aG9kPWEsbi5hcmc9czs7KXt2YXIgbz1uLmRlbGVnYXRlO2lmKG8pe3ZhciBsPVMobyxuKTtpZihsKXtpZihsPT09Zyljb250aW51ZTtyZXR1cm4gbH19aWYoIm5leHQiPT09bi5tZXRob2Qpbi5zZW50PW4uX3NlbnQ9bi5hcmc7ZWxzZSBpZigidGhyb3ciPT09bi5tZXRob2Qpe2lmKGk9PT1fKXRocm93IGk9cCxuLmFyZztuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKX1lbHNlInJldHVybiI9PT1uLm1ldGhvZCYmbi5hYnJ1cHQoInJldHVybiIsbi5hcmcpO2k9Zjt2YXIgaD11KHQscixuKTtpZigibm9ybWFsIj09PWgudHlwZSl7aWYoaT1uLmRvbmU/cDpkLGguYXJnPT09Zyljb250aW51ZTtyZXR1cm57dmFsdWU6aC5hcmcsZG9uZTpuLmRvbmV9fSJ0aHJvdyI9PT1oLnR5cGUmJihpPXAsbi5tZXRob2Q9InRocm93IixuLmFyZz1oLmFyZyl9fX1mdW5jdGlvbiBTKHQscil7dmFyIG49ci5tZXRob2QsaT10Lml0ZXJhdG9yW25dO2lmKGk9PT1lKXJldHVybiByLmRlbGVnYXRlPW51bGwsInRocm93Ij09PW4mJnQuaXRlcmF0b3IucmV0dXJuJiYoci5tZXRob2Q9InJldHVybiIsci5hcmc9ZSxTKHQsciksInRocm93Ij09PXIubWV0aG9kKXx8InJldHVybiIhPT1uJiYoci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciK24rIicgbWV0aG9kIikpLGc7dmFyIGE9dShpLHQuaXRlcmF0b3Isci5hcmcpO2lmKCJ0aHJvdyI9PT1hLnR5cGUpcmV0dXJuIHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9YS5hcmcsci5kZWxlZ2F0ZT1udWxsLGc7dmFyIHM9YS5hcmc7cmV0dXJuIHM/cy5kb25lPyhyW3QucmVzdWx0TmFtZV09cy52YWx1ZSxyLm5leHQ9dC5uZXh0TG9jLCJyZXR1cm4iIT09ci5tZXRob2QmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksci5kZWxlZ2F0ZT1udWxsLGcpOnM6KHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9bmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSxyLmRlbGVnYXRlPW51bGwsZyl9ZnVuY3Rpb24gQih0KXt2YXIgZT17dHJ5TG9jOnRbMF19OzEgaW4gdCYmKGUuY2F0Y2hMb2M9dFsxXSksMiBpbiB0JiYoZS5maW5hbGx5TG9jPXRbMl0sZS5hZnRlckxvYz10WzNdKSx0aGlzLnRyeUVudHJpZXMucHVzaChlKX1mdW5jdGlvbiBPKHQpe3ZhciBlPXQuY29tcGxldGlvbnx8e307ZS50eXBlPSJub3JtYWwiLGRlbGV0ZSBlLmFyZyx0LmNvbXBsZXRpb249ZX1mdW5jdGlvbiBMKHQpe3RoaXMudHJ5RW50cmllcz1be3RyeUxvYzoicm9vdCJ9XSx0LmZvckVhY2goQix0aGlzKSx0aGlzLnJlc2V0KCEwKX1mdW5jdGlvbiBSKHQpe2lmKG51bGwhPXQpe3ZhciByPXRbc107aWYocilyZXR1cm4gci5jYWxsKHQpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB0Lm5leHQpcmV0dXJuIHQ7aWYoIWlzTmFOKHQubGVuZ3RoKSl7dmFyIGk9LTEsYT1mdW5jdGlvbiByKCl7Zm9yKDsrK2k8dC5sZW5ndGg7KWlmKG4uY2FsbCh0LGkpKXJldHVybiByLnZhbHVlPXRbaV0sci5kb25lPSExLHI7cmV0dXJuIHIudmFsdWU9ZSxyLmRvbmU9ITAscn07cmV0dXJuIGEubmV4dD1hfX10aHJvdyBuZXcgVHlwZUVycm9yKHR5cGVvZiB0KyIgaXMgbm90IGl0ZXJhYmxlIil9cmV0dXJuIHcucHJvdG90eXBlPXYsaShrLCJjb25zdHJ1Y3RvciIse3ZhbHVlOnYsY29uZmlndXJhYmxlOiEwfSksaSh2LCJjb25zdHJ1Y3RvciIse3ZhbHVlOncsY29uZmlndXJhYmxlOiEwfSksdy5kaXNwbGF5TmFtZT1oKHYsbCwiR2VuZXJhdG9yRnVuY3Rpb24iKSx0LmlzR2VuZXJhdG9yRnVuY3Rpb249ZnVuY3Rpb24odCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQuY29uc3RydWN0b3I7cmV0dXJuISFlJiYoZT09PXd8fCJHZW5lcmF0b3JGdW5jdGlvbiI9PT0oZS5kaXNwbGF5TmFtZXx8ZS5uYW1lKSl9LHQubWFyaz1mdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LHYpOih0Ll9fcHJvdG9fXz12LGgodCxsLCJHZW5lcmF0b3JGdW5jdGlvbiIpKSx0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGspLHR9LHQuYXdyYXA9ZnVuY3Rpb24odCl7cmV0dXJue19fYXdhaXQ6dH19LHooQS5wcm90b3R5cGUpLGgoQS5wcm90b3R5cGUsbywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSx0LkFzeW5jSXRlcmF0b3I9QSx0LmFzeW5jPWZ1bmN0aW9uKGUscixuLGksYSl7dm9pZCAwPT09YSYmKGE9UHJvbWlzZSk7dmFyIHM9bmV3IEEoYyhlLHIsbixpKSxhKTtyZXR1cm4gdC5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpP3M6cy5uZXh0KCkudGhlbigoZnVuY3Rpb24odCl7cmV0dXJuIHQuZG9uZT90LnZhbHVlOnMubmV4dCgpfSkpfSx6KGspLGgoayxsLCJHZW5lcmF0b3IiKSxoKGsscywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSxoKGssInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4iW29iamVjdCBHZW5lcmF0b3JdIn0pKSx0LmtleXM9ZnVuY3Rpb24odCl7dmFyIGU9T2JqZWN0KHQpLHI9W107Zm9yKHZhciBuIGluIGUpci5wdXNoKG4pO3JldHVybiByLnJldmVyc2UoKSxmdW5jdGlvbiB0KCl7Zm9yKDtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7aWYobiBpbiBlKXJldHVybiB0LnZhbHVlPW4sdC5kb25lPSExLHR9cmV0dXJuIHQuZG9uZT0hMCx0fX0sdC52YWx1ZXM9UixMLnByb3RvdHlwZT17Y29uc3RydWN0b3I6TCxyZXNldDpmdW5jdGlvbih0KXtpZih0aGlzLnByZXY9MCx0aGlzLm5leHQ9MCx0aGlzLnNlbnQ9dGhpcy5fc2VudD1lLHRoaXMuZG9uZT0hMSx0aGlzLmRlbGVnYXRlPW51bGwsdGhpcy5tZXRob2Q9Im5leHQiLHRoaXMuYXJnPWUsdGhpcy50cnlFbnRyaWVzLmZvckVhY2goTyksIXQpZm9yKHZhciByIGluIHRoaXMpInQiPT09ci5jaGFyQXQoMCkmJm4uY2FsbCh0aGlzLHIpJiYhaXNOYU4oK3Iuc2xpY2UoMSkpJiYodGhpc1tyXT1lKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuZG9uZT0hMDt2YXIgdD10aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZigidGhyb3ciPT09dC50eXBlKXRocm93IHQuYXJnO3JldHVybiB0aGlzLnJ2YWx9LGRpc3BhdGNoRXhjZXB0aW9uOmZ1bmN0aW9uKHQpe2lmKHRoaXMuZG9uZSl0aHJvdyB0O3ZhciByPXRoaXM7ZnVuY3Rpb24gaShuLGkpe3JldHVybiBvLnR5cGU9InRocm93IixvLmFyZz10LHIubmV4dD1uLGkmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksISFpfWZvcih2YXIgYT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7YT49MDstLWEpe3ZhciBzPXRoaXMudHJ5RW50cmllc1thXSxvPXMuY29tcGxldGlvbjtpZigicm9vdCI9PT1zLnRyeUxvYylyZXR1cm4gaSgiZW5kIik7aWYocy50cnlMb2M8PXRoaXMucHJldil7dmFyIGw9bi5jYWxsKHMsImNhdGNoTG9jIiksaD1uLmNhbGwocywiZmluYWxseUxvYyIpO2lmKGwmJmgpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX1lbHNlIGlmKGwpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApfWVsc2V7aWYoIWgpdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX19fX0sYWJydXB0OmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtyPj0wOy0tcil7dmFyIGk9dGhpcy50cnlFbnRyaWVzW3JdO2lmKGkudHJ5TG9jPD10aGlzLnByZXYmJm4uY2FsbChpLCJmaW5hbGx5TG9jIikmJnRoaXMucHJldjxpLmZpbmFsbHlMb2Mpe3ZhciBhPWk7YnJlYWt9fWEmJigiYnJlYWsiPT09dHx8ImNvbnRpbnVlIj09PXQpJiZhLnRyeUxvYzw9ZSYmZTw9YS5maW5hbGx5TG9jJiYoYT1udWxsKTt2YXIgcz1hP2EuY29tcGxldGlvbjp7fTtyZXR1cm4gcy50eXBlPXQscy5hcmc9ZSxhPyh0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5uZXh0PWEuZmluYWxseUxvYyxnKTp0aGlzLmNvbXBsZXRlKHMpfSxjb21wbGV0ZTpmdW5jdGlvbih0LGUpe2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuImJyZWFrIj09PXQudHlwZXx8ImNvbnRpbnVlIj09PXQudHlwZT90aGlzLm5leHQ9dC5hcmc6InJldHVybiI9PT10LnR5cGU/KHRoaXMucnZhbD10aGlzLmFyZz10LmFyZyx0aGlzLm1ldGhvZD0icmV0dXJuIix0aGlzLm5leHQ9ImVuZCIpOiJub3JtYWwiPT09dC50eXBlJiZlJiYodGhpcy5uZXh0PWUpLGd9LGZpbmlzaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci5maW5hbGx5TG9jPT09dClyZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sci5hZnRlckxvYyksTyhyKSxnfX0sY2F0Y2g6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtlPj0wOy0tZSl7dmFyIHI9dGhpcy50cnlFbnRyaWVzW2VdO2lmKHIudHJ5TG9jPT09dCl7dmFyIG49ci5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT1uLnR5cGUpe3ZhciBpPW4uYXJnO08ocil9cmV0dXJuIGl9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iil9LGRlbGVnYXRlWWllbGQ6ZnVuY3Rpb24odCxyLG4pe3JldHVybiB0aGlzLmRlbGVnYXRlPXtpdGVyYXRvcjpSKHQpLHJlc3VsdE5hbWU6cixuZXh0TG9jOm59LCJuZXh0Ij09PXRoaXMubWV0aG9kJiYodGhpcy5hcmc9ZSksZ319LHR9KHQuZXhwb3J0cyk7dHJ5e2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWV9Y2F0Y2godCl7Im9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWU6RnVuY3Rpb24oInIiLCJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikoZSl9fShpKSk7dmFyIGEscz17ZXhwb3J0czp7fX07dmFyIG89KGF8fChhPTEsZnVuY3Rpb24odCl7Y29uc3QgZT00LHI9MCxuPTEsaT0yO2Z1bmN0aW9uIGEodCl7bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH1jb25zdCBzPTAsbz0xLGw9MixoPTMsYz0yNTgsdT0yOSxfPTI1NixkPV8rMSt1LGY9MzAscD0xOSxnPTIqZCsxLHk9MTUsdz0xNix2PTcsbT0yNTYsYj0xNix4PTE3LGs9MTgsej1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSksQT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxLDEsMiwyLDMsMyw0LDQsNSw1LDYsNiw3LDcsOCw4LDksOSwxMCwxMCwxMSwxMSwxMiwxMiwxMywxM10pLEU9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMiwzLDddKSxTPW5ldyBVaW50OEFycmF5KFsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSksQj01MTIsTz1uZXcgQXJyYXkoMiooZCsyKSk7YShPKTtjb25zdCBMPW5ldyBBcnJheSgyKmYpO2EoTCk7Y29uc3QgUj1uZXcgQXJyYXkoQik7YShSKTtjb25zdCBEPW5ldyBBcnJheShjLWgrMSk7YShEKTtjb25zdCBVPW5ldyBBcnJheSh1KTthKFUpO2NvbnN0IEM9bmV3IEFycmF5KGYpO2Z1bmN0aW9uIFQodCxlLHIsbixpKXt0aGlzLnN0YXRpY190cmVlPXQsdGhpcy5leHRyYV9iaXRzPWUsdGhpcy5leHRyYV9iYXNlPXIsdGhpcy5lbGVtcz1uLHRoaXMubWF4X2xlbmd0aD1pLHRoaXMuaGFzX3N0cmVlPXQmJnQubGVuZ3RofWxldCBGLEgsWjtmdW5jdGlvbiBNKHQsZSl7dGhpcy5keW5fdHJlZT10LHRoaXMubWF4X2NvZGU9MCx0aGlzLnN0YXRfZGVzYz1lfWEoQyk7Y29uc3QgTj10PT50PDI1Nj9SW3RdOlJbMjU2Kyh0Pj4+NyldLEk9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTV9LGo9KHQsZSxyKT0+e3QuYmlfdmFsaWQ+dy1yPyh0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSxJKHQsdC5iaV9idWYpLHQuYmlfYnVmPWU+PnctdC5iaV92YWxpZCx0LmJpX3ZhbGlkKz1yLXcpOih0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSx0LmJpX3ZhbGlkKz1yKX0sUD0odCxlLHIpPT57aih0LHJbMiplXSxyWzIqZSsxXSl9LCQ9KHQsZSk9PntsZXQgcj0wO2Rve3J8PTEmdCx0Pj4+PTEscjw8PTF9d2hpbGUoLS1lPjApO3JldHVybiByPj4+MX0sSz10PT57MTY9PT10LmJpX3ZhbGlkPyhJKHQsdC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wKTp0LmJpX3ZhbGlkPj04JiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JnQuYmlfYnVmLHQuYmlfYnVmPj49OCx0LmJpX3ZhbGlkLT04KX0sWD0odCxlKT0+e2NvbnN0IHI9ZS5keW5fdHJlZSxuPWUubWF4X2NvZGUsaT1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxhPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxzPWUuc3RhdF9kZXNjLmV4dHJhX2JpdHMsbz1lLnN0YXRfZGVzYy5leHRyYV9iYXNlLGw9ZS5zdGF0X2Rlc2MubWF4X2xlbmd0aDtsZXQgaCxjLHUsXyxkLGYscD0wO2ZvcihfPTA7Xzw9eTtfKyspdC5ibF9jb3VudFtfXT0wO2ZvcihyWzIqdC5oZWFwW3QuaGVhcF9tYXhdKzFdPTAsaD10LmhlYXBfbWF4KzE7aDxnO2grKyljPXQuaGVhcFtoXSxfPXJbMipyWzIqYysxXSsxXSsxLF8+bCYmKF89bCxwKyspLHJbMipjKzFdPV8sYz5ufHwodC5ibF9jb3VudFtfXSsrLGQ9MCxjPj1vJiYoZD1zW2Mtb10pLGY9clsyKmNdLHQub3B0X2xlbis9ZiooXytkKSxhJiYodC5zdGF0aWNfbGVuKz1mKihpWzIqYysxXStkKSkpO2lmKDAhPT1wKXtkb3tmb3IoXz1sLTE7MD09PXQuYmxfY291bnRbX107KV8tLTt0LmJsX2NvdW50W19dLS0sdC5ibF9jb3VudFtfKzFdKz0yLHQuYmxfY291bnRbbF0tLSxwLT0yfXdoaWxlKHA+MCk7Zm9yKF89bDswIT09XztfLS0pZm9yKGM9dC5ibF9jb3VudFtfXTswIT09YzspdT10LmhlYXBbLS1oXSx1Pm58fChyWzIqdSsxXSE9PV8mJih0Lm9wdF9sZW4rPShfLXJbMip1KzFdKSpyWzIqdV0sclsyKnUrMV09XyksYy0tKX19LEc9KHQsZSxyKT0+e2NvbnN0IG49bmV3IEFycmF5KHkrMSk7bGV0IGksYSxzPTA7Zm9yKGk9MTtpPD15O2krKylzPXMrcltpLTFdPDwxLG5baV09cztmb3IoYT0wO2E8PWU7YSsrKXtsZXQgZT10WzIqYSsxXTswIT09ZSYmKHRbMiphXT0kKG5bZV0rKyxlKSl9fSxXPSgpPT57bGV0IHQsZSxyLG4saTtjb25zdCBhPW5ldyBBcnJheSh5KzEpO2ZvcihyPTAsbj0wO248dS0xO24rKylmb3IoVVtuXT1yLHQ9MDt0PDE8PHpbbl07dCsrKURbcisrXT1uO2ZvcihEW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihDW25dPWksdD0wO3Q8MTw8QVtuXTt0KyspUltpKytdPW47Zm9yKGk+Pj03O248ZjtuKyspZm9yKENbbl09aTw8Nyx0PTA7dDwxPDxBW25dLTc7dCsrKVJbMjU2K2krK109bjtmb3IoZT0wO2U8PXk7ZSsrKWFbZV09MDtmb3IodD0wO3Q8PTE0MzspT1syKnQrMV09OCx0KyssYVs4XSsrO2Zvcig7dDw9MjU1OylPWzIqdCsxXT05LHQrKyxhWzldKys7Zm9yKDt0PD0yNzk7KU9bMip0KzFdPTcsdCsrLGFbN10rKztmb3IoO3Q8PTI4NzspT1syKnQrMV09OCx0KyssYVs4XSsrO2ZvcihHKE8sZCsxLGEpLHQ9MDt0PGY7dCsrKUxbMip0KzFdPTUsTFsyKnRdPSQodCw1KTtGPW5ldyBUKE8seixfKzEsZCx5KSxIPW5ldyBUKEwsQSwwLGYseSksWj1uZXcgVChuZXcgQXJyYXkoMCksRSwwLHAsdil9LFk9dD0+e2xldCBlO2ZvcihlPTA7ZTxkO2UrKyl0LmR5bl9sdHJlZVsyKmVdPTA7Zm9yKGU9MDtlPGY7ZSsrKXQuZHluX2R0cmVlWzIqZV09MDtmb3IoZT0wO2U8cDtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVsyKm1dPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQuc3ltX25leHQ9dC5tYXRjaGVzPTB9LHE9dD0+e3QuYmlfdmFsaWQ+OD9JKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH0sVj0odCxlLHIsbik9Pntjb25zdCBpPTIqZSxhPTIqcjtyZXR1cm4gdFtpXTx0W2FdfHx0W2ldPT09dFthXSYmbltlXTw9bltyXX0sUT0odCxlLHIpPT57Y29uc3Qgbj10LmhlYXBbcl07bGV0IGk9cjw8MTtmb3IoO2k8PXQuaGVhcF9sZW4mJihpPHQuaGVhcF9sZW4mJlYoZSx0LmhlYXBbaSsxXSx0LmhlYXBbaV0sdC5kZXB0aCkmJmkrKywhVihlLG4sdC5oZWFwW2ldLHQuZGVwdGgpKTspdC5oZWFwW3JdPXQuaGVhcFtpXSxyPWksaTw8PTE7dC5oZWFwW3JdPW59LEo9KHQsZSxyKT0+e2xldCBuLGksYSxzLG89MDtpZigwIT09dC5zeW1fbmV4dClkb3tuPTI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLG4rPSgyNTUmdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrbysrXSk8PDgsaT10LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLDA9PT1uP1AodCxpLGUpOihhPURbaV0sUCh0LGErXysxLGUpLHM9elthXSwwIT09cyYmKGktPVVbYV0saih0LGkscykpLG4tLSxhPU4obiksUCh0LGEscikscz1BW2FdLDAhPT1zJiYobi09Q1thXSxqKHQsbixzKSkpfXdoaWxlKG88dC5zeW1fbmV4dCk7UCh0LG0sZSl9LHR0PSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsaT1lLnN0YXRfZGVzYy5oYXNfc3RyZWUsYT1lLnN0YXRfZGVzYy5lbGVtcztsZXQgcyxvLGwsaD0tMTtmb3IodC5oZWFwX2xlbj0wLHQuaGVhcF9tYXg9ZyxzPTA7czxhO3MrKykwIT09clsyKnNdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT1oPXMsdC5kZXB0aFtzXT0wKTpyWzIqcysxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOylsPXQuaGVhcFsrK3QuaGVhcF9sZW5dPWg8Mj8rK2g6MCxyWzIqbF09MSx0LmRlcHRoW2xdPTAsdC5vcHRfbGVuLS0saSYmKHQuc3RhdGljX2xlbi09blsyKmwrMV0pO2ZvcihlLm1heF9jb2RlPWgscz10LmhlYXBfbGVuPj4xO3M+PTE7cy0tKVEodCxyLHMpO2w9YTtkb3tzPXQuaGVhcFsxXSx0LmhlYXBbMV09dC5oZWFwW3QuaGVhcF9sZW4tLV0sUSh0LHIsMSksbz10LmhlYXBbMV0sdC5oZWFwWy0tdC5oZWFwX21heF09cyx0LmhlYXBbLS10LmhlYXBfbWF4XT1vLHJbMipsXT1yWzIqc10rclsyKm9dLHQuZGVwdGhbbF09KHQuZGVwdGhbc10+PXQuZGVwdGhbb10/dC5kZXB0aFtzXTp0LmRlcHRoW29dKSsxLHJbMipzKzFdPXJbMipvKzFdPWwsdC5oZWFwWzFdPWwrKyxRKHQsciwxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sWCh0LGUpLEcocixoLHQuYmxfY291bnQpfSxldD0odCxlLHIpPT57bGV0IG4saSxhPS0xLHM9ZVsxXSxvPTAsbD03LGg9NDtmb3IoMD09PXMmJihsPTEzOCxoPTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrbzxsJiZpPT09c3x8KG88aD90LmJsX3RyZWVbMippXSs9bzowIT09aT8oaSE9PWEmJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzIqYl0rKyk6bzw9MTA/dC5ibF90cmVlWzIqeF0rKzp0LmJsX3RyZWVbMiprXSsrLG89MCxhPWksMD09PXM/KGw9MTM4LGg9Myk6aT09PXM/KGw9NixoPTMpOihsPTcsaD00KSl9LHJ0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9Myksbj0wO248PXI7bisrKWlmKGk9cyxzPWVbMioobisxKSsxXSwhKCsrbzxsJiZpPT09cykpe2lmKG88aClkb3tQKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tbyk7ZWxzZSAwIT09aT8oaSE9PWEmJihQKHQsaSx0LmJsX3RyZWUpLG8tLSksUCh0LGIsdC5ibF90cmVlKSxqKHQsby0zLDIpKTpvPD0xMD8oUCh0LHgsdC5ibF90cmVlKSxqKHQsby0zLDMpKTooUCh0LGssdC5ibF90cmVlKSxqKHQsby0xMSw3KSk7bz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpfX0sbnQ9dD0+e2xldCBlO2ZvcihldCh0LHQuZHluX2x0cmVlLHQubF9kZXNjLm1heF9jb2RlKSxldCh0LHQuZHluX2R0cmVlLHQuZF9kZXNjLm1heF9jb2RlKSx0dCh0LHQuYmxfZGVzYyksZT1wLTE7ZT49MyYmMD09PXQuYmxfdHJlZVsyKlNbZV0rMV07ZS0tKTtyZXR1cm4gdC5vcHRfbGVuKz0zKihlKzEpKzUrNSs0LGV9LGl0PSh0LGUscixuKT0+e2xldCBpO2ZvcihqKHQsZS0yNTcsNSksaih0LHItMSw1KSxqKHQsbi00LDQpLGk9MDtpPG47aSsrKWoodCx0LmJsX3RyZWVbMipTW2ldKzFdLDMpO3J0KHQsdC5keW5fbHRyZWUsZS0xKSxydCh0LHQuZHluX2R0cmVlLHItMSl9LGF0PXQ9PntsZXQgZSxpPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKyssaT4+Pj0xKWlmKDEmaSYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIHI7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gbjtmb3IoZT0zMjtlPF87ZSsrKWlmKDAhPT10LmR5bl9sdHJlZVsyKmVdKXJldHVybiBuO3JldHVybiByfTtsZXQgc3Q9ITE7Y29uc3Qgb3Q9KHQsZSxyLG4pPT57aih0LChzPDwxKSsobj8xOjApLDMpLHEodCksSSh0LHIpLEkodCx+ciksciYmdC5wZW5kaW5nX2J1Zi5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK3IpLHQucGVuZGluZyksdC5wZW5kaW5nKz1yfSxsdD0odCxyLG4sYSk9PntsZXQgcyxoLGM9MDt0LmxldmVsPjA/KHQuc3RybS5kYXRhX3R5cGU9PT1pJiYodC5zdHJtLmRhdGFfdHlwZT1hdCh0KSksdHQodCx0LmxfZGVzYyksdHQodCx0LmRfZGVzYyksYz1udCh0KSxzPXQub3B0X2xlbiszKzc+Pj4zLGg9dC5zdGF0aWNfbGVuKzMrNz4+PjMsaDw9cyYmKHM9aCkpOnM9aD1uKzUsbis0PD1zJiYtMSE9PXI/b3QodCxyLG4sYSk6dC5zdHJhdGVneT09PWV8fGg9PT1zPyhqKHQsKG88PDEpKyhhPzE6MCksMyksSih0LE8sTCkpOihqKHQsKGw8PDEpKyhhPzE6MCksMyksaXQodCx0LmxfZGVzYy5tYXhfY29kZSsxLHQuZF9kZXNjLm1heF9jb2RlKzEsYysxKSxKKHQsdC5keW5fbHRyZWUsdC5keW5fZHRyZWUpKSxZKHQpLGEmJnEodCl9O3ZhciBodD17X3RyX2luaXQ6dD0+e3N0fHwoVygpLHN0PSEwKSx0LmxfZGVzYz1uZXcgTSh0LmR5bl9sdHJlZSxGKSx0LmRfZGVzYz1uZXcgTSh0LmR5bl9kdHJlZSxIKSx0LmJsX2Rlc2M9bmV3IE0odC5ibF90cmVlLFopLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wLFkodCl9LF90cl9zdG9yZWRfYmxvY2s6b3QsX3RyX2ZsdXNoX2Jsb2NrOmx0LF90cl90YWxseToodCxlLHIpPT4odC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lLHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ZT4+OCx0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPXIsMD09PWU/dC5keW5fbHRyZWVbMipyXSsrOih0Lm1hdGNoZXMrKyxlLS0sdC5keW5fbHRyZWVbMiooRFtyXStfKzEpXSsrLHQuZHluX2R0cmVlWzIqTihlKV0rKyksdC5zeW1fbmV4dD09PXQuc3ltX2VuZCksX3RyX2FsaWduOnQ9PntqKHQsbzw8MSwzKSxQKHQsbSxPKSxLKHQpfX0sY3Q9KHQsZSxyLG4pPT57bGV0IGk9NjU1MzUmdCxhPXQ+Pj4xNiY2NTUzNSxzPTA7Zm9yKDswIT09cjspe3M9cj4yZTM/MmUzOnIsci09cztkb3tpPWkrZVtuKytdfDAsYT1hK2l8MH13aGlsZSgtLXMpO2klPTY1NTIxLGElPTY1NTIxfXJldHVybiBpfGE8PDE2fTtjb25zdCB1dD1uZXcgVWludDMyQXJyYXkoKCgpPT57bGV0IHQsZT1bXTtmb3IodmFyIHI9MDtyPDI1NjtyKyspe3Q9cjtmb3IodmFyIG49MDtuPDg7bisrKXQ9MSZ0PzM5ODgyOTIzODRedD4+PjE6dD4+PjE7ZVtyXT10fXJldHVybiBlfSkoKSk7dmFyIF90PSh0LGUscixuKT0+e2NvbnN0IGk9dXQsYT1uK3I7dF49LTE7Zm9yKGxldCByPW47cjxhO3IrKyl0PXQ+Pj44XmlbMjU1Jih0XmVbcl0pXTtyZXR1cm5+dH0sZHQ9ezI6Im5lZWQgZGljdGlvbmFyeSIsMToic3RyZWFtIGVuZCIsMDoiIiwiLTEiOiJmaWxlIGVycm9yIiwiLTIiOiJzdHJlYW0gZXJyb3IiLCItMyI6ImRhdGEgZXJyb3IiLCItNCI6Imluc3VmZmljaWVudCBtZW1vcnkiLCItNSI6ImJ1ZmZlciBlcnJvciIsIi02IjoiaW5jb21wYXRpYmxlIHZlcnNpb24ifSxmdD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX01FTV9FUlJPUjotNCxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTtjb25zdHtfdHJfaW5pdDpwdCxfdHJfc3RvcmVkX2Jsb2NrOmd0LF90cl9mbHVzaF9ibG9jazp5dCxfdHJfdGFsbHk6d3QsX3RyX2FsaWduOnZ0fT1odCx7Wl9OT19GTFVTSDptdCxaX1BBUlRJQUxfRkxVU0g6YnQsWl9GVUxMX0ZMVVNIOnh0LFpfRklOSVNIOmt0LFpfQkxPQ0s6enQsWl9PSzpBdCxaX1NUUkVBTV9FTkQ6RXQsWl9TVFJFQU1fRVJST1I6U3QsWl9EQVRBX0VSUk9SOkJ0LFpfQlVGX0VSUk9SOk90LFpfREVGQVVMVF9DT01QUkVTU0lPTjpMdCxaX0ZJTFRFUkVEOlJ0LFpfSFVGRk1BTl9PTkxZOkR0LFpfUkxFOlV0LFpfRklYRUQ6Q3QsWl9ERUZBVUxUX1NUUkFURUdZOlR0LFpfVU5LTk9XTjpGdCxaX0RFRkxBVEVEOkh0fT1mdCxadD05LE10PTE1LE50PTgsSXQ9Mjg2LGp0PTMwLFB0PTE5LCR0PTIqSXQrMSxLdD0xNSxYdD0zLEd0PTI1OCxXdD1HdCtYdCsxLFl0PTMyLHF0PTQyLFZ0PTU3LFF0PTY5LEp0PTczLHRlPTkxLGVlPTEwMyxyZT0xMTMsbmU9NjY2LGllPTEsYWU9MixzZT0zLG9lPTQsbGU9MyxoZT0odCxlKT0+KHQubXNnPWR0W2VdLGUpLGNlPXQ9PjIqdC0odD40Pzk6MCksdWU9dD0+e2xldCBlPXQubGVuZ3RoO2Zvcig7LS1lPj0wOyl0W2VdPTB9LF9lPXQ9PntsZXQgZSxyLG4saT10Lndfc2l6ZTtlPXQuaGFzaF9zaXplLG49ZTtkb3tyPXQuaGVhZFstLW5dLHQuaGVhZFtuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSk7ZT1pLG49ZTtkb3tyPXQucHJldlstLW5dLHQucHJldltuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSl9O2xldCBkZT0odCxlLHIpPT4oZTw8dC5oYXNoX3NoaWZ0XnIpJnQuaGFzaF9tYXNrO2NvbnN0IGZlPXQ9Pntjb25zdCBlPXQuc3RhdGU7bGV0IHI9ZS5wZW5kaW5nO3I+dC5hdmFpbF9vdXQmJihyPXQuYXZhaWxfb3V0KSwwIT09ciYmKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsZS5wZW5kaW5nX291dCtyKSx0Lm5leHRfb3V0KSx0Lm5leHRfb3V0Kz1yLGUucGVuZGluZ19vdXQrPXIsdC50b3RhbF9vdXQrPXIsdC5hdmFpbF9vdXQtPXIsZS5wZW5kaW5nLT1yLDA9PT1lLnBlbmRpbmcmJihlLnBlbmRpbmdfb3V0PTApKX0scGU9KHQsZSk9Pnt5dCh0LHQuYmxvY2tfc3RhcnQ+PTA/dC5ibG9ja19zdGFydDotMSx0LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsZSksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0LGZlKHQuc3RybSl9LGdlPSh0LGUpPT57dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX0seWU9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JmV9LHdlPSh0LGUscixuKT0+e2xldCBpPXQuYXZhaWxfaW47cmV0dXJuIGk+biYmKGk9biksMD09PWk/MDoodC5hdmFpbF9pbi09aSxlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbix0Lm5leHRfaW4raSksciksMT09PXQuc3RhdGUud3JhcD90LmFkbGVyPWN0KHQuYWRsZXIsZSxpLHIpOjI9PT10LnN0YXRlLndyYXAmJih0LmFkbGVyPV90KHQuYWRsZXIsZSxpLHIpKSx0Lm5leHRfaW4rPWksdC50b3RhbF9pbis9aSxpKX0sdmU9KHQsZSk9PntsZXQgcixuLGk9dC5tYXhfY2hhaW5fbGVuZ3RoLGE9dC5zdHJzdGFydCxzPXQucHJldl9sZW5ndGgsbz10Lm5pY2VfbWF0Y2g7Y29uc3QgbD10LnN0cnN0YXJ0PnQud19zaXplLVd0P3Quc3Ryc3RhcnQtKHQud19zaXplLVd0KTowLGg9dC53aW5kb3csYz10LndfbWFzayx1PXQucHJldixfPXQuc3Ryc3RhcnQrR3Q7bGV0IGQ9aFthK3MtMV0sZj1oW2Erc107dC5wcmV2X2xlbmd0aD49dC5nb29kX21hdGNoJiYoaT4+PTIpLG8+dC5sb29rYWhlYWQmJihvPXQubG9va2FoZWFkKTtkb3tpZihyPWUsaFtyK3NdPT09ZiYmaFtyK3MtMV09PT1kJiZoW3JdPT09aFthXSYmaFsrK3JdPT09aFthKzFdKXthKz0yLHIrKztkb3t9d2hpbGUoaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmE8Xyk7aWYobj1HdC0oXy1hKSxhPV8tR3Qsbj5zKXtpZih0Lm1hdGNoX3N0YXJ0PWUscz1uLG4+PW8pYnJlYWs7ZD1oW2Ercy0xXSxmPWhbYStzXX19fXdoaWxlKChlPXVbZSZjXSk+bCYmMCE9LS1pKTtyZXR1cm4gczw9dC5sb29rYWhlYWQ/czp0Lmxvb2thaGVhZH0sbWU9dD0+e2NvbnN0IGU9dC53X3NpemU7bGV0IHIsbixpO2Rve2lmKG49dC53aW5kb3dfc2l6ZS10Lmxvb2thaGVhZC10LnN0cnN0YXJ0LHQuc3Ryc3RhcnQ+PWUrKGUtV3QpJiYodC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KGUsZStlLW4pLDApLHQubWF0Y2hfc3RhcnQtPWUsdC5zdHJzdGFydC09ZSx0LmJsb2NrX3N0YXJ0LT1lLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSxfZSh0KSxuKz1lKSwwPT09dC5zdHJtLmF2YWlsX2luKWJyZWFrO2lmKHI9d2UodC5zdHJtLHQud2luZG93LHQuc3Ryc3RhcnQrdC5sb29rYWhlYWQsbiksdC5sb29rYWhlYWQrPXIsdC5sb29rYWhlYWQrdC5pbnNlcnQ+PVh0KWZvcihpPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tpXSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1tpKzFdKTt0Lmluc2VydCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krWHQtMV0pLHQucHJldltpJnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPWksaSsrLHQuaW5zZXJ0LS0sISh0Lmxvb2thaGVhZCt0Lmluc2VydDxYdCkpOyk7fXdoaWxlKHQubG9va2FoZWFkPFd0JiYwIT09dC5zdHJtLmF2YWlsX2luKX0sYmU9KHQsZSk9PntsZXQgcixuLGksYT10LnBlbmRpbmdfYnVmX3NpemUtNT50Lndfc2l6ZT90Lndfc2l6ZTp0LnBlbmRpbmdfYnVmX3NpemUtNSxzPTAsbz10LnN0cm0uYXZhaWxfaW47ZG97aWYocj02NTUzNSxpPXQuYmlfdmFsaWQrNDI+PjMsdC5zdHJtLmF2YWlsX291dDxpKWJyZWFrO2lmKGk9dC5zdHJtLmF2YWlsX291dC1pLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LHI+bit0LnN0cm0uYXZhaWxfaW4mJihyPW4rdC5zdHJtLmF2YWlsX2luKSxyPmkmJihyPWkpLHI8YSYmKDA9PT1yJiZlIT09a3R8fGU9PT1tdHx8ciE9PW4rdC5zdHJtLmF2YWlsX2luKSlicmVhaztzPWU9PT1rdCYmcj09PW4rdC5zdHJtLmF2YWlsX2luPzE6MCxndCh0LDAsMCxzKSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy00XT1yLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTNdPXI+PjgsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMl09fnIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMV09fnI+PjgsZmUodC5zdHJtKSxuJiYobj5yJiYobj1yKSx0LnN0cm0ub3V0cHV0LnNldCh0LndpbmRvdy5zdWJhcnJheSh0LmJsb2NrX3N0YXJ0LHQuYmxvY2tfc3RhcnQrbiksdC5zdHJtLm5leHRfb3V0KSx0LnN0cm0ubmV4dF9vdXQrPW4sdC5zdHJtLmF2YWlsX291dC09bix0LnN0cm0udG90YWxfb3V0Kz1uLHQuYmxvY2tfc3RhcnQrPW4sci09biksciYmKHdlKHQuc3RybSx0LnN0cm0ub3V0cHV0LHQuc3RybS5uZXh0X291dCxyKSx0LnN0cm0ubmV4dF9vdXQrPXIsdC5zdHJtLmF2YWlsX291dC09cix0LnN0cm0udG90YWxfb3V0Kz1yKX13aGlsZSgwPT09cyk7cmV0dXJuIG8tPXQuc3RybS5hdmFpbF9pbixvJiYobz49dC53X3NpemU/KHQubWF0Y2hlcz0yLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tdC53X3NpemUsdC5zdHJtLm5leHRfaW4pLDApLHQuc3Ryc3RhcnQ9dC53X3NpemUsdC5pbnNlcnQ9dC5zdHJzdGFydCk6KHQud2luZG93X3NpemUtdC5zdHJzdGFydDw9byYmKHQuc3Ryc3RhcnQtPXQud19zaXplLHQud2luZG93LnNldCh0LndpbmRvdy5zdWJhcnJheSh0Lndfc2l6ZSx0Lndfc2l6ZSt0LnN0cnN0YXJ0KSwwKSx0Lm1hdGNoZXM8MiYmdC5tYXRjaGVzKyssdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpKSx0LndpbmRvdy5zZXQodC5zdHJtLmlucHV0LnN1YmFycmF5KHQuc3RybS5uZXh0X2luLW8sdC5zdHJtLm5leHRfaW4pLHQuc3Ryc3RhcnQpLHQuc3Ryc3RhcnQrPW8sdC5pbnNlcnQrPW8+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6byksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0KSx0LmhpZ2hfd2F0ZXI8dC5zdHJzdGFydCYmKHQuaGlnaF93YXRlcj10LnN0cnN0YXJ0KSxzP29lOmUhPT1tdCYmZSE9PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZ0LnN0cnN0YXJ0PT09dC5ibG9ja19zdGFydD9hZTooaT10LndpbmRvd19zaXplLXQuc3Ryc3RhcnQsdC5zdHJtLmF2YWlsX2luPmkmJnQuYmxvY2tfc3RhcnQ+PXQud19zaXplJiYodC5ibG9ja19zdGFydC09dC53X3NpemUsdC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyxpKz10Lndfc2l6ZSx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLGk+dC5zdHJtLmF2YWlsX2luJiYoaT10LnN0cm0uYXZhaWxfaW4pLGkmJih3ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCxpKSx0LnN0cnN0YXJ0Kz1pLHQuaW5zZXJ0Kz1pPnQud19zaXplLXQuaW5zZXJ0P3Qud19zaXplLXQuaW5zZXJ0OmkpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLGk9dC5iaV92YWxpZCs0Mj4+MyxpPXQucGVuZGluZ19idWZfc2l6ZS1pPjY1NTM1PzY1NTM1OnQucGVuZGluZ19idWZfc2l6ZS1pLGE9aT50Lndfc2l6ZT90Lndfc2l6ZTppLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LChuPj1hfHwobnx8ZT09PWt0KSYmZSE9PW10JiYwPT09dC5zdHJtLmF2YWlsX2luJiZuPD1pKSYmKHI9bj5pP2k6bixzPWU9PT1rdCYmMD09PXQuc3RybS5hdmFpbF9pbiYmcj09PW4/MTowLGd0KHQsdC5ibG9ja19zdGFydCxyLHMpLHQuYmxvY2tfc3RhcnQrPXIsZmUodC5zdHJtKSkscz9zZTppZSl9LHhlPSh0LGUpPT57bGV0IHIsbjtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksMCE9PXImJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpKSx0Lm1hdGNoX2xlbmd0aD49WHQpaWYobj13dCh0LHQuc3Ryc3RhcnQtdC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPD10Lm1heF9sYXp5X21hdGNoJiZ0Lmxvb2thaGVhZD49WHQpe3QubWF0Y2hfbGVuZ3RoLS07ZG97dC5zdHJzdGFydCsrLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydH13aGlsZSgwIT0tLXQubWF0Y2hfbGVuZ3RoKTt0LnN0cnN0YXJ0Kyt9ZWxzZSB0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wLHQuaW5zX2g9dC53aW5kb3dbdC5zdHJzdGFydF0sdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCsxXSk7ZWxzZSBuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0Kys7aWYobiYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sa2U9KHQsZSk9PntsZXQgcixuLGk7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDxXdCl7aWYobWUodCksdC5sb29rYWhlYWQ8V3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHI9MCx0Lmxvb2thaGVhZD49WHQmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpLHQucHJldl9sZW5ndGg9dC5tYXRjaF9sZW5ndGgsdC5wcmV2X21hdGNoPXQubWF0Y2hfc3RhcnQsdC5tYXRjaF9sZW5ndGg9WHQtMSwwIT09ciYmdC5wcmV2X2xlbmd0aDx0Lm1heF9sYXp5X21hdGNoJiZ0LnN0cnN0YXJ0LXI8PXQud19zaXplLVd0JiYodC5tYXRjaF9sZW5ndGg9dmUodCxyKSx0Lm1hdGNoX2xlbmd0aDw9NSYmKHQuc3RyYXRlZ3k9PT1SdHx8dC5tYXRjaF9sZW5ndGg9PT1YdCYmdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0PjQwOTYpJiYodC5tYXRjaF9sZW5ndGg9WHQtMSkpLHQucHJldl9sZW5ndGg+PVh0JiZ0Lm1hdGNoX2xlbmd0aDw9dC5wcmV2X2xlbmd0aCl7aT10LnN0cnN0YXJ0K3QubG9va2FoZWFkLVh0LG49d3QodCx0LnN0cnN0YXJ0LTEtdC5wcmV2X21hdGNoLHQucHJldl9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10LnByZXZfbGVuZ3RoLTEsdC5wcmV2X2xlbmd0aC09Mjtkb3srK3Quc3Ryc3RhcnQ8PWkmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpfXdoaWxlKDAhPS0tdC5wcmV2X2xlbmd0aCk7aWYodC5tYXRjaF9hdmFpbGFibGU9MCx0Lm1hdGNoX2xlbmd0aD1YdC0xLHQuc3Ryc3RhcnQrKyxuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1lbHNlIGlmKHQubWF0Y2hfYXZhaWxhYmxlKXtpZihuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0LTFdKSxuJiZwZSh0LCExKSx0LnN0cnN0YXJ0KyssdC5sb29rYWhlYWQtLSwwPT09dC5zdHJtLmF2YWlsX291dClyZXR1cm4gaWV9ZWxzZSB0Lm1hdGNoX2F2YWlsYWJsZT0xLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tfXJldHVybiB0Lm1hdGNoX2F2YWlsYWJsZSYmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLHQubWF0Y2hfYXZhaWxhYmxlPTApLHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0semU9KHQsZSk9PntsZXQgcixuLGksYTtjb25zdCBzPXQud2luZG93O2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8PUd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDw9R3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHQubWF0Y2hfbGVuZ3RoPTAsdC5sb29rYWhlYWQ+PVh0JiZ0LnN0cnN0YXJ0PjAmJihpPXQuc3Ryc3RhcnQtMSxuPXNbaV0sbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSkpe2E9dC5zdHJzdGFydCtHdDtkb3t9d2hpbGUobj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmaTxhKTt0Lm1hdGNoX2xlbmd0aD1HdC0oYS1pKSx0Lm1hdGNoX2xlbmd0aD50Lmxvb2thaGVhZCYmKHQubWF0Y2hfbGVuZ3RoPXQubG9va2FoZWFkKX1pZih0Lm1hdGNoX2xlbmd0aD49WHQ/KHI9d3QodCwxLHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5zdHJzdGFydCs9dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg9MCk6KHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyksciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sQWU9KHQsZSk9PntsZXQgcjtmb3IoOzspe2lmKDA9PT10Lmxvb2thaGVhZCYmKG1lKHQpLDA9PT10Lmxvb2thaGVhZCkpe2lmKGU9PT1tdClyZXR1cm4gaWU7YnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCxyPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0KyssciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX07ZnVuY3Rpb24gRWUodCxlLHIsbixpKXt0aGlzLmdvb2RfbGVuZ3RoPXQsdGhpcy5tYXhfbGF6eT1lLHRoaXMubmljZV9sZW5ndGg9cix0aGlzLm1heF9jaGFpbj1uLHRoaXMuZnVuYz1pfWNvbnN0IFNlPVtuZXcgRWUoMCwwLDAsMCxiZSksbmV3IEVlKDQsNCw4LDQseGUpLG5ldyBFZSg0LDUsMTYsOCx4ZSksbmV3IEVlKDQsNiwzMiwzMix4ZSksbmV3IEVlKDQsNCwxNiwxNixrZSksbmV3IEVlKDgsMTYsMzIsMzIsa2UpLG5ldyBFZSg4LDE2LDEyOCwxMjgsa2UpLG5ldyBFZSg4LDMyLDEyOCwyNTYsa2UpLG5ldyBFZSgzMiwxMjgsMjU4LDEwMjQsa2UpLG5ldyBFZSgzMiwyNTgsMjU4LDQwOTYsa2UpXSxCZT10PT57dC53aW5kb3dfc2l6ZT0yKnQud19zaXplLHVlKHQuaGVhZCksdC5tYXhfbGF6eV9tYXRjaD1TZVt0LmxldmVsXS5tYXhfbGF6eSx0Lmdvb2RfbWF0Y2g9U2VbdC5sZXZlbF0uZ29vZF9sZW5ndGgsdC5uaWNlX21hdGNoPVNlW3QubGV2ZWxdLm5pY2VfbGVuZ3RoLHQubWF4X2NoYWluX2xlbmd0aD1TZVt0LmxldmVsXS5tYXhfY2hhaW4sdC5zdHJzdGFydD0wLHQuYmxvY2tfc3RhcnQ9MCx0Lmxvb2thaGVhZD0wLHQuaW5zZXJ0PTAsdC5tYXRjaF9sZW5ndGg9dC5wcmV2X2xlbmd0aD1YdC0xLHQubWF0Y2hfYXZhaWxhYmxlPTAsdC5pbnNfaD0wfTtmdW5jdGlvbiBPZSgpe3RoaXMuc3RybT1udWxsLHRoaXMuc3RhdHVzPTAsdGhpcy5wZW5kaW5nX2J1Zj1udWxsLHRoaXMucGVuZGluZ19idWZfc2l6ZT0wLHRoaXMucGVuZGluZ19vdXQ9MCx0aGlzLnBlbmRpbmc9MCx0aGlzLndyYXA9MCx0aGlzLmd6aGVhZD1udWxsLHRoaXMuZ3ppbmRleD0wLHRoaXMubWV0aG9kPUh0LHRoaXMubGFzdF9mbHVzaD0tMSx0aGlzLndfc2l6ZT0wLHRoaXMud19iaXRzPTAsdGhpcy53X21hc2s9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMud2luZG93X3NpemU9MCx0aGlzLnByZXY9bnVsbCx0aGlzLmhlYWQ9bnVsbCx0aGlzLmluc19oPTAsdGhpcy5oYXNoX3NpemU9MCx0aGlzLmhhc2hfYml0cz0wLHRoaXMuaGFzaF9tYXNrPTAsdGhpcy5oYXNoX3NoaWZ0PTAsdGhpcy5ibG9ja19zdGFydD0wLHRoaXMubWF0Y2hfbGVuZ3RoPTAsdGhpcy5wcmV2X21hdGNoPTAsdGhpcy5tYXRjaF9hdmFpbGFibGU9MCx0aGlzLnN0cnN0YXJ0PTAsdGhpcy5tYXRjaF9zdGFydD0wLHRoaXMubG9va2FoZWFkPTAsdGhpcy5wcmV2X2xlbmd0aD0wLHRoaXMubWF4X2NoYWluX2xlbmd0aD0wLHRoaXMubWF4X2xhenlfbWF0Y2g9MCx0aGlzLmxldmVsPTAsdGhpcy5zdHJhdGVneT0wLHRoaXMuZ29vZF9tYXRjaD0wLHRoaXMubmljZV9tYXRjaD0wLHRoaXMuZHluX2x0cmVlPW5ldyBVaW50MTZBcnJheSgyKiR0KSx0aGlzLmR5bl9kdHJlZT1uZXcgVWludDE2QXJyYXkoMiooMipqdCsxKSksdGhpcy5ibF90cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKlB0KzEpKSx1ZSh0aGlzLmR5bl9sdHJlZSksdWUodGhpcy5keW5fZHRyZWUpLHVlKHRoaXMuYmxfdHJlZSksdGhpcy5sX2Rlc2M9bnVsbCx0aGlzLmRfZGVzYz1udWxsLHRoaXMuYmxfZGVzYz1udWxsLHRoaXMuYmxfY291bnQ9bmV3IFVpbnQxNkFycmF5KEt0KzEpLHRoaXMuaGVhcD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmhlYXApLHRoaXMuaGVhcF9sZW49MCx0aGlzLmhlYXBfbWF4PTAsdGhpcy5kZXB0aD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmRlcHRoKSx0aGlzLnN5bV9idWY9MCx0aGlzLmxpdF9idWZzaXplPTAsdGhpcy5zeW1fbmV4dD0wLHRoaXMuc3ltX2VuZD0wLHRoaXMub3B0X2xlbj0wLHRoaXMuc3RhdGljX2xlbj0wLHRoaXMubWF0Y2hlcz0wLHRoaXMuaW5zZXJ0PTAsdGhpcy5iaV9idWY9MCx0aGlzLmJpX3ZhbGlkPTB9Y29uc3QgTGU9dD0+e2lmKCF0KXJldHVybiAxO2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4hZXx8ZS5zdHJtIT09dHx8ZS5zdGF0dXMhPT1xdCYmZS5zdGF0dXMhPT1WdCYmZS5zdGF0dXMhPT1RdCYmZS5zdGF0dXMhPT1KdCYmZS5zdGF0dXMhPT10ZSYmZS5zdGF0dXMhPT1lZSYmZS5zdGF0dXMhPT1yZSYmZS5zdGF0dXMhPT1uZT8xOjB9LFJlPXQ9PntpZihMZSh0KSlyZXR1cm4gaGUodCxTdCk7dC50b3RhbF9pbj10LnRvdGFsX291dD0wLHQuZGF0YV90eXBlPUZ0O2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4gZS5wZW5kaW5nPTAsZS5wZW5kaW5nX291dD0wLGUud3JhcDwwJiYoZS53cmFwPS1lLndyYXApLGUuc3RhdHVzPTI9PT1lLndyYXA/VnQ6ZS53cmFwP3F0OnJlLHQuYWRsZXI9Mj09PWUud3JhcD8wOjEsZS5sYXN0X2ZsdXNoPS0yLHB0KGUpLEF0fSxEZT10PT57Y29uc3QgZT1SZSh0KTtyZXR1cm4gZT09PUF0JiZCZSh0LnN0YXRlKSxlfSxVZT0odCxlLHIsbixpLGEpPT57aWYoIXQpcmV0dXJuIFN0O2xldCBzPTE7aWYoZT09PUx0JiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+WnR8fHIhPT1IdHx8bjw4fHxuPjE1fHxlPDB8fGU+OXx8YTwwfHxhPkN0fHw4PT09biYmMSE9PXMpcmV0dXJuIGhlKHQsU3QpOzg9PT1uJiYobj05KTtjb25zdCBvPW5ldyBPZTtyZXR1cm4gdC5zdGF0ZT1vLG8uc3RybT10LG8uc3RhdHVzPXF0LG8ud3JhcD1zLG8uZ3poZWFkPW51bGwsby53X2JpdHM9bixvLndfc2l6ZT0xPDxvLndfYml0cyxvLndfbWFzaz1vLndfc2l6ZS0xLG8uaGFzaF9iaXRzPWkrNyxvLmhhc2hfc2l6ZT0xPDxvLmhhc2hfYml0cyxvLmhhc2hfbWFzaz1vLmhhc2hfc2l6ZS0xLG8uaGFzaF9zaGlmdD1+figoby5oYXNoX2JpdHMrWHQtMSkvWHQpLG8ud2luZG93PW5ldyBVaW50OEFycmF5KDIqby53X3NpemUpLG8uaGVhZD1uZXcgVWludDE2QXJyYXkoby5oYXNoX3NpemUpLG8ucHJldj1uZXcgVWludDE2QXJyYXkoby53X3NpemUpLG8ubGl0X2J1ZnNpemU9MTw8aSs2LG8ucGVuZGluZ19idWZfc2l6ZT00Km8ubGl0X2J1ZnNpemUsby5wZW5kaW5nX2J1Zj1uZXcgVWludDhBcnJheShvLnBlbmRpbmdfYnVmX3NpemUpLG8uc3ltX2J1Zj1vLmxpdF9idWZzaXplLG8uc3ltX2VuZD0zKihvLmxpdF9idWZzaXplLTEpLG8ubGV2ZWw9ZSxvLnN0cmF0ZWd5PWEsby5tZXRob2Q9cixEZSh0KX07dmFyIENlPXtkZWZsYXRlSW5pdDoodCxlKT0+VWUodCxlLEh0LE10LE50LFR0KSxkZWZsYXRlSW5pdDI6VWUsZGVmbGF0ZVJlc2V0OkRlLGRlZmxhdGVSZXNldEtlZXA6UmUsZGVmbGF0ZVNldEhlYWRlcjoodCxlKT0+TGUodCl8fDIhPT10LnN0YXRlLndyYXA/U3Q6KHQuc3RhdGUuZ3poZWFkPWUsQXQpLGRlZmxhdGU6KHQsZSk9PntpZihMZSh0KXx8ZT56dHx8ZTwwKXJldHVybiB0P2hlKHQsU3QpOlN0O2NvbnN0IHI9dC5zdGF0ZTtpZighdC5vdXRwdXR8fDAhPT10LmF2YWlsX2luJiYhdC5pbnB1dHx8ci5zdGF0dXM9PT1uZSYmZSE9PWt0KXJldHVybiBoZSh0LDA9PT10LmF2YWlsX291dD9PdDpTdCk7Y29uc3Qgbj1yLmxhc3RfZmx1c2g7aWYoci5sYXN0X2ZsdXNoPWUsMCE9PXIucGVuZGluZyl7aWYoZmUodCksMD09PXQuYXZhaWxfb3V0KXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9ZWxzZSBpZigwPT09dC5hdmFpbF9pbiYmY2UoZSk8PWNlKG4pJiZlIT09a3QpcmV0dXJuIGhlKHQsT3QpO2lmKHIuc3RhdHVzPT09bmUmJjAhPT10LmF2YWlsX2luKXJldHVybiBoZSh0LE90KTtpZihyLnN0YXR1cz09PXF0JiYwPT09ci53cmFwJiYoci5zdGF0dXM9cmUpLHIuc3RhdHVzPT09cXQpe2xldCBlPUh0KyhyLndfYml0cy04PDw0KTw8OCxuPS0xO2lmKG49ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj8wOnIubGV2ZWw8Nj8xOjY9PT1yLmxldmVsPzI6MyxlfD1uPDw2LDAhPT1yLnN0cnN0YXJ0JiYoZXw9WXQpLGUrPTMxLWUlMzEseWUocixlKSwwIT09ci5zdHJzdGFydCYmKHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSx0LmFkbGVyPTEsci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKHIuc3RhdHVzPT09VnQpaWYodC5hZGxlcj0wLGdlKHIsMzEpLGdlKHIsMTM5KSxnZShyLDgpLHIuZ3poZWFkKWdlKHIsKHIuZ3poZWFkLnRleHQ/MTowKSsoci5nemhlYWQuaGNyYz8yOjApKyhyLmd6aGVhZC5leHRyYT80OjApKyhyLmd6aGVhZC5uYW1lPzg6MCkrKHIuZ3poZWFkLmNvbW1lbnQ/MTY6MCkpLGdlKHIsMjU1JnIuZ3poZWFkLnRpbWUpLGdlKHIsci5nemhlYWQudGltZT4+OCYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MTYmMjU1KSxnZShyLHIuZ3poZWFkLnRpbWU+PjI0JjI1NSksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLDI1NSZyLmd6aGVhZC5vcyksci5nemhlYWQuZXh0cmEmJnIuZ3poZWFkLmV4dHJhLmxlbmd0aCYmKGdlKHIsMjU1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCksZ2UocixyLmd6aGVhZC5leHRyYS5sZW5ndGg+PjgmMjU1KSksci5nemhlYWQuaGNyYyYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZywwKSksci5nemluZGV4PTAsci5zdGF0dXM9UXQ7ZWxzZSBpZihnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLGxlKSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7aWYoci5zdGF0dXM9PT1RdCl7aWYoci5nemhlYWQuZXh0cmEpe2xldCBlPXIucGVuZGluZyxuPSg2NTUzNSZyLmd6aGVhZC5leHRyYS5sZW5ndGgpLXIuZ3ppbmRleDtmb3IoO3IucGVuZGluZytuPnIucGVuZGluZ19idWZfc2l6ZTspe2xldCBpPXIucGVuZGluZ19idWZfc2l6ZS1yLnBlbmRpbmc7aWYoci5wZW5kaW5nX2J1Zi5zZXQoci5nemhlYWQuZXh0cmEuc3ViYXJyYXkoci5nemluZGV4LHIuZ3ppbmRleCtpKSxyLnBlbmRpbmcpLHIucGVuZGluZz1yLnBlbmRpbmdfYnVmX3NpemUsci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4Kz1pLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtlPTAsbi09aX1sZXQgaT1uZXcgVWludDhBcnJheShyLmd6aGVhZC5leHRyYSk7ci5wZW5kaW5nX2J1Zi5zZXQoaS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K24pLHIucGVuZGluZyksci5wZW5kaW5nKz1uLHIuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5lJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLWUsZSkpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPUp0fWlmKHIuc3RhdHVzPT09SnQpe2lmKHIuZ3poZWFkLm5hbWUpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5uYW1lLmxlbmd0aD8yNTUmci5nemhlYWQubmFtZS5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPXRlfWlmKHIuc3RhdHVzPT09dGUpe2lmKHIuZ3poZWFkLmNvbW1lbnQpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5jb21tZW50Lmxlbmd0aD8yNTUmci5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpfXIuc3RhdHVzPWVlfWlmKHIuc3RhdHVzPT09ZWUpe2lmKHIuZ3poZWFkLmhjcmMpe2lmKHIucGVuZGluZysyPnIucGVuZGluZ19idWZfc2l6ZSYmKGZlKHQpLDAhPT1yLnBlbmRpbmcpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7Z2UociwyNTUmdC5hZGxlciksZ2Uocix0LmFkbGVyPj44JjI1NSksdC5hZGxlcj0wfWlmKHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1pZigwIT09dC5hdmFpbF9pbnx8MCE9PXIubG9va2FoZWFkfHxlIT09bXQmJnIuc3RhdHVzIT09bmUpe2xldCBuPTA9PT1yLmxldmVsP2JlKHIsZSk6ci5zdHJhdGVneT09PUR0P0FlKHIsZSk6ci5zdHJhdGVneT09PVV0P3plKHIsZSk6U2Vbci5sZXZlbF0uZnVuYyhyLGUpO2lmKG4hPT1zZSYmbiE9PW9lfHwoci5zdGF0dXM9bmUpLG49PT1pZXx8bj09PXNlKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihyLmxhc3RfZmx1c2g9LTEpLEF0O2lmKG49PT1hZSYmKGU9PT1idD92dChyKTplIT09enQmJihndChyLDAsMCwhMSksZT09PXh0JiYodWUoci5oZWFkKSwwPT09ci5sb29rYWhlYWQmJihyLnN0cnN0YXJ0PTAsci5ibG9ja19zdGFydD0wLHIuaW5zZXJ0PTApKSksZmUodCksMD09PXQuYXZhaWxfb3V0KSlyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fXJldHVybiBlIT09a3Q/QXQ6ci53cmFwPD0wP0V0OigyPT09ci53cmFwPyhnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSxnZShyLHQuYWRsZXI+PjE2JjI1NSksZ2Uocix0LmFkbGVyPj4yNCYyNTUpLGdlKHIsMjU1JnQudG90YWxfaW4pLGdlKHIsdC50b3RhbF9pbj4+OCYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MTYmMjU1KSxnZShyLHQudG90YWxfaW4+PjI0JjI1NSkpOih5ZShyLHQuYWRsZXI+Pj4xNikseWUociw2NTUzNSZ0LmFkbGVyKSksZmUodCksci53cmFwPjAmJihyLndyYXA9LXIud3JhcCksMCE9PXIucGVuZGluZz9BdDpFdCl9LGRlZmxhdGVFbmQ6dD0+e2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBlPXQuc3RhdGUuc3RhdHVzO3JldHVybiB0LnN0YXRlPW51bGwsZT09PXJlP2hlKHQsQnQpOkF0fSxkZWZsYXRlU2V0RGljdGlvbmFyeToodCxlKT0+e2xldCByPWUubGVuZ3RoO2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBuPXQuc3RhdGUsaT1uLndyYXA7aWYoMj09PWl8fDE9PT1pJiZuLnN0YXR1cyE9PXF0fHxuLmxvb2thaGVhZClyZXR1cm4gU3Q7aWYoMT09PWkmJih0LmFkbGVyPWN0KHQuYWRsZXIsZSxyLDApKSxuLndyYXA9MCxyPj1uLndfc2l6ZSl7MD09PWkmJih1ZShuLmhlYWQpLG4uc3Ryc3RhcnQ9MCxuLmJsb2NrX3N0YXJ0PTAsbi5pbnNlcnQ9MCk7bGV0IHQ9bmV3IFVpbnQ4QXJyYXkobi53X3NpemUpO3Quc2V0KGUuc3ViYXJyYXkoci1uLndfc2l6ZSxyKSwwKSxlPXQscj1uLndfc2l6ZX1jb25zdCBhPXQuYXZhaWxfaW4scz10Lm5leHRfaW4sbz10LmlucHV0O2Zvcih0LmF2YWlsX2luPXIsdC5uZXh0X2luPTAsdC5pbnB1dD1lLG1lKG4pO24ubG9va2FoZWFkPj1YdDspe2xldCB0PW4uc3Ryc3RhcnQsZT1uLmxvb2thaGVhZC0oWHQtMSk7ZG97bi5pbnNfaD1kZShuLG4uaW5zX2gsbi53aW5kb3dbdCtYdC0xXSksbi5wcmV2W3Qmbi53X21hc2tdPW4uaGVhZFtuLmluc19oXSxuLmhlYWRbbi5pbnNfaF09dCx0Kyt9d2hpbGUoLS1lKTtuLnN0cnN0YXJ0PXQsbi5sb29rYWhlYWQ9WHQtMSxtZShuKX1yZXR1cm4gbi5zdHJzdGFydCs9bi5sb29rYWhlYWQsbi5ibG9ja19zdGFydD1uLnN0cnN0YXJ0LG4uaW5zZXJ0PW4ubG9va2FoZWFkLG4ubG9va2FoZWFkPTAsbi5tYXRjaF9sZW5ndGg9bi5wcmV2X2xlbmd0aD1YdC0xLG4ubWF0Y2hfYXZhaWxhYmxlPTAsdC5uZXh0X2luPXMsdC5pbnB1dD1vLHQuYXZhaWxfaW49YSxuLndyYXA9aSxBdH0sZGVmbGF0ZUluZm86InBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkifTtjb25zdCBUZT0odCxlKT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsZSk7dmFyIEZlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2Zvcig7ZS5sZW5ndGg7KXtjb25zdCByPWUuc2hpZnQoKTtpZihyKXtpZigib2JqZWN0IiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcihyKyJtdXN0IGJlIG5vbi1vYmplY3QiKTtmb3IoY29uc3QgZSBpbiByKVRlKHIsZSkmJih0W2VdPXJbZV0pfX1yZXR1cm4gdH0sSGU9e2Fzc2lnbjpGZSxmbGF0dGVuQ2h1bmtzOnQ9PntsZXQgZT0wO2ZvcihsZXQgcj0wLG49dC5sZW5ndGg7cjxuO3IrKyllKz10W3JdLmxlbmd0aDtjb25zdCByPW5ldyBVaW50OEFycmF5KGUpO2ZvcihsZXQgZT0wLG49MCxpPXQubGVuZ3RoO2U8aTtlKyspe2xldCBpPXRbZV07ci5zZXQoaSxuKSxuKz1pLmxlbmd0aH1yZXR1cm4gcn19O2xldCBaZT0hMDt0cnl7U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLG5ldyBVaW50OEFycmF5KDEpKX1jYXRjaCh0KXtaZT0hMX1jb25zdCBNZT1uZXcgVWludDhBcnJheSgyNTYpO2ZvcihsZXQgdD0wO3Q8MjU2O3QrKylNZVt0XT10Pj0yNTI/Njp0Pj0yNDg/NTp0Pj0yNDA/NDp0Pj0yMjQ/Mzp0Pj0xOTI/MjoxO01lWzI1NF09TWVbMjU0XT0xO2NvbnN0IE5lPSh0LGUpPT57aWYoZTw2NTUzNCYmdC5zdWJhcnJheSYmWmUpcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCx0Lmxlbmd0aD09PWU/dDp0LnN1YmFycmF5KDAsZSkpO2xldCByPSIiO2ZvcihsZXQgbj0wO248ZTtuKyspcis9U3RyaW5nLmZyb21DaGFyQ29kZSh0W25dKTtyZXR1cm4gcn07dmFyIEllPXtzdHJpbmcyYnVmOnQ9PntpZigiZnVuY3Rpb24iPT10eXBlb2YgVGV4dEVuY29kZXImJlRleHRFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUpcmV0dXJuKG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHQpO2xldCBlLHIsbixpLGEscz10Lmxlbmd0aCxvPTA7Zm9yKGk9MDtpPHM7aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxvKz1yPDEyOD8xOnI8MjA0OD8yOnI8NjU1MzY/Mzo0O2ZvcihlPW5ldyBVaW50OEFycmF5KG8pLGE9MCxpPTA7YTxvO2krKylyPXQuY2hhckNvZGVBdChpKSw1NTI5Nj09KDY0NTEyJnIpJiZpKzE8cyYmKG49dC5jaGFyQ29kZUF0KGkrMSksNTYzMjA9PSg2NDUxMiZuKSYmKHI9NjU1MzYrKHItNTUyOTY8PDEwKSsobi01NjMyMCksaSsrKSkscjwxMjg/ZVthKytdPXI6cjwyMDQ4PyhlW2ErK109MTkyfHI+Pj42LGVbYSsrXT0xMjh8NjMmcik6cjw2NTUzNj8oZVthKytdPTIyNHxyPj4+MTIsZVthKytdPTEyOHxyPj4+NiY2MyxlW2ErK109MTI4fDYzJnIpOihlW2ErK109MjQwfHI+Pj4xOCxlW2ErK109MTI4fHI+Pj4xMiY2MyxlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik7cmV0dXJuIGV9LGJ1ZjJzdHJpbmc6KHQsZSk9Pntjb25zdCByPWV8fHQubGVuZ3RoO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RGVjb2RlciYmVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSlyZXR1cm4obmV3IFRleHREZWNvZGVyKS5kZWNvZGUodC5zdWJhcnJheSgwLGUpKTtsZXQgbixpO2NvbnN0IGE9bmV3IEFycmF5KDIqcik7Zm9yKGk9MCxuPTA7bjxyOyl7bGV0IGU9dFtuKytdO2lmKGU8MTI4KXthW2krK109ZTtjb250aW51ZX1sZXQgcz1NZVtlXTtpZihzPjQpYVtpKytdPTY1NTMzLG4rPXMtMTtlbHNle2ZvcihlJj0yPT09cz8zMTozPT09cz8xNTo3O3M+MSYmbjxyOyllPWU8PDZ8NjMmdFtuKytdLHMtLTtzPjE/YVtpKytdPTY1NTMzOmU8NjU1MzY/YVtpKytdPWU6KGUtPTY1NTM2LGFbaSsrXT01NTI5NnxlPj4xMCYxMDIzLGFbaSsrXT01NjMyMHwxMDIzJmUpfX1yZXR1cm4gTmUoYSxpKX0sdXRmOGJvcmRlcjoodCxlKT0+eyhlPWV8fHQubGVuZ3RoKT50Lmxlbmd0aCYmKGU9dC5sZW5ndGgpO2xldCByPWUtMTtmb3IoO3I+PTAmJjEyOD09KDE5MiZ0W3JdKTspci0tO3JldHVybiByPDB8fDA9PT1yP2U6citNZVt0W3JdXT5lP3I6ZX19O2Z1bmN0aW9uIGplKCl7dGhpcy5pbnB1dD1udWxsLHRoaXMubmV4dF9pbj0wLHRoaXMuYXZhaWxfaW49MCx0aGlzLnRvdGFsX2luPTAsdGhpcy5vdXRwdXQ9bnVsbCx0aGlzLm5leHRfb3V0PTAsdGhpcy5hdmFpbF9vdXQ9MCx0aGlzLnRvdGFsX291dD0wLHRoaXMubXNnPSIiLHRoaXMuc3RhdGU9bnVsbCx0aGlzLmRhdGFfdHlwZT0yLHRoaXMuYWRsZXI9MH12YXIgUGU9amU7Y29uc3QgJGU9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyx7Wl9OT19GTFVTSDpLZSxaX1NZTkNfRkxVU0g6WGUsWl9GVUxMX0ZMVVNIOkdlLFpfRklOSVNIOldlLFpfT0s6WWUsWl9TVFJFQU1fRU5EOnFlLFpfREVGQVVMVF9DT01QUkVTU0lPTjpWZSxaX0RFRkFVTFRfU1RSQVRFR1k6UWUsWl9ERUZMQVRFRDpKZX09ZnQ7ZnVuY3Rpb24gdHIodCl7dGhpcy5vcHRpb25zPUhlLmFzc2lnbih7bGV2ZWw6VmUsbWV0aG9kOkplLGNodW5rU2l6ZToxNjM4NCx3aW5kb3dCaXRzOjE1LG1lbUxldmVsOjgsc3RyYXRlZ3k6UWV9LHR8fHt9KTtsZXQgZT10aGlzLm9wdGlvbnM7ZS5yYXcmJmUud2luZG93Qml0cz4wP2Uud2luZG93Qml0cz0tZS53aW5kb3dCaXRzOmUuZ3ppcCYmZS53aW5kb3dCaXRzPjAmJmUud2luZG93Qml0czwxNiYmKGUud2luZG93Qml0cys9MTYpLHRoaXMuZXJyPTAsdGhpcy5tc2c9IiIsdGhpcy5lbmRlZD0hMSx0aGlzLmNodW5rcz1bXSx0aGlzLnN0cm09bmV3IFBlLHRoaXMuc3RybS5hdmFpbF9vdXQ9MDtsZXQgcj1DZS5kZWZsYXRlSW5pdDIodGhpcy5zdHJtLGUubGV2ZWwsZS5tZXRob2QsZS53aW5kb3dCaXRzLGUubWVtTGV2ZWwsZS5zdHJhdGVneSk7aWYociE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7aWYoZS5oZWFkZXImJkNlLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLGUuaGVhZGVyKSxlLmRpY3Rpb25hcnkpe2xldCB0O2lmKHQ9InN0cmluZyI9PXR5cGVvZiBlLmRpY3Rpb25hcnk/SWUuc3RyaW5nMmJ1ZihlLmRpY3Rpb25hcnkpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKGUuZGljdGlvbmFyeSk/bmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KTplLmRpY3Rpb25hcnkscj1DZS5kZWZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sdCksciE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7dGhpcy5fZGljdF9zZXQ9ITB9fWZ1bmN0aW9uIGVyKHQsZSl7Y29uc3Qgcj1uZXcgdHIoZSk7aWYoci5wdXNoKHQsITApLHIuZXJyKXRocm93IHIubXNnfHxkdFtyLmVycl07cmV0dXJuIHIucmVzdWx0fWZ1bmN0aW9uIHJyKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxlcih0LGUpfWZ1bmN0aW9uIG5yKHQsZSl7cmV0dXJuKGU9ZXx8e30pLmd6aXA9ITAsZXIodCxlKX10ci5wcm90b3R5cGUucHVzaD1mdW5jdGlvbih0LGUpe2NvbnN0IHI9dGhpcy5zdHJtLG49dGhpcy5vcHRpb25zLmNodW5rU2l6ZTtsZXQgaSxhO2lmKHRoaXMuZW5kZWQpcmV0dXJuITE7Zm9yKGE9ZT09PX5+ZT9lOiEwPT09ZT9XZTpLZSwic3RyaW5nIj09dHlwZW9mIHQ/ci5pbnB1dD1JZS5zdHJpbmcyYnVmKHQpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKHQpP3IuaW5wdXQ9bmV3IFVpbnQ4QXJyYXkodCk6ci5pbnB1dD10LHIubmV4dF9pbj0wLHIuYXZhaWxfaW49ci5pbnB1dC5sZW5ndGg7OylpZigwPT09ci5hdmFpbF9vdXQmJihyLm91dHB1dD1uZXcgVWludDhBcnJheShuKSxyLm5leHRfb3V0PTAsci5hdmFpbF9vdXQ9biksKGE9PT1YZXx8YT09PUdlKSYmci5hdmFpbF9vdXQ8PTYpdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNle2lmKGk9Q2UuZGVmbGF0ZShyLGEpLGk9PT1xZSlyZXR1cm4gci5uZXh0X291dD4wJiZ0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxpPUNlLmRlZmxhdGVFbmQodGhpcy5zdHJtKSx0aGlzLm9uRW5kKGkpLHRoaXMuZW5kZWQ9ITAsaT09PVllO2lmKDAhPT1yLmF2YWlsX291dCl7aWYoYT4wJiZyLm5leHRfb3V0PjApdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNlIGlmKDA9PT1yLmF2YWlsX2luKWJyZWFrfWVsc2UgdGhpcy5vbkRhdGEoci5vdXRwdXQpfXJldHVybiEwfSx0ci5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LHRyLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXt0PT09WWUmJih0aGlzLnJlc3VsdD1IZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksdGhpcy5jaHVua3M9W10sdGhpcy5lcnI9dCx0aGlzLm1zZz10aGlzLnN0cm0ubXNnfTt2YXIgaXI9dHIsYXI9ZXIsc3I9cnIsb3I9bnIsbHI9ZnQsaHI9e0RlZmxhdGU6aXIsZGVmbGF0ZTphcixkZWZsYXRlUmF3OnNyLGd6aXA6b3IsY29uc3RhbnRzOmxyfTt0LkRlZmxhdGU9aXIsdC5jb25zdGFudHM9bHIsdC5kZWZhdWx0PWhyLHQuZGVmbGF0ZT1hcix0LmRlZmxhdGVSYXc9c3IsdC5nemlwPW9yLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0ocy5leHBvcnRzKSkscy5leHBvcnRzKSxsPXtleHBvcnRzOnt9fTt2YXIgaCxjPXtleHBvcnRzOnt9fSx1PXIoT2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsZGVmYXVsdDp7fX0pKTtmdW5jdGlvbiBfKCl7cmV0dXJuIGh8fChoPTEsYy5leHBvcnRzPShlPWV8fGZ1bmN0aW9uKGUscil7dmFyIG47aWYoInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5jcnlwdG8mJihuPXdpbmRvdy5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZiYmc2VsZi5jcnlwdG8mJihuPXNlbGYuY3J5cHRvKSwidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMuY3J5cHRvJiYobj1nbG9iYWxUaGlzLmNyeXB0byksIW4mJiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cubXNDcnlwdG8mJihuPXdpbmRvdy5tc0NyeXB0byksIW4mJnZvaWQgMCE9PXQmJnQuY3J5cHRvJiYobj10LmNyeXB0byksIW4pdHJ5e249dX1jYXRjaCh0KXt9dmFyIGk9ZnVuY3Rpb24oKXtpZihuKXtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5nZXRSYW5kb21WYWx1ZXMpdHJ5e3JldHVybiBuLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdfWNhdGNoKHQpe31pZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5yYW5kb21CeXRlcyl0cnl7cmV0dXJuIG4ucmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKX1jYXRjaCh0KXt9fXRocm93IG5ldyBFcnJvcigiTmF0aXZlIGNyeXB0byBtb2R1bGUgY291bGQgbm90IGJlIHVzZWQgdG8gZ2V0IHNlY3VyZSByYW5kb20gbnVtYmVyLiIpfSxhPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPWUscj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLHM9e30sbz1zLmxpYj17fSxsPW8uQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBlPWEodGhpcyk7cmV0dXJuIHQmJmUubWl4SW4odCksZS5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1lLmluaXR8fChlLmluaXQ9ZnVuY3Rpb24oKXtlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGUuaW5pdC5wcm90b3R5cGU9ZSxlLiRzdXBlcj10aGlzLGV9LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShlKSYmKHRoaXNbZV09dFtlXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0saD1vLldvcmRBcnJheT1sLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPWUhPXI/ZTo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8Xykuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKyspe3ZhciBzPXJbYT4+PjJdPj4+MjQtYSU0KjgmMjU1O2VbbithPj4+Ml18PXM8PDI0LShuK2EpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288aTtvKz00KWVbbitvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPWksdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlczt0W3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0KjgsdC5sZW5ndGg9ZS5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9bC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxyPTA7cjx0O3IrPTQpZS5wdXNoKGkoKSk7cmV0dXJuIG5ldyBoLmluaXQoZSx0KX19KSxjPXMuZW5jPXt9LF89Yy5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgaC5pbml0KHIsZS8yKX19LGQ9Yy5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKylyW24+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGguaW5pdChyLGUpfX0sZj1jLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoZC5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gZC5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LHA9by5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWwuZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IGguaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1mLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbih0KXt2YXIgcixuPXRoaXMuX2RhdGEsaT1uLndvcmRzLGE9bi5zaWdCeXRlcyxzPXRoaXMuYmxvY2tTaXplLG89YS8oNCpzKSxsPShvPXQ/ZS5jZWlsKG8pOmUubWF4KCgwfG8pLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKnMsYz1lLm1pbig0KmwsYSk7aWYobCl7Zm9yKHZhciB1PTA7dTxsO3UrPXMpdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSx1KTtyPWkuc3BsaWNlKDAsbCksbi5zaWdCeXRlcy09Y31yZXR1cm4gbmV3IGguaW5pdChyLGMpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWwuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH0sX21pbkJ1ZmZlclNpemU6MH0pO28uSGFzaGVyPXAuZXh0ZW5kKHtjZmc6bC5leHRlbmQoKSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7cC5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxibG9ja1NpemU6MTYsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHQuaW5pdChyKS5maW5hbGl6ZShlKX19LF9jcmVhdGVIbWFjSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgZy5ITUFDLmluaXQodCxyKS5maW5hbGl6ZShlKX19fSk7dmFyIGc9cy5hbGdvPXt9O3JldHVybiBzfShNYXRoKSxlKSksYy5leHBvcnRzO3ZhciBlfXZhciBkO2Z1bmN0aW9uIGYoKXtyZXR1cm4gZHx8KGQ9MSxsLmV4cG9ydHM9KHQ9XygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLldvcmRBcnJheTtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIGk9W10sYT0wLHM9MDtzPGU7cysrKWlmKHMlNCl7dmFyIG89blt0LmNoYXJDb2RlQXQocy0xKV08PHMlNCoyfG5bdC5jaGFyQ29kZUF0KHMpXT4+PjYtcyU0KjI7aVthPj4+Ml18PW88PDI0LWElNCo4LGErK31yZXR1cm4gci5jcmVhdGUoaSxhKX1lLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLGE9MDthPHI7YSs9Mylmb3IodmFyIHM9KGVbYT4+PjJdPj4+MjQtYSU0KjgmMjU1KTw8MTZ8KGVbYSsxPj4+Ml0+Pj4yNC0oYSsxKSU0KjgmMjU1KTw8OHxlW2ErMj4+PjJdPj4+MjQtKGErMiklNCo4JjI1NSxvPTA7bzw0JiZhKy43NSpvPHI7bysrKWkucHVzaChuLmNoYXJBdChzPj4+NiooMy1vKSY2MykpO3ZhciBsPW4uY2hhckF0KDY0KTtpZihsKWZvcig7aS5sZW5ndGglNDspaS5wdXNoKGwpO3JldHVybiBpLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZT10Lmxlbmd0aCxyPXRoaXMuX21hcCxpPXRoaXMuX3JldmVyc2VNYXA7aWYoIWkpe2k9dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIGE9MDthPHIubGVuZ3RoO2ErKylpW3IuY2hhckNvZGVBdChhKV09YX12YXIgcz1yLmNoYXJBdCg2NCk7aWYocyl7dmFyIG89dC5pbmRleE9mKHMpOy0xIT09byYmKGU9byl9cmV0dXJuIG4odCxlLGkpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9fSgpLHQuZW5jLkJhc2U2NCkpLGwuZXhwb3J0czt2YXIgdH12YXIgcCxnPWUoZigpKSx5PXtleHBvcnRzOnt9fSx3PXtleHBvcnRzOnt9fTtmdW5jdGlvbiB2KCl7cmV0dXJuIHB8fChwPTEsdy5leHBvcnRzPSh0PV8oKSxmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLHM9ci5hbGdvLG89W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PTA7dDw2NDt0Kyspb1t0XT00Mjk0OTY3Mjk2KmUuYWJzKGUuc2luKHQrMSkpfDB9KCk7dmFyIGw9cy5NRDU9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTA7cjwxNjtyKyspe3ZhciBuPWUrcixpPXRbbl07dFtuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgYT10aGlzLl9oYXNoLndvcmRzLHM9dFtlKzBdLGw9dFtlKzFdLGQ9dFtlKzJdLGY9dFtlKzNdLHA9dFtlKzRdLGc9dFtlKzVdLHk9dFtlKzZdLHc9dFtlKzddLHY9dFtlKzhdLG09dFtlKzldLGI9dFtlKzEwXSx4PXRbZSsxMV0saz10W2UrMTJdLHo9dFtlKzEzXSxBPXRbZSsxNF0sRT10W2UrMTVdLFM9YVswXSxCPWFbMV0sTz1hWzJdLEw9YVszXTtTPWgoUyxCLE8sTCxzLDcsb1swXSksTD1oKEwsUyxCLE8sbCwxMixvWzFdKSxPPWgoTyxMLFMsQixkLDE3LG9bMl0pLEI9aChCLE8sTCxTLGYsMjIsb1szXSksUz1oKFMsQixPLEwscCw3LG9bNF0pLEw9aChMLFMsQixPLGcsMTIsb1s1XSksTz1oKE8sTCxTLEIseSwxNyxvWzZdKSxCPWgoQixPLEwsUyx3LDIyLG9bN10pLFM9aChTLEIsTyxMLHYsNyxvWzhdKSxMPWgoTCxTLEIsTyxtLDEyLG9bOV0pLE89aChPLEwsUyxCLGIsMTcsb1sxMF0pLEI9aChCLE8sTCxTLHgsMjIsb1sxMV0pLFM9aChTLEIsTyxMLGssNyxvWzEyXSksTD1oKEwsUyxCLE8seiwxMixvWzEzXSksTz1oKE8sTCxTLEIsQSwxNyxvWzE0XSksUz1jKFMsQj1oKEIsTyxMLFMsRSwyMixvWzE1XSksTyxMLGwsNSxvWzE2XSksTD1jKEwsUyxCLE8seSw5LG9bMTddKSxPPWMoTyxMLFMsQix4LDE0LG9bMThdKSxCPWMoQixPLEwsUyxzLDIwLG9bMTldKSxTPWMoUyxCLE8sTCxnLDUsb1syMF0pLEw9YyhMLFMsQixPLGIsOSxvWzIxXSksTz1jKE8sTCxTLEIsRSwxNCxvWzIyXSksQj1jKEIsTyxMLFMscCwyMCxvWzIzXSksUz1jKFMsQixPLEwsbSw1LG9bMjRdKSxMPWMoTCxTLEIsTyxBLDksb1syNV0pLE89YyhPLEwsUyxCLGYsMTQsb1syNl0pLEI9YyhCLE8sTCxTLHYsMjAsb1syN10pLFM9YyhTLEIsTyxMLHosNSxvWzI4XSksTD1jKEwsUyxCLE8sZCw5LG9bMjldKSxPPWMoTyxMLFMsQix3LDE0LG9bMzBdKSxTPXUoUyxCPWMoQixPLEwsUyxrLDIwLG9bMzFdKSxPLEwsZyw0LG9bMzJdKSxMPXUoTCxTLEIsTyx2LDExLG9bMzNdKSxPPXUoTyxMLFMsQix4LDE2LG9bMzRdKSxCPXUoQixPLEwsUyxBLDIzLG9bMzVdKSxTPXUoUyxCLE8sTCxsLDQsb1szNl0pLEw9dShMLFMsQixPLHAsMTEsb1szN10pLE89dShPLEwsUyxCLHcsMTYsb1szOF0pLEI9dShCLE8sTCxTLGIsMjMsb1szOV0pLFM9dShTLEIsTyxMLHosNCxvWzQwXSksTD11KEwsUyxCLE8scywxMSxvWzQxXSksTz11KE8sTCxTLEIsZiwxNixvWzQyXSksQj11KEIsTyxMLFMseSwyMyxvWzQzXSksUz11KFMsQixPLEwsbSw0LG9bNDRdKSxMPXUoTCxTLEIsTyxrLDExLG9bNDVdKSxPPXUoTyxMLFMsQixFLDE2LG9bNDZdKSxTPV8oUyxCPXUoQixPLEwsUyxkLDIzLG9bNDddKSxPLEwscyw2LG9bNDhdKSxMPV8oTCxTLEIsTyx3LDEwLG9bNDldKSxPPV8oTyxMLFMsQixBLDE1LG9bNTBdKSxCPV8oQixPLEwsUyxnLDIxLG9bNTFdKSxTPV8oUyxCLE8sTCxrLDYsb1s1Ml0pLEw9XyhMLFMsQixPLGYsMTAsb1s1M10pLE89XyhPLEwsUyxCLGIsMTUsb1s1NF0pLEI9XyhCLE8sTCxTLGwsMjEsb1s1NV0pLFM9XyhTLEIsTyxMLHYsNixvWzU2XSksTD1fKEwsUyxCLE8sRSwxMCxvWzU3XSksTz1fKE8sTCxTLEIseSwxNSxvWzU4XSksQj1fKEIsTyxMLFMseiwyMSxvWzU5XSksUz1fKFMsQixPLEwscCw2LG9bNjBdKSxMPV8oTCxTLEIsTyx4LDEwLG9bNjFdKSxPPV8oTyxMLFMsQixkLDE1LG9bNjJdKSxCPV8oQixPLEwsUyxtLDIxLG9bNjNdKSxhWzBdPWFbMF0rU3wwLGFbMV09YVsxXStCfDAsYVsyXT1hWzJdK098MCxhWzNdPWFbM10rTHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JbaT4+PjVdfD0xMjg8PDI0LWklMzI7dmFyIGE9ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLHM9bjtyWzE1KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpLHJbMTQrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKHM8PDh8cz4+PjI0KXw0Mjc4MjU1MzYwJihzPDwyNHxzPj4+OCksdC5zaWdCeXRlcz00KihyLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsbD1vLndvcmRzLGg9MDtoPDQ7aCsrKXt2YXIgYz1sW2hdO2xbaF09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIG99LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2Z1bmN0aW9uIGgodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZSZyfH5lJm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBjKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmbnxyJn5uKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gdSh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlXnJebikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIF8odCxlLHIsbixpLGEscyl7dmFyIG89dCsocl4oZXx+bikpK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1yLk1ENT1hLl9jcmVhdGVIZWxwZXIobCksci5IbWFjTUQ1PWEuX2NyZWF0ZUhtYWNIZWxwZXIobCl9KE1hdGgpLHQuTUQ1KSksdy5leHBvcnRzO3ZhciB0fXZhciBtLGI9e2V4cG9ydHM6e319LHg9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGsoKXtyZXR1cm4gbXx8KG09MSx4LmV4cG9ydHM9KHQ9XygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5Xb3JkQXJyYXksaT1yLkhhc2hlcixhPWUuYWxnbyxzPVtdLG89YS5TSEExPWkuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IG4uaW5pdChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4LDMyODUzNzc1MjBdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0sbz1yWzNdLGw9cls0XSxoPTA7aDw4MDtoKyspe2lmKGg8MTYpc1toXT0wfHRbZStoXTtlbHNle3ZhciBjPXNbaC0zXV5zW2gtOF1ec1toLTE0XV5zW2gtMTZdO3NbaF09Yzw8MXxjPj4+MzF9dmFyIHU9KG48PDV8bj4+PjI3KStsK3NbaF07dSs9aDwyMD8xNTE4NTAwMjQ5KyhpJmF8fmkmbyk6aDw0MD8xODU5Nzc1MzkzKyhpXmFebyk6aDw2MD8oaSZhfGkmb3xhJm8pLTE4OTQwMDc1ODg6KGleYV5vKS04OTk0OTc1MTQsbD1vLG89YSxhPWk8PDMwfGk+Pj4yLGk9bixuPXV9clswXT1yWzBdK258MCxyWzFdPXJbMV0raXwwLHJbMl09clsyXSthfDAsclszXT1yWzNdK298MCxyWzRdPXJbNF0rbHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEsZT10LndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCp0LnNpZ0J5dGVzO3JldHVybiBlW24+Pj41XXw9MTI4PDwyNC1uJTMyLGVbMTQrKG4rNjQ+Pj45PDw0KV09TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGVbMTUrKG4rNjQ+Pj45PDw0KV09cix0LnNpZ0J5dGVzPTQqZS5sZW5ndGgsdGhpcy5fcHJvY2VzcygpLHRoaXMuX2hhc2h9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2UuU0hBMT1pLl9jcmVhdGVIZWxwZXIobyksZS5IbWFjU0hBMT1pLl9jcmVhdGVIbWFjSGVscGVyKG8pfSgpLHQuU0hBMSkpLHguZXhwb3J0czt2YXIgdH12YXIgeixBPXtleHBvcnRzOnt9fTtmdW5jdGlvbiBFKCl7cmV0dXJuIHp8fCh6PTEsQS5leHBvcnRzPSh0PV8oKSxyPShlPXQpLmxpYi5CYXNlLG49ZS5lbmMuVXRmOCx2b2lkKGUuYWxnby5ITUFDPXIuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLl9oYXNoZXI9bmV3IHQuaW5pdCwic3RyaW5nIj09dHlwZW9mIGUmJihlPW4ucGFyc2UoZSkpO3ZhciByPXQuYmxvY2tTaXplLGk9NCpyO2Uuc2lnQnl0ZXM+aSYmKGU9dC5maW5hbGl6ZShlKSksZS5jbGFtcCgpO2Zvcih2YXIgYT10aGlzLl9vS2V5PWUuY2xvbmUoKSxzPXRoaXMuX2lLZXk9ZS5jbG9uZSgpLG89YS53b3JkcyxsPXMud29yZHMsaD0wO2g8cjtoKyspb1toXV49MTU0OTU1NjgyOCxsW2hdXj05MDk1MjI0ODY7YS5zaWdCeXRlcz1zLnNpZ0J5dGVzPWksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2hhc2hlcjt0LnJlc2V0KCksdC51cGRhdGUodGhpcy5faUtleSl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9oYXNoZXIscj1lLmZpbmFsaXplKHQpO3JldHVybiBlLnJlc2V0KCksZS5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19KSkpKSxBLmV4cG9ydHM7dmFyIHQsZSxyLG59dmFyIFM7ZnVuY3Rpb24gQigpe3JldHVybiBTfHwoUz0xLGIuZXhwb3J0cz0odD1fKCksaygpLEUoKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuQmFzZSxpPXIuV29yZEFycmF5LGE9ZS5hbGdvLHM9YS5NRDUsbz1hLkV2cEtERj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtrZXlTaXplOjQsaGFzaGVyOnMsaXRlcmF0aW9uczoxfSksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCl9LGNvbXB1dGU6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHIsbj10aGlzLmNmZyxhPW4uaGFzaGVyLmNyZWF0ZSgpLHM9aS5jcmVhdGUoKSxvPXMud29yZHMsbD1uLmtleVNpemUsaD1uLml0ZXJhdGlvbnM7by5sZW5ndGg8bDspe3ImJmEudXBkYXRlKHIpLHI9YS51cGRhdGUodCkuZmluYWxpemUoZSksYS5yZXNldCgpO2Zvcih2YXIgYz0xO2M8aDtjKyspcj1hLmZpbmFsaXplKHIpLGEucmVzZXQoKTtzLmNvbmNhdChyKX1yZXR1cm4gcy5zaWdCeXRlcz00Kmwsc319KTtlLkV2cEtERj1mdW5jdGlvbih0LGUscil7cmV0dXJuIG8uY3JlYXRlKHIpLmNvbXB1dGUodCxlKX19KCksdC5FdnBLREYpKSxiLmV4cG9ydHM7dmFyIHR9dmFyIE8sTD17ZXhwb3J0czp7fX07dmFyIFI7dmFyIEQsVSxDPShSfHwoUj0xLHkuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxhPVtdLHM9W10sbz1bXSxsPVtdLGg9W10sYz1bXSx1PVtdLF89W10sZD1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBmPW5ebjw8MV5uPDwyXm48PDNebjw8NDtmPWY+Pj44XjI1NSZmXjk5LGlbcl09ZixhW2ZdPXI7dmFyIHA9dFtyXSxnPXRbcF0seT10W2ddLHc9MjU3KnRbZl1eMTY4NDMwMDgqZjtzW3JdPXc8PDI0fHc+Pj44LG9bcl09dzw8MTZ8dz4+PjE2LGxbcl09dzw8OHx3Pj4+MjQsaFtyXT13LHc9MTY4NDMwMDkqeV42NTUzNypnXjI1NypwXjE2ODQzMDA4KnIsY1tmXT13PDwyNHx3Pj4+OCx1W2ZdPXc8PDE2fHc+Pj4xNixfW2ZdPXc8PDh8dz4+PjI0LGRbZl09dyxyPyhyPXBedFt0W3RbeV5wXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgZj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0scD1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksYT10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/YVtzXT1lW3NdOihoPWFbcy0xXSxzJXI/cj42JiZzJXI9PTQmJihoPWlbaD4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdKTooaD1pWyhoPWg8PDh8aD4+PjI0KT4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdLGhePWZbcy9yfDBdPDwyNCksYVtzXT1hW3Mtcl1eaCk7Zm9yKHZhciBvPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGw9MDtsPG47bCsrKXtpZihzPW4tbCxsJTQpdmFyIGg9YVtzXTtlbHNlIGg9YVtzLTRdO29bbF09bDw0fHxzPD00P2g6Y1tpW2g+Pj4yNF1dXnVbaVtoPj4+MTYmMjU1XV1eX1tpW2g+Pj44JjI1NV1dXmRbaVsyNTUmaF1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxvLGwsaCxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxjLHUsXyxkLGEpLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLGEscyxvKXtmb3IodmFyIGw9dGhpcy5fblJvdW5kcyxoPXRbZV1eclswXSxjPXRbZSsxXV5yWzFdLHU9dFtlKzJdXnJbMl0sXz10W2UrM11eclszXSxkPTQsZj0xO2Y8bDtmKyspe3ZhciBwPW5baD4+PjI0XV5pW2M+Pj4xNiYyNTVdXmFbdT4+PjgmMjU1XV5zWzI1NSZfXV5yW2QrK10sZz1uW2M+Pj4yNF1eaVt1Pj4+MTYmMjU1XV5hW18+Pj44JjI1NV1ec1syNTUmaF1ecltkKytdLHk9blt1Pj4+MjRdXmlbXz4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXnNbMjU1JmNdXnJbZCsrXSx3PW5bXz4+PjI0XV5pW2g+Pj4xNiYyNTVdXmFbYz4+PjgmMjU1XV5zWzI1NSZ1XV5yW2QrK107aD1wLGM9Zyx1PXksXz13fXA9KG9baD4+PjI0XTw8MjR8b1tjPj4+MTYmMjU1XTw8MTZ8b1t1Pj4+OCYyNTVdPDw4fG9bMjU1Jl9dKV5yW2QrK10sZz0ob1tjPj4+MjRdPDwyNHxvW3U+Pj4xNiYyNTVdPDwxNnxvW18+Pj44JjI1NV08PDh8b1syNTUmaF0pXnJbZCsrXSx5PShvW3U+Pj4yNF08PDI0fG9bXz4+PjE2JjI1NV08PDE2fG9baD4+PjgmMjU1XTw8OHxvWzI1NSZjXSlecltkKytdLHc9KG9bXz4+PjI0XTw8MjR8b1toPj4+MTYmMjU1XTw8MTZ8b1tjPj4+OCYyNTVdPDw4fG9bMjU1JnVdKV5yW2QrK10sdFtlXT1wLHRbZSsxXT1nLHRbZSsyXT15LHRbZSszXT13fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIocCl9KCksdC5BRVN9KF8oKSxmKCksdigpLEIoKSxPfHwoTz0xLEwuZXhwb3J0cz0oRD1fKCksQigpLHZvaWQoRC5saWIuQ2lwaGVyfHxmdW5jdGlvbih0KXt2YXIgZT1ELHI9ZS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxhPXIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobSxzPWUuZW5jO3MuVXRmODt2YXIgbz1zLkJhc2U2NCxsPWUuYWxnby5FdnBLREYsaD1yLkNpcGhlcj1hLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKCksY3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSxyKXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQociksdGhpcy5feGZvcm1Nb2RlPXQsdGhpcy5fa2V5PWUsdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe2EucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHByb2Nlc3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCl9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxrZXlTaXplOjQsaXZTaXplOjQsX0VOQ19YRk9STV9NT0RFOjEsX0RFQ19YRk9STV9NT0RFOjIsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3c6Z31yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19KCl9KTtyLlN0cmVhbUNpcGhlcj1oLmV4dGVuZCh7X2RvRmluYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcHJvY2VzcyghMCl9LGJsb2NrU2l6ZToxfSk7dmFyIGM9ZS5tb2RlPXt9LHU9ci5CbG9ja0NpcGhlck1vZGU9bi5leHRlbmQoe2NyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUodCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZSh0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSl7dGhpcy5fY2lwaGVyPXQsdGhpcy5faXY9ZX19KSxfPWMuQ0JDPWZ1bmN0aW9uKCl7dmFyIGU9dS5leHRlbmQoKTtmdW5jdGlvbiByKGUscixuKXt2YXIgaSxhPXRoaXMuX2l2O2E/KGk9YSx0aGlzLl9pdj10KTppPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIHM9MDtzPG47cysrKWVbcitzXV49aVtzXX1yZXR1cm4gZS5FbmNyeXB0b3I9ZS5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplO3IuY2FsbCh0aGlzLHQsZSxpKSxuLmVuY3J5cHRCbG9jayh0LGUpLHRoaXMuX3ByZXZCbG9jaz10LnNsaWNlKGUsZStpKX19KSxlLkRlY3J5cHRvcj1lLmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemUsYT10LnNsaWNlKGUsZStpKTtuLmRlY3J5cHRCbG9jayh0LGUpLHIuY2FsbCh0aGlzLHQsZSxpKSx0aGlzLl9wcmV2QmxvY2s9YX19KSxlfSgpLGQ9KGUucGFkPXt9KS5Qa2NzNz17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGE9bjw8MjR8bjw8MTZ8bjw8OHxuLHM9W10sbz0wO288bjtvKz00KXMucHVzaChhKTt2YXIgbD1pLmNyZWF0ZShzLG4pO3QuY29uY2F0KGwpfSx1bnBhZDpmdW5jdGlvbih0KXt2YXIgZT0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1lfX07ci5CbG9ja0NpcGhlcj1oLmV4dGVuZCh7Y2ZnOmguY2ZnLmV4dGVuZCh7bW9kZTpfLHBhZGRpbmc6ZH0pLHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ7aC5yZXNldC5jYWxsKHRoaXMpO3ZhciBlPXRoaXMuY2ZnLHI9ZS5pdixuPWUubW9kZTt0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFP3Q9bi5jcmVhdGVFbmNyeXB0b3I6KHQ9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlJiZ0aGlzLl9tb2RlLl9fY3JlYXRvcj09dD90aGlzLl9tb2RlLmluaXQodGhpcyxyJiZyLndvcmRzKToodGhpcy5fbW9kZT10LmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPXQpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh0LGUpfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT8oZS5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksdD10aGlzLl9wcm9jZXNzKCEwKSk6KHQ9dGhpcy5fcHJvY2VzcyghMCksZS51bnBhZCh0KSksdH0sYmxvY2tTaXplOjR9KTt2YXIgZj1yLkNpcGhlclBhcmFtcz1uLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0KXt0aGlzLm1peEluKHQpfSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19KSxwPShlLmZvcm1hdD17fSkuT3BlblNTTD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9pLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdChlKTplKS50b1N0cmluZyhvKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGUscj1vLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09blswXSYmMTcwMTA3NjgzMT09blsxXSYmKGU9aS5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxmLmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6ZX0pfX0sZz1yLlNlcmlhbGl6YWJsZUNpcGhlcj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtmb3JtYXQ6cH0pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobik7dmFyIGk9dC5jcmVhdGVFbmNyeXB0b3IocixuKSxhPWkuZmluYWxpemUoZSkscz1pLmNmZztyZXR1cm4gZi5jcmVhdGUoe2NpcGhlcnRleHQ6YSxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTp0LmJsb2NrU2l6ZSxmb3JtYXR0ZXI6bi5mb3JtYXR9KX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtyZXR1cm4gbj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLG4pLmZpbmFsaXplKGUuY2lwaGVydGV4dCl9LF9wYXJzZTpmdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLnBhcnNlKHQsdGhpcyk6dH19KSx5PShlLmtkZj17fSkuT3BlblNTTD17ZXhlY3V0ZTpmdW5jdGlvbih0LGUscixuLGEpe2lmKG58fChuPWkucmFuZG9tKDgpKSxhKXM9bC5jcmVhdGUoe2tleVNpemU6ZStyLGhhc2hlcjphfSkuY29tcHV0ZSh0LG4pO2Vsc2UgdmFyIHM9bC5jcmVhdGUoe2tleVNpemU6ZStyfSkuY29tcHV0ZSh0LG4pO3ZhciBvPWkuY3JlYXRlKHMud29yZHMuc2xpY2UoZSksNCpyKTtyZXR1cm4gcy5zaWdCeXRlcz00KmUsZi5jcmVhdGUoe2tleTpzLGl2Om8sc2FsdDpufSl9fSx3PXIuUGFzc3dvcmRCYXNlZENpcGhlcj1nLmV4dGVuZCh7Y2ZnOmcuY2ZnLmV4dGVuZCh7a2RmOnl9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPShuPXRoaXMuY2ZnLmV4dGVuZChuKSkua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsbi5zYWx0LG4uaGFzaGVyKTtuLml2PWkuaXY7dmFyIGE9Zy5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIGEubWl4SW4oaSksYX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0LG4uaGFzaGVyKTtyZXR1cm4gbi5pdj1pLml2LGcuZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpKSkpKSkseS5leHBvcnRzKSxUPWUoQyksRj17ZXhwb3J0czp7fX07ZnVuY3Rpb24gSCgpe3JldHVybiBVfHwoVT0xLEYuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI9dCxuPXIubGliLGk9bi5Xb3JkQXJyYXksYT1uLkhhc2hlcixzPXIuYWxnbyxvPVtdLGw9W107IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtmb3IodmFyIHI9ZS5zcXJ0KHQpLG49MjtuPD1yO24rKylpZighKHQlbikpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gcih0KXtyZXR1cm4gNDI5NDk2NzI5NioodC0oMHx0KSl8MH1mb3IodmFyIG49MixpPTA7aTw2NDspdChuKSYmKGk8OCYmKG9baV09cihlLnBvdyhuLC41KSkpLGxbaV09cihlLnBvdyhuLDEvMykpLGkrKyksbisrfSgpO3ZhciBoPVtdLGM9cy5TSEEyNTY9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KG8uc2xpY2UoMCkpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLGE9clsyXSxzPXJbM10sbz1yWzRdLGM9cls1XSx1PXJbNl0sXz1yWzddLGQ9MDtkPDY0O2QrKyl7aWYoZDwxNiloW2RdPTB8dFtlK2RdO2Vsc2V7dmFyIGY9aFtkLTE1XSxwPShmPDwyNXxmPj4+NyleKGY8PDE0fGY+Pj4xOCleZj4+PjMsZz1oW2QtMl0seT0oZzw8MTV8Zz4+PjE3KV4oZzw8MTN8Zz4+PjE5KV5nPj4+MTA7aFtkXT1wK2hbZC03XSt5K2hbZC0xNl19dmFyIHc9biZpXm4mYV5pJmEsdj0objw8MzB8bj4+PjIpXihuPDwxOXxuPj4+MTMpXihuPDwxMHxuPj4+MjIpLG09XysoKG88PDI2fG8+Pj42KV4obzw8MjF8bz4+PjExKV4obzw8N3xvPj4+MjUpKSsobyZjXn5vJnUpK2xbZF0raFtkXTtfPXUsdT1jLGM9byxvPXMrbXwwLHM9YSxhPWksaT1uLG49bSsodit3KXwwfXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStzfDAscls0XT1yWzRdK298MCxyWzVdPXJbNV0rY3wwLHJbNl09cls2XSt1fDAscls3XT1yWzddK198MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLHI9dC53b3JkcyxuPTgqdGhpcy5fbkRhdGFCeXRlcyxpPTgqdC5zaWdCeXRlcztyZXR1cm4gcltpPj4+NV18PTEyODw8MjQtaSUzMixyWzE0KyhpKzY0Pj4+OTw8NCldPWUuZmxvb3Iobi80Mjk0OTY3Mjk2KSxyWzE1KyhpKzY0Pj4+OTw8NCldPW4sdC5zaWdCeXRlcz00KnIubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWEuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtyLlNIQTI1Nj1hLl9jcmVhdGVIZWxwZXIoYyksci5IbWFjU0hBMjU2PWEuX2NyZWF0ZUhtYWNIZWxwZXIoYyl9KE1hdGgpLHQuU0hBMjU2fShfKCkpKSxGLmV4cG9ydHN9dmFyIFosTT1lKEgoKSksTj17ZXhwb3J0czp7fX07dmFyIEksaj0oWnx8KFo9MSxOLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5QnVmZmVyKXt2YXIgZT10LmxpYi5Xb3JkQXJyYXkscj1lLmluaXQsbj1lLmluaXQ9ZnVuY3Rpb24odCl7aWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYodD1uZXcgVWludDhBcnJheSh0KSksKHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fCJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhDbGFtcGVkQXJyYXkmJnQgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheXx8dCBpbnN0YW5jZW9mIEludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIEludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkmJih0PW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCx0LmJ5dGVMZW5ndGgpKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl7Zm9yKHZhciBlPXQuYnl0ZUxlbmd0aCxuPVtdLGk9MDtpPGU7aSsrKW5baT4+PjJdfD10W2ldPDwyNC1pJTQqODtyLmNhbGwodGhpcyxuLGUpfWVsc2Ugci5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O24ucHJvdG90eXBlPWV9fSgpLHQubGliLldvcmRBcnJheX0oXygpKSksTi5leHBvcnRzKSxQPWUoaiksJD17ZXhwb3J0czp7fX07dmFyIEs9KEl8fChJPTEsJC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LkhtYWNTSEEyNTZ9KF8oKSxIKCksRSgpKSksJC5leHBvcnRzKSxYPWUoSyk7Y29uc3QgRz0hMTtsZXQgVyxZPWZldGNoO29ubWVzc2FnZT1mdW5jdGlvbih0KXtjb25zdHtqb2I6ZSxjbWQ6cixzZXJ2ZXI6bixwYXRoOmksYnVmZmVyOmEsa2V5QmFzZTY0OnMsZ3ppcDpsLHJlZmVycmVyOmgsaWQ6YyxhcHBJZDp1LHBlcnNpc3RlbnRJZDpfLENST1FVRVRfVkVSU0lPTjpkLGRlYnVnOmYsd2hhdDpwLG9mZmxpbmU6eX09dC5kYXRhO3kmJihZPWspO3N3aXRjaChyKXtjYXNlInVwbG9hZEVuY3J5cHRlZCI6eChpKTticmVhaztjYXNlImdldE9mZmxpbmVGaWxlIjp6KHQuZGF0YS51cmwpO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5lcnJvcigiVW5rbm93biB3b3JrZXIgY29tbWFuZCIscil9ZnVuY3Rpb24gdyh0KXtjb25zdCBlPURhdGUubm93KCkscj1QLmNyZWF0ZSh0KSxuPWcucGFyc2UocyksaT1YKHIsbiksYT1QLnJhbmRvbSgxNikse2NpcGhlcnRleHQ6b309VC5lbmNyeXB0KHIsbix7aXY6YX0pLGw9bmV3IEFycmF5QnVmZmVyKDQrYS5zaWdCeXRlcytpLnNpZ0J5dGVzK28uc2lnQnl0ZXMpLGg9bmV3IERhdGFWaWV3KGwpO2xldCB1PTA7aC5zZXRVaW50MzIodSwxMTI5NDY4MjA5LCExKSx1Kz00O2Zvcihjb25zdCB0IG9mW2EsaSxvXSlmb3IoY29uc3QgZSBvZiB0LndvcmRzKWguc2V0SW50MzIodSxlLCExKSx1Kz00O3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IGVuY3J5cHRlZCAoJHtsLmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLGx9ZnVuY3Rpb24gdih0KXtjb25zdCBlPURhdGUubm93KCkscj1vLmRlZmxhdGUodCx7Z3ppcDohMCxsZXZlbDoxfSk7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gY29tcHJlc3NlZCAoJHtyLmxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCkscn1mdW5jdGlvbiBtKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPU0oUC5jcmVhdGUodCkpLG49Zy5zdHJpbmdpZnkocikucmVwbGFjZSgvPS9nLCIiKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IGhhc2hlZCAoJHt0LmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLG59YXN5bmMgZnVuY3Rpb24gYih0KXtpZih5KXtjb25zdCBlPWBvZmZsaW5lOi8vLyR7dH1gO3JldHVybnt1cmw6ZSx1cGxvYWRVcmw6ZX19Y29uc3QgZT1EYXRlLm5vdygpLHI9YCR7bi51cmx9LyR7dH1gO2lmKCFuLmFwaUtleSlyZXR1cm57dXJsOnIsdXBsb2FkVXJsOnJ9O2NvbnN0IGk9YXdhaXQgWShyLHtoZWFkZXJzOnsiWC1Dcm9xdWV0LUF1dGgiOm4uYXBpS2V5LCJYLUNyb3F1ZXQtQXBwIjp1LCJYLUNyb3F1ZXQtSWQiOl8sIlgtQ3JvcXVldC1TZXNzaW9uIjpjLCJYLUNyb3F1ZXQtVmVyc2lvbiI6ZCwiWC1Dcm9xdWV0LVBhdGgiOm5ldyBVUkwoaCkucGF0aG5hbWV9LHJlZmVycmVyOmh9KSx7b2s6YSxzdGF0dXM6cyxzdGF0dXNUZXh0Om99PWk7aWYoIWEpdGhyb3cgRXJyb3IoYEVycm9yIGluIHNpZ25pbmcgVVJMOiAke3N9IC0gJHtvfWApO2NvbnN0e2Vycm9yOmwscmVhZDpnLHdyaXRlOnd9PWF3YWl0IGkuanNvbigpO2lmKGwpdGhyb3cgRXJyb3IobCk7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYCR7cH0gdXBsb2FkIGF1dGhvcml6ZWQgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSx7dXJsOmcsdXBsb2FkVXJsOnd9fWFzeW5jIGZ1bmN0aW9uIHgodCl7dHJ5e2xldCByPXcobD92KGEpOmEpO0csdC5pbmNsdWRlcygiJUhBU0glIikmJih0PXQucmVwbGFjZSgiJUhBU0glIixtKHIpKSk7Y29uc3R7dXBsb2FkVXJsOm4sdXJsOml9PWF3YWl0IGIodCkscz1EYXRlLm5vdygpLHtvazpvLHN0YXR1czp1LHN0YXR1c1RleHQ6X309YXdhaXQgWShuLHttZXRob2Q6IlBVVCIsbW9kZToiY29ycyIsaGVhZGVyczp7IkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSJ9LHJlZmVycmVyOmgsYm9keTpyfSk7aWYoIW8pdGhyb3cgRXJyb3IoYHNlcnZlciByZXR1cm5lZCAke3V9ICR7X30gZm9yIFBVVCAke259YCk7ZiYmY29uc29sZS5sb2coYyxgJHtwfSB1cGxvYWRlZCAoJHt1fSkgaW4gJHtEYXRlLm5vdygpLXN9bXMgJHtpfWApLFcoe2pvYjplLHVybDppLG9rOm8sc3RhdHVzOnUsc3RhdHVzVGV4dDpfLGJ5dGVzOnIuYnl0ZUxlbmd0aH0pfWNhdGNoKHQpe2YmJmNvbnNvbGUuZXJyb3IoYCR7Y30gdXBsb2FkIGVycm9yICR7dC5tZXNzYWdlfWApLFcoe2pvYjplLG9rOiExLHN0YXR1czotMSxzdGF0dXNUZXh0OnQubWVzc2FnZX0pfX1mdW5jdGlvbiBrKHQsZSl7cmV0dXJuIGYmJmNvbnNvbGUubG9nKGMsYHN0b3JpbmcgJHt0fWApLHEuc2V0KHQsZS5ib2R5KSx7b2s6ITAsc3RhdHVzOjIwMSxzdGF0dXNUZXh0OiJPZmZsaW5lIGNyZWF0ZWQifX1mdW5jdGlvbiB6KHQpe2NvbnN0IHI9cS5nZXQodCk7aWYoIXIpcmV0dXJuIGYmJmNvbnNvbGUuZXJyb3IoYCR7Y30gZmlsZSBub3QgZm91bmQgJHt0fWApLHZvaWQgVyh7am9iOmUsb2s6ITEsc3RhdHVzOi0xLHN0YXR1c1RleHQ6Ik9mZmxpbmUgZmlsZSBub3QgZm91bmQifSk7ZiYmY29uc29sZS5sb2coYyxgcmV0cmlldmVkICR7dH1gKSxXKHtqb2I6ZSxvazohMCxzdGF0dXM6MjAwLHN0YXR1c1RleHQ6Ik9mZmxpbmUgZmlsZSBmb3VuZCIsYm9keTpyLGJ5dGVzOnIuYnl0ZUxlbmd0aH0pfX0sVz1wb3N0TWVzc2FnZTtjb25zdCBxPW5ldyBNYXB9KCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXVwbG9hZC5qcy5tYXAKCg=="),Se=Ln.CROQUET_VERSION,We=Ln.CROQUET_PLATFORM==="node",Jo="https://croquet.io/files/v1",il="https://files.croquet.io",di=il,V=null;function rl(){globalThis.__MULTISYNQ__||(We?console.log("Croquet "+Se):console.log("%cCroquet%c %c"+Se,"color:#F0493E","color:inherit","color:"+(Se.includes("+")?"#909":"inherit")));let s=!We&&window.location.hostname.match(/^(.*\.)?croquet\.io$/i)&&window.location.pathname.startsWith("/dev/"),e=Y.dev||Y.dev!==!1&&s;if(V={messages:Y.has("debug","messages",!1),sends:Y.has("debug","sends",!1),publish:Y.has("debug","publish",!1),events:Y.has("debug","events",!1),ticks:Y.has("debug","ticks",!1),pong:Y.has("debug","pong",!1),snapshot:Y.has("debug","snapshot",!1),session:Y.has("debug","session",!1),initsnapshot:Y.has("debug","initsnapshot",!0),reflector:Y.has("debug","reflector",e),offline:Y.has("debug","offline",!1)},V.offline&&P.showMessage(`${P.libName}: offline mode enabled, no multiuser`,{level:"warning"}),Y.box){let t=new URL(Y.box,window.location).href;t.endsWith("/")||(t+="/"),Y.reflector=t+"reflector",Y.files=t+"files"}}function Qo(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V||rl(),typeof s=="string"&&(s=Object.fromEntries(s.split(",").map(e=>[e.replace(/^no/,""),!s.startsWith("no")])));for(let[e,t]of Object.entries(s))e in V?V[e]=t:P.showMessage(`${P.libName}: unknown debug option "${e}"`,{level:"warning",only:"once"});return V}var ol="wss://api.multisynq.io/depin",Oh=ol,j,fe,Te="reflector",Bh=Y.nocheat,es=200,ts=[0],Uo=4096,hi,pt=new Dh;pt.onerror=s=>console.error(`UploadWorker error: ${s.message}`);var Do=0,Et=new Set;function Oo(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=null;for(let t of Et)if(e||(e=t),t.id===s){e=t;break}if(e){let{appId:t,persistentId:n}=e.sessionSpec;return{appId:t,persistentId:n,key:e.key,uploadEncrypted:i=>e.uploadEncrypted(i),downloadEncrypted:i=>e.downloadEncrypted(i)}}return{}}Object.defineProperty(oe,"controller",{get(){return this.controllers.values().next().value}}),oe.controllers=Et;var Ri=class{constructor(){V||rl(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new Vi(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,oe.removeAllSubscriptionsFor(this.viewId),oe.addSubscription(this.viewId,"__views__",this.viewId,e=>ya(`users now ${e}`),"oncePerFrameWhileSynced"),this.leaving||P.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||this.sessionSpec.rejoinLimit===0}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;let{codeHash:e,computedCodeHash:t}=this.sessionSpec;return e!==t}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){let{name:t,optionsFromUrl:n,persistentIdOptions:i,password:r,appId:o,apiKey:a,viewData:c,viewIdDebugSuffix:l,location:d}=e,p=o?`${o}/${t}`:t;this.key=po(r,"",{keySize:8,hasher:oo.algo.SHA1,iterations:1}),l&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+l).slice(0,16)).replace(/[^a-z0-9]/gi,w=>`_${w==="%"?"":w.charCodeAt(0).toString(16).toUpperCase()}`));let f={...e.options};if(n)for(let w of n)w in Y&&(f[w]=Y[w]);let h={},v={};for(let[w,W]of Object.entries(f))i?.includes(w)?h[w]=W:v[w]=W;let G=V.events||V.publish;G&&(v.__debugEvents=!0),d&&(v.__location=!0);let y=Y.hashOverride||e.hashOverride,X=await async function(w,W){return Yt(w+Xt(W))}(p,h),{developerId:L,token:S}=await this.verifyApiKey(a,o,X),{id:Z,codeHash:u,computedCodeHash:m}=await async function(w,W,R,M,K){let N,H,O=Xr[w],A="";O?(N=O.codeHashes,H=O.computedCodeHash,A=" (code hashing from cache)"):(N=await Promise.all(ji),H=await Yt([K,...N].join("|")),Xr[w]={codeHashes:N,computedCodeHash:H});let I=M||H,x=await Yt(w+"|"+W+Xt(R)+I);if(vr()&&!Lr.has(x)){Vl||[...document.getElementsByTagName("meta")].find(k=>k.getAttribute("charset"))||console.warn(`${P.libName}: Missing <meta charset="..."> declaration. ${P.libName} model code hashing might differ between browsers.`),Re[H].what="Version ID",Re[w].what="Persistent ID",Re[x].what="Session ID",I!==H&&(N.push(H),Re[H].what="Computed Version ID (replaced by overrideHash)",Re[I]={what:"Version ID (as specified by overrideHash)"});let T=[...N,I,w,x].map(k=>({hash:k,...Re[k]}));console.log(`${P.libName}: Debug Hashing for session ${x}${A}`,T),Lr.add(x)}return vr()||(Re={}),{id:x,persistentId:w,codeHash:I,computedCodeHash:H}}(X,L,v,y,Se);this.tove||(this.tove=await this.encrypt(Z)),c&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(c)),V.session&&console.log(`${P.libName} session "${p}":
        sessionId=${Z}${o?`
        persistentId=${X}`:""}
        versionId=${u===m?u:`${u} (specified in hashOverride)
        versionId=${m} (computed)`}
        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:f,name:p,id:Z,persistentId:X,developerId:L,token:S,codeHash:u,computedCodeHash:m,debugEvents:G};let{msPerTick:b,multiplier:g}=this.getTickAndMultiplier();this.msPerTick=b,this.tickMultiplier=g,this.setUpActivityChecks()}async establishSession(){let{id:e,persistentId:t,codeHash:n}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:n,created:new Date().toISOString()}};let i=new Promise(r=>{this.sessionSpec.sessionJoined=r});this.checkForConnection(!1),V.session&&console.log(e,"waiting for join and SYNC"),await i,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(e){if(V.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(Y.box||Y.reflector)return{apiKey:"none",signServer:"none",reflector:Y.reflector};let t={};for(let c of e.split(",")){let l=c.lastIndexOf(":"),d=c[l===-1?0:l+1];if(!d?.match(/^[12]$/))throw Error("Invalid API key: "+c);if(d in t)throw Error("Duplicate API key versions");t[d]={key:l===-1?c:c.slice(l+1),backend:l===-1?"":c.slice(0,l)}}let n=!t[1];n&&t[2].backend&&(n=t[2].backend),function(c){j===void 0&&(j="depin"in Y?Y.depin:c,j&&!V.offline?(fe=j===!0?Oh:j==="prod"?ol:j==="dev"?"wss://api.multisynq.dev/depin":j==="local"?"ws://localhost:8787":j,fe.endsWith("/")&&(fe=fe.slice(0,-1)),fe=fe.replace(/^http(s):/,"ws$1:"),fe.startsWith("ws")||(fe=(We||window.location.protocol!=="https:"?"ws://":"wss://")+fe),Te="synchronizer",V.session&&console.log(`DEPIN_API=${fe}`)):j=!1)}(n);let i=t[j?2:1];if(!i)throw Error(`No ${j?"Multisynq":"Croquet"} API key provided`);let r=i.key,o=Y.backend||i.backend,a=Y.reflector?.includes("/");return o==="none"?{apiKey:r,signServer:"none",reflector:"overridden"}:j?{apiKey:r,signServer:`${fe.replace(/^ws/,"http")}/clients`,reflector:"depin"}:{apiKey:r,signServer:"https://api.croquet.io/sign",reflector:a?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(e,t,n){let{signServer:i,apiKey:r}=this.getBackend(e);if(i==="none")return{developerId:"unknown_dev_id"};try{let a=await this.fetchWithRetries("verifying API key",[403],2,()=>fetch(`${i}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":r,"X-Croquet-App":t,"X-Croquet-Id":n,"X-Croquet-Version":Se,"X-Croquet-Path":new URL(P.referrerURL()).pathname},referrer:P.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"})),c=await a.json(),{developerId:l,error:d}=c;if(d)throw Error(d);return V.session&&console.log(`${j?"Multisynq":"Croquet"}: verified API key for developer ${l}`),c}catch(o){throw Error(`${j?"Multisynq":"Croquet"} API key validation failed for "${r}": ${o.message}`)}}async fetchWithRetries(e,t,n,i){let r=1+n,o,a=0;for(;;){let c,l;try{if(c=await i(),c.ok)return c}catch(h){l=h}a++;let d="",p=c&&t.includes(c.status);if(p?d="fatal ":a===r&&(d="final "),o=c?`${d}status ${c.status} ${c.statusText} - "${await c.text()}"`:`${d}error "${l?.message}"`,a===r||p)break;let f=a===1?100:a===2?1e3:5e3;console.warn(`${o} while ${e}; retrying in ${f}ms`),await new Promise(h=>{setTimeout(h,f)})}throw console.warn(`${o} while ${e}; giving up`),Error(o)}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){let e=this.vm.snapshot(),t=this.lastKnownTime(e),n=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:n,date:new globalThis.CroquetViewDate().toISOString(),host:We?"localhost":window.location.hostname,sdk:Se},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,n;try{e=_.begin("snapshot"),n=this.takeSnapshot()}catch(i){return ae("snapshot",i),null}finally{t=_.end("snapshot")-e}return V.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)}ms`),n}setDebug(e){return Qo(e)}requestDebugSnapshot(){Qo("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(!this.connected||!this.vm||this.viewOnly)return;let t=this.vm.time,n=t-this.vm.lastSnapshotPoll;if(n<5e3&&!e)return void(V.snapshot&&console.log(`not requesting snapshot poll (${n}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(e){let r=Object.keys(this.vm.views);if(r.sort(),e!==this.viewId&&r[0]!==this.viewId&&r[1]!==this.viewId&&r[2]!==this.viewId)return void(V.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));V.snapshot&&console.log("forcing snapshot poll")}let i=new de(t,0,"_","handlePollForSnapshot",[]);this.sendTagged(i,{debounce:5e3,msgID:"pollForSnapshot"}),V.snapshot&&console.log(this.id,`requesting snapshot poll via ${Te}`)}handlePollForSnapshot(e){if(this.synced!==!0||this.viewOnly)return void(this.triggeringCpuTime=null);let t=this.triggeringCpuTime||this.cpuTime,n,i,r;this.triggeringCpuTime=null,this.cpuTime=0;try{n=_.begin("snapshot"),i={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(o){return void ae("snapshot",o)}finally{r=_.end("snapshot")-n,this.cpuTime-=r}V.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(r)}ms`),queueMicrotask(()=>this.pollForSnapshot(e,i))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),V.snapshot&&console.log(this.id,"sending snapshot vote",t),this.sendTutti({time:e,topic:"snapshot",data:t,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(e){let{tally:t}=e;V.snapshot&&console.log(this.id,"received snapshot votes",t);let{numberOfGroups:n,shouldUpload:i,dissidentFlag:r}=this.analyzeTally(t,"cpuTime");if(n>1){this.diverged=!0;let o=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${o})! Snapshots fall into ${n} groups`)}if(this.synced!==!0)V.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(i){let o={...this.auditStats},a=this.takeSnapshotHandleErrors();a&&queueMicrotask(()=>this.uploadSnapshot(a,o,r))}}analyzeTally(e,t){let n=!1,i=null,r=[],o={},a=null;Object.keys(e).forEach((f,h)=>{let v=JSON.parse(f);r.push(v);let{hash:G,viewId:y}=v;y===this.viewId&&(a=h),o[G]||(o[G]=[]),o[G].push(h)});let c=Object.keys(o),l=c.length,d=0;l>1&&(c.sort((f,h)=>o[h].length-o[f].length),o[c[0]].length===o[c[1]].length&&(V.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),c[1]<c[0]&&(d=1)));let p=c[d];if(a!==null){let f=r[a].hash,h=o[f];h.length>1&&h.sort((v,G)=>r[v][t]-r[G][t]),h[0]===a&&(n=!0,f!==p&&(i={groupVotes:h.length,allVotes:r.length}))}return{numberOfGroups:l,shouldUpload:n,dissidentFlag:i}}snapshotPath(e,t,n){let i=Math.ceil(e).toString().padStart(10,"0"),{appId:r,persistentId:o,codeHash:a,apiKey:c}=this.sessionSpec;return c?`apps/${r}/snap/${a}/${o}.${this.id}/${i}_${t}.${n}`:`snapshots/${this.id}/${i}_${t}-${n}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise(t=>{let n={...e};delete n.meta,Yt(JSON.stringify(n)).then(i=>{e.meta.hash=i,delete e.meta.hashPromise,t(i)})})),e.meta.hashPromise)}uploadServer(e){if(typeof Y.files=="string"){let i=new URL(Y.files,window.location).href;return i.endsWith("/")&&(i=i.slice(0,-1)),{url:i,apiKey:null}}let{apiKey:t,signServer:n}=this.getBackend(e);if(n==="none"&&!V.offline)throw Error("no file server configured");return{url:n,apiKey:t}}async uploadSnapshot(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;await this.hashSnapshot(e);let i=_.begin("snapshot"),r=JSON.stringify(e),o=_.end("snapshot")-i;V.snapshot&&console.log(this.id,`snapshot stringified (${r.length} bytes) in ${Math.ceil(o)}ms`);let{time:a,seq:c,hash:l}=e.meta,d=this.connection.socket;try{let p=await this.uploadEncrypted({content:r,path:this.snapshotPath(a,c,l),key:this.key,gzip:!0,debug:V.snapshot,what:"snapshot"});return this.connection.socket!==d?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(a,c,l,p,t,n),!0)}catch{return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(e,t,n,i,r,o){if(V.snapshot){let a=`time: ${e}, seq: ${t}, hash: ${n}`;o&&(a+=", as dissident; "+JSON.stringify(o)),console.log(this.id,`sending snapshot url to ${Te} (${a}): ${i}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:e,seq:t,hash:n,url:i,auditStats:r,dissident:o}}))}catch(a){console.error("ERROR while sending",a)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${e}#${t}`,url:i,dissident:o})}async diffDivergedSnapshots(e){let t=await Promise.all(e.map(i=>this.downloadEncrypted({url:i,gzip:!0,key:this.key,debug:V.snapshot,json:!0,what:"diverged snapshot"})));for(let i of t)delete i.meta;let n=0;(function i(r,o,a){if(typeof r!=typeof o)console.log(`${a} diverged (${typeof r} vs ${typeof o}):`,r,o),n++;else if(Array.isArray(r)!==Array.isArray(o))console.log(`${a} diverged (array vs object):`,r,o),n++;else if(typeof r=="object"){let c=r?Object.keys(r):[],l=o?Object.keys(o):[],d=c.filter(f=>!l.includes(f)),p=l.filter(f=>!c.includes(f));(d.length||p.length)&&(console.log(`${a} diverged (keys mismatch):`,d,p),n++);for(let f of c)l.includes(f)&&i(r[f],o[f],`${a}${Kt(r,f)}`)}else r!==o&&(console.log(`${a} diverged (value mismatch):`,r,o),n++)})(t[0],t[1],"CROQUETVM"),n?console.log(`Total ${n} differences between diverged snapshots:`,t.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted(e){let{url:t,gzip:n,key:i,debug:r,json:o,what:a}=e;t.startsWith(Jo)&&(t=t.replace(Jo,il));let c=t.startsWith("offline:"),l=c?1:3,d=Date.now(),p=await this.fetchWithRetries(`fetching ${a}`,[],l,()=>c?this.fetchOffline(t,a,r):fetch(t,{method:"GET",mode:"cors",referrer:P.referrerURL()})),f=await p.arrayBuffer();r&&console.log(this.id,`${a} fetched (${f.byteLength} bytes) in ${-d+(d=Date.now())}ms`),_.addNetworkTraffic(`${a}_in`,f.byteLength);let h=this.decryptBinary(f,i);r&&console.log(this.id,`${a} decrypted (${h.length} bytes) in ${-d+(d=Date.now())}ms`);let v=n?jh.inflate(h):h;return r&&n&&console.log(this.id,`${a} inflated (${v.length} bytes) in ${-d+(d=Date.now())}ms`),o?JSON.parse(new TextDecoder().decode(v)):v}async fetchOffline(e,t,n){let i=++Do;return new Promise((r,o)=>{let a=We?"addListener":"addEventListener",c=We?"removeListener":"removeEventListener";pt.postMessage({job:i,cmd:"getOfflineFile",url:e,id:this.id,what:t,debug:n,offline:V.offline});let l=d=>{if(i!==d.data.job)return;let{ok:p,status:f,statusText:h,body:v,bytes:G}=d.data;_.addNetworkTraffic(`${t}_out`,G),pt[c]("message",l),p?r({arrayBuffer:()=>v}):o(Error(`${f}: ${h}`))};try{pt[a]("message",l)}catch(d){console.log("failed to add listener",d)}})}async uploadEncrypted(e){let{content:t,path:n,key:i,gzip:r,keep:o,debug:a,what:c}=e,l=typeof t=="string"?new TextEncoder().encode(t).buffer:t,d=o?void 0:[l],p=typeof i=="string"?i:ye.stringify(i),{apiKey:f,appId:h,persistentId:v}=this.sessionSpec,G=++Do;return new Promise((y,X)=>{let L=We?"addListener":"addEventListener",S=We?"removeListener":"removeEventListener";pt.postMessage({job:G,cmd:"uploadEncrypted",server:this.uploadServer(f),path:n,buffer:l,keyBase64:p,gzip:r,referrer:P.referrerURL(),id:this.id,appId:h,persistentId:v,CROQUET_VERSION:Se,debug:a,what:c,offline:V.offline},d);let Z=u=>{if(G!==u.data.job)return;let{url:m,ok:b,status:g,statusText:w,bytes:W}=u.data;_.addNetworkTraffic(`${c}_out`,W),pt[S]("message",Z),b?y(m):X(Error(`${g}: ${w}`))};try{pt[L]("message",Z)}catch(u){console.log("failed to add listener",u)}})}persistentPath(e){let{appId:t,persistentId:n}=this.sessionSpec;return`apps/${t}/${n}/save/${e}`}pollForPersist(e,t,n,i,r){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(V.offline)return;let o={viewId:this.viewId,hash:i,ms:r+.001*Math.random()},a={persistTime:t,persistentHash:i,persistentString:n};V.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,o),this.sendTutti({time:e,topic:"persist",data:o,localContext:a,tallyTarget:["handlePersistVote"]})}async handlePersistVote(e){let{tally:t,localContext:n}=e;if(V.snapshot){let d=n?`for time @${n.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${d}`,t)}let{numberOfGroups:i,shouldUpload:r,dissidentFlag:o}=this.analyzeTally(t,"ms");if(i>1&&console.warn(this.id,`Persistence records fall into ${i} groups`),!r||!n)return;let{persistTime:a,persistentHash:c,persistentString:l}=n;this.doPersist(a,l,c,o)}async doPersist(e,t,n,i){let r=await this.uploadEncrypted({path:this.persistentPath(n),content:t,key:this.key,gzip:!0,debug:V.snapshot,what:"persistence"});if(V.snapshot){let o=i?` (as dissident; ${JSON.stringify(i)})`:"";console.log(this.id,`sending persistent data url to ${Te}${o}: ${r}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:e,url:r,dissident:i}}))}catch(o){console.error("ERROR while sending",o)}}async forcePersist(e,t,n){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${t.length} bytes`),Y.forcePersist==="alert"&&confirm("forcePersist triggered. Do it?"),await this.doPersist(e,t,n),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(e){let t="noop",n=[];switch(e[2].what){case"users":{let{joined:r,left:o,active:a,total:c}=e[2];this.users=a,this.usersTotal=c;let l="__VM__",d="__peers__",p={entered:r||[],exited:o||[],count:a,total:c};for(let f of p.entered.concat(p.exited))f.data&&(f.data=this.decryptPayload(f.data));t="publishFromModelOnly",n=[l,d,p],oe.handleEvent(this.viewId+":__views__",p.count);break}case"tally":{let{tuttiSeq:r,tuttiKey:o,tally:a,tallyTarget:c,missingClients:l}=e[2];(V.messages||V.snapshot)&&l&&console.log(`${l} ${l===1?"client":"clients"} failed to participate in tally ${o||r}`),t="handleTuttiResult",n=[{tuttiSeq:r,tuttiKey:o,tally:a,tallyTarget:c}];break}case"audit":{let r=e[0];V.messages&&console.log(`audit request at time ${r}`),t="handleAuditRequest",n=[{time:r}];break}}let i=new de(0,0,"_",t,n);e[2]=i.asState()[2]}handleTuttiResult(e){let{tuttiSeq:t,tuttiKey:n,tally:i,tallyTarget:r}=e,o=n?p=>p.tuttiKey===n:p=>p.dummyTuttiSeq===t,a=this.tuttiHistory.findIndex(o),c=a!==-1&&this.tuttiHistory.splice(a,1)[0],l=null,d=null;if(c&&(l=c.payload,d=c.localContext),r){let[p,...f]=r,h=[...f,{tally:i,localPayload:l,localContext:d}],v=new de(0,0,"_",p,h);this.vm.verifyExternal(v),v.executeOn(this.vm,!0)}}handleAuditRequest(e){let{time:t}=e;this.vm.time!==t&&console.error(`time ${this.vm.time} cf audit time ${t}`);let{auditStats:n}=this,{lastUsers:i,minUsers:r,maxUsers:o,payloadTally:a,sessionTimeAtDispatch:c}=n;if(n.payloadTally=0,this.vm.time>c&&(n.minUsers=n.maxUsers=i),!this.fastForwardHandler){let l=_.networkTraffic.audit_reflector_in||0,d=_.networkTraffic.audit_reflector_out||0;_.resetAuditStats();let{clientId:p}=this.connection.socket;queueMicrotask(()=>{V.session&&console.log(this.id,`handling audit request at ${t} after ${l} bytes in, ${d} out`);let f=encodeURIComponent(JSON.stringify({time:t,clientId:p,lastUsers:i,minUsers:r,maxUsers:o,payloadTally:a,bytesIn:l,bytesOut:d})),h=`${fe}/clients/report?session=${this.id}&stats=${f}`.replace("ws","http");fetch(h,{mode:"no-cors"})})}}handleUserTotalForAccounting(e){if(j){let{auditStats:t}=this;if(t.lastUsers=e,this.vm.time<=t.sessionTimeAtDispatch)return;(t.minUsers===-1||e<t.minUsers)&&(t.minUsers=e),e>t.maxUsers&&(t.maxUsers=e)}}messageSizeForAccounting(e){let t=typeof e[2]=="string"?e[2].length:e[2]._size||0;return t+=16,t}async receive(e,t){let n=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),Et.add(this);let{progressReporter:i}=this.sessionSpec,r=i||(()=>{}),{messages:o,url:a,persisted:c,time:l,seq:d,snapshotSeq:p,tove:f,reflector:h,flags:v,auditStatsInitializer:G}=t;if(f&&f!==this.tove)try{if(this.decrypt(f)!==this.id)throw Error("wrong sessionId in tove?!")}catch(b){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${b.message}`),4200),void r(-1)}let y=t.timeline;this.flags=v||{};let X=c?"persistence":"snapshot";V.session&&console.log(this.id,`received SYNC from ${h} ${Te}: time ${l}, ${o.length} messages, ${X} ${a||"<none>"}`);let L=!!this.vm;if(L){this.networkQueue.length=0;let b=!!y&&y===this.timeline,g=o[0],w=d,W=p!==void 0?p:g?g[1]:w;V.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${W}-#${w}`);let R=b&&vs(W,this.vm.seq)&&vs(this.vm.seq,w)&&l>=this.reflectorTime;if(R){let M=0;g&&vs(g[1],this.vm.seq)&&(M=this.vm.seq-g[1]+1>>>0);for(let K=M;R&&K<o.length;K++){let N=o[K][2];typeof N!="string"&&N.what==="users"&&N.left&&N.left.includes(this.viewId)&&(V.session&&console.log(this.id,`${Te} reports that this view has left`),R=!1)}R&&M&&(V.messages&&console.log(this.id,`rejoin: discarding ${M} messages #${g[1]}-#${this.vm.seq}`),o.splice(0,M))}if(R){if(this.sendBuffer.length>0){let M=this.sendBuffer;this.sendBuffer=[],V.session&&console.log(this.id,`rejoin: sending ${M.length} messages buffered while disconnected`);for(let K of M)K()}}else V.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),L=!1}let S=this.networkQueue;this.networkQueue=[];for(let b of o){let g=this.messageSizeForAccounting(b);if(typeof b[2]!="string")this.convertReflectorMessage(b);else try{b[2]=this.decryptPayload(b[2])[0]}catch(w){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${w.message}`),4200),void r(-1)}V.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(b)),this.networkQueue.push([b,g])}if(this.networkQueue.push(...S),l>this.reflectorTime&&this.timeFromReflector(l,"reflector"),L)return V.session&&console.log(this.id,"seamless rejoin successful"),void(this.syncCompleted=!0);let Z;if(this.timeline=y||"",V.snapshot&&a&&console.log(this.id,`fetching ${X} ${a}`),a)try{Z=await this.downloadEncrypted({url:a,gzip:!0,key:this.key,debug:V.snapshot,json:!0,what:X})}catch(b){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${X}: ${b.message}`),4200),void r(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void r(-1);if(c){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(Z)}else Z&&(this.sessionSpec.snapshot=Z),this.install();G&&(V.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(G)}`),this.auditStats=G),V.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${l}`);let u=this.vm.time,m=await new Promise(b=>{let{port1:g,port2:w}=new MessageChannel;g.onmessage=()=>{let W=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(r(1),b(!0),W=!1);else{let R=(this.vm.time-u)/(this.reflectorTime-u);r(R)}else V.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),r(-1),b(!1),W=!1;W&&this.stepSession("fastForward",{budget:es})},this.fastForwardHandler=W=>{this.connected&&this.vm?W==="error"?(r(-1),b(!1)):w.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),r(-1),b(!1))},queueMicrotask(()=>this.stepSession("fastForward",{budget:es}))});return delete this.fastForwardHandler,void(m&&(V.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&P.showMessage(`${P.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{let i=t;i[1]>>>=0;let r=this.messageSizeForAccounting(i);if(typeof i[2]!="string")V.messages&&console.log(this.id,"received META "+JSON.stringify(i)),this.convertReflectorMessage(i),V.messages&&console.log(this.id,"converted to "+JSON.stringify(i));else try{let[a,c,l]=this.decryptPayload(i[2]);i[2]=a,c===this.viewId&&this.addToStatistics(l,this.lastReceived),V.messages&&console.log(this.id,"received "+JSON.stringify(i))}catch(a){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${a.message}`),4200)}let o;return this.networkQueue.push([i,r]),this.flags.rawtime&&(o=i[i.length-1]),this.timeFromReflector(i[0],"reflector",o),void(this.simulateIfNeeded&&queueMicrotask(()=>this.simulateIfNeeded()))}case"TICK":{if(!this.vm)return;let i=typeof t=="number"?t:t.time;if(V.ticks){let r=n&&this.lastReceived-n-this.msPerTick*this.tickMultiplier|0,o=i-this.vm.time;console.log(this.id,`received TICK ${i} ${Math.abs(r)<5?"on time":r<0?"early":"late"} (${o} ms, jitter ${r>0?"+":""}${r} ms)`)}return this.timeFromReflector(i,"reflector"),this.tickMultiplier>1&&this.multiplyTick(i),void(this.simulateIfNeeded&&queueMicrotask(()=>this.simulateIfNeeded()))}case"INFO":{let{msg:i,options:r}=t,o=j?"Multisynq Synchronizer":"Croquet Reflector";return void P.showMessage(`${o}: ${i}`,r)}case"REQU":return V.snapshot&&console.log(`received REQU (snapshot request) from ${Te}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",e,t)}}install(e){let t=Date.now(),{snapshot:n,initFn:i,options:r,debugEvents:o}=this.sessionSpec,[a,c]=n.models?["deserializ","snapshot"]:["initializ","root model"];V.session&&console.log(this.id,`${a}ing ${c}`);let l=new ce(n,o,()=>{try{return i(r,e)}catch(p){throw ae("init",p,"fatal"),p}},this.migratingOldSnapshot);if((V.session||V.snapshot&&n.models)&&console.log(this.id,`${c} ${a}ed in ${Date.now()-t}ms`),V.initsnapshot&&!n.models){V.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let p=null;try{p=JSON.stringify(l.snapshot())}catch(f){throw ae("initial snapshot",f,"fatal"),f}try{l=new ce(JSON.parse(p),o,()=>i(r))}catch(f){throw ae("initial snapshot resume",f,"fatal"),f}}let d=this.lastKnownTime(l);this.reflectorTime=Math.max(this.reflectorTime,d),this.setVM(l)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),V.session&&console.log(this.id,"Controller sending JOIN");let{tick:e,delay:t}=this.getTickAndMultiplier(),{name:n,codeHash:i,appId:r,apiKey:o,persistentId:a,developerId:c,heraldUrl:l,rejoinLimit:d,autoSleep:p,computedCodeHash:f,location:h,flags:v}=this.sessionSpec,G=j?"hiddenName":n,y=j?"hiddenApiKey":this.getBackend(o).apiKey,X=j?"hiddenAppId":r,L=j?"hiddenUrl":P.referrerURL(),S=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:h?[this.viewId]:this.viewId,Z={name:G,apiKey:y,appId:X,url:L,persistentId:a,sdk:Se,developerId:c,version:1,user:S,location:h,ticks:{tick:e,delay:t},dormantDelay:p,tove:this.tove,codeHash:i};l&&Object.assign(Z,{heraldUrl:l}),d&&Object.assign(Z,{leaveDelay:d+250}),f!==i&&Object.assign(Z,{computedCodeHash:f}),v&&Object.assign(Z,{flags:v}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:Z})),this.syncReceiptTimeout=setTimeout(()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))},5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout(()=>{this.leaving?V.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(V.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())},this.sessionSpec.rejoinLimit)))}leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],{rebootModelView:t}=this.sessionSpec;if(this.reset(),V.session&&console.log(this.id,`resetting ${e?"(but keeping)":"and discarding"} controller`),e||Et.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");t()}async encrypt(e){let t=yt.random(16),n=Ds.encrypt(e,this.key,{iv:t}),i=Dn(e,this.key);return`${ye.stringify(t)}${ye.stringify(i)}${n}`}get deprecatedDefaultKey(){return hi||(hi=po("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:oo.algo.SHA1,iterations:1})),hi}decrypt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.key,n=ye.parse(e.slice(0,24)),i=ye.parse(e.slice(24,68)),r=e.slice(68),o=Ds.decrypt(r,t,{iv:n}),a="";try{a=Vd.stringify(o)}catch{}let c=Dn(a,this.key);if(this.compareHmacs(i.words,c.words))return a;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(e,t){let n=new TextDecoder().decode(new Uint8Array(e,0,4)),i,r,o,a,c;switch(typeof t=="string"&&(t=ye.parse(t)),n){case"CRQ0":i=new TextDecoder().decode(e),r=ye.parse(i.slice(4,28)),o=ye.parse(i.slice(28,72)),a=i.slice(72),c=Ds.decrypt(a,t,{iv:r});break;case"CRQ1":i=new Uint8Array(e),r=yt.create(i.subarray(4,20)),o=yt.create(i.subarray(20,52)),a=yt.create(i.subarray(52)),c=Ds.decrypt({ciphertext:a},t,{iv:r});break;default:throw Error(`${this.id} unknown encryption version ${n}`)}c.clamp();let l=Dn(c,t);if(this.compareHmacs(o.words,l.words))return ua(c);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(e,t,n){let[i,r,o]=e.asState();return[i,r,await this.encryptPayload([o,t,n])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let n=e.length===t.length;for(let i=0;i<e.length;i++)e[i]!==t[i]&&(n=!1);return n}sendMessage(e){if(this.viewOnly||!this.vm)return;let t=e.asState()[2].length;if(t>16384)return void console.warn(this.id,`Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to ${Te}.`);!this.payloadSizeWarned&&t>Uo&&(console.log(this.id,`Message with payload of ${t} bytes being sent to ${Te}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);let n=Date.now(),i=this.rateLimitedSendTimes,r=this.rateLimitBuffer;if(_.perSecondTally({requestedMessages:1}),r.length)return void this.addToRateLimitBuffer(e);let o=0;if(i.length&&this.synced){let a=i[i.length-1],c=1e3/this.eventRateLimit-(n-a);c>1&&(o=Math.ceil(c))}o?(this.addToRateLimitBuffer(e),setTimeout(()=>this.serviceRateLimitBuffer(),o)):(this.recordRateLimitedSend(n),this.socketSendMessage(e),_.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){let t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(this.id,`Sends to ${Te} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){_.perSecondTally({bundledMessages:1});let t=Date.now(),n=e.asState(),i=n[2].length,r=this.rateLimitBuffer;if(r.length){let a=r[r.length-1],{msgStates:c,totalPayload:l}=a;if(l<Uo)return c.push({msgState:n,bufferTime:t}),void(a.totalPayload+=i)}_.perSecondTally({newBundles:1}),r.push({msgStates:[{msgState:n,bufferTime:t}],totalPayload:i});let o=r.length;V.session&&o%5==0&&o!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${o} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=o),o>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&o>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;let e=this.rateLimitBuffer;if(!e.length)return;let t=Date.now(),n=1e3/this.eventRateLimit,i=this.rateLimitedSendTimes;if(i.length){let d=i[i.length-1];if(n-(t-d)>0)return}let r=e.shift(),{msgStates:o,totalPayload:a}=r,c=[],l=0;if(o.forEach(d=>{c.push(d.msgState),l+=t-d.bufferTime}),c.length===1){let d=de.fromState(c[0],this.vm);this.socketSendMessage(d)}else{let d=new de(this.vm.time,0,"_","handleBundledEvents",[c]);this.socketSendMessage(d)}if(this.recordRateLimitedSend(t),_.perSecondTally({sentBundles:1,sentMessagesTotal:o.length,sendDelay:l,sentBundlePayload:a,sentPayloadTotal:a}),V.session&&this.connected){let d=e.length;d&&d%5==0&&d!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${d} event bundles`),this.rateLimitLastLogged=d)}e.length&&setTimeout(()=>this.serviceRateLimitBuffer(),n)}async socketSendMessage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=await this.encryptMessage(e,this.viewId,Date.now()),i=V.sends&&(t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(V.sends&&console.log(this.id,`buffering ${i}`),this.sendBuffer.push(()=>this.socketSendMessage(e,t))));V.sends&&console.log(this.id,`sending ${i}`);let r={id:this.id,action:"SEND",args:[...n,this.latency]};t&&(r.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(r))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti(e){let{time:t,topic:n,data:i,localContext:r=null,firstMessage:o=null,wantsVote:a=!0,tallyTarget:c=null}=e;if(this.viewOnly)return;let l=o&&await this.encryptMessage(o,this.viewId,Date.now()),d=Xt(i);if(!this.connected||!this.syncCompleted)return void(this.vm&&(V.sends&&console.log(this.id,`buffering "${n}" TUTTI ${d} ${o&&o.asState()}`),this.sendBuffer.push(()=>this.sendTutti({time:t,topic:n,data:i,localContext:r,firstMessage:o,wantsVote:a,tallyTarget:c}))));V.sends&&console.log(this.id,`sending "${n}" TUTTI ${d} ${o&&o.asState()}`),this.lastSent=Date.now();let p=`${n}@${t}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[t,0,d,l,a,c,p]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:t,tuttiKey:p,dummyTuttiSeq:0,payload:d,localContext:r})}sendLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.connected&&this.syncCompleted?(V.sends&&console.log(this.id,"sending LOG"),t.length<2&&(t=t[0]),this.connection.send(JSON.stringify({action:"LOG",args:t}))):this.vm&&(V.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push(()=>this.sendLog(...t)))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){let e=this.sessionSpec.options,t=["number","string"].includes(typeof e.tps)?e.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[n,i]=(t+"x").split("x").map(l=>Number.parseFloat("0"+l)),r=1e3/Math.max(1/30,Math.min(60,n)),o=Math.max(1,i),a=r,c=0;return o>1&&!Bh&&(a=r/o,c=Math.ceil(a*(o-1))),{msPerTick:a,multiplier:o,tick:r,delay:c}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{let o=_.begin("simulate");for(;t;){let a=this.networkQueue[0];if(!a)break;let[c,l]=a;if(t=this.vm.advanceTo(c[0],e),!t)break;this.networkQueue.shift(),j&&(this.auditStats.payloadTally+=l);let d=this.vm.scheduleExternalMessage(c);t=this.vm.advanceTo(d.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,_.end("simulate")-o)}_.backlog(this.backlog);let n=this.lag,i=Math.max(200,.1*this.msPerTick),r=Math.max(2e3,.2*this.msPerTick);if(typeof this.synced=="boolean"&&this.viewed&&(this.synced&&n>r||!this.synced&&n<i)&&(this.synced?this.applySyncChange(!1):this.syncTimer||(this.syncTimer=setTimeout(()=>{delete this.syncTimer,this.connected&&this.lag<i&&this.applySyncChange(!0)},200))),!V.offline)if(this.synced&&t&&this.vm.time-this.lastSnapshotRequest>5e3){let o=!1;this.cpuTime>5e3?(V.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),o=!0):j&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(V.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),o=!0),o&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout(()=>this.scheduleSnapshot(),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return t}catch(t){return ae("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}stepSession(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=_.stepSession(t.frameTime,!0);n&&console.log(n);let{backlog:i,latency:r,starvation:o,activity:a}=this;if(e==="animation"){_.animationFrame(t.frameTime,{backlog:i,starvation:o,latency:r,activity:a,users:this.users});let l=Date.now();if(this.lastAnimationEnd){let d=l-this.lastAnimationEnd;if(this.animationGapCheck===!0&&d>200&&(this.animationGapCheck=[],V.session&&console.log(this.id,"animation has stopped (too long between steps)")),this.animationGapCheck!==!0){let p=this.animationGapCheck;p.push(d),p.length>4&&p.shift(),p.length===4&&p.reduce((f,h)=>f+h,0)<=400&&(this.animationGapCheck=!0,V.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=l}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let c;switch(e){case"animation":{let l=t.expectedSimFPS,d=Date.now(),p=ts.reduce((f,h)=>f+h,0)/ts.length;if(c=this.simulate(d+Math.min(p,es)),c===!1){let f=l===0?0:1e3/l*4;this.backlog>f&&(c=this.simulate(d+es-p))}c!=="error"&&(ts.push(Date.now()-d),ts.length>4&&ts.shift());break}case"fastForward":case"background":c=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(c),c!=="error"&&(_.begin("update"),this.processModelViewEvents(e==="animation"),_.end("update"),this.vm&&(this.serviceRateLimitBuffer(),e==="animation"&&(t.view&&(_.begin("render"),this.inViewRealm(()=>t.view.update(t.frameTime)),_.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(e){V.session&&console.log(this.id,`synced=${e}`),this.synced=e,P.showSyncWait(!e),this.vm.publishFromView(this.viewId,"synced",e)}inViewRealm(e){return xs(this.vm,()=>e(this.vm))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,n){e<this.reflectorTime?(t!=="controller"||V.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):(typeof this.synced!="boolean"&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&_.backlog(this.backlog),this.tickHook&&this.tickHook(e,n))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);let t=this.msPerTick,n=this.tickMultiplier,i=1;this.localTicker=globalThis.setInterval(()=>{this.timeFromReflector(Math.round(e+i*t),"controller"),V.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,i),++i>=n&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)},t)}startStepping(e){let t=n=>{this.leaving||(this.isOutOfSight()||e(n),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){let e=null;this.isOutOfSight=()=>!(We||document.visibilityState!=="hidden"&&e),this.isBeingAnimated=()=>{let o=this.animationGapCheck===!0,a=Date.now()-this.lastAnimationEnd<200;return o&&!a&&(this.animationGapCheck=[],V.session&&console.log(this.id,"animation has stopped (too long since last step)")),o&&a},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated(),!We&&new IntersectionObserver((o,a)=>e=o[0].isIntersecting).observe(document.body);let t=this.sessionSpec.autoSleep,n;if(t){let o=1e3*t,a=0,c=0;n=()=>{let l=Date.now();l-a<980||(a=l,this.isOutOfSight()?c?l-c>o&&(this.dormantDisconnect(),c=0):c=l:c=0)}}let i=()=>{this.leaving?r&&(clearInterval(r),r=null):this.connected&&this.vm&&(n&&n(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))},r=setInterval(i,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(i(),!this.fastForwardHandler&&this.connected)){let o=.9*this.msPerTick;t&&(o=Math.min(o,es));let a=this.synced?"background":"fastForward";this.stepSession(a,{budget:o})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}},Vi=class{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let e;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;let t=()=>{V.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,_.connected(!0),this.controller.sendJoin()};if(V.offline)e=new Pi,e.isConnected=()=>e.readyState===WebSocket.OPEN;else if(j){let{synchSpec:n,developSpec:i}=Y;if(n&&i)throw Error("Cannot handle both synchSpec and developSpec options");let r="",o=n||i;o&&(r+=`&synch=${encodeURIComponent(o)}`);let a=this.id,{persistentId:c,appId:l,developerId:d}=this.controller.sessionSpec;e=new Ii(`${fe}/clients/connect?session=${a}&persist=${c}&app=${encodeURIComponent(l)}&developer=${d}${r}`),e.isConnected=()=>e.dataChannel?.readyState==="open",e.onconnected=t}else{let n=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector,i=We?void 0:window.location.href,r={},o=this.controller.sessionSpec.token;if(o&&(r.token=o),Y.reflector){let c=Y.reflector.toUpperCase();c==="CF"||c.match(/^[A-Z]{3}$/)?(n=V.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",c.length===3&&(r.colo=c)):Y.reflector.match(/^[-a-z0-9]+$/i)?r.region=Y.reflector:n=new URL(Y.reflector,i).href.replace(/^http/,"ws")}if(!n.match(/^wss?:/))throw Error("Cannot interpret reflector address "+n);n.endsWith("/")||(n+="/");let a=new URL(n+this.id,i);for(let[c,l]of Object.entries(r))a.searchParams.append(c,l);e=new WebSocket(a),e.isConnected=()=>e.readyState===WebSocket.OPEN}e.onopen=n=>{let i=this.socket;i&&(i.onopen=i.onmessage=i.onerror=i.onclose=null),this.socket=e,this.connectHasBeenCalled=!1,e.twoStageConnection||t()},e.onmessage=n=>{if(e!==this.socket)return;let{data:i}=n;if(i.startsWith("_CHUNK")){let o=i.charAt(6)==="1",a=i.charAt(7)==="1",c=i.slice(8);if(o&&(e.chunkCollector=[]),e.chunkCollector.push(c),a){let l="".concat(...e.chunkCollector);e.chunkCollector=[],_.addNetworkTraffic("reflector_in",l.length,!!j),this.receive(l)}}else _.addNetworkTraffic("reflector_in",i.length,!!j),this.receive(i)},e.onerror=n=>{V.session&&console.log(this.id,e.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},e.onclose=n=>{this.socket&&e!==this.socket||this.socketClosed(n.code,n.reason)}}socketClosed(e,t){V.session&&console.log(this.id,`socketClosed with code=${e} message="${t}"`),e>=4100&&e!==4110&&(V.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);let n=!this.controller.leaving&&e!==1e3&&e<4100,i=e===4110;i||e===1e3||this.reconnectDelay||setTimeout(()=>{if(this.connected||this.socket?.isConnecting?.())return;let r=n?"Reconnecting":"Connection closed";P.showMessage(`${r}: ${e} ${t}`,{level:n?"warning":"fatal"})},500),V.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${e} ${t}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),_.connected(!1),_.resetAuditStats(),i?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),n&&(V.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout(()=>{delete this.reconnectTimeout,this.connectToReflector()},this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e),_.addNetworkTraffic("reflector_out",e.length,!!j)}receive(e){this.lastReceived=Date.now();let{id:t,action:n,args:i}=JSON.parse(e);if(t)try{this.controller.receive(n,i)}catch(r){this.closeConnectionWithError("receive",r)}else if(n==="PONG"){if(V.pong&&console.log("PONG after",Date.now()-i,"ms"),this.pongHook)try{this.pongHook(i)}catch(r){console.error(r)}}else console.warn("Unknown action",n)}dormantDisconnect(){this.connected&&(V.session&&console.log(this.id,`dormant; disconnecting from ${Te}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4e3;console.error(n,t),this.closeConnection(n,`Error in ${e}: ${t.message||t}`)}closeConnection(e,t){if(this.socket){this.socket.onclose=null;try{this.socket.close(e,t)}catch(n){console.error(`Error in socket.close(${e}, ${JSON.stringify(t)}):`,n)}}this.socketClosed(e,t)}PULSE(e){this.connected&&(this.socket.bufferedAmount===0?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){this.lastReceived!==0&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((j?"Synchronizer":"Reflector")+" has gone away")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();this.connected&&this.send(JSON.stringify({action:"PING",args:e}))}};globalThis.setInterval(()=>{for(let s of Et)s.connected&&s.vm&&s.connection.keepAlive(Date.now())},100);var ui=Symbol("hash"),mi=Symbol("key"),tn=Symbol("url"),Bo=new Map,Ao=0;function ss(s){return Y.has("debug",s,!1)}function pi(s){return s.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ns(s){return s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+3&-4,"=")}function sn(s,e){return s||(s="*"),e.replace(/[\s\S]/g,t=>String.fromCharCode(t.charCodeAt(0)^s.charCodeAt(0)))}var Mi=class{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(e,t,n){if(ce.hasCurrent())throw Error(`${P.libName}.Data.store() called from Model code`);let i,r,o;if(typeof e=="string"?(i=e,e=t,r=!0,o=n):(i=t&&t.sessionId,r=t&&t.shareable,o=t&&t.keep),!(e instanceof ArrayBuffer))throw Error(`${P.libName}.Data.store() called with non-ArrayBuffer data`);let{appId:a,persistentId:c,key:l,uploadEncrypted:d}=Oo(i),p=r?yt.random(32).toString(ye):ye.stringify(l),f=`apps/${a}/${c}/data/%HASH%`,h="data#"+ ++Ao;ss("data")&&console.log(`${P.libName}.Data: storing ${h} ${e.byteLength} bytes`);let v=await d({path:f,content:e,key:p,keep:o,debug:ss("data"),what:h}),G=function(X){return X.replace(/.*\//,"")}(v),y=new ue(G,r&&p,v);return ss("data")&&console.log(`${P.libName}.Data: stored ${h} as ${this.toId(y)}`),y}static async fetch(e,t){let n;if(t&&t[tn]?(n=e,e=t):n=t&&t.sessionId,ce.hasCurrent())throw Error(`${P.libName}.Data.fetch() called from Model code`);let{downloadEncrypted:i,key:r}=Oo(n),o=e&&e[ui],a=e&&e[mi]||ye.stringify(r),c=e&&e[tn];if(typeof o!="string"||typeof a!="string"||typeof c!="string")throw Error(`${P.libName}.Data.fetch() called with invalid handle`);let l="data#"+ ++Ao;return ss("data")&&console.log(`${P.libName}.Data: fetching ${l} ${this.toId(e)}`),i({url:c,key:a,debug:ss("data"),what:l})}static hash(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"base64url";typeof e=="function"&&(e=Function.prototype.toString.call(e)),typeof e=="string"?e=new TextEncoder().encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=new TextEncoder().encode(Xt(e)));let n=da(yt.create(e));switch(t){case"hex":return n.toString();case"base64":return n.toString(ye);case"base64url":return pi(n.toString(ye));default:throw Error(`${P.libName}.Data: unknown hash output "${t}", expected "hex"/"base64"/"base64url"`)}}static fromId(e){let t=e.slice(0,1),n,i,r,o;switch(t){case"0":n=e.slice(1,44),i=e.slice(44),r=`${di}/sessiondata/${n}`;break;case"1":n=e.slice(1,44),i=e.slice(44,87)+"=",o=e.slice(87),r=`${di}/apps/${o}/data/${n}`;break;case"2":n=e.slice(1,44),i=ns(e.slice(44,87)),o=sn(i,atob(ns(e.slice(87)))),r=`${di}/apps/${o}/data/${n}`;break;case"3":i=ns(e.slice(1,44)),r=sn(i,atob(ns(e.slice(44)))),n=r.slice(-43);break;case"4":i=null,r=sn(i,atob(ns(e.slice(1)))),n=r.slice(-43);break;default:throw Error(`${P.libName}.Data expected handle v0-v4 got v${t}`)}return new this(n,i,r)}static toId(e){if(!e)return"";let t=e[ui],n=e[mi],i=e[tn];if(i.slice(-43)!==t)throw Error(`${P.libName} Data: malformed URL`);let r=n&&pi(n),o=pi(btoa(sn(n,i)));return n?`3${r}${o}`:`4${o}`}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=Bo.get(e);if(i)return i;if(n.slice(-43)!==e)throw Error(`${P.libName} Data: malformed URL`);Object.defineProperty(this,ui,{value:e}),t&&Object.defineProperty(this,mi,{value:t}),Object.defineProperty(this,tn,{value:n}),Bo.set(e,this)}},ue=class extends Mi{},qi={cls:ue,write:s=>ue.toId(s),read:s=>ue.fromId(s)},z=null,_e=null,is=Symbol("DEBUG_WRITE_TARGET"),$e=null;function Kt(s,e){return Array.isArray(s)||typeof e!="string"?`[${e}]`:e.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${e}`:`["${e}"]`}var bn=class extends Error{};function $o(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>z.random(),globalThis.CroquetViewMath={};for(let[s,e]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[s]=e.value;for(let[s,e]of Object.entries(globalThis.CroquetMath)){let t=Math[s];Math[s]=e.length===1?n=>z?e(n):t(n):(n,i)=>z?e(n,i):t(n,i)}}if(!globalThis.CroquetViewDate){let t=function(i,r){return e||(e=!0,console.warn(new bn(`${i} used in Model code`))),r},n=function(i,r,o,a,c,l,d){let p=this instanceof n,f=[i,r,o,a,c,l,d];if(f.length=arguments.length,z)switch(t(p?"new Date()":"Date()"),arguments.length){case 0:f.push(z.time);break;case 1:break;default:f[0]=s.UTC(...f),f.length=1}let h=new s(...f);return p?h:""+h},s=globalThis.Date,e=!1;n.prototype=s.prototype,n.UTC=s.UTC,n.now=()=>z?t("Date.now()",z.time):s.now(),n.parse=function(){return z?t("Date.parse()",0):s.parse(...arguments)},globalThis.CroquetViewDate=s,globalThis.Date=n}}Object.defineProperty(bn.prototype,"name",{value:`${P.libName}Warning`});var lt=Symbol("QFUNC");function al(s,e,t,n){let i=new Yi(s,e,t,n),r=i.compile();return r[lt]=i,r}function ll(s,e,t,n){let i=[],r=[],o,a,c,l;if(t){if("this"in t){for(e=t.this,o="_this";o in t;)o="_"+o;delete(t={...t,[o]:e}).this}if(c=[...Object.keys(t).sort()],l=[...c.map(y=>t[y])],c.length){for(a="env";a in t||a===n;)a="_"+a;i.push(a),r.push(l)}}s.match(/\bCroquet\b/)&&!c?.includes("Croquet")&&(i.push("Croquet"),r.push(J.Croquet)),s.match(/\bMultisynq\b/)&&!c?.includes("Multisynq")&&(i.push("Multisynq"),r.push(J.Croquet));let d=n||"qFunc";for(;c?.includes(d);)d="_"+d;let p=`"use strict"

`;p+=`// Croquet QFunc Compiler by Codefrau

`,p+=`//////////////// Start Compiler /////////////////
`,p+="try { const ",c?.length&&(p+=`[${c.join(", ")}] = ${a}, `);let f=s.split(`
`),h=f.slice(1),v=Math.min(...h.map(y=>y.match(/^\s*/)[0].length));v>0&&(f.some(y=>(y.match(/`/g)||[]).length%2==1)||(f=[f[0],...h.map(y=>y.slice(v))],s=f.join(`
`)));let G=f[f.length-1].match(/^\s*/)[0];G&&(s=G+s),p+=`${d} =
`,p+=`//////////////// Start User Code ////////////////

`,p+=s,p+=`

///////////////// End User Code /////////////////
`,p+=`return ${d}`,o&&(p+=`.bind(${o})`),p+=` } catch (compileError) { return compileError; }
`,p+="///////////////// End Compiler //////////////////";try{let y=new Function(...i,p).call(e,...r);if(y instanceof Error)throw console.warn("rethrowing error",y),y;return y}catch(y){throw console.warn(`createQFunc compiling:

${s}`),Error(`createQFunc(): ${y.message}`)}}var Yi=class{constructor(e,t,n,i){if(this.thisVal=e,this.env=t,this.selfRef=i,this.source=n,i===void 0){this.selfRef="",typeof n=="function"&&(this.source=n.toString());let r=Object.keys(t);for(let o of r)if(n===t[o]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${o} cannot both reference the function`);this.selfRef=o}this.selfRef&&(this.env={...t},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return ll(this.source,this.thisVal,this.env,this.selfRef)}},er={cls:lt,write:s=>{let{[lt]:{thisVal:e,env:t,source:n,selfRef:i}}=s;return[e,n,i,...Object.entries(t).flat()]},read:s=>{let[e,t,n,...i]=s,r={};for(let o=0;o<i.length;o+=2)r[i[o]]=i[o+1];return al(e,r,t,n)}},yn="future message",qo="message in cancelFuture",tr="subscription handler";function cl(s){return`qFunc~${s.split(" ")[0]}~`}var dl=cl(yn),Hi=cl(tr);function Ah(s){return s===yn||s===tr}function Ki(s){return s.startsWith(dl)}function ea(s){return`${Hi}${s}`}function nn(s,e){return!!s.startsWith(Hi)&&s.slice(Hi.length)===e}function hl(s,e){if(z)throw Error("VirtualMachine confusion");if(!(s instanceof ce))throw Error("not a VM: "+s);let t=z;try{z=s,globalThis.CROQUETVM=s,e()}finally{z=t}}var $h="#reflected",Ni=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],sr={};for(let s=0;s<Ni.length;s++)sr[Ni[s]]=s;var zi=new WeakMap;function ta(s){zi.set(s,null)}var _i=class{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}},ce=class{static current(){return z||console.warn("VirtualMachine.current() called from outside the vm!"),z}static hasCurrent(){return!!z}static evaluate(e){if(z)return e();$o();let t=z;try{return z=new _i,e()}finally{z=t}}constructor(e,t,n,i){$o(),_e={snapshot:Y.has("debug","snapshot",!1),session:Y.has("debug","session",!1),write:Y.has("debug","write",!1)},ta(this),hl(this,()=>{wa(this,()=>{if(this.models={},this.namedModels={},this.messages=new Ti((r,o)=>r.before(o)),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=t,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,e.models){let r=Vs.newOrRecycled(this).readVM(e,"VM",i),o=[],a=[];for(let c of Object.keys(r))c!=="meta"&&(c==="staticInitializers"?o=r[c]:c in this?c==="_random"?this[c]=new dn(null,{state:r[c]}):c==="messages"?a=r.messages:this[c]=r[c]:console.warn(`Ignoring property snapshot.${c}`));for(let c of o)c();for(let c of a)this.messages.add(c);for(let[c,l]of Object.entries(this.subscriptions))for(let d of l){let[p]=d.split("."),f=this.subscribers.get(p);f||this.subscribers.set(p,f=new Set),f.add(c)}}else this._random=new dn(e.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),n(this)})})}registerModel(e,t){if(z!==this)throw Error("You can only create models from model code!");return t||(t="M"+ ++this.modelsId),this.models[t]=e,t}deregisterModel(e){if(z!==this)throw Error("You can only destroy models from model code!");let t=this.models;delete this.models[e];for(let[n,i]of Object.entries(this.namedModels))t===i&&delete this.namedModels[n];this.messages.removeMany(n=>n.hasReceiver(e))}lookUpModel(e){if(e==="_")return this;let t=this.models[e];if(t)return t;let[n,i,r]=e.match(/^([^#]+)#(.*)$/)||[];return t=this.models[i],t&&t.lookUp(r)}get(e){let t=this.namedModels[e];return z!==this&&_e.write&&t?this.debugWriteProxy(this,t,t.id):t}set(e,t){if(z!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[e]=t}debugWriteProxy(e,t,n){if(typeof t!="object"||t===null||t[is])return t;if(t instanceof J&&(n=t.id),!this.$debugWriteProxyHandler){let r=function(o,a,c){c&&(o+=` ${c} of`);let l=$e.get(a).path;if(console.warn(`write-debug: non-model code is ${o} ${l}:`,a),c&&c[0]!=="$")throw Error(`write-debug: Attempt to modify ${P.libName} model state from outside!`)};$e||($e=new WeakMap),this.$debugWriteProxyHandler={set(o,a,c){z!==e?r("assigning",o,a):console.warn(`${P.libName} debug write protection inside model - this should not happen!`),o[a]=c},deleteProperty(o,a){z!==e?r("deleting",o,a):console.warn(`${P.libName} debug write protection inside model - this should not happen!`),delete o[a]},get(o,a){if(a===is)return o;let c=o[a];if(c&&c[is])return c;if(z!==e){if(typeof c=="object"&&c!==null){let l=$e.get(o).path;if(c instanceof Map){let d=new Map([...c.entries()].map((p,f)=>{let[h,v]=p;return[e.debugWriteProxy(e,h,`${l}.key#${f}`),e.debugWriteProxy(e,v,`${l}.value#${f}`)]}));return d[is]=c,d.set=()=>r("setting an item in",c),d.delete=()=>r("deleting from",c),d.clear=()=>r("clearing",c),$e.set(c,{proxy:d,path:l+Kt(c,a)}),d}if(c instanceof Set){let d=new Set([...c.values()].map((p,f)=>e.debugWriteProxy(e,p,`${l}.item#${f}`)));return d[is]=c,d.add=()=>r("adding to",c),d.delete=()=>r("deleting from",c),d.clear=()=>r("clearing",c),$e.set(c,{proxy:d,path:l+Kt(c,a)}),d}return e.debugWriteProxy(e,c,l+Kt(c,a))}}else console.warn(`${P.libName} debug write protection inside model - this should not happen!`);return c}}}let i=$e.get(t);return i||(i={proxy:new Proxy(t,this.$debugWriteProxyHandler),path:n},$e.set(t,i)),i.proxy}noop(){}generateJoinExit(e){let{entered:t,exited:n,count:i,total:r}=e;this.controller.handleUserTotalForAccounting(r);let o={};for(let l of t){if(typeof l=="string")continue;let d,p,f;Array.isArray(l)?[d,p]=l:(d=l.id,f=l.data,p=l.location),o[d]={},f&&(o[d].data=f),p&&(p.region&&(p.country=p.region.slice(0,2),p.region=p.region.slice(2)),o[d].loc=p)}if(t=t.map(l=>typeof l=="string"?l:Array.isArray(l)?l[0]:l.id),n=n.map(l=>typeof l=="string"?l:Array.isArray(l)?l[0]:l.id),t.length===i){n=Object.keys(this.views);for(let l of n)this.views[l].extraConnections=0}if(t.length>0&&n.length>0&&t.some(l=>n.includes(l))){for(let l=0;l<t.length;l++){let d=t[l],p=n.indexOf(d);p>=0&&(t.splice(l,1),n.splice(p,1),l--)}if(t.length+n.length===0)return}let a=l=>{let{data:d,loc:p}=this.views[l];if(!d)return l;let f={viewId:l,viewData:d};return p&&(f.location=p),f};for(let l of n)if(this.views[l]){if(this.views[l].extraConnections){this.views[l].extraConnections--,_e.session&&console.log(this.id,`@${this.time}#${this.seq} view ${l} closed extra connection`);continue}let d=a(l);delete this.views[l],this.publishFromModelOnly(this.id,"view-exit",d)}else{let{time:d,seq:p}=this;console.error(`${this.id} @${d}#${p} view ${l} exited without being present - this should not happen`),Promise.resolve().then(()=>{this.controller.sendLog(`view-exit-mismatch @${d}#${p} ${l} left without being present`)})}for(let l of t)if(this.views[l])_e.session&&console.log(this.id,`@${this.time}#${this.seq} view ${l} opened another connection`),this.views[l].extraConnections=(this.views[l].extraConnections||0)+1;else{this.views[l]=o[l]||{};let d=a(l);this.publishFromModelOnly(this.id,"view-join",d)}let c=Object.values(this.views).reduce((l,d)=>l+1+(d.extraConnections||0),0);if(i!==c){let{time:l,seq:d}=this;console.error(`@${l}#${d} view count mismatch (model: ${c}, reflector: ${i}) - this should not happen`),Promise.resolve().then(()=>{this.controller.sendLog(`view-exit-mismatch @${l}#${d} connections model: ${c} reflector: ${i}`)})}}scheduleExternalMessage(e){let t=de.fromState(e,this);if(t.time<this.time)throw Error("past message from reflector "+e);let n=this.externalSeq+1>>>0;if(t.seq!==n)throw Error(`External message error. Expected message #${n} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if(e.receiver!=="_")throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in sr))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,n,i){if(e.every)return this.futureRepeat(e.every,t,n,i);if(e<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;let r=new de(this.time+e,2*this.futureSeq,t,n,i);return this.messages.add(r),{time:r.time,seq:r.seq}}cancelFuture(e,t){let n=this.messages,i;if(typeof t.time=="number"){let{time:r,seq:o}=t;i=n.removeOne(a=>a.time===r&&a.seq===o)}else{if(t==="*")return i=n.removeMany(r=>r.receiver===e.id),i.length>0;{let r=this.asMethodName(e,t,qo),o=e.id;i=n.removeOne(a=>a.receiver===o&&a.selector===r||a.receiver==="_"&&a.selector==="futureExecAndRepeat"&&a.args[1]===o&&a.args[2]===r),Ki(r)&&delete e[r]}}return i!==void 0}futureRepeat(e,t,n,i){this.futureSend(e,"_","futureExecAndRepeat",[e,t,n,i])}futureExecAndRepeat(e,t,n,i){let r=this.lookUpModel(t);if(r){if(typeof r[n]=="function")try{r[n](...i)}catch(o){ae(`future message ${r}.${n}`,o)}else{let o=this.compileFuncString(n,r);try{o(...i)}catch(a){ae(`future message ${r} ${o}`,a)}}this.futureRepeat(e,t,n,i)}}future(e,t,n,i){if(!this.lookUpModel(e.id))throw Error(`future send to unregistered model ${e}`);if(n===void 0){let o=this;return new Proxy(e,{get:(a,c)=>function(){for(var l=arguments.length,d=new Array(l),p=0;p<l;p++)d[p]=arguments[p];return o.future(e,t,c,d)}})}let r=this.asMethodName(e,n,yn);if(typeof r!="string")throw Error(`future message to ${e} ${r} is not a string`);if(typeof e[r]!="function"&&r.indexOf(".")<0&&r[0]!=="{")throw Error(`future send to ${e} with unknown method ${r}()`);return this.futureSend(t,e.id,r,i)}advanceTo(e,t){if(z)throw Error("cannot advance time from model code");let n;for(;(n=this.messages.peek())&&n.time<=e;){let{time:i,seq:r}=n;if(i<this.time)throw Error("past message encountered: "+n);if(1&r&&(this.seq=this.seq+1>>>0,r/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${r/2>>>0} in ${n}`);if(this.messages.poll(),this.time=n.time,n.executeOn(this),globalThis.CroquetViewDate.now()>=t)return!1}return this.time=e,!0}asMethodName(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(typeof t=="string")return t;if(typeof t=="function"){if(e[t.name]===t)return t.name;if(t[lt]&&i){let l=ea(i);if(e[l]===t)return l}let o=e;for(;o!==null;){for(let[l,d]of Object.entries(Object.getOwnPropertyDescriptors(o)))if(d.value===t){if(t[lt]&&((r=n)!==yn&&r!==qo||!Ki(l)))continue;return l}if(o===e&&t[lt]){if(!Ah(n))return nt(`${n} is not a registered QFunc: ${t}`,{only:"once"}),null;let l;if(i)l=ea(i);else{let d=dl,p=0;do l=`${d}${p++}`;while(e[l])}return e[l]=t,l}o=Object.getPrototypeOf(o)}nt(`${n} is not a method of ${e} and not a QFunc: ${t}
`,{only:"once"});let a=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,c=t.toString().match(a);return!c||c[3]&&c[3]!==c[1]?this.asFuncString(t):c[2]}var r;return null}asFuncString(e){let t=e.toString();return`{${btoa(JSON.stringify(t))}}`}compileFuncString(e,t){this.$compiledFuncs||(this.$compiledFuncs={});let n=t.id+":"+e,i=this.$compiledFuncs[n];if(!i){let r=JSON.parse(atob(e.slice(1,-1)));i=ll(r,t),r.startsWith("function")&&(i=i.bind(t)),this.$compiledFuncs[n]=i}return i}addSubscription(e,t,n,i){if(z!==this)throw Error("Cannot add a model subscription from outside model code");if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);let r=t+":"+n,o=this.asMethodName(e,i,tr,r);if(typeof o!="string")throw Error(`Subscription handler for "${n}" must be a method name`);if(o.indexOf(".")<0&&typeof e[o]!="function"&&o[0]!=="{")throw Error(`Subscriber method for "${n}" not found: ${e}.${o}()`);let a=e===this?"_":e.id,c=a+"."+o;if(t==="*"||n==="*")return void this.addGenericSubscription(r,c);if(this.subscriptions[r]){if(this.subscriptions[r].indexOf(c)!==-1)throw Error(`${e}.${o} already subscribed to ${n}`)}else this.subscriptions[r]=[];this.subscriptions[r].push(c);let l=this.subscribers.get(a);l||this.subscribers.set(a,l=new Set),l.add(r)}removeSubscription(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*";if(z!==this)throw Error("Cannot remove a model subscription from outside model code");if(t==="*"||n==="*")return void this.removeGenericSubscription(e,t,n,i);let r=t+":"+n,o=this.subscriptions[r];if(o){let a=e.id+".";if(i==="*"){for(let l=o.length-1;l>=0;l--)if(o[l].startsWith(a)){let d=o[l].slice(a.length);nn(d,r)&&delete e[d],o.splice(l,1)}o.length===0&&delete this.subscriptions[r]}else{let l=this.asMethodName(e,i,"unsubscribe argument",r);if(typeof l!="string")throw Error(`Invalid unsubscribe args for "${n}" in ${e}: ${i}`);let d=a+l,p=o.indexOf(d);if(p!==-1&&(o.splice(p,1),o.length===0&&delete this.subscriptions[r],nn(l,r)&&delete e[l]),o.find(f=>f.startsWith(a)))return}let c=this.subscribers.get(e.id);c.delete(r),c.size===0&&this.subscribers.delete(e.id)}}addGenericSubscription(e,t){this.genericSubscriptions.push({topic:e,handler:t})}removeGenericSubscription(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"*",r=t+":"+n,o=e.id+".";for(let a=this.genericSubscriptions.length-1;a>=0;a--){let c=this.genericSubscriptions[a];c.topic===r&&c.handler.startsWith(o)&&(i!=="*"&&c.handler!==o+i||(this.genericSubscriptions.splice(a,1),nn(i,r)&&delete e[i]))}}removeAllSubscriptionsFor(e){let t=this.subscribers.get(e.id);if(t){let n=e.id+".";for(let i of t){let r=this.subscriptions[i];for(let o=r.length-1;o>=0;o--)if(r[o].startsWith(n)){let a=r[o].slice(n.length);nn(a,i)&&delete e[a],r.splice(o,1)}r.length===0&&delete this.subscriptions[i]}this.subscribers.delete(e.id)}}publishFromModel(e,t,n){if(z!==this)throw Error("Cannot publish a model event from outside model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);let i=t.endsWith($h);i&&(t=t.slice(0,t.length-10));let r=this.currentEventFromModel;this.currentEventFromModel=!0;let o=e+":"+t;this.handleModelEventInModel(o,n,i),this.handleModelEventInView(o,n),this.currentEventFromModel=r}publishFromModelOnly(e,t,n){if(z!==this)throw Error("Cannot publish a model event from outside model code");let i=e+":"+t;this.handleModelEventInModel(i,n)}publishFromView(e,t,n){if(z)throw Error("Cannot publish a view event from model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);let i=e+":"+t;this.handleViewEventInModel(i,n),this.handleViewEventInView(i,n)}handleBundledEvents(e){for(let t of e){let n=de.fromState(t,this);this.verifyExternal(n),n.executeOn(this,!0)}}handleModelEventInModel(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(z!==this)throw Error("handleModelEventInModel called from outside model code");if(n){if(this.controller.synced!==!0)return;let i=e+"#__vote",r=e+"#divergence",o=!!oe.subscriptions[i],a=!!this.subscriptions[e],c=!!this.subscriptions[r];o&&c&&console.log(`divergence subscription for ${e} overridden by vote subscription`);let l=a?new de(this.time,0,"_","handleModelEventInModel",[e,t]):null,d;d=o?["handleModelEventInView",i]:["handleTuttiDivergence",r],Promise.resolve().then(()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:l,wantsVote:o,tallyTarget:d}))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(e,t),this.subscriptions[e]&&this.invokeHandlers(this.subscriptions[e],e,t)}invokeHandlers(e,t,n){let i=e.slice();for(let r=0;r<i.length;r++){let o=i[r];(o===e[r]||e.includes(o))&&this.invokeHandler(o,t,n)}}invokeGenericHandlers(e,t){let[n,i]=e.split(":");if(!(n.startsWith("__")&&n.endsWith("__")||i.startsWith("__")&&i.endsWith("__")))for(let r of this.genericSubscriptions){let[o,a]=r.topic.split(":");(o==="*"&&a===i||o===n&&a==="*"||o==="*"&&a==="*")&&this.invokeHandler(r.handler,e,t)}}invokeHandler(e,t,n){let i=this.currentEvent;this.currentEvent=t;try{let[r,...o]=e.split("."),a=o.join("."),c=this.lookUpModel(r);if(!c)return void nt(`event ${t} .${a}(): subscriber not found`);if(a[0]==="{"){let l=this.compileFuncString(a,c);try{l(n)}catch(d){ae(`event ${t} ${c} ${l}`,d)}return}if(a.indexOf(".")>=0){let l=a.indexOf("."),d=a.slice(0,l),p=a.slice(l+1);try{c.call(d,p,n)}catch(f){ae(`event ${t} ${c}.call(${JSON.stringify(d)}, ${JSON.stringify(p)})`,f)}return}if(typeof c[a]!="function")return void ae(`event ${t} ${c}.${a}(): method not found`);try{c[a](n)}catch(l){ae(`event ${t} ${c}.${a}()`,l)}}finally{this.currentEvent=i}}handleViewEventInModel(e,t){if(this.subscriptions[e]){let n=[e];t!==void 0&&n.push(t);let i=new de(this.time,0,"_","handleModelEventInModel",n);this.controller.sendMessage(i)}}handleModelEventInView(e,t){_e.write&&(t=this.debugWriteProxy(this,t,`event ${e} arg`)),oe.handleEvent(e,t,n=>function(i){if(!z)throw Error("VirtualMachine confusion");let r=z;try{z=null,i()}finally{z=r}}(()=>xs(this,n,!0)))}handleViewEventInView(e,t){oe.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{let n=e.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${n}:`,t)}}handleSessionDiverged(e){let{key:t,url:n}=e;this.diverged||(this.diverged=new Map);let i=this.diverged.get(t);i||this.diverged.set(t,i=[]),i.push(n),i.length===2&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(t)}debugDiverged(e){e||(e=this.diverged.keys().next().value);let t=this.diverged.get(e);if(!t||t.length<2)throw Error(`no diverged urls for snapshot ${e}`);Promise.resolve().then(()=>this.controller.diffDivergedSnapshots(t))}processModelViewEvents(e){if(z)throw Error("cannot process view events in model code");return xs(this,()=>oe.processFrameEvents(e,!!this.controller.synced))}handlePollForSnapshot(){let e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}handleAuditRequest(e){this.controller.handleAuditRequest(e)}snapshot(){return Rs.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return Xt(new Fi().getHash(this))}debug(e){return this.controller.setDebug(e)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(e,t){this.controller&&this.controller.sessionSpec.appId==="no.appId"&&console.warn(`${P.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);let n=_.begin("snapshot"),i=typeof t=="function"?t.call(e):t;if(typeof i!="object")throw Error(`${P.libName}: persistSession() can only persist objects (got ${typeof i})`);let r=Xt(i),o=ue.hash(r),a=_.end("snapshot")-n,c=this.persisted===o,l=this.time;var d,p;if(_e.snapshot&&console.log(this.id,`persistent data @${l} collected, stringified and hashed in ${Math.ceil(a)}ms${c?" (unchanged, ignoring)":""}`),Y.forcePersist&&queueMicrotask(()=>this.controller.forcePersist(l,r,o)),!c)if(d=this,p={persistTime:l,persistentString:r,persistentHash:o,ms:a},zi.set(d,p),this.persisted=o,this.inPersistenceCoolOff)_e.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{let f=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;f>0?(_e.snapshot&&console.log(this.id,`postponing persistence poll by ${f}ms`),this.futureSend(f,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;let e=(t=this,zi.get(t));var t;if(!e)return;let{persistTime:n,persistentString:i,persistentHash:r,ms:o}=e;if(ta(this),this.controller&&this.controller.synced){_e.snapshot&&console.log(this.id,`asking controller to poll for persistence @${n}`);let a=this.time;Promise.resolve().then(()=>this.controller.pollForPersist(a,n,i,r,o))}}random(){if(z!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(z!==this)throw Error("synchronized random accessed from outside the model");let e="";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}};function qh(s,e,t){let n;if(s==="_"){let i=sr[e];typeof i=="number"&&(n=i.toString(36))}if(n===void 0&&(n=`${s}>${e}`),t.length>0){let i=gn.newOrRecycled();n+=JSON.stringify(i.encode(t))}return n}function vs(s,e){return(e-s|0)>=0}var de=class s{constructor(e,t,n,i,r){this.time=e,this.seq=t,this.receiver=n,this.selector=i,this.args=r}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?vs(this.externalSeq,e.externalSeq):vs(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,qh(this.receiver,this.selector,this.args)]}static fromState(e,t){let[n,i,r]=e,{receiver:o,selector:a,args:c}=function(l,d){let p,f,h;if(l.length===1||l[1]==="["){let G=parseInt(l[0],36);p="_",f=Ni[G],h=l.slice(1)}else{let G=l.indexOf(">"),y=l.indexOf("[");y===-1&&(y=l.length),p=l.slice(0,G),f=l.slice(G+1,y),h=l.slice(y)}let v=[];return h&&(v=wn.newOrRecycled(d).decode(JSON.parse(h))),{receiver:p,selector:f,args:v}}(r,t);return new s(n,i,o,a,c)}executeOn(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];e.currentEventFromModel=!this.isExternal();let n=t?c=>c():c=>hl(e,()=>wa(e,c)),{receiver:i,selector:r,args:o}=this,a=e.lookUpModel(i);if(a)if(r[0]==="{"){let c=e.compileFuncString(r,a);n(()=>{try{c(...o)}catch(l){ae(`${this.shortString()} ${c}`,l)}})}else r.indexOf(".")>=0?n(()=>{let c=r.indexOf("."),l=r.slice(0,c),d=r.slice(c+1);try{a.call(l,d,...o)}catch(p){ae(`${this.shortString()} ${a}.call(${JSON.stringify(l)}, ${JSON.stringify(d)})`,p)}}):typeof a[r]!="function"?nt(`${this.shortString()} ${a}.${r}(): method not found`):n(()=>{try{if(Ki(r)){let c=a[r];delete a[r],c(...o)}else a[r](...o)}catch(c){ae(`${this.shortString()} ${a}.${r}()`,c)}});else nt(`${this.shortString()} ${r}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){let{receiver:e,selector:t,args:n}=this,i=this.isExternal(),r=i?this.externalSeq:this.internalSeq;return`${i?"External":"Future"}Message[${this.time}${":#"[+i]}${r} ${e}.${t}(${n.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}},eu=(()=>{let s=new ArrayBuffer(8),e=new DataView(s);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})(),Fi=class{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",de),this.addHasher("Teatime:Data",qi),this.addHasher("Teatime:QFunc",er);for(let[e,t]of J.allClassTypes())this.addHasher(e,t)}addHasher(e,t){let{cls:n,write:i}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:r=>({...r})};i&&this.hashers.set(n,r=>this.hashStructure(r,i(r)))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(let[t,n]of Object.entries(e))if(t!=="controller"&&t!=="meta")if(t==="_random")this.hash(n.state(),!1);else if(t==="messages"){let i=n.asArray();(this.hashState.fC=i.length)&&this.hash(i,!1)}else this.hashEntry(t,n);return this.hashDeferred(),this.hashState}hashDeferred(){let e=0;for(;e<this.todo.length;){let{key:t,value:n}=this.todo[e++];this.hashEntry(t,n,!1)}this.todo.length=0}hash(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];switch(typeof e){case"number":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?e===0?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=eu(e)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=e.length);case"boolean":case"undefined":return;case"bigint":if(e===0n)this.hashState.zC++;else{this.hashState.nC++;let n=e<0?-1n:0n;for(;e!==n;)this.hashState.nH+=Number(0xFFFFFFFFn&e),e>>=32n}return;default:{if(this.done.has(e)||e===null)return;if(this.hashers.has(e.constructor))return void this.hashers.get(e.constructor)(e);let n=Object.prototype.toString.call(e).slice(8,-1);if(this.hashers.has(n))return void this.hashers.get(n)(e);switch(n){case"Array":return void this.hashArray(e,t);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(e));case"Set":return void this.hashStructure(e,[...e]);case"Map":return void this.hashStructure(e,[...e],!1);case"DataView":return void this.hashIntArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(e);case"Float32Array":case"Float64Array":return void this.hashArray(e,!1);case"Object":e instanceof J?this.hashModel(e):e.constructor===Object&&this.hashObject(e,t)}}}}hashModel(e){this.hashState.mC++,this.done.add(e);for(let[t,n]of Object.entries(e))t!=="__realm"&&n!==void 0&&this.hashEntry(t,n)}hashObject(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.hashState.oC++,this.done.add(e);for(let[n,i]of Object.entries(e))i!==void 0&&this.hashEntry(n,i,t)}hashArray(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.done.add(e);for(let n=0;n<e.length;n++)this.hashEntry(n,e[n],t)}hashIntArray(e){this.done.add(e);for(let t=0;t<e.length;t++){let n=e[t];n===0?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=n)}}hashStructure(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];t!==void 0&&(this.done.add(e),this.hash(t,n))}hashEntry(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];e[0]!=="$"&&(n&&typeof t=="object"?this.todo.push({key:e,value:t}):this.hash(t,n))}},Rs=class{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",de),this.addWriter("Teatime:Data",qi),this.addWriter("Teatime:QFunc",er);for(let[t,n]of J.allClassTypes())this.addWriter(t,n);this.okayToIgnore={$debugWriteProxyHandler:!0};for(let t of J.allClasses())if(Object.prototype.hasOwnProperty.call(t,"okayToIgnore")){let n=t.okayToIgnore();if(!Array.isArray(n))throw new Error("okayToIgnore() must return an array");for(let i of n){if(i[0]!=="$")throw Error(`okayToIgnore: ignored prop "${i}" must start with '$'`);this.okayToIgnore[i]=!0}}}addWriter(e,t){let n=Object.getPrototypeOf(t)===Object.prototype,{cls:i,write:r}=n?t:{cls:t,write:o=>({...o})};if(i===Object)throw Error(`${P.libName} types: '${e}' is the Object class itself, must be a user class`);if(i===Array)throw Error(`${P.libName} types: '${e}' is the Array class, must be a user class`);r?this.writers.set(i,(o,a)=>this.writeAs(e,o,r(o),n?`${a}.write(${i.name})`:a)):t.writeStatic||console.warn(`${P.libName} types: ${e} does not implement write() or writeStatic()`)}snapshot(e,t){let n={_random:e._random.state(),messages:this.write(e.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(n);for(let[i,r]of Object.entries(e))i in n||this.writeInto(n,i,r,t);return this.writeDeferred(),delete n.controller,delete n.subscribers,delete n.$compiledFuncs,n}writeAllStaticInto(e){for(let t of J.allClasses())if(t!==J)for(let[n,i]of Object.entries(t)){if(n[0]==="$")continue;let r=J.classToID(t);e.staticModelProps||(e.staticModelProps={}),r in e.staticModelProps||(e.staticModelProps[r]={}),this.writeInto(e.staticModelProps[r],n,i,`Model(${r}).static`),Zn("Model",r)}for(let[t,n]of J.allClassTypes())if(typeof n=="object"){let{writeStatic:i}=n;if(i){let r=i();r&&(e.staticTypeProps||(e.staticTypeProps={}),e.staticTypeProps[t]=this.write(r,`Type(${t}).writeStatic()`),Zn("Type",t))}}}writeDeferred(){let e=0;for(;e<this.todo.length;){let{state:t,key:n,value:i,path:r}=this.todo[e++];this.writeInto(t,n,i,r,!1)}this.todo.length=0}write(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];switch(typeof e){case"number":return Object.is(e,-0)?{$class:"NegZero"}:Number.isFinite(e)?e:Number.isNaN(e)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(e)};case"string":case"boolean":return e;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:e.toString()};default:{if(this.refs.has(e))return this.writeRef(e);if(e===null)return e;if(this.writers.has(e.constructor))return this.writers.get(e.constructor)(e,t);let i=Object.prototype.toString.call(e).slice(8,-1);if(this.writers.has(i))return this.writers.get(i)(e,t);switch(i){case"Array":return this.writeArray(e,t,n);case"ArrayBuffer":return this.writeArrayBuffer(e);case"Set":return this.writeAs(i,e,[...e],t);case"Map":return this.writeAs(i,e,[...e].flat(),t);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(i,e);case"Object":if(e instanceof J)return this.writeModel(e,t);if(e.constructor===Object||typeof e.constructor!="function")return this.writeObject(e,t,n);throw console.warn(`${P.libName}: unknown class at ${t}:`,e),Error(`${P.libName}: class not registered in Model.types(): ${e.constructor.name}`);case"Function":if(e[lt])return this.writers.get(lt)(e,t);throw console.warn(`${P.libName}: found function at ${t}:`,e),Error(`${P.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${P.libName}: unsupported property at ${t}:`,e),Error(`${P.libName}: serialization of ${i}s is not supported`)}}}}writeModel(e,t){let n={};this.refs.set(e,n);try{n.$model=J.classToID(e.constructor)}catch(i){throw console.error(`unregistered model class at ${t}:`,e),i}for(let i of Object.keys(e).sort()){if(i==="__realm")continue;let r=e[i];(typeof r=="number"&&Number.isFinite(r)&&!Object.is(r,-0)||typeof r=="string"||typeof r=="boolean")&&i[0]!=="$"?n[i]=r:this.writeInto(n,i,r,`${e}`,!0)}return n}writeObject(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],i={};this.refs.set(e,i);for(let r of Object.keys(e).sort()){let o=e[r];(typeof o=="number"&&Number.isFinite(o)&&!Object.is(o,-0)||typeof o=="string"||typeof o=="boolean")&&r[0]!=="$"?i[r]=o:this.writeInto(i,r,o,t,n)}return i}writeArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],i=[];this.refs.set(e,i);for(let r=0;r<e.length;r++){let o=e[r];typeof o=="number"&&Number.isFinite(o)&&!Object.is(o,-0)||typeof o=="string"||typeof o=="boolean"?i[r]=o:this.writeInto(i,r,o,t,n)}return i}writeArrayBuffer(e){let t={$class:"ArrayBuffer",$value:su(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){let n={$class:e,$value:[this.write(t.buffer),t.byteOffset,e==="DataView"?t.byteLength:t.length]};return this.refs.set(t,n),n}writeAs(e,t,n,i){let r={$class:e};this.refs.set(t,r);let o=this.write(n,i,!1);return typeof o!="object"||o===null||o.$class||Array.isArray(o)?r.$value=o:Object.assign(r,o),r}writeRef(e){let t=this.refs.get(e);if(typeof t!="object")throw Error("Non-object in refs: "+e);return Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}}),{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,n,i){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t[0]==="$")return void(this.okayToIgnore[t]||(nt(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[t]=!0));if(r&&typeof n=="object")return void this.todo.push({state:e,key:t,value:n,path:i});let o=this.write(n,i+Kt(e,t));e[t]=o}},sa=Symbol("croquet:unresolved"),Vs=class{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[],t.postprocess=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",de),this.addReader("Teatime:Data",qi),this.addReader("Teatime:QFunc",er),this.readers.set("Undefined",()=>{}),this.readers.set("NaN",()=>NaN),this.readers.set("Infinity",t=>t*(1/0)),this.readers.set("NegZero",()=>-0),this.readers.set("BigInt",t=>BigInt(t)),this.readers.set("ArrayBuffer",t=>function(n){let i=globalThis.atob(n),r=i.length,o=new Uint8Array(r);for(let a=0;a<r;a++)o[a]=i.charCodeAt(a);return o.buffer}(t)),this.readers.set("DataView",t=>new DataView(...t)),this.readers.set("Int8Array",t=>new Int8Array(...t)),this.readers.set("Uint8Array",t=>new Uint8Array(...t)),this.readers.set("Uint8ClampedArray",t=>new Uint8ClampedArray(...t)),this.readers.set("Int16Array",t=>new Int16Array(...t)),this.readers.set("Uint16Array",t=>new Uint16Array(...t)),this.readers.set("Int32Array",t=>new Int32Array(...t)),this.readers.set("Uint32Array",t=>new Uint32Array(...t)),this.readers.set("Float32Array",t=>new Float32Array(...t)),this.readers.set("Float64Array",t=>new Float64Array(...t));for(let[t,n]of J.allClassTypes())this.addReader(t,n)}addReader(e,t){let n=i=>Object.assign(Object.create(t.prototype),i);typeof t=="object"&&(n=t.read),this.readers.set(e,n)}enableBackwardCompatibility(e){let t=e?.meta?.sdk;if(!t)return;let[n,i,r,o]=t.split(/[-.+]/).map(c=>+c),a=`${n}.${i}`;r&&(a+=`.${r}`),o&&(a+=`-${o}`),console.warn(`${P.libName}: reading snapshot version ${a}`),this.compatMaps=n<1||n===1&&(i<1||i===1&&r<7)}readVM(e,t,n){if(t!=="VM")throw Error("VirtualMachine must be root object");n&&this.enableBackwardCompatibility(e);let i=this.read(e,t,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(i),i}readDeferred(){let e=0;for(;e<this.todo.length;){let{object:t,key:n,value:i,path:r}=this.todo[e++];this.readInto(t,n,i,r,!1)}this.todo.length=0}resolveRefs(){for(let{object:e,key:t,ref:n,path:i}of this.unresolved){if(!this.refs.has(n))throw Error(`Unresolved ref: ${n} at ${i}[${JSON.stringify(t)}]`);e[t]=this.refs.get(n)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(let e of this.postprocess)e();this.postprocess.length=0}readAllStatic(e){let{staticModelProps:t,staticTypeProps:n}=e,i=[];if(t){for(let[r,o]of Object.entries(t)){let a=J.classFromID(r);i.push(()=>Object.assign(a,o)),Zn("Model",r)}delete e.staticModelProps}if(n){let r=Object.fromEntries(J.allClassTypes());for(let[o,a]of Object.entries(n)){let c=r[o];if(typeof c=="object"){let l=c;i.push(()=>l.readStatic(a))}else{let l=c;i.push(()=>Object.assign(l,a))}Zn("Type",o)}delete e.staticTypeProps}i.length&&(e.staticInitializers=i)}read(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];switch(typeof e){case"number":case"string":case"boolean":return e;default:{let i=Object.prototype.toString.call(e).slice(8,-1);switch(i){case"Array":return this.readArray(e,t,n);case"Null":return null;case"Object":{let{$class:r,$model:o,$ref:a}=e;if(a)throw Error("refs should have been handled in readInto()");return o?this.readModel(e,t):r?this.readAs(r,e,t):this.readObject(Object,e,t,n)}default:throw Error(`Don't know how to deserialize ${i} at ${t}`)}}}}readModel(e,t){let n=J.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,n);for(let[i,r]of Object.entries(e))i!=="id"&&i[0]!=="$"&&this.readInto(n,i,r,t);return n}readObject(e,t,n){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],r=new e;t.$id&&this.refs.set(t.$id,r);for(let[o,a]of Object.entries(t))o[0]!=="$"&&this.readInto(r,o,a,n,i);return r}readArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],i=[];e.$id&&this.refs.set(e.$id,i);for(let r=0;r<e.length;r++)e[r]!==void 0&&this.readInto(i,r,e[r],t,n);return i}readAsArray(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],i=e.$value;return e.$id&&(i.$id=e.$id),this.readArray(i,t,n)}readAsSet(e,t){let n=new Set;e.$id&&this.refs.set(e.$id,n);let i=this.unresolved.length,r=this.read(e.$value,t,!1),o=()=>{for(let a of r)n.add(a)};return this.unresolved.length===i?o():this.postprocess.push(o),n}readAsMap(e,t){let n=new Map;e.$id&&this.refs.set(e.$id,n);let i=this.unresolved.length,r=this.read(e.$value,t,!1),o=this.compatMaps?()=>{if(r.some(a=>a.length!==2))console.warn("Deferring map resolution at",t),this.postprocess.push(o);else for(let[a,c]of r)n.set(a,c)}:()=>{for(let a=0;a<r.length;a+=2)n.set(r[a],r[a+1])};return this.unresolved.length===i?o():this.postprocess.push(o),n}readAsClass(e,t,n){let i={},r=new Map;if("$value"in t)i=this.read(t.$value,n,!1);else for(let[a,c]of Object.entries(t)){if(a[0]==="$")continue;let l=c&&c.$ref;l?this.refs.has(l)?i[a]=this.refs.get(l):(i[a]=sa,r.set(l,a)):this.readInto(i,a,c,n,!1)}let o=this.readers.get(e)(i,n);o||e==="Undefined"||e==="BigInt"||e==="NaN"||e==="NegZero"||console.warn(`Reading "${e}" returned ${o} at ${n}`),t.$id&&this.refs.set(t.$id,o);for(let[a,c]of r.entries())this.unresolved.push({object:o,key:c,ref:a,path:n});return o}readAs(e,t,n){switch(e){case"Array":return this.readAsArray(t,n);case"Set":return this.readAsSet(t,n);case"Map":return this.readAsMap(t,n);default:return this.readAsClass(e,t,n)}}readRef(e,t,n,i){if(!n||!n.$ref)return!1;let r=n.$ref;return this.refs.has(r)?e[t]=this.refs.get(r):(e[t]=sa,this.unresolved.push({object:e,key:t,ref:r,path:i})),!0}readInto(e,t,n,i){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.readRef(e,t,n,i)||(r&&typeof n=="object"?this.todo.push({object:e,key:t,value:n,path:i}):e[t]=this.read(n,i+Kt(e,t)))}},gn=class extends Rs{encode(e){let t=this.writeArray(e,"args");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}},wn=class extends Vs{decode(e){let t=this.readArray(e,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),t}resolveRefs(){for(let{object:e,key:t,ref:n,path:i}of this.unresolved)if(this.refs.has(n))e[t]=this.refs.get(n);else{let r=this.vm.lookUpModel(n);if(!r)throw Error(`Unresolved ref: ${n} at ${i}[${JSON.stringify(t)}]`);e[t]=r}}},tu=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function ul(s,e,t,n){let i=Array.isArray(s)?s:s.constructor===Set?s.values():s.constructor===Map?s.entries():Object.values(s),r=[];for(let o of i)typeof o!="object"||o===null||n.has(o)||(n.add(o),r.push(o));for(let o of r){if(tu.includes(o.constructor))continue;let a=e+"."+o.constructor.name;if(t[a]){if(t[a]!==o.constructor)throw new Error("Class with name "+a+" already gathered, but new one has different identity")}else t[a]=o.constructor}for(let o of r)ul(o,e,t,n)}function Zn(s,e){let t=oe.controllers.size;t>1&&nt(`Static properties in shared ${s} ${e} can lead to divergence because ${t} ${P.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function su(s){let e=new Uint8Array(s),t=[];for(let n=0;n<e.byteLength;n+=4096){let i=e.subarray(n,n+4096);t.push(String.fromCharCode.apply(null,i))}return globalThis.btoa(t.join(""))}var qe={classes:Y.has("debug","classes")},fi=Symbol("SECRET"),rn=new WeakSet,J=class s{static create(){if(!bi(this))throw Error(`Model class "${this.name}" not registered`);let e=this,t=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(t.beWellKnownAs("modelRoot"),t.__realm.vm.debugEvents&&this.eventDebugInit(t)),rn.add(t),t.init(...arguments),rn.has(t)&&(rn.delete(t),Object.getPrototypeOf(e)!==s&&console.warn(`${t} did not call super.init(options)`)),t}static createNoInit(e){let t=Ue(),n=new this(fi);return e||(e=t.register(n)),qe.write===void 0&&(qe.write=Y.has("debug","write"),qe.publish=Y.has("debug","publish"),qe.events=Y.has("debug","events")),Object.defineProperty(n,"__realm",{value:t,writable:qe.write}),Object.defineProperty(n,"id",{value:e,enumerable:!0}),n}static allowConstructors(){fi=void 0,console.warn("disabling error reporting for Model constructors")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),Vs.resetInstance(),Rs.resetInstance(),gn.resetInstance(),wn.resetInstance(),function(t,n){let i=ma(t),r=Yt(`${n}:${i}`);ji.push(r),r.then(o=>Re[o].what=`Class ${n}`)}(this,e),function(t,n){let i=jt[n];if(i&&i!==t)throw Error(`Registering model class ${t.name} failed, id "${n}" already used by ${i.name}`);bi(t)?qe.classes&&!i&&console.warn(`ignoring re-exported model class ${n}`):(qe.classes&&console.log(`registering model class ${n}`),t[Xs]=n),jt[n]=t}(this,e),s.lastRegistered=this,this}static wellKnownModel(e){if(!ce.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return ce.current().get(e)}static evaluate(e){return ce.evaluate(e)}static isExecuting(){return ce.hasCurrent()}static types(){return{}}static gatherClassTypes(e,t){let n={};return ul({root:e},t,n,new Set),n}static eventDebugOptions(){return qe}static eventDebugInit(e){e.subscribe("*","*",e.createQFunc(`
        function logEvents(data) {
            // do this now to have no side effects below
            const { scope, event, source } = this.activeSubscription;
            // below stuff is outside the model. Must not have any side effects!
            const debug = this.constructor.eventDebugOptions();
            if (!debug.events && !debug.publish) return;
            const action = source === "model" ? "publish" : "receive";
            const emoji = source === "model" ? "\u{1F52E}" : "\u{1F4EC}";
            console.log(\`\${emoji} @\${this.now()} Model \${action} \${scope}:\${event}\`, data);
        }
        `))}static okayToIgnore(){return[]}static classToID(e){return function(t){if(bi(t))return t[Xs];let n=t.name||"ClassName";throw Error(`Model class not registered, did you call ${n}.register("${n}")?`)}(e)}static classFromID(e){return ia(e)}static allClasses(){return na()}static allClassTypes(){return function(){let e={};for(let t of na())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return ia(e).createNoInit(t)}constructor(e){if(e!==fi)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(e,t){rn.delete(this)}destroy(){Ue().unsubscribeAll(this),Ue().deregister(this)}publish(e,t,n){this.__realm||this.__realmError(),this.__realm.publish(t,n,e)}subscribe(e,t,n){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,n)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"*";this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,n)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!ce.hasCurrent())return;let{currentEvent:e,currentEventFromModel:t}=ce.current();if(!e)return;let[n,i]=e.split(":");return{scope:n,event:i,source:t?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;this.__realm||this.__realmError();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this.__realm.future(this,e,t,i)}cancelFuture(e){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,e)}random(){return Ue().random()}now(){return Ue().now()}beWellKnownAs(e){Ue().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(ce.current()===this.__realm.vm)return!0;let t=Error(e||`${this}.modelOnly() called from outside a model!`);throw ae("view code",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(e,t){return t===void 0&&(t=e,e={}),al(this,e,t)}persistSession(e){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){return`${this.constructor[Xs]||this.constructor.name}#${this.id}`}},jt={},Xs=Symbol("CLASS_ID");function na(){return Object.values(jt)}function bi(s){return Object.prototype.hasOwnProperty.call(s,Xs)}function ia(s){if(jt[s])return jt[s];throw Error(`Model class "${s}" in snapshot, but not registered?`)}var ra="Croquet.Model",rs;J[Xs]=ra,jt[ra]=J;var ct=class{static displayStatus(e,t){return ya(e,t)}static displayWarning(e,t){return nt(e,t)}static displayError(e,t){return function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return n&&P.showMessage(n,{...i,level:"error"})}(e,t)}constructor(e){typeof e=="object"&&"__realm"in e||console.warn(`${P.libName}: argument to View constructor needs to be a Model`);let t=Ue("");t&&t.isViewRealm()||(t=xs(e.__realm.vm,()=>Ue(),!0)),Object.defineProperty(this,"realm",{value:t}),Object.defineProperty(this,"id",{value:t.register(this),configurable:!0});let n=t.controller.session;if(n.view||(n.view=this),rs||(rs={events:Y.has("debug","events"),publish:Y.has("debug","publish")}),n.view===this&&(rs.events||rs.publish)){let i=a=>{if(!t.vm.debugEvents)return;let{scope:c,event:l,source:d,subscribed:p}=this.activeSubscription;if(!p&&!rs.publish)return;let f=d==="view"?"publish":"receive";console.log(`${d==="view"?"\u{1F4EE}":"\u{1F441}\uFE0F"} View ${f} ${c}:${l}${p||f==="publish"?"":" (no subscribers)"}`,a)},r=a=>this.activeSubscription.source==="view"&&i(a),o=a=>this.activeSubscription.source==="model"&&i(a);r.__CROQUET__=!0,o.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},o),this.subscribe("*",{event:"*",handling:"immediate"},r)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(e,t,n){this.realm.publish(t,n,e)}subscribe(e,t,n){if(typeof n=="string"&&(n=this[n]),typeof n!="function")throw Error(`${P.libName}: subscribe() handler is not a function`);let i=n;(n=i.bind(this)).unbound=i;let{event:r,handling:o}=t.event?t:{event:t};this.realm.subscribe(r,this.id,n,e,o)}unsubscribe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;typeof n=="string"&&(n=this[n]),this.realm.unsubscribe(t,this.id,n,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){let{currentEvent:e,currentEventFromModel:t,currentEventOnlyGeneric:n}=oe;if(!e)return;let[i,r]=e.split(":");return{scope:i,event:r,source:t?"model":"view",subscribed:!n}}future(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.realm.future(this,e)}random(){return Ue().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){let e=this.constructor.name;return e.includes("View")?e:`${e}[View]`}},vn=new class{constructor(){this.ready=!1,this.isInIframe=window.top!==window,this.subscriptions={},this.enumerator=null}setReceiver(s){this.receiver=s,this.ready=!0}setIframeEnumerator(s){this.enumerator=s}on(s,e){if(!this.receiver)throw Error("setReceiver() has not been called");if(typeof e=="string"&&(e=this.receiver[e]),!e)throw Error("Messenger.on: the second argument must be a method name or a function");if(this.subscriptions[s]){if(this.findIndex(this.subscriptions[s],e)>=0)throw Error(`${e} is already subscribed`)}else this.subscriptions[s]=[];this.subscriptions[s].push(e),this.listener||(this.listener=t=>this.receive(t),window.addEventListener("message",this.listener))}detach(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=null),this.stopPublishingPointerMove(),this.receiver=null,this.subscriptions={},this.enumerator=null,this.ready=!1}removeSubscription(s,e){typeof e=="string"&&(e=this.receiver[e]);let t=this.subscriptions[s];if(t){let n=this.findIndex(t,e);t.splice(n,1),t.length===0&&delete this.subscriptions[s]}}removeAllSubscriptions(){this.subscriptions={}}receive(s){let{event:e,data:t}=s.data,n=s.source;this.handleEvent(e,t,n)}handleEvent(s,e,t){let n=this.subscriptions[s];n&&n.forEach(i=>{i.call(this.receiver,e,t)})}send(s,e,t){if(this.isInIframe)return void window.top.postMessage({event:s,data:e},"*");if(t)return void t.postMessage({event:s,data:e},"*");this.enumerator&&this.enumerator().forEach(n=>{n.contentWindow.postMessage({event:s,data:e},"*")})}findIndex(s,e){let t=e.name;return s.findIndex(n=>{let i=n.name;return t||i?t===i:e===n})}startPublishingPointerMove(){this._moveHandler||(this._moveHandler=s=>this.send("pointerPosition",{x:s.clientX,y:s.clientY,type:s.type}),window.document.addEventListener("pointermove",this._moveHandler,!0))}stopPublishingPointerMove(){this._moveHandler&&(window.document.removeEventListener("pointermove",this._moveHandler,!0),this._moveHandler=null)}},nu=Ln.CROQUET_PLATFORM==="node",oa=60,Xn=class s{static async join(e){try{return await this.join_impl(e)}catch(t){throw P.showMessage(t.message||t,{level:"fatal"}),t}}static async join_impl(e){e.appId||(e.appId="no.appId"),e.name||(e.name=P.autoSession(),e.password||(e.password=P.autoPassword())),e.model||(e.model=J.lastRegistered),e.view||(e.view=ct);let t=[];for(let[h,v]of Object.entries(e))v instanceof Promise&&t.push(v.then(G=>e[h]=G));function n(h,v){return h===v||h.prototype instanceof v}if(await Promise.all(t),e.box){if(typeof e.box!="string")throw Error(`${P.libName}: box must be a string in Session.join()!`);if(!e.box.includes("/"))throw Error(`${P.libName}: box must be a (partial) URL in Session.join()!`)}else if(!e.reflector||!e.files){if(typeof e.apiKey!="string")throw Error(`${P.libName}: no apiKey provided in Session.join()!`);if(e.apiKey.length>128)throw Error(`${P.libName}: apiKey > 128 characters in Session.join()!`)}if(typeof e.name!="string")throw Error(`${P.libName}: no session name provided in Session.join()!`);if(e.name.length>128)throw Error(`${P.libName}: session name > 128 characters in Session.join()!`);let i=e.model;if(typeof i!="function"||!n(i,J))throw Error(`${P.libName}: bad model class in Session.join()`);let r=e.view||ct;if(typeof r!="function"||!n(r,ct))throw Error(`${P.libName}: bad view class in Session.join()`);if(typeof e.appId!="string")throw Error(`${P.libName}: no appId provided in Session.join()`);if(!e.appId.length>128)throw Error(`${P.libName}: appId > 128 characters in Session.join()`);if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${P.libName}: malformed appId in Session.join()`);if(typeof e.password!="string"||!e.password)throw Error(`${P.libName}: no password provided in Session.join()`);for(let h of["reflector","synchronizer","files","backend","box"]){let v=Y[h]||e[h];v!==void 0&&(Y[h]=v)}if(nu&&e.step!=="manual")throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in e){if(typeof e.rejoinLimit!="number"||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else e.rejoinLimit=1e3;if("eventRateLimit"in e){if(typeof e.eventRateLimit!="number"||e.eventRateLimit<1||e.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!e.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(e.hashOverride){if(e.hashOverride.length!==43)throw Error("hashOverride must be 43 characters");if(e.hashOverride.search(/[^-_a-zA-Z0-9]/)!==-1)throw Error("hashOverride must be base64url encoded")}if(e.debug){let h=function(v){return typeof v=="string"&&(v=v.split(",")),v?Array.isArray(v)?v:[v]:[]};Y.debug=[...h(e.debug),...h(Y.debug)].join(",")}if("autoSleep"in e){let h=e.autoSleep,v=typeof h;if(v==="number"){if(h<0)throw Error("an autoSleep value must be >= 0")}else{if(v!=="boolean")throw Error("autoSleep must be numeric or boolean");e.autoSleep=h?10:0}}else e.autoSleep=10;if(e.flags){let h=e.flags;typeof h=="string"&&(h=h.split(",")),h=h?Array.isArray(h)?h:[h]:[],h=h.filter(v=>typeof v!="object"),h.length?(e.flags={},h.forEach(v=>e.flags[v]=!0)):e.flags=null}"expectedSimFPS"in e&&(oa=Math.min(e.expectedSimFPS,120));let o=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];(function(){Object.isFrozen(Ls)||(ml(Ls),function(h){let v=JSON.stringify(h,(X,L)=>typeof L=="function"?ma(L):L);if(v==="{}")return;let G=JSON.parse(v),y=Yt(Xt(G));ji.push(y),y.then(X=>Re[X].what=`${P.libName} Constants`)}(Ls))})();let a=new Ri,c=JSON.parse(JSON.stringify({...e.options}));if(e.persistentIdOptions){if(!Array.isArray(e.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(let h of e.persistentIdOptions)if(!(h in c))throw Error(`persistentIdOptions key "${h}" not found in options`)}let l={id:"",persistentId:"",versionId:"",name:e.name,model:null,view:null,step(h){a.stepSession("animation",{frameTime:h,view:l.view,expectedSimFPS:oa})},leave:()=>s.leave(l.id),data:{store:(h,v)=>ue.store(h,{...v,sessionId:l.id}),fetch:(h,v)=>ue.fetch(h,{...v,sessionId:l.id}),hash:h=>ue.hash(h),toId:h=>ue.toId(h),fromId:h=>ue.fromId(h)},get latency(){return a.latency},get latencies(){return a.latencies}};typeof __CROQUET_DEVTOOLS__<"u"&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:l,controller:a}}));let d={options:c,initFn:(h,v)=>i.create(h,v),rebootModelView:f};for(let[h,v]of Object.entries(e))o.includes(h)&&(d[h]=v);await a.initFromSessionSpec(d);let p=!1;return await f(),e.step!=="manual"&&a.startStepping(l.step),l;async function f(){(function(){l.model=null,l.view&&(Y.has("debug","session",!1)&&console.log(l.id,"detaching root view"),l.view.detach(),l.view.id!==""&&console.warn(`${P.libName}: ${l.view} did not call super.detach()`),l.view=null),P.clearSessionMoniker(),vn.ready&&vn.detach()})(),a.leaving?a.leaving(!0):p||(p=!0,await a.establishSession(d),p=!1,l.model=a.vm.get("modelRoot"),l.id=a.id,l.persistentId=a.persistentId,l.versionId=a.versionId,a.session=l,P.makeSessionWidgets(l.id),a.inViewRealm(()=>{Y.has("debug","session",!1)&&console.log(l.id,"creating root view"),new r(l.model,d.viewOptions)}))}}static async leave(e){let t=function(r){for(let o of Et)if(o.id===r)return o;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);let n=new Promise(r=>t.leaving=r),i=t.connection;return!!i.connected&&(i.closeConnection(1e3),n)}static thisSession(){let e=ce.current();return e?e.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(e){}leave(){}},Ls={};function ml(s){if(!Object.isFrozen(s)){Object.freeze(s);for(let e of Object.values(s))!e||typeof e!="object"&&typeof e!="function"||ml(e)}}var aa={Model:J,View:ct,Session:Xn,Data:ue,Constants:Ls,App:P,Messenger:vn,VERSION:Se};J.Croquet=aa,ct.Croquet=aa,typeof __CROQUET_DEVTOOLS__<"u"&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:Se}})),typeof globalThis<"u"&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=Se),je.App=P,je.Constants=Ls,je.Data=ue,je.Messenger=vn,je.Model=J,je.Session=Xn,je.VERSION=Se,je.View=ct});var iu={};vl(iu,{App:()=>ee.App,Constants:()=>ee.Constants,Data:()=>ee.Data,Model:()=>ee.Model,Session:()=>ee.Session,VERSION:()=>Cn,View:()=>ee.View});var ee=Xl(pl()),Cn="1.0.4";console.log(`Multisynq ${Cn}`);var fl={Model:ee.Model,View:ee.View,Session:ee.Session,Data:ee.Data,Constants:ee.Constants,App:ee.App,VERSION:Cn};ee.Model.Multisynq=fl;ee.View.Multisynq=fl;typeof globalThis<"u"&&(globalThis.__MULTISYNQ__?console.warn("WARNING: Multiple instances of Multisynq being imported."):globalThis.__MULTISYNQ__=Cn);return Ll(iu);})();
/*! Bundled license information:

toastify-js/src/toastify.js:
  (*!
   * Toastify js 1.12.0
   * https://github.com/apvarun/toastify-js
   * @license MIT licensed
   *
   * Copyright (C) 2018 Varun A P
   *)
*/
//# sourceMappingURL=multisynq-client.min.js.map
