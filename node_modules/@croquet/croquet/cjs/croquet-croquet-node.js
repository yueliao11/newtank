/**
 * Copyright Croquet Labs 2025
 * Bundle of @croquet/croquet
 * Date: 2025-06-09
 * Version: 2.0.4
 */

"use strict";var e=require("minimist"),t=require("fast-json-stable-stringify"),s=require("fastpriorityqueue");function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}var n=i(require("ws")),r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var a,l={exports:{}};a||(a=1,function(e){var t=function(e){var t,s=Object.prototype,i=s.hasOwnProperty,n=Object.defineProperty||function(e,t,s){e[t]=s.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,s){return e[t]=s}}function d(e,t,s,i){var r=t&&t.prototype instanceof y?t:y,o=Object.create(r.prototype),a=new k(i||[]);return n(o,"_invoke",{value:x(e,s,a)}),o}function h(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u="suspendedStart",m="suspendedYield",p="executing",b="completed",f={};function y(){}function g(){}function Z(){}var X={};c(X,o,(function(){return this}));var w=Object.getPrototypeOf,G=w&&w(w(V([])));G&&G!==s&&i.call(G,o)&&(X=G);var v=Z.prototype=y.prototype=Object.create(X);function L(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function s(n,r,o,a){var l=h(e[n],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return s("throw",e,o,a)}))}a(l.arg)}var r;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){s(e,i,t,n)}))}return r=r?r.then(n,n):n()}})}function x(e,s,i){var n=u;return function(r,o){if(n===p)throw new Error("Generator is already running");if(n===b){if("throw"===r)throw o;return{value:t,done:!0}}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var l=W(a,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===u)throw n=b,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=p;var c=h(e,s,i);if("normal"===c.type){if(n=i.done?b:m,c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n=b,i.method="throw",i.arg=c.arg)}}}function W(e,s){var i=s.method,n=e.iterator[i];if(n===t)return s.delegate=null,"throw"===i&&e.iterator.return&&(s.method="return",s.arg=t,W(e,s),"throw"===s.method)||"return"!==i&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var r=h(n,e.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,f;var o=r.arg;return o?o.done?(s[e.resultName]=o.value,s.next=e.nextLoc,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,f):o:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function V(e){if(null!=e){var s=e[o];if(s)return s.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function s(){for(;++n<e.length;)if(i.call(e,n))return s.value=e[n],s.done=!1,s;return s.value=t,s.done=!0,s};return r.next=r}}throw new TypeError(typeof e+" is not iterable")}return g.prototype=Z,n(v,"constructor",{value:Z,configurable:!0}),n(Z,"constructor",{value:g,configurable:!0}),g.displayName=c(Z,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Z):(e.__proto__=Z,c(e,l,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},L(S.prototype),c(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,s,i,n,r){void 0===r&&(r=Promise);var o=new S(d(t,s,i,n),r);return e.isGeneratorFunction(s)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},L(v),c(v,l,"Generator"),c(v,o,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),s=[];for(var i in t)s.push(i);return s.reverse(),function e(){for(;s.length;){var i=s.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=V,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var s in this)"t"===s.charAt(0)&&i.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var s=this;function n(i,n){return a.type="throw",a.arg=e,s.next=i,n&&(s.method="next",s.arg=t),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),C(s),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var i=s.completion;if("throw"===i.type){var n=i.arg;C(s)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,s,i){return this.delegate={iterator:V(e),resultName:s,nextLoc:i},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{globalThis.regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(l));const c=e(process.argv.slice(2));const d=new class{constructor(){!function(e){for(const t of Object.keys(c)){if("_"===t)continue;let s=c[t];"string"==typeof s&&"["===s[0]&&(s=s.slice(1,-1).split(",")),e[t]=s}}(this)}has(e,t,s){"boolean"!=typeof s&&(s=this.isHost(s));const i=this[e];if("string"!=typeof i)return s;const n=i.split(",");return!0===s&&(t=`no${t}`),t.endsWith("s")&&(t=t.slice(0,-1)),n.includes(t)||n.includes(`${t}s`)?!s:s}isHost(e){return"localhost"===e}isLocalhost(){return this.isHost("localhost")}};var h={exports:{}};var u,m={exports:{}};function p(){return u||(u=1,m.exports=(e=e||function(e,t){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==r&&r.crypto&&(s=r.crypto),!s)try{s=require("crypto")}catch(e){}var i=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),o={},a=o.lib={},l=a.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var r=0;r<n;r++){var o=s[r>>>2]>>>24-r%4*8&255;t[i+r>>>2]|=o<<24-(i+r)%4*8}else for(var a=0;a<n;a+=4)t[i+a>>>2]=s[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(i());return new c.init(t,e)}}),d=o.enc={},h=d.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new c.init(s,t/2)}},u=d.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new c.init(s,t)}},m=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=m.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,i=this._data,n=i.words,r=i.sigBytes,o=this.blockSize,a=r/(4*o),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,d=e.min(4*l,r);if(l){for(var h=0;h<l;h+=o)this._doProcessBlock(n,h);s=n.splice(0,l),i.sigBytes-=d}return new c.init(s,d)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new b.HMAC.init(e,s).finalize(t)}}});var b=o.algo={};return o}(Math),e)),m.exports;var e}var b;var f,y,g=(b||(b=1,h.exports=(f=p(),function(){if("function"==typeof ArrayBuffer){var e=f.lib.WordArray,t=e.init,s=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var s=e.byteLength,i=[],n=0;n<s;n++)i[n>>>2]|=e[n]<<24-n%4*8;t.call(this,i,s)}else t.apply(this,arguments)};s.prototype=e}}(),f.lib.WordArray)),h.exports),Z=o(g),X={exports:{}};function w(){return y||(y=1,X.exports=function(e){return function(t){var s=e,i=s.lib,n=i.WordArray,r=i.Hasher,o=s.algo,a=[],l=[];!function(){function e(e){for(var s=t.sqrt(e),i=2;i<=s;i++)if(!(e%i))return!1;return!0}function s(e){return 4294967296*(e-(0|e))|0}for(var i=2,n=0;n<64;)e(i)&&(n<8&&(a[n]=s(t.pow(i,.5))),l[n]=s(t.pow(i,1/3)),n++),i++}();var c=[],d=o.SHA256=r.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var s=this._hash.words,i=s[0],n=s[1],r=s[2],o=s[3],a=s[4],d=s[5],h=s[6],u=s[7],m=0;m<64;m++){if(m<16)c[m]=0|e[t+m];else{var p=c[m-15],b=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,f=c[m-2],y=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;c[m]=b+c[m-7]+y+c[m-16]}var g=i&n^i&r^n&r,Z=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),X=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[m]+c[m];u=h,h=d,d=a,a=o+X|0,o=r,r=n,n=i,i=X+(Z+g)|0}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+r|0,s[3]=s[3]+o|0,s[4]=s[4]+a|0,s[5]=s[5]+d|0,s[6]=s[6]+h|0,s[7]=s[7]+u|0},_doFinalize:function(){var e=this._data,s=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return s[n>>>5]|=128<<24-n%32,s[14+(n+64>>>9<<4)]=t.floor(i/4294967296),s[15+(n+64>>>9<<4)]=i,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});s.SHA256=r._createHelper(d),s.HmacSHA256=r._createHmacHelper(d)}(Math),e.SHA256}(p())),X.exports}var G=o(w());let v;function L(e){const t=e.sigBytes,s=e.words,i=new Uint8Array(t);let n=0,r=0;for(;n<t;){const e=s[r++];if(i[n++]=(4278190080&e)>>>24,n===t)break;if(i[n++]=(16711680&e)>>>16,n===t)break;if(i[n++]=(65280&e)>>>8,n===t)break;i[n++]=255&e}return i}function S(e){function t(e){const t=e.indexOf("{"),s=e.lastIndexOf("}");if(-1===t||-1===s||s<t)return e;const i=e.slice(0,t).replace(/\s+/g," ").replace(/\s\(/,"("),n=e.slice(t+1,s);return`${i.trim()}{${n.trim()}}`}let s=t(""+e);if(!s.startsWith("class")){const i=e.prototype;i&&(s+=Object.getOwnPropertyNames(i).map((e=>`${e}:${t(""+i[e])}`)).join(""))}return s}function x(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function W(){return d.has("debug","hashing",!1)}v=globalThis.crypto&&globalThis.crypto.subtle&&"function"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(e,t)=>{if("SHA-256"!==e)throw Error(`${K.libName}: only SHA-256 available`);const s=Z.create(t);return L(G(s)).buffer};let T={};const C=new TextEncoder;async function k(e){const t=C.encode(e),s=await async function(e){return 0===e.length?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":x(await v("SHA-256",e))}(t);return T[s]={string:e,buffer:t},s}const V=[],I={};const P=new Set;function R(e,t={}){return e&&K.showMessage(e,{...t,level:"warning"})}function Y(e,t={}){return e&&K.showMessage(e,{...t,level:"status"})}function M(e,t,s="error"){console.error(`Error during ${e}`,t);const i=(t.stack||"").split("\n").filter((e=>!e.match(/croquet-.*\.min.js/))).join("\n");K.showMessage(`Error during ${e}: ${t.message}\n\n${i}`,{level:s,duration:"error"===s?1e4:void 0,stopOnFocus:!0})}const K={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},sessionURL:null,root:!1,sync:!1,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock(){},makeSessionWidgets(){},makeQRCanvas:()=>null,clearSessionMoniker(){},showSyncWait(e){},messageFunction:function(e,t={}){const s=t.level;console.log(`${"status"===s?"":s+": "} ${e}`)},showMessage:(e,t={})=>d.nomessages||!1===K.root||!1===K.messages||!K.messageFunction?("warning"===t.level&&console.warn(e),"error"===t.level&&console.error(e),null):K.messageFunction(e,t),isCroquetHost:e=>e.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(e)||e.endsWith("ngrok.io"),referrerURL:()=>"http://localhost/node.html",autoSession(e={key:"q"}){"string"==typeof e&&(e={key:e}),e||(e={});const t=e.key||"q";let s=d[t]||"";if(s)try{s=decodeURIComponent(s)}catch(e){}else s=Math.floor(Math.random()*36**10).toString(36),console.warn(`no ${K.libName} session name provided, using "${s}"`);d.has("debug","session")&&console.log(`${K.libName}.App.autoSession: "${s}"`);const i=Promise.resolve(s);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${K.libName}.App.autoSession() return value used directly. It returns a promise now!`),s),i},autoPassword(e={key:"pw"}){const t=e.key||"pw";let s=d[t]||"";if(!s){const e=require("crypto").randomBytes(16);s=x(e),console.warn(`no ${K.libName} session password provided, using "${s}"`)}d.has("debug","session")&&console.log(`${K.libName}.App.autoPassword: "${s}"`);const i=Promise.resolve(s);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${K.libName}.App.autoPassword() return value used directly. It returns a promise now!`),s),i}},H="#__vote";function N(e,t,s=null){let i="none";for(const n of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const r of e[n])r.for===t?null===s||r.unbound===s?e[n].delete(r):i="subscriber":"none"===i&&(i="others");return i}const z=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(e){return"V"+ ++this.subscriberIds}deregister(e){}addSubscription(e,t,s,i,n){if(e.includes(":"))throw Error(`Invalid subscription scope "${e}" (must not contain ':')`);if("vote"===n)return void this.addSubscription(e,t+H,s,i,"immediate");"*"!==e&&"*"!==t||(this.genericSubscriptions=!0);const r=e+":"+t,o=i;o.for=s;let a=this.subscriptions[r];if(a||(a=this.subscriptions[r]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[n])throw Error(`Unknown subscribe() option: handling="${n}"`);a[n].add(o);let l=this.subscribers.get(s);l||this.subscribers.set(s,l=new Set),l.add(r)}removeSubscription(e,t,s,i=null){const n=e+":"+t,r=this.subscriptions[n];if(r){const e=N(r,s,i);if("none"===e&&delete this.subscriptions[n],"subscriber"!==e){const e=this.subscribers.get(s);e&&(e.delete(n),0===e.size&&this.subscribers.delete(s))}}t.endsWith(H)||this.removeSubscription(e,t+H,s)}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e);if(t){for(const s of t){const t=this.subscriptions[s];if(t){"none"===N(t,e)&&delete this.subscriptions[s]}else console.error(`${K.libName}: topic ${s} not found in subscriptions table for ${e} during removeAllSubscriptionsFor()`)}this.subscribers.delete(e)}}subscriptionsFor(e){const t=this.subscriptions[e];if(!t&&!this.genericSubscriptions)return null;const s=[];let i=!!t;if(this.genericSubscriptions){const[t,n]=e.split(":");if(!(t.startsWith("__")&&t.endsWith("__")||n.startsWith("__")&&n.endsWith("__")))for(const e of["*:*",t+":*","*:"+n]){const t=this.subscriptions[e];t&&(s.push([t,e]),!i&&this.hasUserSubcription(t)&&(i=!0))}const r=!i;if(r)for(const e of s)e.push(r)}return t&&s.push([t,e]),0===s.length?null:s}hasUserSubcription(e){for(const t of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const s of e[t])if(!s.unbound.__CROQUET__)return!0;return!1}handleEvent(e,t,s=null){const i=this.subscriptionsFor(e);if(!i)return;const n=!!s;let r=0,o=0,a=0;for(const[l,c,d]of i)r+=l.queued.size,o+=l.oncePerFrame.size,a+=l.oncePerFrameWhileSynced.size,l.immediate.size>0&&(s||(s=e=>e()),s((()=>{for(const s of l.immediate){const i=this.currentEvent,r=this.currentEventFromModel,o=this.currentEventOnlyGeneric;this.currentEvent=e,this.currentEventFromModel=n,this.currentEventOnlyGeneric=d;try{s(t)}catch(e){console.error(e),console.warn(`${K.libName}: error "${e.message}" in "immediate" subscription ${c}`)}this.currentEvent=i,this.currentEventFromModel=r,this.currentEventOnlyGeneric=o}})));r>0&&this.queuedEvents.push({topic:e,data:t,fromModel:n}),o>0&&this.perFrameEvents.set(e,{data:t,fromModel:n}),a>0&&this.perSyncedFrameEvents.set(e,{data:t,fromModel:n})}processFrameEvents(e,t){let s=0;const i=(e,t,i,n)=>{const r=this.subscriptionsFor(t);if(!r)return;const o=this.currentEvent,a=this.currentEventFromModel;this.currentEvent=t,this.currentEventFromModel=n;for(const[n,o,a]of r){const r=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=a;for(const r of n[e]){try{r(i)}catch(s){console.error(s),console.warn(`${K.libName}: error "${s.message}" in "${e}" subscription ${t}`)}s++}this.currentEventOnlyGeneric=r}this.currentEvent=o,this.currentEventFromModel=a};for(const{topic:e,data:t,fromModel:s}of this.queuedEvents)i("queued",e,t,s);if(this.queuedEvents.length=0,e){for(const[e,{data:t,fromModel:s}]of this.perFrameEvents)i("oncePerFrame",e,t,s);if(this.perFrameEvents.clear(),t){for(const[e,{data:t,fromModel:s}]of this.perSyncedFrameEvents)i("oncePerFrameWhileSynced",e,t,s);this.perSyncedFrameEvents.clear()}for(const{topic:e,data:t,fromModel:s}of this.queuedEvents)i("queued",e,t,s);this.queuedEvents.length=0}return s}};let F={get subscribe(){return F={subscribe:d.has("debug","subscribe",!1)},F.subscribe}};class j{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,s){this.vm.publishFromModel(s,e,t)}subscribe(e,t,s,i){return F.subscribe&&console.log(`Model.subscribe("${t}:${s}", ${e} ${(""+i).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(e,t,s,i)}unsubscribe(e,t,s,i="*"){F.subscribe&&console.log(`Model.unsubscribe(${t}:${s}", ${e} ${(""+i).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(e,t,s,i)}unsubscribeAll(e){F.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,s,i){if(J&&J.equal(this))return this.vm.future(e,t,s,i);throw Error(`Model.future() called from outside: ${e}`)}cancelFuture(e,t){if(J&&J.equal(this))return this.vm.cancelFuture(e,t);throw Error(`Model.cancelFuture() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof j&&e.vm===this.vm}isViewRealm(){return!1}}class _{constructor(e){this.vd=z,this.vm=e,this.controller=e.controller}valid(){return this.vm===this.controller.vm}register(e){return z.register(e)}deregister(e){z.deregister(e)}publish(e,t,s){this.vm.publishFromView(s,e,t)}subscribe(e,t,s,i,n="queued"){F.subscribe&&console.log(`View[${t}].subscribe("${i}:${e}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):""+s} [${n}])`),z.addSubscription(i,e,t,s,n)}unsubscribe(e,t,s=null,i){F.subscribe&&console.log(`View[${t}].unsubscribe("${i}:${e}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):"*"})`),z.removeSubscription(i,e,t,s)}unsubscribeAll(e){F.subscribe&&console.log(`View[${e}].unsubscribeAll()`),z.removeAllSubscriptionsFor(e)}future(e,t){const s=this.vm;return new Proxy(e,{get(i,n){if("function"==typeof e[n]){return new Proxy(e[n],{apply(i,r,o){setTimeout((()=>{e.id&&E(s,(()=>e[n](...o)),!0)}),t)}})}throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(e){return e instanceof _&&e.vm===this.vm}isViewRealm(){return!0}}let J=null;function U(e="Tried to execute code that requires realm outside of realm."){if(!J&&e)throw Error(e);return J}function Q(e,t){if(null!==J)throw Error("Can't switch realms from inside realm");try{return J=new j(e),t()}finally{J=null}}function E(e,t,s=!1){if(null!==J&&!s)throw Error("Can't switch realms from inside realm");const i=J;try{return J=new _(e),t()}finally{J=i}}var D=256,O=Math.pow(D,6),B=Math.pow(2,52),$=2*B,A=255;function q(e,t){var s=[];if((t=t||{}).entropy)throw new Error("this version of seedrandom does not support entropy");if(null==e&&!t.state)throw new Error("this version of seedrandom requires a seed");!function(e,t){var s,i=e+"",n=0;for(;n<i.length;)t[A&n]=A&(s^=19*t[A&n])+i.charCodeAt(n++);return r=t,String.fromCharCode.apply(0,r);var r}(se(e,3),s);var i=new ee(s),n=function(){for(var e=i.g(6),t=O,s=0;e<B;)e=(e+s)*D,t*=D,s=i.g(1);for(;e>=$;)e/=2,t/=2,s>>>=1;return(e+s)/t};return n.int32=function(){return 0|i.g(4)},n.quick=function(){return i.g(4)/4294967296},n.double=n,(t.pass||function(e,t){return t&&(t.S&&te(t,i),e.state=function(){return te(i,{})}),e})(n,t.state)}function ee(e){var t,s=e.length,i=this,n=0,r=i.i=i.j=0,o=i.S=[];for(s||(e=[s++]);n<D;)o[n]=n++;for(n=0;n<D;n++)o[n]=o[r=A&r+e[n%s]+(t=o[n])],o[r]=t;(i.g=function(e){for(var t,s=0,n=i.i,r=i.j,o=i.S;e--;)t=o[n=A&n+1],s=s*D+o[A&(o[n]=o[r=A&r+t])+(o[r]=t)];return i.i=n,i.j=r,s})(D)}function te(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function se(e,t){var s,i=[],n=typeof e;if(t&&"object"==n)for(s in e)try{i.push(se(e[s],t-1))}catch(e){}return i.length?i:"string"==n?e:e+"\0"}var ie=function(e){return e!=e},ne=Math.sqrt,re=.7853981633974483;var oe=function(e){var t,s;return 0===e?.16666666666666713:((e<0?-e:e)<=1?(t=e*(19.562619833175948+e*(e*(5.444622390564711+e*(.004253011369004428*e-.6019598008014124))-16.262479672107002))-8.198089802484825,s=e*(139.51056146574857+e*(e*(70.49610280856842+e*(1*e-14.740913729888538))-147.1791292232726))-49.18853881490881):(t=.004253011369004428+(e=1/e)*(e*(5.444622390564711+e*(e*(19.562619833175948+-8.198089802484825*e)-16.262479672107002))-.6019598008014124),s=1+e*(e*(70.49610280856842+e*(e*(139.51056146574857+-49.18853881490881*e)-147.1791292232726))-14.740913729888538)),t/s)};var ae=function(e){var t,s;return 0===e?.08333333333333809:((e<0?-e:e)<=1?(t=28.536655482610616+e*(e*(6.968710824104713+e*(.002967721961301243*e-.5634242780008963))-25.56901049652825),s=342.43986579130785+e*(e*(147.0656354026815+e*(1*e-21.947795316429207))-383.8770957603691)):(t=.002967721961301243+(e=1/e)*(e*(6.968710824104713+e*(28.536655482610616*e-25.56901049652825))-.5634242780008963),s=1+e*(e*(147.0656354026815+e*(342.43986579130785*e-383.8770957603691))-21.947795316429207)),t/s)};var le=function(e){var t,s,i,n,r;if(ie(e))return NaN;if(e>0?i=e:(t=!0,i=-e),i>1)return NaN;if(i>.625)n=(s=1-i)*ae(s),s=ne(s+s),r=re-s,r-=s=s*n-6123233995736766e-32,r+=re;else{if(i<1e-8)return e;r=i*(r=(s=i*i)*oe(s))+i}return t?-r:r};var ce=function(e){var t;return ie(e)||e<-1||e>1?NaN:e>.5?2*le(ne(.5-.5*e)):(t=re-le(e),t+=6123233995736766e-32,t+=re)};var de=function(){return"function"==typeof Symbol&&"symbol"==typeof Symbol("foo")}();var he=function(){return de&&"symbol"==typeof Symbol.toStringTag},ue=Object.prototype.toString;var me=function(e){return ue.call(e)},pe=Object.prototype.hasOwnProperty;var be=function(e,t){return null!=e&&pe.call(e,t)},fe="function"==typeof Symbol?Symbol.toStringTag:"";var ye=function(e){var t,s,i;if(null==e)return ue.call(e);s=e[fe],t=be(e,fe);try{e[fe]=void 0}catch(t){return ue.call(e)}return i=ue.call(e),t?e[fe]=s:delete e[fe],i},ge=he()?ye:me,Ze="function"==typeof Uint32Array;var Xe=function(e){return Ze&&e instanceof Uint32Array||"[object Uint32Array]"===ge(e)},we=4294967295,Ge="function"==typeof Uint32Array?Uint32Array:null;var ve=function(){var e,t;if("function"!=typeof Ge)return!1;try{t=new Ge(t=[1,3.14,-3.14,we+1,we+2]),e=Xe(t)&&1===t[0]&&3===t[1]&&t[2]===we-2&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Le="function"==typeof Uint32Array?Uint32Array:null;var Se=function(){throw new Error("not implemented")},xe=ve()?Le:Se,We="function"==typeof Float64Array;var Te=function(e){return We&&e instanceof Float64Array||"[object Float64Array]"===ge(e)},Ce="function"==typeof Float64Array?Float64Array:null;var ke=function(){var e,t;if("function"!=typeof Ce)return!1;try{t=new Ce([1,3.14,-3.14,NaN]),e=Te(t)&&1===t[0]&&3.14===t[1]&&-3.14===t[2]&&t[3]!=t[3]}catch(t){e=!1}return e},Ve="function"==typeof Float64Array?Float64Array:null;var Ie=function(){throw new Error("not implemented")},Pe=ke()?Ve:Ie,Re="function"==typeof Uint8Array;var Ye=function(e){return Re&&e instanceof Uint8Array||"[object Uint8Array]"===ge(e)},Me="function"==typeof Uint8Array?Uint8Array:null;var Ke=function(){var e,t;if("function"!=typeof Me)return!1;try{t=new Me(t=[1,3.14,-3.14,256,257]),e=Ye(t)&&1===t[0]&&3===t[1]&&253===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},He="function"==typeof Uint8Array?Uint8Array:null;var Ne=function(){throw new Error("not implemented")},ze=Ke()?He:Ne,Fe="function"==typeof Uint16Array;var je=function(e){return Fe&&e instanceof Uint16Array||"[object Uint16Array]"===ge(e)},_e="function"==typeof Uint16Array?Uint16Array:null;var Je=function(){var e,t;if("function"!=typeof _e)return!1;try{t=new _e(t=[1,3.14,-3.14,65536,65537]),e=je(t)&&1===t[0]&&3===t[1]&&65533===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Ue="function"==typeof Uint16Array?Uint16Array:null;var Qe,Ee=function(){throw new Error("not implemented")},De={uint16:Je()?Ue:Ee,uint8:ze};(Qe=new De.uint16(1))[0]=4660;var Oe=52===new De.uint8(Qe.buffer)[0],Be=!0===Oe?1:0,$e=new Pe(1),Ae=new xe($e.buffer);var qe=function(e){return $e[0]=e,Ae[Be]},et=!0===Oe?1:0,tt=new Pe(1),st=new xe(tt.buffer);var it=function(e,t){return tt[0]=e,st[et]=t>>>0,tt[0]},nt=it,rt=Number.POSITIVE_INFINITY,ot=Number.NEGATIVE_INFINITY,at=1023;var lt=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.3999999999940942+e*(.2857142874366239+e*(.22222198432149784+e*(.1818357216161805+e*(.15313837699209373+.14798198605116586*e)))))},ct=.6931471803691238,dt=1.9082149292705877e-10;var ht=function(e){var t,s,i,n,r,o,a,l,c,d;if(e<-1||ie(e))return NaN;if(-1===e)return ot;if(e===rt)return e;if(0===e)return e;if(d=1,(i=e<0?-e:e)<.41421356237309503){if(i<1.862645149230957e-9)return i<5551115123125783e-32?e:e-e*e*.5;e>-.2928932188134525&&(d=0,n=e,s=1)}return 0!==d&&(i<9007199254740992?(r=(d=((s=qe(c=1+e))>>20)-at)>0?1-(c-e):e-(c-1),r/=c):(d=((s=qe(c=e))>>20)-at,r=0),(s&=1048575)<434334?c=nt(c,1072693248|s):(d+=1,c=nt(c,1071644672|s),s=1048576-s>>2),n=c-1),t=.5*n*n,0===s?0===n?d*ct+(r+=d*dt):d*ct-((l=t*(1-.6666666666666666*n))-(d*dt+r)-n):(l=(a=(o=n/(2+n))*o)*lt(a),0===d?n-(t-o*(t+l)):d*ct-(t-(o*(t+l)+(d*dt+r))-n))},ut=.6931471805599453;var mt=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var pt=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},bt=.6931471803691238,ft=1.9082149292705877e-10,yt=1048575;var gt=function(e){var t,s,i,n,r,o,a,l,c,d,h;return 0===e?ot:ie(e)||e<0?NaN:(n=0,(s=qe(e))<1048576&&(n-=54,s=qe(e*=0x40000000000000)),s>=2146435072?e+e:(n+=(s>>20)-at|0,n+=(a=(s&=yt)+614244&1048576)>>20,o=(e=nt(e,s|1072693248^a))-1,(yt&2+s)<3?0===o?0===n?0:n*bt+n*ft:(r=o*o*(.5-.3333333333333333*o),0===n?o-r:n*bt-(r-n*ft-o)):(a=s-398458|0,l=440401-s|0,i=(d=(h=(c=o/(2+o))*c)*h)*mt(d),r=h*pt(d)+i,(a|=l)>0?(t=.5*o*o,0===n?o-(t-c*(t+r)):n*bt-(t-(c*(t+r)+n*ft)-o)):0===n?o-c*(o-r):n*bt-(c*(o-r)-n*ft-o))))};var Zt=function(e){var t;return ie(e)||e<1?NaN:1===e?0:e>=268435456?gt(e)+ut:e>2?gt(2*e-1/(e+ne(e*e-1))):ht((t=e-1)+ne(2*t+t*t))};var Xt=function(e){return e===rt||e===ot},wt=1/(1<<28);var Gt=function(e){var t,s,i;return ie(e)||Xt(e)?e:(e<0&&(e=-e,t=!0),i=e<wt?e:e>268435456?gt(e)+ut:e>2?gt(2*e+1/(ne(e*e+1)+e)):ht(e+(s=e*e)/(1+ne(1+s))),t?-i:i)},vt=1.5707963267948966;var Lt=function(e){return 0===e?-64.85021904942025:e*(e*(e*(-.8750608600031904*e-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var St=function(e){return 0===e?194.5506571482614:194.5506571482614+e*(485.3903996359137+e*(432.88106049129027+e*(165.02700983169885+e*(24.858464901423062+1*e))))},xt=6123233995736766e-32;var Wt=function(e){var t,s,i,n;return ie(e)||0===e?e:e===rt?vt:e===ot?-1.5707963267948966:(e<0&&(s=!0,e=-e),t=0,e>2.414213562373095?(i=vt,t=1,e=-1/e):e<=.66?i=0:(i=re,t=2,e=(e-1)/(e+1)),n=e*(n=(n=e*e)*Lt(n)/St(n))+e,2===t?n+=.5*xt:1===t&&(n+=xt),i+=n,s?-i:i)},Tt=1/(1<<28);var Ct,kt,Vt=function(e){var t,s;return ie(e)||e<-1||e>1?NaN:1===e?rt:-1===e?ot:(e<0&&(t=!0,e=-e),e<Tt?t?-e:e:(s=e<.5?.5*ht((s=e+e)+s*e/(1-e)):.5*ht((e+e)/(1-e)),t?-s:s))};!0===Oe?(Ct=1,kt=0):(Ct=0,kt=1);var It={HIGH:Ct,LOW:kt},Pt=new Pe(1),Rt=new xe(Pt.buffer),Yt=It.HIGH,Mt=It.LOW;var Kt=function(e,t){return Pt[0]=t,e[0]=Rt[Yt],e[1]=Rt[Mt],e};var Ht,Nt,zt=function(e,t){return 1===arguments.length?Kt([0,0],e):Kt(e,t)};!0===Oe?(Ht=1,Nt=0):(Ht=0,Nt=1);var Ft={HIGH:Ht,LOW:Nt},jt=new Pe(1),_t=new xe(jt.buffer),Jt=Ft.HIGH,Ut=Ft.LOW;var Qt=function(e,t){return _t[Jt]=e,_t[Ut]=t,jt[0]},Et=Qt,Dt=[0,0];var Ot=function(e,t){var s,i;return zt(Dt,e),s=Dt[0],s&=2147483647,i=qe(t),Et(s|=i&=2147483648,Dt[1])};var Bt=function(e){return!!(qe(e)>>>31)},$t=3.141592653589793;var At=function(e,t){var s;return ie(t)||ie(e)?NaN:Xt(t)?t===rt?Xt(e)?Ot($t/4,e):Ot(0,e):Xt(e)?Ot(3*$t/4,e):Ot($t,e):Xt(e)?Ot($t/2,e):0===e?t>=0&&!Bt(t)?Ot(0,e):Ot($t,e):0===t?Ot($t/2,e):(s=Wt(e/t),t<0?s<=0?s+$t:s-$t:s)},qt=22250738585072014e-324;var es=function(e){return 0===e?1.87595182427177:1.87595182427177+e*(e*(1.6214297201053545+e*(.14599619288661245*e-.758397934778766))-1.8849797954337717)},ts=2147483647;var ss=function(e){var t,s,i,n,r;return ie(e)||Xt(e)||0===e?e:(s=-2147483648&(i=qe(e)),i&=ts,r=0,e<qt?(r=0x40000000000000,t=qe(r*=e),r=Et(s|(t=(t&ts)/3+696219795),0)):r=nt(r,s|(t=i/3+715094163)),r*=es(n=r*r*(r/e)),t=qe(r),r=Et(t+1,0),r+=r*(n=((n=e/(r*r))-r)/(r+r+n)))},is=ss;var ns=function(e){return 0===e?.0416666666666666:.0416666666666666+e*(2480158728947673e-20*e-.001388888888887411)};var rs=function(e){return 0===e?-2.7557314351390663e-7:e*(2.087572321298175e-9+-11359647557788195e-27*e)-2.7557314351390663e-7};var os=function(e,t){var s,i,n,r;return n=(r=e*e)*r,i=r*ns(r),i+=n*n*rs(r),(n=1-(s=.5*r))+(1-n-s+(r*i-e*t))},as=-.16666666666666632;var ls=function(e,t){var s,i,n;return s=.00833333333332249+(n=e*e)*(27557313707070068e-22*n-.0001984126982985795)+n*(n*n)*(1.58969099521155e-10*n-2.5050760253406863e-8),i=n*e,0===t?e+i*(as+n*s):e-(n*(.5*t-i*s)-t-i*as)},cs=!0===Oe?0:1,ds=new Pe(1),hs=new xe(ds.buffer);var us=function(e){return ds[0]=e,hs[cs]},ms=Math.floor;var ps=function(e){return e<0?-e:0===e?0:e};var bs=function(e,t){return ie(t)||Xt(t)?(e[0]=t,e[1]=0,e):0!==t&&ps(t)<qt?(e[0]=4503599627370496*t,e[1]=-52,e):(e[0]=t,e[1]=0,e)};var fs=function(e,t){return 1===arguments.length?bs([0,0],e):bs(e,t)};var ys=function(e){var t=qe(e);return(t=(2146435072&t)>>>20)-at|0},gs=ys,Zs=[0,0],Xs=[0,0];var ws=function(e,t){var s,i;return 0===e||ie(e)||Xt(e)?e:(fs(Zs,e),t+=Zs[1],(t+=gs(e=Zs[0]))<-1074?Ot(0,e):t>1023?e<0?ot:rt:(t<=-1023?(t+=52,i=2220446049250313e-31):i=1,zt(Xs,e),s=Xs[0],s&=2148532223,i*Et(s|=t+at<<20,Xs[1])))},Gs=ws,vs=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Ls=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],Ss=16777216,xs=5.960464477539063e-8,Ws=Vs(new Array(20)),Ts=Vs(new Array(20)),Cs=Vs(new Array(20)),ks=Vs(new Array(20));function Vs(e){var t,s=e.length;for(t=0;t<s;t++)e[t]=0;return e}function Is(e,t,s,i,n,r,o,a,l){var c,d,h,u,m,p,b,f,y;for(u=r,y=i[s],f=s,m=0;f>0;m++)d=xs*y|0,ks[m]=y-Ss*d|0,y=i[f-1]+d,f-=1;if(y=Gs(y,n),y-=8*ms(.125*y),y-=b=0|y,h=0,n>0?(b+=m=ks[s-1]>>24-n,ks[s-1]-=m<<24-n,h=ks[s-1]>>23-n):0===n?h=ks[s-1]>>23:y>=.5&&(h=2),h>0){for(b+=1,c=0,m=0;m<s;m++)f=ks[m],0===c?0!==f&&(c=1,ks[m]=16777216-f):ks[m]=16777215-f;if(n>0)switch(n){case 1:ks[s-1]&=8388607;break;case 2:ks[s-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=Gs(1,n)))}if(0===y){for(f=0,m=s-1;m>=r;m--)f|=ks[m];if(0===f){for(p=1;0===ks[r-p];p++);for(m=s+1;m<=s+p;m++){for(l[a+m]=vs[o+m],d=0,f=0;f<=a;f++)d+=e[f]*l[a+(m-f)];i[m]=d}return Is(e,t,s+=p,i,n,r,o,a,l)}}if(0===y)for(s-=1,n-=24;0===ks[s];)s-=1,n-=24;else(y=Gs(y,-n))>=Ss?(d=xs*y|0,ks[s]=y-Ss*d|0,n+=24,ks[s+=1]=d):ks[s]=0|y;for(d=Gs(1,n),m=s;m>=0;m--)i[m]=d*ks[m],d*=xs;for(m=s;m>=0;m--){for(d=0,p=0;p<=u&&p<=s-m;p++)d+=Ls[p]*i[m+p];Cs[s-m]=d}for(d=0,m=s;m>=0;m--)d+=Cs[m];for(t[0]=0===h?d:-d,d=Cs[0]-d,m=1;m<=s;m++)d+=Cs[m];return t[1]=0===h?d:-d,7&b}var Ps=function(e,t,s,i){var n,r,o,a,l,c,d;for((r=(s-3)/24|0)<0&&(r=0),a=s-24*(r+1),c=r-(o=i-1),d=o+4,l=0;l<=d;l++)Ws[l]=c<0?0:vs[c],c+=1;for(l=0;l<=4;l++){for(n=0,c=0;c<=o;c++)n+=e[c]*Ws[o+(l-c)];Ts[l]=n}return Is(e,t,4,Ts,a,4,r,o,Ws)},Rs=Math.round;var Ys=function(e,t,s){var i,n,r,o,a;return r=e-1.5707963267341256*(i=Rs(.6366197723675814*e)),o=6077100506506192e-26*i,a=t>>20,s[0]=r-o,a-(qe(s[0])>>20&2047)>16&&(o=20222662487959506e-37*i-((n=r)-(r=n-(o=6077100506303966e-26*i))-o),s[0]=r-o,a-(qe(s[0])>>20&2047)>49&&(o=84784276603689e-45*i-((n=r)-(r=n-(o=20222662487111665e-37*i))-o),s[0]=r-o)),s[1]=r-s[0]-o,i},Ms=1.5707963267341256,Ks=6077100506506192e-26,Hs=2*Ks,Ns=3*Ks,zs=4*Ks,Fs=new Array(3),js=new Array(2);var _s=function(e,t){var s,i,n,r,o,a,l;if((n=2147483647&qe(e))<=1072243195)return t[0]=e,t[1]=0,0;if(n<=1074752122)return 598523==(1048575&n)?Ys(e,n,t):n<=1073928572?e>0?(l=e-Ms,t[0]=l-Ks,t[1]=l-t[0]-Ks,1):(l=e+Ms,t[0]=l+Ks,t[1]=l-t[0]+Ks,-1):e>0?(l=e-2*Ms,t[0]=l-Hs,t[1]=l-t[0]-Hs,2):(l=e+2*Ms,t[0]=l+Hs,t[1]=l-t[0]+Hs,-2);if(n<=1075594811)return n<=1075183036?1074977148===n?Ys(e,n,t):e>0?(l=e-3*Ms,t[0]=l-Ns,t[1]=l-t[0]-Ns,3):(l=e+3*Ms,t[0]=l+Ns,t[1]=l-t[0]+Ns,-3):1075388923===n?Ys(e,n,t):e>0?(l=e-4*Ms,t[0]=l-zs,t[1]=l-t[0]-zs,4):(l=e+4*Ms,t[0]=l+zs,t[1]=l-t[0]+zs,-4);if(n<1094263291)return Ys(e,n,t);if(n>=2146435072)return t[0]=NaN,t[1]=NaN,0;for(s=us(e),l=Et(n-((i=(n>>20)-1046)<<20),s),o=0;o<2;o++)Fs[o]=0|l,l=16777216*(l-Fs[o]);for(Fs[2]=l,r=3;0===Fs[r-1];)r-=1;return a=Ps(Fs,js,i,r),e<0?(t[0]=-js[0],t[1]=-js[1],-a):(t[0]=js[0],t[1]=js[1],a)},Js=_s,Us=[0,0];var Qs=function(e){var t;if(t=qe(e),(t&=2147483647)<=1072243195)return t<1044381696?1:os(e,0);if(t>=2146435072)return NaN;switch(3&Js(e,Us)){case 0:return os(Us[0],Us[1]);case 1:return-ls(Us[0],Us[1]);case 2:return-os(Us[0],Us[1]);default:return ls(Us[0],Us[1])}},Es=Math.ceil;var Ds=function(e){return e<0?Es(e):ms(e)};var Os=function(e){return 0===e?.16666666666666602:.16666666666666602+e*(e*(6613756321437934e-20+e*(4.1381367970572385e-8*e-16533902205465252e-22))-.0027777777777015593)};var Bs=function(e,t,s){var i,n,r;return r=(i=e-t)-(n=i*i)*Os(n),Gs(1-(t-i*r/(2-r)-e),s)},$s=1.4426950408889634,As=1/(1<<28);var qs=function(e){var t;return ie(e)||e===rt?e:e===ot?0:e>709.782712893384?rt:e<-745.1332191019411?0:e>-3.725290298461914e-9&&e<As?1+e:(t=Ds(e<0?$s*e-.5:$s*e+.5),Bs(e-.6931471803691238*t,1.9082149292705877e-10*t,t))};var ei=function(e){return ie(e)?e:(e<0&&(e=-e),e>21?qs(e)/2:(qs(e)+qs(-e))/2)};var ti=function(e){return 0===e?-.03333333333333313:e*(.0015873015872548146+e*(e*(4008217827329362e-21+-2.0109921818362437e-7*e)-793650757867488e-19))-.03333333333333313},si=.6931471803691238,ii=1.9082149292705877e-10,ni=1.4426950408889634;var ri=function(e){var t,s,i,n,r,o,a,l,c,d,h,u;if(e===rt||ie(e))return e;if(e===ot)return-1;if(0===e)return e;if(e<0?(s=!0,a=-e):(s=!1,a=e),a>=38.816242111356935){if(s)return-1;if(a>=709.782712893384)return rt}if(r=0|qe(a),a>.34657359027997264)a<1.0397207708399179?s?(i=e+si,n=-1.9082149292705877e-10,u=-1):(i=e-si,n=ii,u=1):(u=s?ni*e-.5:ni*e+.5,i=e-(d=u|=0)*si,n=d*ii),c=i-(e=i-n)-n;else{if(r<1016070144)return e;u=0}return h=(l=e*(t=.5*e))*(((o=1+l*ti(l))-(d=3-o*t))/(6-e*d)),0===u?e-(e*h-l):(h=e*(h-c)-c,h-=l,-1===u?.5*(e-h)-.5:1===u?e<-.25?-2*(h-(e+.5)):1+2*(e-h):u<=-2||u>56?(i=qe(a=1-(h-e))+(u<<20)|0,(a=nt(a,i))-1):(d=1,u<20?a=(d=nt(d,i=1072693248-(2097152>>u)|0))-(h-e):(a=e-(h+(d=nt(d,i=at-u<<20))),a+=1),i=qe(a)+(u<<20)|0,nt(a,i)))},oi=!0===Oe?0:1,ai=new Pe(1),li=new xe(ai.buffer);var ci=function(e,t){return ai[0]=e,li[oi]=t>>>0,ai[0]},di=ci;var hi=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var ui=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},mi=1048575;var pi=function(e){var t,s,i,n,r,o,a,l,c,d;return i=qe(e),n=e-1,(mi&2+i)<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(i&=mi)-398458|0,d=440401-i|0,s=(l=(o=(r=n/(2+n))*r)*o)*hi(l),a=o*ui(l)+s,(c|=d)>0?r*((t=.5*n*n)+a)-t:r*(a-n))},bi=.4342944818781689;var fi=function(e){var t,s,i,n,r,o,a;return ie(e)||e<0?NaN:0===e?ot:(r=0,(s=qe(e))<1048576&&(r-=54,s=qe(e*=0x40000000000000)),s>=2146435072?e+e:(r+=(s>>20)-at|0,e=nt(e,(s&=1048575)|1072693248^(n=s+614244&1048576)),o=r+=n>>20,i=pi(e),a=3694239077158931e-28*o+25082946711645275e-27*((e-=1)+i),(a+=(e-(t=di(e,0))+i)*bi+t*bi)+.30102999566361177*o))};var yi=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var gi=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},Zi=1048575;var Xi=function(e){var t,s,i,n,r,o,a,l,c,d;return i=qe(e),n=e-1,(Zi&2+i)<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(i&=Zi)-398458|0,d=440401-i|0,s=(l=(o=(r=n/(2+n))*r)*o)*yi(l),a=o*gi(l)+s,(c|=d)>0?r*((t=.5*n*n)+a)-t:r*(a-n))},wi=1.4426950407214463,Gi=[0,0];var vi=function(e){var t,s,i,n,r;if(ie(e)||e<0)return NaN;if(zt(Gi,e),r=0,(s=Gi[0])<1048576){if(!(2147483647&s|Gi[1]))return ot;r-=54,s=qe(e*=0x40000000000000)}return s>=2146435072?e+e:(r+=(s>>20)-at|0,e=nt(e,(s&=1048575)|1072693248^(n=s+614244&1048576)),r+=n>>20,i=Xi(e),1.6751713164886512e-10*((e-=1)+i)+(e-(t=di(e,0))+i)*wi+t*wi+r)},Li=[0,0];var Si=function(e){var t;if(t=qe(e),(t&=2147483647)<=1072243195)return t<1045430272?e:ls(e,0);if(t>=2146435072)return NaN;switch(3&Js(e,Li)){case 0:return ls(Li[0],Li[1]);case 1:return os(Li[0],Li[1]);case 2:return-ls(Li[0],Li[1]);default:return-os(Li[0],Li[1])}};var xi=function(e){var t,s;return 0===e?.16666666666666666:((e<0?-e:e)<=1?(t=e*(e*(-.789474443963537*e-163.72585752598383)-11561.443576500522)-351754.9648081514,s=e*(36157.827983443196+e*(1*e-277.7110814206028))-2110529.7888489086):(t=(e=1/e)*(e*(-351754.9648081514*e-11561.443576500522)-163.72585752598383)-.789474443963537,s=1+e*(e*(36157.827983443196+-2110529.7888489086*e)-277.7110814206028)),t/s)},Wi=709.782712893384,Ti=Wi+ut,Ci=Wi-ut;var ki=function(e){var t;return 0===e?e:(t=ps(e),e>Ti||e<-709.089565712824?e>0?rt:ot:t>1?t>=Ci?(t=qs(.5*t),t*=.5*t,e<0&&(t=-t),t):(t=.5*(t=qs(t))-.5/t,e<0&&(t=-t),t):e+e*(t*=t)*xi(t))};var Vi=function(e){return 0===e?.13333333333320124:.13333333333320124+e*(.021869488294859542+e*(.0035920791075913124+e*(.0005880412408202641+e*(7817944429395571e-20+-18558637485527546e-21*e))))};var Ii=function(e){return 0===e?.05396825397622605:.05396825397622605+e*(.0088632398235993+e*(.0014562094543252903+e*(.0002464631348184699+e*(7140724913826082e-20+2590730518636337e-20*e))))};var Pi=function(e,t,s){var i,n,r,o,a,l,c,d,h;return(n=2147483647&(i=qe(e)))>=1072010280&&(e<0&&(e=-e,t=-t),e=(h=.7853981633974483-e)+(d=3061616997868383e-32-t),t=0),o=t+(h=e*e)*((a=h*e)*((o=Vi(d=h*h))+(c=h*Ii(d)))+t),d=e+(o+=.3333333333333341*a),n>=1072010280?(1-(i>>30&2))*((c=s)-2*(e-(d*d/(d+c)-o))):1===s?d:(di(h=d,0),c=o-(h-e),di(l=r=-1/d,0),l+r*((a=1+l*h)+l*c))},Ri=[0,0];var Yi=function(e){var t,s;return t=qe(e),(t&=2147483647)<=1072243195?t<1044381696?e:Pi(e,0,1):t>=2146435072?NaN:(s=Js(e,Ri),Pi(Ri[0],Ri[1],1-((1&s)<<1)))};var Mi=function(e){var t,s;return 0===e?-.3333333333333332:((e<0?-e:e)<=1?(t=e*(e*(0*e-.9643991794250523)-99.28772310019185)-1614.6876844170845,s=4844.063053251255+e*(2235.4883906010045+e*(112.81167849163293+1*e))):(t=0+(e=1/e)*(e*(-1614.6876844170845*e-99.28772310019185)-.9643991794250523),s=1+e*(112.81167849163293+e*(2235.4883906010045+4844.063053251255*e))),t/s)};var Ki=function(e){var t,s;if((s=ps(e))>44.014845965556525)return e<0?-1:1;if(s>=.625)s=1-2/((t=qs(2*s))+1),e<0&&(s=-s);else{if(0===e)return e;s=e+e*(t=e*e)*Mi(t)}return s};void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:ce,acosh:Zt,asin:le,asinh:Gt,atan:Wt,atanh:Vt,atan2:At,cbrt:is,cos:Qs,cosh:ei,exp:qs,expm1:ri,log:gt,log1p:ht,log10:fi,log2:vi,sin:Si,sinh:ki,tan:Yi,tanh:Ki});const Hi=Math.pow;function Ni(e){return e===1/0||e===-1/0}globalThis.CroquetMath.pow=(e,t)=>{if(isNaN(e)||isNaN(t))return NaN;if(Ni(e)||Ni(t))return Hi(e,t);if(0===e||0===t)return Hi(e,t);if(e<0&&!function(e){return Number.isInteger(e)}(t))return NaN;if(1===t)return e;if(2===t)return e*e;if(3===t)return e*e*e;if(4===t)return e*e*e*e;let s=1;e<0&&(e*=-1,s=Hi(-1,t));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(e)*t)*s};class zi extends s{poll(){const e=super.poll();return this.array[this.size]=null,e}asArray(){const e=[];return this.forEach((t=>e.push(t))),e}asUnsortedArray(){return this.array.slice(0,this.size)}}let Fi=!1,ji=Ji(0),_i={};function Ji(e){return{start:e,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:Fi}}const Ui=[],Qi={},Ei={animationFrame(e,t={}){!function(e){ji.total=e-ji.start}(e),ji=Ji(e);for(const[e,s]of Object.entries(t))this[e](s)},begin(e){const t=performance.now();ji.items[e]=(ji.items[e]||0)-t;const s=Ui[Ui.length-1];return s&&(ji.items[s]+=t),Ui.push(e),t},end(e){const t=performance.now();ji.items[e]+=t;const s=Ui.pop();if(s!==e)throw Error(`Unmatched stats calls: expected end("${s}"), got end("${e}")`);const i=Ui[Ui.length-1];return i&&(ji.items[i]-=t),t},backlog(e){ji.backlog=Math.max(e,ji.backlog)},starvation(e){ji.network=e},latency(e){ji.latency=e},activity(e){ji.activity=e},users(e){ji.users=e},connected(e){ji.connected=Fi=e},networkTraffic:Qi,addNetworkTraffic(e,t,s=!1){Qi[e]=(Qi[e]||0)+t,s&&(Qi[`audit_${e}`]=(Qi[`audit_${e}`]||0)+t)},resetAuditStats(){for(const e in Qi)e.startsWith("audit_")&&(Qi[e]=0)},perSecondTally(e={}){if(globalThis.logMessageStats)for(const[t,s]of Object.entries(e))_i[t]=(_i[t]||0)+s},stepSession(e,t=!1){const s=Math.floor(Date.now()/1e3);if(!globalThis.logMessageStats)return _i={second:s},null;let i=null;if(s!==_i.second){if(_i.second&&t&&(_i.requestedMessages||_i.sentMessagesTotal)){i={..._i};const e=s-_i.second;1!==e&&(i.sampleSeconds=e),i.sentBundles&&(i.averageDelay=Math.round(10*i.sendDelay/i.sentMessagesTotal)/10,i.averageBundlePayload=Math.round(i.sentBundlePayload/i.sentBundles)),delete i.second,delete i.sendDelay,delete i.sentBundlePayload}_i={second:s}}return i}};var Di,Oi={exports:{}};function Bi(){return Di||(Di=1,Oi.exports=function(e){return function(){var t=e,s=t.lib.WordArray;function i(e,t,i){for(var n=[],r=0,o=0;o<t;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2|i[e.charCodeAt(o)]>>>6-o%4*2;n[r>>>2]|=a<<24-r%4*8,r++}return s.create(n,r)}t.enc.Base64={stringify:function(e){var t=e.words,s=e.sigBytes,i=this._map;e.clamp();for(var n=[],r=0;r<s;r+=3)for(var o=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,a=0;a<4&&r+.75*a<s;a++)n.push(i.charAt(o>>>6*(3-a)&63));var l=i.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(e){var t=e.length,s=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var r=0;r<s.length;r++)n[s.charCodeAt(r)]=r}var o=s.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return i(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(p())),Oi.exports}var $i,Ai=o(Bi()),qi=p(),en={exports:{}};var tn,sn=($i||($i=1,en.exports=function(e){return e.enc.Utf8}(p())),en.exports),nn=o(sn),rn={exports:{}},on={exports:{}};function an(){return tn||(tn=1,on.exports=function(e){!function(){var t=e,s=t.lib.Base,i=t.enc.Utf8;t.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var s=e.blockSize,n=4*s;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),o=this._iKey=t.clone(),a=r.words,l=o.words,c=0;c<s;c++)a[c]^=1549556828,l[c]^=909522486;r.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,s=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(s))}})}()}(p())),on.exports}var ln;var cn,dn=(ln||(ln=1,rn.exports=function(e){return function(){var t=e,s=t.lib,i=s.Base,n=s.WordArray,r=t.algo,o=r.SHA256,a=r.HMAC,l=r.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:o,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s=this.cfg,i=a.create(s.hasher,e),r=n.create(),o=n.create([1]),l=r.words,c=o.words,d=s.keySize,h=s.iterations;l.length<d;){var u=i.update(t).finalize(o);i.reset();for(var m=u.words,p=m.length,b=u,f=1;f<h;f++){b=i.finalize(b),i.reset();for(var y=b.words,g=0;g<p;g++)m[g]^=y[g]}r.concat(u),c[0]++}return r.sigBytes=4*d,r}});t.PBKDF2=function(e,t,s){return l.create(s).compute(e,t)}}(),e.PBKDF2}(p(),w(),an())),rn.exports),hn=o(dn),un={exports:{}},mn={exports:{}};function pn(){return cn||(cn=1,mn.exports=function(e){return function(t){var s=e,i=s.lib,n=i.WordArray,r=i.Hasher,o=s.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=o.MD5=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var i=t+s,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var r=this._hash.words,o=e[t+0],l=e[t+1],m=e[t+2],p=e[t+3],b=e[t+4],f=e[t+5],y=e[t+6],g=e[t+7],Z=e[t+8],X=e[t+9],w=e[t+10],G=e[t+11],v=e[t+12],L=e[t+13],S=e[t+14],x=e[t+15],W=r[0],T=r[1],C=r[2],k=r[3];W=c(W,T,C,k,o,7,a[0]),k=c(k,W,T,C,l,12,a[1]),C=c(C,k,W,T,m,17,a[2]),T=c(T,C,k,W,p,22,a[3]),W=c(W,T,C,k,b,7,a[4]),k=c(k,W,T,C,f,12,a[5]),C=c(C,k,W,T,y,17,a[6]),T=c(T,C,k,W,g,22,a[7]),W=c(W,T,C,k,Z,7,a[8]),k=c(k,W,T,C,X,12,a[9]),C=c(C,k,W,T,w,17,a[10]),T=c(T,C,k,W,G,22,a[11]),W=c(W,T,C,k,v,7,a[12]),k=c(k,W,T,C,L,12,a[13]),C=c(C,k,W,T,S,17,a[14]),W=d(W,T=c(T,C,k,W,x,22,a[15]),C,k,l,5,a[16]),k=d(k,W,T,C,y,9,a[17]),C=d(C,k,W,T,G,14,a[18]),T=d(T,C,k,W,o,20,a[19]),W=d(W,T,C,k,f,5,a[20]),k=d(k,W,T,C,w,9,a[21]),C=d(C,k,W,T,x,14,a[22]),T=d(T,C,k,W,b,20,a[23]),W=d(W,T,C,k,X,5,a[24]),k=d(k,W,T,C,S,9,a[25]),C=d(C,k,W,T,p,14,a[26]),T=d(T,C,k,W,Z,20,a[27]),W=d(W,T,C,k,L,5,a[28]),k=d(k,W,T,C,m,9,a[29]),C=d(C,k,W,T,g,14,a[30]),W=h(W,T=d(T,C,k,W,v,20,a[31]),C,k,f,4,a[32]),k=h(k,W,T,C,Z,11,a[33]),C=h(C,k,W,T,G,16,a[34]),T=h(T,C,k,W,S,23,a[35]),W=h(W,T,C,k,l,4,a[36]),k=h(k,W,T,C,b,11,a[37]),C=h(C,k,W,T,g,16,a[38]),T=h(T,C,k,W,w,23,a[39]),W=h(W,T,C,k,L,4,a[40]),k=h(k,W,T,C,o,11,a[41]),C=h(C,k,W,T,p,16,a[42]),T=h(T,C,k,W,y,23,a[43]),W=h(W,T,C,k,X,4,a[44]),k=h(k,W,T,C,v,11,a[45]),C=h(C,k,W,T,x,16,a[46]),W=u(W,T=h(T,C,k,W,m,23,a[47]),C,k,o,6,a[48]),k=u(k,W,T,C,g,10,a[49]),C=u(C,k,W,T,S,15,a[50]),T=u(T,C,k,W,f,21,a[51]),W=u(W,T,C,k,v,6,a[52]),k=u(k,W,T,C,p,10,a[53]),C=u(C,k,W,T,w,15,a[54]),T=u(T,C,k,W,l,21,a[55]),W=u(W,T,C,k,Z,6,a[56]),k=u(k,W,T,C,x,10,a[57]),C=u(C,k,W,T,y,15,a[58]),T=u(T,C,k,W,L,21,a[59]),W=u(W,T,C,k,b,6,a[60]),k=u(k,W,T,C,G,10,a[61]),C=u(C,k,W,T,m,15,a[62]),T=u(T,C,k,W,X,21,a[63]),r[0]=r[0]+W|0,r[1]=r[1]+T|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},_doFinalize:function(){var e=this._data,s=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;s[n>>>5]|=128<<24-n%32;var r=t.floor(i/4294967296),o=i;s[15+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),s[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,s,i,n,r,o){var a=e+(t&s|~t&i)+n+o;return(a<<r|a>>>32-r)+t}function d(e,t,s,i,n,r,o){var a=e+(t&i|s&~i)+n+o;return(a<<r|a>>>32-r)+t}function h(e,t,s,i,n,r,o){var a=e+(t^s^i)+n+o;return(a<<r|a>>>32-r)+t}function u(e,t,s,i,n,r,o){var a=e+(s^(t|~i))+n+o;return(a<<r|a>>>32-r)+t}s.MD5=r._createHelper(l),s.HmacMD5=r._createHmacHelper(l)}(Math),e.MD5}(p())),mn.exports}var bn,fn={exports:{}},yn={exports:{}};function gn(){return bn||(bn=1,yn.exports=function(e){return function(){var t=e,s=t.lib,i=s.WordArray,n=s.Hasher,r=t.algo,o=[],a=r.SHA1=n.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=this._hash.words,i=s[0],n=s[1],r=s[2],a=s[3],l=s[4],c=0;c<80;c++){if(c<16)o[c]=0|e[t+c];else{var d=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=d<<1|d>>>31}var h=(i<<5|i>>>27)+l+o[c];h+=c<20?1518500249+(n&r|~n&a):c<40?1859775393+(n^r^a):c<60?(n&r|n&a|r&a)-1894007588:(n^r^a)-899497514,l=a,a=r,r=n<<30|n>>>2,n=i,i=h}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+r|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(i+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=n._createHelper(a),t.HmacSHA1=n._createHmacHelper(a)}(),e.SHA1}(p())),yn.exports}var Zn;function Xn(){return Zn||(Zn=1,fn.exports=function(e){return function(){var t=e,s=t.lib,i=s.Base,n=s.WordArray,r=t.algo,o=r.MD5,a=r.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s,i=this.cfg,r=i.hasher.create(),o=n.create(),a=o.words,l=i.keySize,c=i.iterations;a.length<l;){s&&r.update(s),s=r.update(e).finalize(t),r.reset();for(var d=1;d<c;d++)s=r.finalize(s),r.reset();o.concat(s)}return o.sigBytes=4*l,o}});t.EvpKDF=function(e,t,s){return a.create(s).compute(e,t)}}(),e.EvpKDF}(p(),gn(),an())),fn.exports}var wn,Gn={exports:{}};var vn;var Ln,Sn=(vn||(vn=1,un.exports=function(e){return function(){var t=e,s=t.lib.BlockCipher,i=t.algo,n=[],r=[],o=[],a=[],l=[],c=[],d=[],h=[],u=[],m=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var s=0,i=0;for(t=0;t<256;t++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^255&p^99,n[s]=p,r[p]=s;var b=e[s],f=e[b],y=e[f],g=257*e[p]^16843008*p;o[s]=g<<24|g>>>8,a[s]=g<<16|g>>>16,l[s]=g<<8|g>>>24,c[s]=g,g=16843009*y^65537*f^257*b^16843008*s,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,m[p]=g,s?(s=b^e[e[e[y^b]]],i^=e[e[i]]):s=i=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],b=i.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4,i=4*((this._nRounds=s+6)+1),r=this._keySchedule=[],o=0;o<i;o++)o<s?r[o]=t[o]:(c=r[o-1],o%s?s>6&&o%s==4&&(c=n[c>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c]):(c=n[(c=c<<8|c>>>24)>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c],c^=p[o/s|0]<<24),r[o]=r[o-s]^c);for(var a=this._invKeySchedule=[],l=0;l<i;l++){if(o=i-l,l%4)var c=r[o];else c=r[o-4];a[l]=l<4||o<=4?c:d[n[c>>>24]]^h[n[c>>>16&255]]^u[n[c>>>8&255]]^m[n[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,l,c,n)},decryptBlock:function(e,t){var s=e[t+1];e[t+1]=e[t+3],e[t+3]=s,this._doCryptBlock(e,t,this._invKeySchedule,d,h,u,m,r),s=e[t+1],e[t+1]=e[t+3],e[t+3]=s},_doCryptBlock:function(e,t,s,i,n,r,o,a){for(var l=this._nRounds,c=e[t]^s[0],d=e[t+1]^s[1],h=e[t+2]^s[2],u=e[t+3]^s[3],m=4,p=1;p<l;p++){var b=i[c>>>24]^n[d>>>16&255]^r[h>>>8&255]^o[255&u]^s[m++],f=i[d>>>24]^n[h>>>16&255]^r[u>>>8&255]^o[255&c]^s[m++],y=i[h>>>24]^n[u>>>16&255]^r[c>>>8&255]^o[255&d]^s[m++],g=i[u>>>24]^n[c>>>16&255]^r[d>>>8&255]^o[255&h]^s[m++];c=b,d=f,h=y,u=g}b=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^s[m++],f=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^s[m++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^s[m++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^s[m++],e[t]=b,e[t+1]=f,e[t+2]=y,e[t+3]=g},keySize:8});t.AES=s._createHelper(b)}(),e.AES}(p(),Bi(),pn(),Xn(),wn||(wn=1,Gn.exports=function(e){e.lib.Cipher||function(t){var s=e,i=s.lib,n=i.Base,r=i.WordArray,o=i.BufferedBlockAlgorithm,a=s.enc;a.Utf8;var l=a.Base64,c=s.algo.EvpKDF,d=i.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,s){this.cfg=this.cfg.extend(s),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?Z:y}return function(t){return{encrypt:function(s,i,n){return e(i).encrypt(t,s,i,n)},decrypt:function(s,i,n){return e(i).decrypt(t,s,i,n)}}}}()});i.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=s.mode={},u=i.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),m=h.CBC=function(){var e=u.extend();function s(e,s,i){var n,r=this._iv;r?(n=r,this._iv=t):n=this._prevBlock;for(var o=0;o<i;o++)e[s+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize;s.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),e.Decryptor=e.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize,r=e.slice(t,t+n);i.decryptBlock(e,t),s.call(this,e,t,n),this._prevBlock=r}}),e}(),p=(s.pad={}).Pkcs7={pad:function(e,t){for(var s=4*t,i=s-e.sigBytes%s,n=i<<24|i<<16|i<<8|i,o=[],a=0;a<i;a+=4)o.push(n);var l=r.create(o,i);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};i.BlockCipher=d.extend({cfg:d.cfg.extend({mode:m,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,s=t.iv,i=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,s&&s.words):(this._mode=e.call(i,this,s&&s.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var b=i.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(s.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,s=e.salt;return(s?r.create([1398893684,1701076831]).concat(s).concat(t):t).toString(l)},parse:function(e){var t,s=l.parse(e),i=s.words;return 1398893684==i[0]&&1701076831==i[1]&&(t=r.create(i.slice(2,4)),i.splice(0,4),s.sigBytes-=16),b.create({ciphertext:s,salt:t})}},y=i.SerializableCipher=n.extend({cfg:n.extend({format:f}),encrypt:function(e,t,s,i){i=this.cfg.extend(i);var n=e.createEncryptor(s,i),r=n.finalize(t),o=n.cfg;return b.create({ciphertext:r,key:s,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,s,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(s,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(s.kdf={}).OpenSSL={execute:function(e,t,s,i,n){if(i||(i=r.random(8)),n)o=c.create({keySize:t+s,hasher:n}).compute(e,i);else var o=c.create({keySize:t+s}).compute(e,i);var a=r.create(o.words.slice(t),4*s);return o.sigBytes=4*t,b.create({key:o,iv:a,salt:i})}},Z=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(e,t,s,i){var n=(i=this.cfg.extend(i)).kdf.execute(s,e.keySize,e.ivSize,i.salt,i.hasher);i.iv=n.iv;var r=y.encrypt.call(this,e,t,n.key,i);return r.mixIn(n),r},decrypt:function(e,t,s,i){i=this.cfg.extend(i),t=this._parse(t,i.format);var n=i.kdf.execute(s,e.keySize,e.ivSize,t.salt,i.hasher);return i.iv=n.iv,y.decrypt.call(this,e,t,n.key,i)}})}()}(p(),Xn())))),un.exports),xn=o(Sn),Wn={exports:{}};var Tn=(Ln||(Ln=1,Wn.exports=function(e){return e.HmacSHA256}(p(),w(),an())),Wn.exports),Cn=o(Tn);function kn(e){let t=e.length;for(;--t>=0;)e[t]=0}const Vn=256,In=286,Pn=30,Rn=15,Yn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Mn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Kn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Hn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nn=new Array(576);kn(Nn);const zn=new Array(60);kn(zn);const Fn=new Array(512);kn(Fn);const jn=new Array(256);kn(jn);const _n=new Array(29);kn(_n);const Jn=new Array(Pn);function Un(e,t,s,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}let Qn,En,Dn;function On(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}kn(Jn);const Bn=e=>e<256?Fn[e]:Fn[256+(e>>>7)],$n=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},An=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,$n(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},qn=(e,t,s)=>{An(e,s[2*t],s[2*t+1])},er=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},tr=(e,t,s)=>{const i=new Array(16);let n,r,o=0;for(n=1;n<=Rn;n++)o=o+s[n-1]<<1,i[n]=o;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=er(i[t]++,t))}},sr=e=>{let t;for(t=0;t<In;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Pn;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ir=e=>{e.bi_valid>8?$n(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},nr=(e,t,s,i)=>{const n=2*t,r=2*s;return e[n]<e[r]||e[n]===e[r]&&i[t]<=i[s]},rr=(e,t,s)=>{const i=e.heap[s];let n=s<<1;for(;n<=e.heap_len&&(n<e.heap_len&&nr(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!nr(t,i,e.heap[n],e.depth));)e.heap[s]=e.heap[n],s=n,n<<=1;e.heap[s]=i},or=(e,t,s)=>{let i,n,r,o,a=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+a++],i+=(255&e.pending_buf[e.sym_buf+a++])<<8,n=e.pending_buf[e.sym_buf+a++],0===i?qn(e,n,t):(r=jn[n],qn(e,r+Vn+1,t),o=Yn[r],0!==o&&(n-=_n[r],An(e,n,o)),i--,r=Bn(i),qn(e,r,s),o=Mn[r],0!==o&&(i-=Jn[r],An(e,i,o)))}while(a<e.sym_next);qn(e,256,t)},ar=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,a,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<r;o++)0!==s[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):s[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,s[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=i[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)rr(e,s,o);l=r;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],rr(e,s,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,s[2*l]=s[2*o]+s[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,s[2*o+1]=s[2*a+1]=l,e.heap[1]=l++,rr(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,h,u,m,p,b=0;for(u=0;u<=Rn;u++)e.bl_count[u]=0;for(s[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],u=s[2*s[2*d+1]+1]+1,u>l&&(u=l,b++),s[2*d+1]=u,d>i||(e.bl_count[u]++,m=0,d>=a&&(m=o[d-a]),p=s[2*d],e.opt_len+=p*(u+m),r&&(e.static_len+=p*(n[2*d+1]+m)));if(0!==b){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,b-=2}while(b>0);for(u=l;0!==u;u--)for(d=e.bl_count[u];0!==d;)h=e.heap[--c],h>i||(s[2*h+1]!==u&&(e.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),d--)}})(e,t),tr(s,c,e.bl_count)},lr=(e,t,s)=>{let i,n,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)n=o,o=t[2*(i+1)+1],++a<l&&n===o||(a<c?e.bl_tree[2*n]+=a:0!==n?(n!==r&&e.bl_tree[2*n]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,r=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4))},cr=(e,t,s)=>{let i,n,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=s;i++)if(n=o,o=t[2*(i+1)+1],!(++a<l&&n===o)){if(a<c)do{qn(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==r&&(qn(e,n,e.bl_tree),a--),qn(e,16,e.bl_tree),An(e,a-3,2)):a<=10?(qn(e,17,e.bl_tree),An(e,a-3,3)):(qn(e,18,e.bl_tree),An(e,a-11,7));a=0,r=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4)}};let dr=!1;const hr=(e,t,s,i)=>{An(e,0+(i?1:0),3),ir(e),$n(e,s),$n(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var ur=(e,t,s,i)=>{let n,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Vn;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ar(e,e.l_desc),ar(e,e.d_desc),o=(e=>{let t;for(lr(e,e.dyn_ltree,e.l_desc.max_code),lr(e,e.dyn_dtree,e.d_desc.max_code),ar(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Hn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=n&&(n=r)):n=r=s+5,s+4<=n&&-1!==t?hr(e,t,s,i):4===e.strategy||r===n?(An(e,2+(i?1:0),3),or(e,Nn,zn)):(An(e,4+(i?1:0),3),((e,t,s,i)=>{let n;for(An(e,t-257,5),An(e,s-1,5),An(e,i-4,4),n=0;n<i;n++)An(e,e.bl_tree[2*Hn[n]+1],3);cr(e,e.dyn_ltree,t-1),cr(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),or(e,e.dyn_ltree,e.dyn_dtree)),sr(e),i&&ir(e)},mr={_tr_init:e=>{dr||((()=>{let e,t,s,i,n;const r=new Array(16);for(s=0,i=0;i<28;i++)for(_n[i]=s,e=0;e<1<<Yn[i];e++)jn[s++]=i;for(jn[s-1]=i,n=0,i=0;i<16;i++)for(Jn[i]=n,e=0;e<1<<Mn[i];e++)Fn[n++]=i;for(n>>=7;i<Pn;i++)for(Jn[i]=n<<7,e=0;e<1<<Mn[i]-7;e++)Fn[256+n++]=i;for(t=0;t<=Rn;t++)r[t]=0;for(e=0;e<=143;)Nn[2*e+1]=8,e++,r[8]++;for(;e<=255;)Nn[2*e+1]=9,e++,r[9]++;for(;e<=279;)Nn[2*e+1]=7,e++,r[7]++;for(;e<=287;)Nn[2*e+1]=8,e++,r[8]++;for(tr(Nn,287,r),e=0;e<Pn;e++)zn[2*e+1]=5,zn[2*e]=er(e,5);Qn=new Un(Nn,Yn,257,In,Rn),En=new Un(zn,Mn,0,Pn,Rn),Dn=new Un(new Array(0),Kn,0,19,7)})(),dr=!0),e.l_desc=new On(e.dyn_ltree,Qn),e.d_desc=new On(e.dyn_dtree,En),e.bl_desc=new On(e.bl_tree,Dn),e.bi_buf=0,e.bi_valid=0,sr(e)},_tr_stored_block:hr,_tr_flush_block:ur,_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(jn[s]+Vn+1)]++,e.dyn_dtree[2*Bn(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{An(e,2,3),qn(e,256,Nn),(e=>{16===e.bi_valid?($n(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var pr=(e,t,s,i)=>{let n=65535&e,r=e>>>16&65535,o=0;for(;0!==s;){o=s>2e3?2e3:s,s-=o;do{n=n+t[i++]|0,r=r+n|0}while(--o);n%=65521,r%=65521}return n|r<<16};const br=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var fr=(e,t,s,i)=>{const n=br,r=i+s;e^=-1;for(let s=i;s<r;s++)e=e>>>8^n[255&(e^t[s])];return~e},yr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},gr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Zr,_tr_stored_block:Xr,_tr_flush_block:wr,_tr_tally:Gr,_tr_align:vr}=mr,{Z_NO_FLUSH:Lr,Z_PARTIAL_FLUSH:Sr,Z_FULL_FLUSH:xr,Z_FINISH:Wr,Z_BLOCK:Tr,Z_OK:Cr,Z_STREAM_END:kr,Z_STREAM_ERROR:Vr,Z_DATA_ERROR:Ir,Z_BUF_ERROR:Pr,Z_DEFAULT_COMPRESSION:Rr,Z_FILTERED:Yr,Z_HUFFMAN_ONLY:Mr,Z_RLE:Kr,Z_FIXED:Hr,Z_DEFAULT_STRATEGY:Nr,Z_UNKNOWN:zr,Z_DEFLATED:Fr}=gr,jr=258,_r=262,Jr=42,Ur=113,Qr=666,Er=(e,t)=>(e.msg=yr[t],t),Dr=e=>2*e-(e>4?9:0),Or=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Br=e=>{let t,s,i,n=e.w_size;t=e.hash_size,i=t;do{s=e.head[--i],e.head[i]=s>=n?s-n:0}while(--t);t=n,i=t;do{s=e.prev[--i],e.prev[i]=s>=n?s-n:0}while(--t)};let $r=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const Ar=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},qr=(e,t)=>{wr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ar(e.strm)},eo=(e,t)=>{e.pending_buf[e.pending++]=t},to=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},so=(e,t,s,i)=>{let n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),s),1===e.state.wrap?e.adler=pr(e.adler,t,n,s):2===e.state.wrap&&(e.adler=fr(e.adler,t,n,s)),e.next_in+=n,e.total_in+=n,n)},io=(e,t)=>{let s,i,n=e.max_chain_length,r=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-_r?e.strstart-(e.w_size-_r):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+jr;let m=c[r+o-1],p=c[r+o];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(s=t,c[s+o]===p&&c[s+o-1]===m&&c[s]===c[r]&&c[++s]===c[r+1]){r+=2,s++;do{}while(c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&c[++r]===c[++s]&&r<u);if(i=jr-(u-r),r=u-jr,i>o){if(e.match_start=t,o=i,i>=a)break;m=c[r+o-1],p=c[r+o]}}}while((t=h[t&d])>l&&0!=--n);return o<=e.lookahead?o:e.lookahead},no=e=>{const t=e.w_size;let s,i,n;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-_r)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Br(e),i+=t),0===e.strm.avail_in)break;if(s=so(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=$r(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=$r(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_r&&0!==e.strm.avail_in)},ro=(e,t)=>{let s,i,n,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(s=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n)break;if(n=e.strm.avail_out-n,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>n&&(s=n),s<r&&(0===s&&t!==Wr||t===Lr||s!==i+e.strm.avail_in))break;o=t===Wr&&s===i+e.strm.avail_in?1:0,Xr(e,0,0,o),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Ar(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(so(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Lr&&t!==Wr&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(so(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,r=n>e.w_size?e.w_size:n,i=e.strstart-e.block_start,(i>=r||(i||t===Wr)&&t!==Lr&&0===e.strm.avail_in&&i<=n)&&(s=i>n?n:i,o=t===Wr&&0===e.strm.avail_in&&s===i?1:0,Xr(e,e.block_start,s,o),e.block_start+=s,Ar(e.strm)),o?3:1)},oo=(e,t)=>{let s,i;for(;;){if(e.lookahead<_r){if(no(e),e.lookahead<_r&&t===Lr)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=$r(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-_r&&(e.match_length=io(e,s)),e.match_length>=3)if(i=Gr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=$r(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=$r(e,e.ins_h,e.window[e.strstart+1]);else i=Gr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(qr(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Wr?(qr(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(qr(e,!1),0===e.strm.avail_out)?1:2},ao=(e,t)=>{let s,i,n;for(;;){if(e.lookahead<_r){if(no(e),e.lookahead<_r&&t===Lr)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=$r(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-_r&&(e.match_length=io(e,s),e.match_length<=5&&(e.strategy===Yr||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=Gr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=$r(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(qr(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Gr(e,0,e.window[e.strstart-1]),i&&qr(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Gr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Wr?(qr(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(qr(e,!1),0===e.strm.avail_out)?1:2};function lo(e,t,s,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=n}const co=[new lo(0,0,0,0,ro),new lo(4,4,8,4,oo),new lo(4,5,16,8,oo),new lo(4,6,32,32,oo),new lo(4,4,16,16,ao),new lo(8,16,32,32,ao),new lo(8,16,128,128,ao),new lo(8,32,128,256,ao),new lo(32,128,258,1024,ao),new lo(32,258,258,4096,ao)];function ho(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Fr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Or(this.dyn_ltree),Or(this.dyn_dtree),Or(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Or(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Or(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const uo=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Jr&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Ur&&t.status!==Qr?1:0},mo=e=>{if(uo(e))return Er(e,Vr);e.total_in=e.total_out=0,e.data_type=zr;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Jr:Ur,e.adler=2===t.wrap?0:1,t.last_flush=-2,Zr(t),Cr},po=e=>{const t=mo(e);var s;return t===Cr&&((s=e.state).window_size=2*s.w_size,Or(s.head),s.max_lazy_match=co[s.level].max_lazy,s.good_match=co[s.level].good_length,s.nice_match=co[s.level].nice_length,s.max_chain_length=co[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},bo=(e,t,s,i,n,r)=>{if(!e)return Vr;let o=1;if(t===Rr&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),n<1||n>9||s!==Fr||i<8||i>15||t<0||t>9||r<0||r>Hr||8===i&&1!==o)return Er(e,Vr);8===i&&(i=9);const a=new ho;return e.state=a,a.strm=e,a.status=Jr,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=r,a.method=s,po(e)};var fo=(e,t)=>{if(uo(e)||t>Tr||t<0)return e?Er(e,Vr):Vr;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===Qr&&t!==Wr)return Er(e,0===e.avail_out?Pr:Vr);const i=s.last_flush;if(s.last_flush=t,0!==s.pending){if(Ar(e),0===e.avail_out)return s.last_flush=-1,Cr}else if(0===e.avail_in&&Dr(t)<=Dr(i)&&t!==Wr)return Er(e,Pr);if(s.status===Qr&&0!==e.avail_in)return Er(e,Pr);if(s.status===Jr&&0===s.wrap&&(s.status=Ur),s.status===Jr){let t=Fr+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=Mr||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,to(s,t),0!==s.strstart&&(to(s,e.adler>>>16),to(s,65535&e.adler)),e.adler=1,s.status=Ur,Ar(e),0!==s.pending)return s.last_flush=-1,Cr}if(57===s.status)if(e.adler=0,eo(s,31),eo(s,139),eo(s,8),s.gzhead)eo(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),eo(s,255&s.gzhead.time),eo(s,s.gzhead.time>>8&255),eo(s,s.gzhead.time>>16&255),eo(s,s.gzhead.time>>24&255),eo(s,9===s.level?2:s.strategy>=Mr||s.level<2?4:0),eo(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(eo(s,255&s.gzhead.extra.length),eo(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=fr(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(eo(s,0),eo(s,0),eo(s,0),eo(s,0),eo(s,0),eo(s,9===s.level?2:s.strategy>=Mr||s.level<2?4:0),eo(s,3),s.status=Ur,Ar(e),0!==s.pending)return s.last_flush=-1,Cr;if(69===s.status){if(s.gzhead.extra){let t=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let n=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=fr(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=n,Ar(e),0!==s.pending)return s.last_flush=-1,Cr;t=0,i-=n}let n=new Uint8Array(s.gzhead.extra);s.pending_buf.set(n.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>t&&(e.adler=fr(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=fr(e.adler,s.pending_buf,s.pending-i,i)),Ar(e),0!==s.pending)return s.last_flush=-1,Cr;i=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,eo(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=fr(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=fr(e.adler,s.pending_buf,s.pending-i,i)),Ar(e),0!==s.pending)return s.last_flush=-1,Cr;i=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,eo(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=fr(e.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ar(e),0!==s.pending))return s.last_flush=-1,Cr;eo(s,255&e.adler),eo(s,e.adler>>8&255),e.adler=0}if(s.status=Ur,Ar(e),0!==s.pending)return s.last_flush=-1,Cr}if(0!==e.avail_in||0!==s.lookahead||t!==Lr&&s.status!==Qr){let i=0===s.level?ro(s,t):s.strategy===Mr?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(no(e),0===e.lookahead)){if(t===Lr)return 1;break}if(e.match_length=0,s=Gr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(qr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Wr?(qr(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(qr(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===Kr?((e,t)=>{let s,i,n,r;const o=e.window;for(;;){if(e.lookahead<=jr){if(no(e),e.lookahead<=jr&&t===Lr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,i=o[n],i===o[++n]&&i===o[++n]&&i===o[++n])){r=e.strstart+jr;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<r);e.match_length=jr-(r-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=Gr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=Gr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(qr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Wr?(qr(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(qr(e,!1),0===e.strm.avail_out)?1:2})(s,t):co[s.level].func(s,t);if(3!==i&&4!==i||(s.status=Qr),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),Cr;if(2===i&&(t===Sr?vr(s):t!==Tr&&(Xr(s,0,0,!1),t===xr&&(Or(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),Ar(e),0===e.avail_out))return s.last_flush=-1,Cr}return t!==Wr?Cr:s.wrap<=0?kr:(2===s.wrap?(eo(s,255&e.adler),eo(s,e.adler>>8&255),eo(s,e.adler>>16&255),eo(s,e.adler>>24&255),eo(s,255&e.total_in),eo(s,e.total_in>>8&255),eo(s,e.total_in>>16&255),eo(s,e.total_in>>24&255)):(to(s,e.adler>>>16),to(s,65535&e.adler)),Ar(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Cr:kr)},yo={deflateInit:(e,t)=>bo(e,t,Fr,15,8,Nr),deflateInit2:bo,deflateReset:po,deflateResetKeep:mo,deflateSetHeader:(e,t)=>uo(e)||2!==e.state.wrap?Vr:(e.state.gzhead=t,Cr),deflate:fo,deflateEnd:e=>{if(uo(e))return Vr;const t=e.state.status;return e.state=null,t===Ur?Er(e,Ir):Cr},deflateSetDictionary:(e,t)=>{let s=t.length;if(uo(e))return Vr;const i=e.state,n=i.wrap;if(2===n||1===n&&i.status!==Jr||i.lookahead)return Vr;if(1===n&&(e.adler=pr(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===n&&(Or(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const r=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,no(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=$r(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,no(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=a,e.avail_in=r,i.wrap=n,Cr},deflateInfo:"pako deflate (from Nodeca project)"};const go=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Zo=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)go(s,t)&&(e[t]=s[t])}}return e},Xo=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,i=0,n=e.length;t<n;t++){let n=e[t];s.set(n,i),i+=n.length}return s};let wo=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){wo=!1}const Go=new Uint8Array(256);for(let e=0;e<256;e++)Go[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Go[254]=Go[254]=1;var vo=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,n,r,o=e.length,a=0;for(n=0;n<o;n++)s=e.charCodeAt(n),55296==(64512&s)&&n+1<o&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(a),r=0,n=0;r<a;n++)s=e.charCodeAt(n),55296==(64512&s)&&n+1<o&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),s<128?t[r++]=s:s<2048?(t[r++]=192|s>>>6,t[r++]=128|63&s):s<65536?(t[r++]=224|s>>>12,t[r++]=128|s>>>6&63,t[r++]=128|63&s):(t[r++]=240|s>>>18,t[r++]=128|s>>>12&63,t[r++]=128|s>>>6&63,t[r++]=128|63&s);return t},Lo=(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,n;const r=new Array(2*s);for(n=0,i=0;i<s;){let t=e[i++];if(t<128){r[n++]=t;continue}let o=Go[t];if(o>4)r[n++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<s;)t=t<<6|63&e[i++],o--;o>1?r[n++]=65533:t<65536?r[n++]=t:(t-=65536,r[n++]=55296|t>>10&1023,r[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&wo)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(r,n)},So=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+Go[e[s]]>t?s:t};var xo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Wo=Object.prototype.toString,{Z_NO_FLUSH:To,Z_SYNC_FLUSH:Co,Z_FULL_FLUSH:ko,Z_FINISH:Vo,Z_OK:Io,Z_STREAM_END:Po,Z_DEFAULT_COMPRESSION:Ro,Z_DEFAULT_STRATEGY:Yo,Z_DEFLATED:Mo}=gr;function Ko(e){this.options=Zo({level:Ro,method:Mo,chunkSize:16384,windowBits:15,memLevel:8,strategy:Yo},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xo,this.strm.avail_out=0;let s=yo.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Io)throw new Error(yr[s]);if(t.header&&yo.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?vo(t.dictionary):"[object ArrayBuffer]"===Wo.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=yo.deflateSetDictionary(this.strm,e),s!==Io)throw new Error(yr[s]);this._dict_set=!0}}function Ho(e,t){const s=new Ko(t);if(s.push(e,!0),s.err)throw s.msg||yr[s.err];return s.result}Ko.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let n,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Vo:To,"string"==typeof e?s.input=vo(e):"[object ArrayBuffer]"===Wo.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(r===Co||r===ko)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(n=yo.deflate(s,r),n===Po)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),n=yo.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Io;if(0!==s.avail_out){if(r>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Ko.prototype.onData=function(e){this.chunks.push(e)},Ko.prototype.onEnd=function(e){e===Io&&(this.result=Xo(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var No={Deflate:Ko,deflate:Ho,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ho(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ho(e,t)}};const zo=16209;var Fo=function(e,t){let s,i,n,r,o,a,l,c,d,h,u,m,p,b,f,y,g,Z,X,w,G,v,L,S;const x=e.state;s=e.next_in,L=e.input,i=s+(e.avail_in-5),n=e.next_out,S=e.output,r=n-(t-e.avail_out),o=n+(e.avail_out-257),a=x.dmax,l=x.wsize,c=x.whave,d=x.wnext,h=x.window,u=x.hold,m=x.bits,p=x.lencode,b=x.distcode,f=(1<<x.lenbits)-1,y=(1<<x.distbits)-1;e:do{m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=p[u&f];t:for(;;){if(Z=g>>>24,u>>>=Z,m-=Z,Z=g>>>16&255,0===Z)S[n++]=65535&g;else{if(!(16&Z)){if(64&Z){if(32&Z){x.mode=16191;break e}e.msg="invalid literal/length code",x.mode=zo;break e}g=p[(65535&g)+(u&(1<<Z)-1)];continue t}for(X=65535&g,Z&=15,Z&&(m<Z&&(u+=L[s++]<<m,m+=8),X+=u&(1<<Z)-1,u>>>=Z,m-=Z),m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=b[u&y];;){if(Z=g>>>24,u>>>=Z,m-=Z,Z=g>>>16&255,16&Z){if(w=65535&g,Z&=15,m<Z&&(u+=L[s++]<<m,m+=8,m<Z&&(u+=L[s++]<<m,m+=8)),w+=u&(1<<Z)-1,w>a){e.msg="invalid distance too far back",x.mode=zo;break e}if(u>>>=Z,m-=Z,Z=n-r,w>Z){if(Z=w-Z,Z>c&&x.sane){e.msg="invalid distance too far back",x.mode=zo;break e}if(G=0,v=h,0===d){if(G+=l-Z,Z<X){X-=Z;do{S[n++]=h[G++]}while(--Z);G=n-w,v=S}}else if(d<Z){if(G+=l+d-Z,Z-=d,Z<X){X-=Z;do{S[n++]=h[G++]}while(--Z);if(G=0,d<X){Z=d,X-=Z;do{S[n++]=h[G++]}while(--Z);G=n-w,v=S}}}else if(G+=d-Z,Z<X){X-=Z;do{S[n++]=h[G++]}while(--Z);G=n-w,v=S}for(;X>2;)S[n++]=v[G++],S[n++]=v[G++],S[n++]=v[G++],X-=3;X&&(S[n++]=v[G++],X>1&&(S[n++]=v[G++]))}else{G=n-w;do{S[n++]=S[G++],S[n++]=S[G++],S[n++]=S[G++],X-=3}while(X>2);X&&(S[n++]=S[G++],X>1&&(S[n++]=S[G++]))}break}if(64&Z){e.msg="invalid distance code",x.mode=zo;break e}g=b[(65535&g)+(u&(1<<Z)-1)]}}break}}while(s<i&&n<o);X=m>>3,s-=X,m-=X<<3,u&=(1<<m)-1,e.next_in=s,e.next_out=n,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=n<o?o-n+257:257-(n-o),x.hold=u,x.bits=m};const jo=15,_o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Jo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Uo=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Qo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Eo=(e,t,s,i,n,r,o,a)=>{const l=a.bits;let c,d,h,u,m,p,b=0,f=0,y=0,g=0,Z=0,X=0,w=0,G=0,v=0,L=0,S=null;const x=new Uint16Array(16),W=new Uint16Array(16);let T,C,k,V=null;for(b=0;b<=jo;b++)x[b]=0;for(f=0;f<i;f++)x[t[s+f]]++;for(Z=l,g=jo;g>=1&&0===x[g];g--);if(Z>g&&(Z=g),0===g)return n[r++]=20971520,n[r++]=20971520,a.bits=1,0;for(y=1;y<g&&0===x[y];y++);for(Z<y&&(Z=y),G=1,b=1;b<=jo;b++)if(G<<=1,G-=x[b],G<0)return-1;if(G>0&&(0===e||1!==g))return-1;for(W[1]=0,b=1;b<jo;b++)W[b+1]=W[b]+x[b];for(f=0;f<i;f++)0!==t[s+f]&&(o[W[t[s+f]]++]=f);if(0===e?(S=V=o,p=20):1===e?(S=_o,V=Jo,p=257):(S=Uo,V=Qo,p=0),L=0,f=0,b=y,m=r,X=Z,w=0,h=-1,v=1<<Z,u=v-1,1===e&&v>852||2===e&&v>592)return 1;for(;;){T=b-w,o[f]+1<p?(C=0,k=o[f]):o[f]>=p?(C=V[o[f]-p],k=S[o[f]-p]):(C=96,k=0),c=1<<b-w,d=1<<X,y=d;do{d-=c,n[m+(L>>w)+d]=T<<24|C<<16|k}while(0!==d);for(c=1<<b-1;L&c;)c>>=1;if(0!==c?(L&=c-1,L+=c):L=0,f++,0==--x[b]){if(b===g)break;b=t[s+o[f]]}if(b>Z&&(L&u)!==h){for(0===w&&(w=Z),m+=y,X=b-w,G=1<<X;X+w<g&&(G-=x[X+w],!(G<=0));)X++,G<<=1;if(v+=1<<X,1===e&&v>852||2===e&&v>592)return 1;h=L&u,n[h]=Z<<24|X<<16|m-r}}return 0!==L&&(n[m+L]=b-w<<24|64<<16),a.bits=Z,0};const{Z_FINISH:Do,Z_BLOCK:Oo,Z_TREES:Bo,Z_OK:$o,Z_STREAM_END:Ao,Z_NEED_DICT:qo,Z_STREAM_ERROR:ea,Z_DATA_ERROR:ta,Z_MEM_ERROR:sa,Z_BUF_ERROR:ia,Z_DEFLATED:na}=gr,ra=16180,oa=16190,aa=16191,la=16192,ca=16194,da=16199,ha=16200,ua=16206,ma=16209,pa=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ba(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const fa=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ra||t.mode>16211?1:0},ya=e=>{if(fa(e))return ea;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ra,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,$o},ga=e=>{if(fa(e))return ea;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ya(e)},Za=(e,t)=>{let s;if(fa(e))return ea;const i=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ea:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,ga(e))},Xa=(e,t)=>{if(!e)return ea;const s=new ba;e.state=s,s.strm=e,s.window=null,s.mode=ra;const i=Za(e,t);return i!==$o&&(e.state=null),i};let wa,Ga,va=!0;const La=e=>{if(va){wa=new Int32Array(512),Ga=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Eo(1,e.lens,0,288,wa,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Eo(2,e.lens,0,32,Ga,0,e.work,{bits:5}),va=!1}e.lencode=wa,e.lenbits=9,e.distcode=Ga,e.distbits=5},Sa=(e,t,s,i)=>{let n;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(s-r.wsize,s),0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>i&&(n=i),r.window.set(t.subarray(s-i,s-i+n),r.wnext),(i-=n)?(r.window.set(t.subarray(s-i,s),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0};var xa=(e,t)=>{let s,i,n,r,o,a,l,c,d,h,u,m,p,b,f,y,g,Z,X,w,G,v,L=0;const S=new Uint8Array(4);let x,W;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(fa(e)||!e.output||!e.input&&0!==e.avail_in)return ea;s=e.state,s.mode===aa&&(s.mode=la),o=e.next_out,n=e.output,l=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=s.hold,d=s.bits,h=a,u=l,v=$o;e:for(;;)switch(s.mode){case ra:if(0===s.wrap){s.mode=la;break}for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&c,S[1]=c>>>8&255,s.check=fr(s.check,S,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=ma;break}if((15&c)!==na){e.msg="unknown compression method",s.mode=ma;break}if(c>>>=4,d-=4,G=8+(15&c),0===s.wbits&&(s.wbits=G),G>15||G>s.wbits){e.msg="invalid window size",s.mode=ma;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:aa,c=0,d=0;break;case 16181:for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==na){e.msg="unknown compression method",s.mode=ma;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=ma;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=fr(s.check,S,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,s.check=fr(s.check,S,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=fr(s.check,S,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=fr(s.check,S,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(m=s.length,m>a&&(m=a),m&&(s.head&&(G=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(r,r+m),G)),512&s.flags&&4&s.wrap&&(s.check=fr(s.check,i,m,r)),a-=m,r+=m,s.length-=m),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break e;m=0;do{G=i[r+m++],s.head&&G&&s.length<65536&&(s.head.name+=String.fromCharCode(G))}while(G&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=fr(s.check,i,m,r)),a-=m,r+=m,G)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break e;m=0;do{G=i[r+m++],s.head&&G&&s.length<65536&&(s.head.comment+=String.fromCharCode(G))}while(G&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=fr(s.check,i,m,r)),a-=m,r+=m,G)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=ma;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=aa;break;case 16189:for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}e.adler=s.check=pa(c),c=0,d=0,s.mode=oa;case oa:if(0===s.havedict)return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=d,qo;e.adler=s.check=1,s.mode=aa;case aa:if(t===Oo||t===Bo)break e;case la:if(s.last){c>>>=7&d,d-=7&d,s.mode=ua;break}for(;d<3;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(La(s),s.mode=da,t===Bo){c>>>=2,d-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=ma}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=ma;break}if(s.length=65535&c,c=0,d=0,s.mode=ca,t===Bo)break e;case ca:s.mode=16195;case 16195:if(m=s.length,m){if(m>a&&(m=a),m>l&&(m=l),0===m)break e;n.set(i.subarray(r,r+m),o),a-=m,r+=m,l-=m,o+=m,s.length-=m;break}s.mode=aa;break;case 16196:for(;d<14;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=ma;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.lens[T[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,x={bits:s.lenbits},v=Eo(0,s.lens,0,19,s.lencode,0,s.work,x),s.lenbits=x.bits,v){e.msg="invalid code lengths set",s.mode=ma;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;L=s.lencode[c&(1<<s.lenbits)-1],f=L>>>24,y=L>>>16&255,g=65535&L,!(f<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(g<16)c>>>=f,d-=f,s.lens[s.have++]=g;else{if(16===g){for(W=f+2;d<W;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(c>>>=f,d-=f,0===s.have){e.msg="invalid bit length repeat",s.mode=ma;break}G=s.lens[s.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===g){for(W=f+3;d<W;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=f,d-=f,G=0,m=3+(7&c),c>>>=3,d-=3}else{for(W=f+7;d<W;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=f,d-=f,G=0,m=11+(127&c),c>>>=7,d-=7}if(s.have+m>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=ma;break}for(;m--;)s.lens[s.have++]=G}}if(s.mode===ma)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=ma;break}if(s.lenbits=9,x={bits:s.lenbits},v=Eo(1,s.lens,0,s.nlen,s.lencode,0,s.work,x),s.lenbits=x.bits,v){e.msg="invalid literal/lengths set",s.mode=ma;break}if(s.distbits=6,s.distcode=s.distdyn,x={bits:s.distbits},v=Eo(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,x),s.distbits=x.bits,v){e.msg="invalid distances set",s.mode=ma;break}if(s.mode=da,t===Bo)break e;case da:s.mode=ha;case ha:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=d,Fo(e,u),o=e.next_out,n=e.output,l=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=s.hold,d=s.bits,s.mode===aa&&(s.back=-1);break}for(s.back=0;L=s.lencode[c&(1<<s.lenbits)-1],f=L>>>24,y=L>>>16&255,g=65535&L,!(f<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(y&&!(240&y)){for(Z=f,X=y,w=g;L=s.lencode[w+((c&(1<<Z+X)-1)>>Z)],f=L>>>24,y=L>>>16&255,g=65535&L,!(Z+f<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=Z,d-=Z,s.back+=Z}if(c>>>=f,d-=f,s.back+=f,s.length=g,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=aa;break}if(64&y){e.msg="invalid literal/length code",s.mode=ma;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(W=s.extra;d<W;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;L=s.distcode[c&(1<<s.distbits)-1],f=L>>>24,y=L>>>16&255,g=65535&L,!(f<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(!(240&y)){for(Z=f,X=y,w=g;L=s.distcode[w+((c&(1<<Z+X)-1)>>Z)],f=L>>>24,y=L>>>16&255,g=65535&L,!(Z+f<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=Z,d-=Z,s.back+=Z}if(c>>>=f,d-=f,s.back+=f,64&y){e.msg="invalid distance code",s.mode=ma;break}s.offset=g,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(W=s.extra;d<W;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=ma;break}s.mode=16204;case 16204:if(0===l)break e;if(m=u-l,s.offset>m){if(m=s.offset-m,m>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=ma;break}m>s.wnext?(m-=s.wnext,p=s.wsize-m):p=s.wnext-m,m>s.length&&(m=s.length),b=s.window}else b=n,p=o-s.offset,m=s.length;m>l&&(m=l),l-=m,s.length-=m;do{n[o++]=b[p++]}while(--m);0===s.length&&(s.mode=ha);break;case 16205:if(0===l)break e;n[o++]=s.length,l--,s.mode=ha;break;case ua:if(s.wrap){for(;d<32;){if(0===a)break e;a--,c|=i[r++]<<d,d+=8}if(u-=l,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?fr(s.check,n,u,o-u):pr(s.check,n,u,o-u)),u=l,4&s.wrap&&(s.flags?c:pa(c))!==s.check){e.msg="incorrect data check",s.mode=ma;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=ma;break}c=0,d=0}s.mode=16208;case 16208:v=Ao;break e;case ma:v=ta;break e;case 16210:return sa;default:return ea}return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=d,(s.wsize||u!==e.avail_out&&s.mode<ma&&(s.mode<ua||t!==Do))&&Sa(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?fr(s.check,n,u,e.next_out-u):pr(s.check,n,u,e.next_out-u)),e.data_type=s.bits+(s.last?64:0)+(s.mode===aa?128:0)+(s.mode===da||s.mode===ca?256:0),(0===h&&0===u||t===Do)&&v===$o&&(v=ia),v},Wa={inflateReset:ga,inflateReset2:Za,inflateResetKeep:ya,inflateInit:e=>Xa(e,15),inflateInit2:Xa,inflate:xa,inflateEnd:e=>{if(fa(e))return ea;let t=e.state;return t.window&&(t.window=null),e.state=null,$o},inflateGetHeader:(e,t)=>{if(fa(e))return ea;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,$o):ea},inflateSetDictionary:(e,t)=>{const s=t.length;let i,n,r;return fa(e)?ea:(i=e.state,0!==i.wrap&&i.mode!==oa?ea:i.mode===oa&&(n=1,n=pr(n,t,s,0),n!==i.check)?ta:(r=Sa(e,t,s,s),r?(i.mode=16210,sa):(i.havedict=1,$o)))},inflateInfo:"pako inflate (from Nodeca project)"};var Ta=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ca=Object.prototype.toString,{Z_NO_FLUSH:ka,Z_FINISH:Va,Z_OK:Ia,Z_STREAM_END:Pa,Z_NEED_DICT:Ra,Z_STREAM_ERROR:Ya,Z_DATA_ERROR:Ma,Z_MEM_ERROR:Ka}=gr;function Ha(e){this.options=Zo({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xo,this.strm.avail_out=0;let s=Wa.inflateInit2(this.strm,t.windowBits);if(s!==Ia)throw new Error(yr[s]);if(this.header=new Ta,Wa.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=vo(t.dictionary):"[object ArrayBuffer]"===Ca.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Wa.inflateSetDictionary(this.strm,t.dictionary),s!==Ia)))throw new Error(yr[s])}function Na(e,t){const s=new Ha(t);if(s.push(e),s.err)throw s.msg||yr[s.err];return s.result}Ha.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Va:ka,"[object ArrayBuffer]"===Ca.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),r=Wa.inflate(s,o),r===Ra&&n&&(r=Wa.inflateSetDictionary(s,n),r===Ia?r=Wa.inflate(s,o):r===Ma&&(r=Ra));s.avail_in>0&&r===Pa&&s.state.wrap>0&&0!==e[s.next_in];)Wa.inflateReset(s),r=Wa.inflate(s,o);switch(r){case Ya:case Ma:case Ra:case Ka:return this.onEnd(r),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||r===Pa))if("string"===this.options.to){let e=So(s.output,s.next_out),t=s.next_out-e,n=Lo(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(n)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(r!==Ia||0!==a){if(r===Pa)return r=Wa.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Ha.prototype.onData=function(e){this.chunks.push(e)},Ha.prototype.onEnd=function(e){e===Ia&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Xo(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var za={Inflate:Ha,inflate:Na,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Na(e,t)},ungzip:Na};const{Deflate:Fa,deflate:ja,deflateRaw:_a,gzip:Ja}=No,{Inflate:Ua,inflate:Qa,inflateRaw:Ea,ungzip:Da}=za;var Oa={Deflate:Fa,deflate:ja,deflateRaw:_a,gzip:Ja,Inflate:Ua,inflate:Qa,inflateRaw:Ea,ungzip:Da,constants:gr};class Ba{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout((()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()}),50),this.start=Date.now()}send(e){const{id:t,action:s,args:i}=JSON.parse(e);switch(s){case"JOIN":return this.id=t,this.ticks=i.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:i.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[i.user],active:1,total:1}]),void this.tick();case"SEND":{const e=[...i];return e[0]=this.time,e[1]=++this.seq,void this.reply("RECV",e)}case"PULSE":return;default:throw Error("Offline unhandled "+s)}}close(e,t){this.readyState=WebSocket.CLOSING,setTimeout((()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:e,reason:t})}),50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval((()=>{this.reply("TICK",{time:this.time})}),this.ticks)}reply(e,t){setTimeout((()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:e,args:t})})}),50)}}let $a={get connection(){return $a={connection:d.has("debug","connection",!1)},$a.connection}};class Aa{static get name(){return`${K.libName}WebRTCConnection`}constructor(e){var t;this.clientId=(t=4,Math.random().toString(36).substring(2,2+t)),$a.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(e)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(e){try{globalThis.loadingDataChannel||(globalThis.loadingDataChannel=new Promise((e=>{import("node-datachannel/polyfill").then((e=>(globalThis.RTCPeerConnection=e.RTCPeerConnection,import("node-datachannel")))).then((t=>{t.initLogger("Warning"),t.preload(),e()}))}))),await globalThis.loadingDataChannel,await this.openSignalingChannel(e),$a.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),$a.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),$a.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=e=>this.onDataChannelOpen(e),this.dataChannel.onmessage=e=>this.onDataChannelMessage(e),this.dataChannel.onclosing=e=>this.onDataChannelClosing(e),this.dataChannel.onclose=e=>this.onDataChannelClose(e),this.dataChannel.onerror=e=>this.onDataChannelError(e);const t=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN)return;if(this.negotiationTimeout=setTimeout((()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||($a.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")}),15e3),this.signalToSessionRunner({type:"offer",sdp:t.sdp}),await this.pc.setLocalDescription(t),!this.pc.sctp)return;const s=this.pc.sctp.transport.iceTransport;s.onselectedcandidatepairchange=e=>{$a.connection&&console.log(`${this.clientId} ICE candidate pair changed`);const t=s.getSelectedCandidatePair();this.connectionTypes.local=t.local.type,this.connectionTypes.remote=t.remote.type,this.logConnectionState()}}catch(e){this.synchronizerDisconnected(e.code||4003,e.message)}}openSignalingChannel(e){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise((t=>{this.signaling=new WebSocket(e),this.signaling.onopen=()=>{$a.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=e=>{const s=JSON.parse(e.data);if("READY"===s.what)return this.clientId+=`_${s.id}`,this.iceServers=s.iceServers,void t();if("ERROR"!==s.what)if(s.type)switch($a.connection&&console.log(`${this.clientId} received signal of type "${s.type}"`),s.type){case"answer":this.handleAnswer(s);break;case"candidate":this.handleCandidate(s);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:$a.connection&&console.log(`${this.clientId} unhandled: ${s.type}`)}else console.error(`${this.clientId} unexpected message: ${e.data}`);else console.error(`${this.clientId} registry error: ${s.reason}`)},this.signaling.onclose=e=>{$a.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${e.code})`),this.synchronizerDisconnected(e.code,e.reason)},this.signaling.onerror=e=>{$a.connection&&console.log(`${this.clientId} signaling socket error`,e),this.synchronizerError()}})))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(e){const t=JSON.stringify(e);try{this.signaling.send(t)}catch(e){console.error(`${this.clientId} WebRTC signaling send error`,e)}}async logConnectionState(){if(this.pc)try{const e=await this.pc.getStats();if(e){let t=null;for(const s of e.values())if("transport"===s.type){t=s.selectedCandidatePairId;break}let s=e.get(t);if(!s)for(const t of e.values())if("candidate-pair"===t.type&&t.selected){s=t;break}s&&(this.connectionTypes.local=e.get(s.localCandidateId).candidateType,this.connectionTypes.remote=e.get(s.remoteCandidateId).candidateType)}}catch(e){}const e=this.connectionTypes.local||"",t=this.connectionTypes.remote||"";if($a.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${e}"; synchronizer connection="${t}")`),this.signaling?.readyState===WebSocket.OPEN){const s={type:"selectedCandidatePair",clientType:e,syncType:t};this.signalToSessionRunner(s)}}close(e,t){this.cleanUpConnection()}synchronizerDisconnected(e=1006,t="connection to synchronizer lost"){this.synchronizerCloseReason&&(e=this.synchronizerCloseReason[0],t=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:e,reason:t})}synchronizerError(e){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,e)}cleanUpConnection(){this.closeSignalingChannel();const{pc:e}=this;e&&(this.pc=null,e.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){const{iceServers:e}=this,t=new Set,s=this.pc=new globalThis.RTCPeerConnection({iceServers:e});s.onnegotiationneeded=e=>{s===this.pc&&$a.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},s.onsignalingstatechange=e=>{s===this.pc&&$a.connection&&console.log(`${this.clientId} signaling state: "${s.signalingState}"`)},s.onconnectionstatechange=e=>{if(s!==this.pc)return;const{connectionState:t,iceConnectionState:i}=s;$a.connection&&console.log(`${this.clientId} connection state: "${t}" (cf. ICE connection state: "${i}")`),"disconnected"!==t&&"failed"!==t||this.synchronizerDisconnected()},s.oniceconnectionstatechange=e=>{if(s!==this.pc)return;const t=s.iceConnectionState,i=this.dataChannel.readyState;$a.connection&&console.log(`${this.clientId} ICE connection state: "${t}"; data channel: "${i}"`),"failed"===t&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},s.onicegatheringstatechange=e=>{if(s!==this.pc)return;const t=s.iceGatheringState;$a.connection&&console.log(`${this.clientId} ICE gathering state: "${t}"`),"complete"===t&&(this.localGatheringComplete=!0)},s.onicecandidate=e=>{if(s===this.pc)if(e.candidate){if(this.signaling?.readyState===WebSocket.OPEN){const t={type:"candidate",candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.signalToSessionRunner(t)}}else this.localGatheringComplete=!0},s.onicecandidateerror=e=>{if(s===this.pc&&$a.connection){const s=`${e.errorCode}|${e.url}`;t.has(s)||(701===e.errorCode?console.log(`${this.clientId} ICE 701 warning on ${e.url}`):console.log(`${this.clientId} ICE error from ${e.url}: ${e.errorCode} ${e.errorText}`),t.add(s))}}}async handleAnswer(e){this.pc?await this.pc.setRemoteDescription(e):console.error("no peerconnection")}async handleCandidate(e){this.pc?e.candidate?await this.pc.addIceCandidate(e):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(e){this.dataChannel?this.dataChannel.send(e):console.warn(`${this.clientId} no data channel to send: ${e}`)}onDataChannelOpen(e){$a.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(e){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());const t=e.data;if(t.startsWith("!ping"))this.send(t.replace("ping","pong"));else if(t.startsWith("!close")){const e=t.split("|");this.synchronizerCloseReason=[Number(e[1]),e[2]]}else this.onmessage(e)}onDataChannelError(e){console.error(`${this.clientId} RTCDataChannel error`,e),this.synchronizerError(e.errorDetail)}onDataChannelClosing(e){this.pc&&($a.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(e){this.pc&&($a.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,$a.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);const{signalingKey:e}=this;setTimeout((()=>{e===this.signalingKey&&($a.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())}),1e3)}async defunct_readConnectionType(){const e=await this.pc.getStats();if(e){let t=null;for(const[s,i]of e)if("transport"===i.type){t=i.selectedCandidatePairId;break}let s=e.get(t);if(!s)for(const[t,i]of e)if("candidate-pair"===i.type&&i.selected){s=i;break}if(s)for(const[t,i]of e)if(t===s.remoteCandidateId)return i.candidateType}return""}}var qa=null;try{var el="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");qa=el.Worker}catch(e){}function tl(e,t,s){var i=function(e){return Buffer.from(e,"base64").toString("utf8")}(e),n=i.indexOf("\n",10)+1,r=i.substring(n)+"";return function(e){return new qa(r,Object.assign({},e,{eval:!0}))}}var sl=tl("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI1CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjUtMDYtMDkKICogVmVyc2lvbjogMi4wLjQKICovCgohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiBlKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJkZWZhdWx0Iik/dC5kZWZhdWx0OnR9dmFyIHIsbj17ZXhwb3J0czp7fX07cnx8KHI9MSxmdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbih0KXt2YXIgZSxyPU9iamVjdC5wcm90b3R5cGUsbj1yLmhhc093blByb3BlcnR5LGk9T2JqZWN0LmRlZmluZVByb3BlcnR5fHxmdW5jdGlvbih0LGUscil7dFtlXT1yLnZhbHVlfSxhPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2w/U3ltYm9sOnt9LHM9YS5pdGVyYXRvcnx8IkBAaXRlcmF0b3IiLG89YS5hc3luY0l0ZXJhdG9yfHwiQEBhc3luY0l0ZXJhdG9yIixsPWEudG9TdHJpbmdUYWd8fCJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBoKHQsZSxyKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pLHRbZV19dHJ5e2goe30sIiIpfWNhdGNoKHQpe2g9ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXJ9fWZ1bmN0aW9uIGModCxlLHIsbil7dmFyIGE9ZSYmZS5wcm90b3R5cGUgaW5zdGFuY2VvZiB5P2U6eSxzPU9iamVjdC5jcmVhdGUoYS5wcm90b3R5cGUpLG89bmV3IFIobnx8W10pO3JldHVybiBpKHMsIl9pbnZva2UiLHt2YWx1ZTpFKHQscixvKX0pLHN9ZnVuY3Rpb24gdSh0LGUscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzp0LmNhbGwoZSxyKX19Y2F0Y2godCl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6dH19fXQud3JhcD1jO3ZhciBfPSJzdXNwZW5kZWRTdGFydCIsZD0ic3VzcGVuZGVkWWllbGQiLGY9ImV4ZWN1dGluZyIscD0iY29tcGxldGVkIixnPXt9O2Z1bmN0aW9uIHkoKXt9ZnVuY3Rpb24gdygpe31mdW5jdGlvbiB2KCl7fXZhciBtPXt9O2gobSxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBiPU9iamVjdC5nZXRQcm90b3R5cGVPZix4PWImJmIoYihEKFtdKSkpO3gmJnghPT1yJiZuLmNhbGwoeCxzKSYmKG09eCk7dmFyIGs9di5wcm90b3R5cGU9eS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShtKTtmdW5jdGlvbiB6KHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aCh0LGUsKGZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9pbnZva2UoZSx0KX0pKX0pKX1mdW5jdGlvbiBBKHQsZSl7ZnVuY3Rpb24gcihpLGEscyxvKXt2YXIgbD11KHRbaV0sdCxhKTtpZigidGhyb3ciIT09bC50eXBlKXt2YXIgaD1sLmFyZyxjPWgudmFsdWU7cmV0dXJuIGMmJiJvYmplY3QiPT10eXBlb2YgYyYmbi5jYWxsKGMsIl9fYXdhaXQiKT9lLnJlc29sdmUoYy5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtyKCJuZXh0Iix0LHMsbyl9KSwoZnVuY3Rpb24odCl7cigidGhyb3ciLHQscyxvKX0pKTplLnJlc29sdmUoYykudGhlbigoZnVuY3Rpb24odCl7aC52YWx1ZT10LHMoaCl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIHIoInRocm93Iix0LHMsbyl9KSl9byhsLmFyZyl9dmFyIGE7aSh0aGlzLCJfaW52b2tlIix7dmFsdWU6ZnVuY3Rpb24odCxuKXtmdW5jdGlvbiBpKCl7cmV0dXJuIG5ldyBlKChmdW5jdGlvbihlLGkpe3IodCxuLGUsaSl9KSl9cmV0dXJuIGE9YT9hLnRoZW4oaSxpKTppKCl9fSl9ZnVuY3Rpb24gRSh0LHIsbil7dmFyIGk9XztyZXR1cm4gZnVuY3Rpb24oYSxzKXtpZihpPT09Zil0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZihpPT09cCl7aWYoInRocm93Ij09PWEpdGhyb3cgcztyZXR1cm57dmFsdWU6ZSxkb25lOiEwfX1mb3Iobi5tZXRob2Q9YSxuLmFyZz1zOzspe3ZhciBvPW4uZGVsZWdhdGU7aWYobyl7dmFyIGw9UyhvLG4pO2lmKGwpe2lmKGw9PT1nKWNvbnRpbnVlO3JldHVybiBsfX1pZigibmV4dCI9PT1uLm1ldGhvZCluLnNlbnQ9bi5fc2VudD1uLmFyZztlbHNlIGlmKCJ0aHJvdyI9PT1uLm1ldGhvZCl7aWYoaT09PV8pdGhyb3cgaT1wLG4uYXJnO24uZGlzcGF0Y2hFeGNlcHRpb24obi5hcmcpfWVsc2UicmV0dXJuIj09PW4ubWV0aG9kJiZuLmFicnVwdCgicmV0dXJuIixuLmFyZyk7aT1mO3ZhciBoPXUodCxyLG4pO2lmKCJub3JtYWwiPT09aC50eXBlKXtpZihpPW4uZG9uZT9wOmQsaC5hcmc9PT1nKWNvbnRpbnVlO3JldHVybnt2YWx1ZTpoLmFyZyxkb25lOm4uZG9uZX19InRocm93Ij09PWgudHlwZSYmKGk9cCxuLm1ldGhvZD0idGhyb3ciLG4uYXJnPWguYXJnKX19fWZ1bmN0aW9uIFModCxyKXt2YXIgbj1yLm1ldGhvZCxpPXQuaXRlcmF0b3Jbbl07aWYoaT09PWUpcmV0dXJuIHIuZGVsZWdhdGU9bnVsbCwidGhyb3ciPT09biYmdC5pdGVyYXRvci5yZXR1cm4mJihyLm1ldGhvZD0icmV0dXJuIixyLmFyZz1lLFModCxyKSwidGhyb3ciPT09ci5tZXRob2QpfHwicmV0dXJuIiE9PW4mJihyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIrbisiJyBtZXRob2QiKSksZzt2YXIgYT11KGksdC5pdGVyYXRvcixyLmFyZyk7aWYoInRocm93Ij09PWEudHlwZSlyZXR1cm4gci5tZXRob2Q9InRocm93IixyLmFyZz1hLmFyZyxyLmRlbGVnYXRlPW51bGwsZzt2YXIgcz1hLmFyZztyZXR1cm4gcz9zLmRvbmU/KHJbdC5yZXN1bHROYW1lXT1zLnZhbHVlLHIubmV4dD10Lm5leHRMb2MsInJldHVybiIhPT1yLm1ldGhvZCYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSxyLmRlbGVnYXRlPW51bGwsZyk6czooci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLHIuZGVsZWdhdGU9bnVsbCxnKX1mdW5jdGlvbiBCKHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIE8odCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIFIodCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaChCLHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIEQodCl7aWYobnVsbCE9dCl7dmFyIHI9dFtzXTtpZihyKXJldHVybiByLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgaT0tMSxhPWZ1bmN0aW9uIHIoKXtmb3IoOysraTx0Lmxlbmd0aDspaWYobi5jYWxsKHQsaSkpcmV0dXJuIHIudmFsdWU9dFtpXSxyLmRvbmU9ITEscjtyZXR1cm4gci52YWx1ZT1lLHIuZG9uZT0hMCxyfTtyZXR1cm4gYS5uZXh0PWF9fXRocm93IG5ldyBUeXBlRXJyb3IodHlwZW9mIHQrIiBpcyBub3QgaXRlcmFibGUiKX1yZXR1cm4gdy5wcm90b3R5cGU9dixpKGssImNvbnN0cnVjdG9yIix7dmFsdWU6dixjb25maWd1cmFibGU6ITB9KSxpKHYsImNvbnN0cnVjdG9yIix7dmFsdWU6dyxjb25maWd1cmFibGU6ITB9KSx3LmRpc3BsYXlOYW1lPWgodixsLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgdCYmdC5jb25zdHJ1Y3RvcjtyZXR1cm4hIWUmJihlPT09d3x8IkdlbmVyYXRvckZ1bmN0aW9uIj09PShlLmRpc3BsYXlOYW1lfHxlLm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsdik6KHQuX19wcm90b19fPXYsaCh0LGwsIkdlbmVyYXRvckZ1bmN0aW9uIikpLHQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoayksdH0sdC5hd3JhcD1mdW5jdGlvbih0KXtyZXR1cm57X19hd2FpdDp0fX0seihBLnByb3RvdHlwZSksaChBLnByb3RvdHlwZSxvLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj1BLHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4saSxhKXt2b2lkIDA9PT1hJiYoYT1Qcm9taXNlKTt2YXIgcz1uZXcgQShjKGUscixuLGkpLGEpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/czpzLm5leHQoKS50aGVuKChmdW5jdGlvbih0KXtyZXR1cm4gdC5kb25lP3QudmFsdWU6cy5uZXh0KCl9KSl9LHooayksaChrLGwsIkdlbmVyYXRvciIpLGgoayxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGgoaywidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbih0KXt2YXIgZT1PYmplY3QodCkscj1bXTtmb3IodmFyIG4gaW4gZSlyLnB1c2gobik7cmV0dXJuIHIucmV2ZXJzZSgpLGZ1bmN0aW9uIHQoKXtmb3IoO3IubGVuZ3RoOyl7dmFyIG49ci5wb3AoKTtpZihuIGluIGUpcmV0dXJuIHQudmFsdWU9bix0LmRvbmU9ITEsdH1yZXR1cm4gdC5kb25lPSEwLHR9fSx0LnZhbHVlcz1ELFIucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpSLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChPKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmbi5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciB0PXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBpKG4saSl7cmV0dXJuIG8udHlwZT0idGhyb3ciLG8uYXJnPXQsci5uZXh0PW4saSYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIWl9Zm9yKHZhciBhPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTthPj0wOy0tYSl7dmFyIHM9dGhpcy50cnlFbnRyaWVzW2FdLG89cy5jb21wbGV0aW9uO2lmKCJyb290Ij09PXMudHJ5TG9jKXJldHVybiBpKCJlbmQiKTtpZihzLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgbD1uLmNhbGwocywiY2F0Y2hMb2MiKSxoPW4uY2FsbChzLCJmaW5hbGx5TG9jIik7aWYobCYmaCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfWVsc2UgaWYobCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCl9ZWxzZXtpZighaCl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgaT10aGlzLnRyeUVudHJpZXNbcl07aWYoaS50cnlMb2M8PXRoaXMucHJldiYmbi5jYWxsKGksImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PGkuZmluYWxseUxvYyl7dmFyIGE9aTticmVha319YSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmEudHJ5TG9jPD1lJiZlPD1hLmZpbmFsbHlMb2MmJihhPW51bGwpO3ZhciBzPWE/YS5jb21wbGV0aW9uOnt9O3JldHVybiBzLnR5cGU9dCxzLmFyZz1lLGE/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9YS5maW5hbGx5TG9jLGcpOnRoaXMuY29tcGxldGUocyl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSksZ30sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxPKHIpLGd9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIGk9bi5hcmc7TyhyKX1yZXR1cm4gaX19dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOkQodCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxnfX0sdH0odC5leHBvcnRzKTt0cnl7Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZTpGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShlKX19KG4pKTt2YXIgaSxhPXtleHBvcnRzOnt9fTt2YXIgcz0oaXx8KGk9MSxmdW5jdGlvbih0KXtjb25zdCBlPTQscj0wLG49MSxpPTI7ZnVuY3Rpb24gYSh0KXtsZXQgZT10Lmxlbmd0aDtmb3IoOy0tZT49MDspdFtlXT0wfWNvbnN0IHM9MCxvPTEsbD0yLGg9MyxjPTI1OCx1PTI5LF89MjU2LGQ9XysxK3UsZj0zMCxwPTE5LGc9MipkKzEseT0xNSx3PTE2LHY9NyxtPTI1NixiPTE2LHg9MTcsaz0xOCx6PW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKSxBPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzXSksRT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pLFM9bmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxCPTUxMixPPW5ldyBBcnJheSgyKihkKzIpKTthKE8pO2NvbnN0IFI9bmV3IEFycmF5KDIqZik7YShSKTtjb25zdCBEPW5ldyBBcnJheShCKTthKEQpO2NvbnN0IEw9bmV3IEFycmF5KGMtaCsxKTthKEwpO2NvbnN0IFU9bmV3IEFycmF5KHUpO2EoVSk7Y29uc3QgQz1uZXcgQXJyYXkoZik7ZnVuY3Rpb24gVCh0LGUscixuLGkpe3RoaXMuc3RhdGljX3RyZWU9dCx0aGlzLmV4dHJhX2JpdHM9ZSx0aGlzLmV4dHJhX2Jhc2U9cix0aGlzLmVsZW1zPW4sdGhpcy5tYXhfbGVuZ3RoPWksdGhpcy5oYXNfc3RyZWU9dCYmdC5sZW5ndGh9bGV0IEYsSCxaO2Z1bmN0aW9uIE0odCxlKXt0aGlzLmR5bl90cmVlPXQsdGhpcy5tYXhfY29kZT0wLHRoaXMuc3RhdF9kZXNjPWV9YShDKTtjb25zdCBOPXQ9PnQ8MjU2P0RbdF06RFsyNTYrKHQ+Pj43KV0sST0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPTI1NSZlLHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NX0sUD0odCxlLHIpPT57dC5iaV92YWxpZD53LXI/KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LEkodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+dy10LmJpX3ZhbGlkLHQuYmlfdmFsaWQrPXItdyk6KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LHQuYmlfdmFsaWQrPXIpfSxqPSh0LGUscik9PntQKHQsclsyKmVdLHJbMiplKzFdKX0sJD0odCxlKT0+e2xldCByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfSxLPXQ9PnsxNj09PXQuYmlfdmFsaWQ/KEkodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSxYPSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5tYXhfY29kZSxpPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGE9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLHM9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxvPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsbD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoO2xldCBoLGMsdSxfLGQsZixwPTA7Zm9yKF89MDtfPD15O18rKyl0LmJsX2NvdW50W19dPTA7Zm9yKHJbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxoPXQuaGVhcF9tYXgrMTtoPGc7aCsrKWM9dC5oZWFwW2hdLF89clsyKnJbMipjKzFdKzFdKzEsXz5sJiYoXz1sLHArKyksclsyKmMrMV09XyxjPm58fCh0LmJsX2NvdW50W19dKyssZD0wLGM+PW8mJihkPXNbYy1vXSksZj1yWzIqY10sdC5vcHRfbGVuKz1mKihfK2QpLGEmJih0LnN0YXRpY19sZW4rPWYqKGlbMipjKzFdK2QpKSk7aWYoMCE9PXApe2Rve2ZvcihfPWwtMTswPT09dC5ibF9jb3VudFtfXTspXy0tO3QuYmxfY291bnRbX10tLSx0LmJsX2NvdW50W18rMV0rPTIsdC5ibF9jb3VudFtsXS0tLHAtPTJ9d2hpbGUocD4wKTtmb3IoXz1sOzAhPT1fO18tLSlmb3IoYz10LmJsX2NvdW50W19dOzAhPT1jOyl1PXQuaGVhcFstLWhdLHU+bnx8KHJbMip1KzFdIT09XyYmKHQub3B0X2xlbis9KF8tclsyKnUrMV0pKnJbMip1XSxyWzIqdSsxXT1fKSxjLS0pfX0sRz0odCxlLHIpPT57Y29uc3Qgbj1uZXcgQXJyYXkoeSsxKTtsZXQgaSxhLHM9MDtmb3IoaT0xO2k8PXk7aSsrKXM9cytyW2ktMV08PDEsbltpXT1zO2ZvcihhPTA7YTw9ZTthKyspe2xldCBlPXRbMiphKzFdOzAhPT1lJiYodFsyKmFdPSQobltlXSsrLGUpKX19LFc9KCk9PntsZXQgdCxlLHIsbixpO2NvbnN0IGE9bmV3IEFycmF5KHkrMSk7Zm9yKHI9MCxuPTA7bjx1LTE7bisrKWZvcihVW25dPXIsdD0wO3Q8MTw8eltuXTt0KyspTFtyKytdPW47Zm9yKExbci0xXT1uLGk9MCxuPTA7bjwxNjtuKyspZm9yKENbbl09aSx0PTA7dDwxPDxBW25dO3QrKylEW2krK109bjtmb3IoaT4+PTc7bjxmO24rKylmb3IoQ1tuXT1pPDw3LHQ9MDt0PDE8PEFbbl0tNzt0KyspRFsyNTYraSsrXT1uO2ZvcihlPTA7ZTw9eTtlKyspYVtlXT0wO2Zvcih0PTA7dDw9MTQzOylPWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKDt0PD0yNTU7KU9bMip0KzFdPTksdCsrLGFbOV0rKztmb3IoO3Q8PTI3OTspT1syKnQrMV09Nyx0KyssYVs3XSsrO2Zvcig7dDw9Mjg3OylPWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKEcoTyxkKzEsYSksdD0wO3Q8Zjt0KyspUlsyKnQrMV09NSxSWzIqdF09JCh0LDUpO0Y9bmV3IFQoTyx6LF8rMSxkLHkpLEg9bmV3IFQoUixBLDAsZix5KSxaPW5ldyBUKG5ldyBBcnJheSgwKSxFLDAscCx2KX0sWT10PT57bGV0IGU7Zm9yKGU9MDtlPGQ7ZSsrKXQuZHluX2x0cmVlWzIqZV09MDtmb3IoZT0wO2U8ZjtlKyspdC5keW5fZHRyZWVbMiplXT0wO2ZvcihlPTA7ZTxwO2UrKyl0LmJsX3RyZWVbMiplXT0wO3QuZHluX2x0cmVlWzIqbV09MSx0Lm9wdF9sZW49dC5zdGF0aWNfbGVuPTAsdC5zeW1fbmV4dD10Lm1hdGNoZXM9MH0scT10PT57dC5iaV92YWxpZD44P0kodCx0LmJpX2J1Zik6dC5iaV92YWxpZD4wJiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109dC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wfSxWPSh0LGUscixuKT0+e2NvbnN0IGk9MiplLGE9MipyO3JldHVybiB0W2ldPHRbYV18fHRbaV09PT10W2FdJiZuW2VdPD1uW3JdfSxRPSh0LGUscik9Pntjb25zdCBuPXQuaGVhcFtyXTtsZXQgaT1yPDwxO2Zvcig7aTw9dC5oZWFwX2xlbiYmKGk8dC5oZWFwX2xlbiYmVihlLHQuaGVhcFtpKzFdLHQuaGVhcFtpXSx0LmRlcHRoKSYmaSsrLCFWKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn0sSj0odCxlLHIpPT57bGV0IG4saSxhLHMsbz0wO2lmKDAhPT10LnN5bV9uZXh0KWRve249MjU1JnQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sbis9KDI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdKTw8OCxpPXQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sMD09PW4/aih0LGksZSk6KGE9TFtpXSxqKHQsYStfKzEsZSkscz16W2FdLDAhPT1zJiYoaS09VVthXSxQKHQsaSxzKSksbi0tLGE9TihuKSxqKHQsYSxyKSxzPUFbYV0sMCE9PXMmJihuLT1DW2FdLFAodCxuLHMpKSl9d2hpbGUobzx0LnN5bV9uZXh0KTtqKHQsbSxlKX0sdHQ9KHQsZSk9Pntjb25zdCByPWUuZHluX3RyZWUsbj1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxpPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxhPWUuc3RhdF9kZXNjLmVsZW1zO2xldCBzLG8sbCxoPS0xO2Zvcih0LmhlYXBfbGVuPTAsdC5oZWFwX21heD1nLHM9MDtzPGE7cysrKTAhPT1yWzIqc10/KHQuaGVhcFsrK3QuaGVhcF9sZW5dPWg9cyx0LmRlcHRoW3NdPTApOnJbMipzKzFdPTA7Zm9yKDt0LmhlYXBfbGVuPDI7KWw9dC5oZWFwWysrdC5oZWFwX2xlbl09aDwyPysraDowLHJbMipsXT0xLHQuZGVwdGhbbF09MCx0Lm9wdF9sZW4tLSxpJiYodC5zdGF0aWNfbGVuLT1uWzIqbCsxXSk7Zm9yKGUubWF4X2NvZGU9aCxzPXQuaGVhcF9sZW4+PjE7cz49MTtzLS0pUSh0LHIscyk7bD1hO2Rve3M9dC5oZWFwWzFdLHQuaGVhcFsxXT10LmhlYXBbdC5oZWFwX2xlbi0tXSxRKHQsciwxKSxvPXQuaGVhcFsxXSx0LmhlYXBbLS10LmhlYXBfbWF4XT1zLHQuaGVhcFstLXQuaGVhcF9tYXhdPW8sclsyKmxdPXJbMipzXStyWzIqb10sdC5kZXB0aFtsXT0odC5kZXB0aFtzXT49dC5kZXB0aFtvXT90LmRlcHRoW3NdOnQuZGVwdGhbb10pKzEsclsyKnMrMV09clsyKm8rMV09bCx0LmhlYXBbMV09bCsrLFEodCxyLDEpfXdoaWxlKHQuaGVhcF9sZW4+PTIpO3QuaGVhcFstLXQuaGVhcF9tYXhdPXQuaGVhcFsxXSxYKHQsZSksRyhyLGgsdC5ibF9jb3VudCl9LGV0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9MyksZVsyKihyKzEpKzFdPTY1NTM1LG49MDtuPD1yO24rKylpPXMscz1lWzIqKG4rMSkrMV0sKytvPGwmJmk9PT1zfHwobzxoP3QuYmxfdHJlZVsyKmldKz1vOjAhPT1pPyhpIT09YSYmdC5ibF90cmVlWzIqaV0rKyx0LmJsX3RyZWVbMipiXSsrKTpvPD0xMD90LmJsX3RyZWVbMip4XSsrOnQuYmxfdHJlZVsyKmtdKyssbz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpKX0scnQ9KHQsZSxyKT0+e2xldCBuLGksYT0tMSxzPWVbMV0sbz0wLGw9NyxoPTQ7Zm9yKDA9PT1zJiYobD0xMzgsaD0zKSxuPTA7bjw9cjtuKyspaWYoaT1zLHM9ZVsyKihuKzEpKzFdLCEoKytvPGwmJmk9PT1zKSl7aWYobzxoKWRve2oodCxpLHQuYmxfdHJlZSl9d2hpbGUoMCE9LS1vKTtlbHNlIDAhPT1pPyhpIT09YSYmKGoodCxpLHQuYmxfdHJlZSksby0tKSxqKHQsYix0LmJsX3RyZWUpLFAodCxvLTMsMikpOm88PTEwPyhqKHQseCx0LmJsX3RyZWUpLFAodCxvLTMsMykpOihqKHQsayx0LmJsX3RyZWUpLFAodCxvLTExLDcpKTtvPTAsYT1pLDA9PT1zPyhsPTEzOCxoPTMpOmk9PT1zPyhsPTYsaD0zKToobD03LGg9NCl9fSxudD10PT57bGV0IGU7Zm9yKGV0KHQsdC5keW5fbHRyZWUsdC5sX2Rlc2MubWF4X2NvZGUpLGV0KHQsdC5keW5fZHRyZWUsdC5kX2Rlc2MubWF4X2NvZGUpLHR0KHQsdC5ibF9kZXNjKSxlPXAtMTtlPj0zJiYwPT09dC5ibF90cmVlWzIqU1tlXSsxXTtlLS0pO3JldHVybiB0Lm9wdF9sZW4rPTMqKGUrMSkrNSs1KzQsZX0saXQ9KHQsZSxyLG4pPT57bGV0IGk7Zm9yKFAodCxlLTI1Nyw1KSxQKHQsci0xLDUpLFAodCxuLTQsNCksaT0wO2k8bjtpKyspUCh0LHQuYmxfdHJlZVsyKlNbaV0rMV0sMyk7cnQodCx0LmR5bl9sdHJlZSxlLTEpLHJ0KHQsdC5keW5fZHRyZWUsci0xKX0sYXQ9dD0+e2xldCBlLGk9NDA5MzYyNDQ0Nztmb3IoZT0wO2U8PTMxO2UrKyxpPj4+PTEpaWYoMSZpJiYwIT09dC5keW5fbHRyZWVbMiplXSlyZXR1cm4gcjtpZigwIT09dC5keW5fbHRyZWVbMThdfHwwIT09dC5keW5fbHRyZWVbMjBdfHwwIT09dC5keW5fbHRyZWVbMjZdKXJldHVybiBuO2ZvcihlPTMyO2U8XztlKyspaWYoMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIG47cmV0dXJuIHJ9O2xldCBzdD0hMTtjb25zdCBvdD0odCxlLHIsbik9PntQKHQsKHM8PDEpKyhuPzE6MCksMykscSh0KSxJKHQsciksSSh0LH5yKSxyJiZ0LnBlbmRpbmdfYnVmLnNldCh0LndpbmRvdy5zdWJhcnJheShlLGUrciksdC5wZW5kaW5nKSx0LnBlbmRpbmcrPXJ9LGx0PSh0LHIsbixhKT0+e2xldCBzLGgsYz0wO3QubGV2ZWw+MD8odC5zdHJtLmRhdGFfdHlwZT09PWkmJih0LnN0cm0uZGF0YV90eXBlPWF0KHQpKSx0dCh0LHQubF9kZXNjKSx0dCh0LHQuZF9kZXNjKSxjPW50KHQpLHM9dC5vcHRfbGVuKzMrNz4+PjMsaD10LnN0YXRpY19sZW4rMys3Pj4+MyxoPD1zJiYocz1oKSk6cz1oPW4rNSxuKzQ8PXMmJi0xIT09cj9vdCh0LHIsbixhKTp0LnN0cmF0ZWd5PT09ZXx8aD09PXM/KFAodCwobzw8MSkrKGE/MTowKSwzKSxKKHQsTyxSKSk6KFAodCwobDw8MSkrKGE/MTowKSwzKSxpdCh0LHQubF9kZXNjLm1heF9jb2RlKzEsdC5kX2Rlc2MubWF4X2NvZGUrMSxjKzEpLEoodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLFkodCksYSYmcSh0KX07dmFyIGh0PXtfdHJfaW5pdDp0PT57c3R8fChXKCksc3Q9ITApLHQubF9kZXNjPW5ldyBNKHQuZHluX2x0cmVlLEYpLHQuZF9kZXNjPW5ldyBNKHQuZHluX2R0cmVlLEgpLHQuYmxfZGVzYz1uZXcgTSh0LmJsX3RyZWUsWiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTAsWSh0KX0sX3RyX3N0b3JlZF9ibG9jazpvdCxfdHJfZmx1c2hfYmxvY2s6bHQsX3RyX3RhbGx5Oih0LGUscik9Pih0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPWUsdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lPj44LHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ciwwPT09ZT90LmR5bl9sdHJlZVsyKnJdKys6KHQubWF0Y2hlcysrLGUtLSx0LmR5bl9sdHJlZVsyKihMW3JdK18rMSldKyssdC5keW5fZHRyZWVbMipOKGUpXSsrKSx0LnN5bV9uZXh0PT09dC5zeW1fZW5kKSxfdHJfYWxpZ246dD0+e1AodCxvPDwxLDMpLGoodCxtLE8pLEsodCl9fSxjdD0odCxlLHIsbik9PntsZXQgaT02NTUzNSZ0LGE9dD4+PjE2JjY1NTM1LHM9MDtmb3IoOzAhPT1yOyl7cz1yPjJlMz8yZTM6cixyLT1zO2Rve2k9aStlW24rK118MCxhPWEraXwwfXdoaWxlKC0tcyk7aSU9NjU1MjEsYSU9NjU1MjF9cmV0dXJuIGl8YTw8MTZ9O2NvbnN0IHV0PW5ldyBVaW50MzJBcnJheSgoKCk9PntsZXQgdCxlPVtdO2Zvcih2YXIgcj0wO3I8MjU2O3IrKyl7dD1yO2Zvcih2YXIgbj0wO248ODtuKyspdD0xJnQ/Mzk4ODI5MjM4NF50Pj4+MTp0Pj4+MTtlW3JdPXR9cmV0dXJuIGV9KSgpKTt2YXIgX3Q9KHQsZSxyLG4pPT57Y29uc3QgaT11dCxhPW4rcjt0Xj0tMTtmb3IobGV0IHI9bjtyPGE7cisrKXQ9dD4+PjheaVsyNTUmKHReZVtyXSldO3JldHVybn50fSxkdD17MjoibmVlZCBkaWN0aW9uYXJ5IiwxOiJzdHJlYW0gZW5kIiwwOiIiLCItMSI6ImZpbGUgZXJyb3IiLCItMiI6InN0cmVhbSBlcnJvciIsIi0zIjoiZGF0YSBlcnJvciIsIi00IjoiaW5zdWZmaWNpZW50IG1lbW9yeSIsIi01IjoiYnVmZmVyIGVycm9yIiwiLTYiOiJpbmNvbXBhdGlibGUgdmVyc2lvbiJ9LGZ0PXtaX05PX0ZMVVNIOjAsWl9QQVJUSUFMX0ZMVVNIOjEsWl9TWU5DX0ZMVVNIOjIsWl9GVUxMX0ZMVVNIOjMsWl9GSU5JU0g6NCxaX0JMT0NLOjUsWl9UUkVFUzo2LFpfT0s6MCxaX1NUUkVBTV9FTkQ6MSxaX05FRURfRElDVDoyLFpfRVJSTk86LTEsWl9TVFJFQU1fRVJST1I6LTIsWl9EQVRBX0VSUk9SOi0zLFpfTUVNX0VSUk9SOi00LFpfQlVGX0VSUk9SOi01LFpfTk9fQ09NUFJFU1NJT046MCxaX0JFU1RfU1BFRUQ6MSxaX0JFU1RfQ09NUFJFU1NJT046OSxaX0RFRkFVTFRfQ09NUFJFU1NJT046LTEsWl9GSUxURVJFRDoxLFpfSFVGRk1BTl9PTkxZOjIsWl9STEU6MyxaX0ZJWEVEOjQsWl9ERUZBVUxUX1NUUkFURUdZOjAsWl9CSU5BUlk6MCxaX1RFWFQ6MSxaX1VOS05PV046MixaX0RFRkxBVEVEOjh9O2NvbnN0e190cl9pbml0OnB0LF90cl9zdG9yZWRfYmxvY2s6Z3QsX3RyX2ZsdXNoX2Jsb2NrOnl0LF90cl90YWxseTp3dCxfdHJfYWxpZ246dnR9PWh0LHtaX05PX0ZMVVNIOm10LFpfUEFSVElBTF9GTFVTSDpidCxaX0ZVTExfRkxVU0g6eHQsWl9GSU5JU0g6a3QsWl9CTE9DSzp6dCxaX09LOkF0LFpfU1RSRUFNX0VORDpFdCxaX1NUUkVBTV9FUlJPUjpTdCxaX0RBVEFfRVJST1I6QnQsWl9CVUZfRVJST1I6T3QsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOlJ0LFpfRklMVEVSRUQ6RHQsWl9IVUZGTUFOX09OTFk6THQsWl9STEU6VXQsWl9GSVhFRDpDdCxaX0RFRkFVTFRfU1RSQVRFR1k6VHQsWl9VTktOT1dOOkZ0LFpfREVGTEFURUQ6SHR9PWZ0LFp0PTksTXQ9MTUsTnQ9OCxJdD0yODYsUHQ9MzAsanQ9MTksJHQ9MipJdCsxLEt0PTE1LFh0PTMsR3Q9MjU4LFd0PUd0K1h0KzEsWXQ9MzIscXQ9NDIsVnQ9NTcsUXQ9NjksSnQ9NzMsdGU9OTEsZWU9MTAzLHJlPTExMyxuZT02NjYsaWU9MSxhZT0yLHNlPTMsb2U9NCxsZT0zLGhlPSh0LGUpPT4odC5tc2c9ZHRbZV0sZSksY2U9dD0+Mip0LSh0PjQ/OTowKSx1ZT10PT57bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH0sX2U9dD0+e2xldCBlLHIsbixpPXQud19zaXplO2U9dC5oYXNoX3NpemUsbj1lO2Rve3I9dC5oZWFkWy0tbl0sdC5oZWFkW25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKTtlPWksbj1lO2Rve3I9dC5wcmV2Wy0tbl0sdC5wcmV2W25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKX07bGV0IGRlPSh0LGUscik9PihlPDx0Lmhhc2hfc2hpZnRecikmdC5oYXNoX21hc2s7Y29uc3QgZmU9dD0+e2NvbnN0IGU9dC5zdGF0ZTtsZXQgcj1lLnBlbmRpbmc7cj50LmF2YWlsX291dCYmKHI9dC5hdmFpbF9vdXQpLDAhPT1yJiYodC5vdXRwdXQuc2V0KGUucGVuZGluZ19idWYuc3ViYXJyYXkoZS5wZW5kaW5nX291dCxlLnBlbmRpbmdfb3V0K3IpLHQubmV4dF9vdXQpLHQubmV4dF9vdXQrPXIsZS5wZW5kaW5nX291dCs9cix0LnRvdGFsX291dCs9cix0LmF2YWlsX291dC09cixlLnBlbmRpbmctPXIsMD09PWUucGVuZGluZyYmKGUucGVuZGluZ19vdXQ9MCkpfSxwZT0odCxlKT0+e3l0KHQsdC5ibG9ja19zdGFydD49MD90LmJsb2NrX3N0YXJ0Oi0xLHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydCxlKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQsZmUodC5zdHJtKX0sZ2U9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lfSx5ZT0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZX0sd2U9KHQsZSxyLG4pPT57bGV0IGk9dC5hdmFpbF9pbjtyZXR1cm4gaT5uJiYoaT1uKSwwPT09aT8wOih0LmF2YWlsX2luLT1pLGUuc2V0KHQuaW5wdXQuc3ViYXJyYXkodC5uZXh0X2luLHQubmV4dF9pbitpKSxyKSwxPT09dC5zdGF0ZS53cmFwP3QuYWRsZXI9Y3QodC5hZGxlcixlLGkscik6Mj09PXQuc3RhdGUud3JhcCYmKHQuYWRsZXI9X3QodC5hZGxlcixlLGkscikpLHQubmV4dF9pbis9aSx0LnRvdGFsX2luKz1pLGkpfSx2ZT0odCxlKT0+e2xldCByLG4saT10Lm1heF9jaGFpbl9sZW5ndGgsYT10LnN0cnN0YXJ0LHM9dC5wcmV2X2xlbmd0aCxvPXQubmljZV9tYXRjaDtjb25zdCBsPXQuc3Ryc3RhcnQ+dC53X3NpemUtV3Q/dC5zdHJzdGFydC0odC53X3NpemUtV3QpOjAsaD10LndpbmRvdyxjPXQud19tYXNrLHU9dC5wcmV2LF89dC5zdHJzdGFydCtHdDtsZXQgZD1oW2Ercy0xXSxmPWhbYStzXTt0LnByZXZfbGVuZ3RoPj10Lmdvb2RfbWF0Y2gmJihpPj49Miksbz50Lmxvb2thaGVhZCYmKG89dC5sb29rYWhlYWQpO2Rve2lmKHI9ZSxoW3Irc109PT1mJiZoW3Ircy0xXT09PWQmJmhbcl09PT1oW2FdJiZoWysrcl09PT1oW2ErMV0pe2ErPTIscisrO2Rve313aGlsZShoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmYTxfKTtpZihuPUd0LShfLWEpLGE9Xy1HdCxuPnMpe2lmKHQubWF0Y2hfc3RhcnQ9ZSxzPW4sbj49bylicmVhaztkPWhbYStzLTFdLGY9aFthK3NdfX19d2hpbGUoKGU9dVtlJmNdKT5sJiYwIT0tLWkpO3JldHVybiBzPD10Lmxvb2thaGVhZD9zOnQubG9va2FoZWFkfSxtZT10PT57Y29uc3QgZT10Lndfc2l6ZTtsZXQgcixuLGk7ZG97aWYobj10LndpbmRvd19zaXplLXQubG9va2FoZWFkLXQuc3Ryc3RhcnQsdC5zdHJzdGFydD49ZSsoZS1XdCkmJih0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK2UtbiksMCksdC5tYXRjaF9zdGFydC09ZSx0LnN0cnN0YXJ0LT1lLHQuYmxvY2tfc3RhcnQtPWUsdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpLF9lKHQpLG4rPWUpLDA9PT10LnN0cm0uYXZhaWxfaW4pYnJlYWs7aWYocj13ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCt0Lmxvb2thaGVhZCxuKSx0Lmxvb2thaGVhZCs9cix0Lmxvb2thaGVhZCt0Lmluc2VydD49WHQpZm9yKGk9dC5zdHJzdGFydC10Lmluc2VydCx0Lmluc19oPXQud2luZG93W2ldLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krMV0pO3QuaW5zZXJ0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbaStYdC0xXSksdC5wcmV2W2kmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09aSxpKyssdC5pbnNlcnQtLSwhKHQubG9va2FoZWFkK3QuaW5zZXJ0PFh0KSk7KTt9d2hpbGUodC5sb29rYWhlYWQ8V3QmJjAhPT10LnN0cm0uYXZhaWxfaW4pfSxiZT0odCxlKT0+e2xldCByLG4saSxhPXQucGVuZGluZ19idWZfc2l6ZS01PnQud19zaXplP3Qud19zaXplOnQucGVuZGluZ19idWZfc2l6ZS01LHM9MCxvPXQuc3RybS5hdmFpbF9pbjtkb3tpZihyPTY1NTM1LGk9dC5iaV92YWxpZCs0Mj4+Myx0LnN0cm0uYXZhaWxfb3V0PGkpYnJlYWs7aWYoaT10LnN0cm0uYXZhaWxfb3V0LWksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQscj5uK3Quc3RybS5hdmFpbF9pbiYmKHI9bit0LnN0cm0uYXZhaWxfaW4pLHI+aSYmKHI9aSkscjxhJiYoMD09PXImJmUhPT1rdHx8ZT09PW10fHxyIT09bit0LnN0cm0uYXZhaWxfaW4pKWJyZWFrO3M9ZT09PWt0JiZyPT09bit0LnN0cm0uYXZhaWxfaW4/MTowLGd0KHQsMCwwLHMpLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTRdPXIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctM109cj4+OCx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0yXT1+cix0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0xXT1+cj4+OCxmZSh0LnN0cm0pLG4mJihuPnImJihuPXIpLHQuc3RybS5vdXRwdXQuc2V0KHQud2luZG93LnN1YmFycmF5KHQuYmxvY2tfc3RhcnQsdC5ibG9ja19zdGFydCtuKSx0LnN0cm0ubmV4dF9vdXQpLHQuc3RybS5uZXh0X291dCs9bix0LnN0cm0uYXZhaWxfb3V0LT1uLHQuc3RybS50b3RhbF9vdXQrPW4sdC5ibG9ja19zdGFydCs9bixyLT1uKSxyJiYod2UodC5zdHJtLHQuc3RybS5vdXRwdXQsdC5zdHJtLm5leHRfb3V0LHIpLHQuc3RybS5uZXh0X291dCs9cix0LnN0cm0uYXZhaWxfb3V0LT1yLHQuc3RybS50b3RhbF9vdXQrPXIpfXdoaWxlKDA9PT1zKTtyZXR1cm4gby09dC5zdHJtLmF2YWlsX2luLG8mJihvPj10Lndfc2l6ZT8odC5tYXRjaGVzPTIsdC53aW5kb3cuc2V0KHQuc3RybS5pbnB1dC5zdWJhcnJheSh0LnN0cm0ubmV4dF9pbi10Lndfc2l6ZSx0LnN0cm0ubmV4dF9pbiksMCksdC5zdHJzdGFydD10Lndfc2l6ZSx0Lmluc2VydD10LnN0cnN0YXJ0KToodC53aW5kb3dfc2l6ZS10LnN0cnN0YXJ0PD1vJiYodC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tbyx0LnN0cm0ubmV4dF9pbiksdC5zdHJzdGFydCksdC5zdHJzdGFydCs9byx0Lmluc2VydCs9bz50Lndfc2l6ZS10Lmluc2VydD90Lndfc2l6ZS10Lmluc2VydDpvKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLHM/b2U6ZSE9PW10JiZlIT09a3QmJjA9PT10LnN0cm0uYXZhaWxfaW4mJnQuc3Ryc3RhcnQ9PT10LmJsb2NrX3N0YXJ0P2FlOihpPXQud2luZG93X3NpemUtdC5zdHJzdGFydCx0LnN0cm0uYXZhaWxfaW4+aSYmdC5ibG9ja19zdGFydD49dC53X3NpemUmJih0LmJsb2NrX3N0YXJ0LT10Lndfc2l6ZSx0LnN0cnN0YXJ0LT10Lndfc2l6ZSx0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkodC53X3NpemUsdC53X3NpemUrdC5zdHJzdGFydCksMCksdC5tYXRjaGVzPDImJnQubWF0Y2hlcysrLGkrPXQud19zaXplLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSksaT50LnN0cm0uYXZhaWxfaW4mJihpPXQuc3RybS5hdmFpbF9pbiksaSYmKHdlKHQuc3RybSx0LndpbmRvdyx0LnN0cnN0YXJ0LGkpLHQuc3Ryc3RhcnQrPWksdC5pbnNlcnQrPWk+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6aSksdC5oaWdoX3dhdGVyPHQuc3Ryc3RhcnQmJih0LmhpZ2hfd2F0ZXI9dC5zdHJzdGFydCksaT10LmJpX3ZhbGlkKzQyPj4zLGk9dC5wZW5kaW5nX2J1Zl9zaXplLWk+NjU1MzU/NjU1MzU6dC5wZW5kaW5nX2J1Zl9zaXplLWksYT1pPnQud19zaXplP3Qud19zaXplOmksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsKG4+PWF8fChufHxlPT09a3QpJiZlIT09bXQmJjA9PT10LnN0cm0uYXZhaWxfaW4mJm48PWkpJiYocj1uPmk/aTpuLHM9ZT09PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZyPT09bj8xOjAsZ3QodCx0LmJsb2NrX3N0YXJ0LHIscyksdC5ibG9ja19zdGFydCs9cixmZSh0LnN0cm0pKSxzP3NlOmllKX0seGU9KHQsZSk9PntsZXQgcixuO2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8V3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPFd0JiZlPT09bXQpcmV0dXJuIGllO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZihyPTAsdC5sb29rYWhlYWQ+PVh0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSwwIT09ciYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1XdCYmKHQubWF0Y2hfbGVuZ3RoPXZlKHQscikpLHQubWF0Y2hfbGVuZ3RoPj1YdClpZihuPXd0KHQsdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj1YdCl7dC5tYXRjaF9sZW5ndGgtLTtkb3t0LnN0cnN0YXJ0KyssdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0fXdoaWxlKDAhPS0tdC5tYXRjaF9sZW5ndGgpO3Quc3Ryc3RhcnQrK31lbHNlIHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTAsdC5pbnNfaD10LndpbmRvd1t0LnN0cnN0YXJ0XSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0KzFdKTtlbHNlIG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKztpZihuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxrZT0odCxlKT0+e2xldCByLG4saTtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksdC5wcmV2X2xlbmd0aD10Lm1hdGNoX2xlbmd0aCx0LnByZXZfbWF0Y2g9dC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aD1YdC0xLDAhPT1yJiZ0LnByZXZfbGVuZ3RoPHQubWF4X2xhenlfbWF0Y2gmJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpLHQubWF0Y2hfbGVuZ3RoPD01JiYodC5zdHJhdGVneT09PUR0fHx0Lm1hdGNoX2xlbmd0aD09PVh0JiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD1YdC0xKSksdC5wcmV2X2xlbmd0aD49WHQmJnQubWF0Y2hfbGVuZ3RoPD10LnByZXZfbGVuZ3RoKXtpPXQuc3Ryc3RhcnQrdC5sb29rYWhlYWQtWHQsbj13dCh0LHQuc3Ryc3RhcnQtMS10LnByZXZfbWF0Y2gsdC5wcmV2X2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQucHJldl9sZW5ndGgtMSx0LnByZXZfbGVuZ3RoLT0yO2RveysrdC5zdHJzdGFydDw9aSYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCl9d2hpbGUoMCE9LS10LnByZXZfbGVuZ3RoKTtpZih0Lm1hdGNoX2F2YWlsYWJsZT0wLHQubWF0Y2hfbGVuZ3RoPVh0LTEsdC5zdHJzdGFydCsrLG4mJihwZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLG4mJnBlKHQsITEpLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tLDA9PT10LnN0cm0uYXZhaWxfb3V0KXJldHVybiBpZX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSksdC5tYXRjaF9hdmFpbGFibGU9MCksdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSx6ZT0odCxlKT0+e2xldCByLG4saSxhO2NvbnN0IHM9dC53aW5kb3c7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDw9R3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPD1HdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCx0Lmxvb2thaGVhZD49WHQmJnQuc3Ryc3RhcnQ+MCYmKGk9dC5zdHJzdGFydC0xLG49c1tpXSxuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldKSl7YT10LnN0cnN0YXJ0K0d0O2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPGEpO3QubWF0Y2hfbGVuZ3RoPUd0LShhLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj1YdD8ocj13dCh0LDEsdC5tYXRjaF9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10Lm1hdGNoX2xlbmd0aCx0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wKToocj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxBZT0odCxlKT0+e2xldCByO2Zvcig7Oyl7aWYoMD09PXQubG9va2FoZWFkJiYobWUodCksMD09PXQubG9va2FoZWFkKSl7aWYoZT09PW10KXJldHVybiBpZTticmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfTtmdW5jdGlvbiBFZSh0LGUscixuLGkpe3RoaXMuZ29vZF9sZW5ndGg9dCx0aGlzLm1heF9sYXp5PWUsdGhpcy5uaWNlX2xlbmd0aD1yLHRoaXMubWF4X2NoYWluPW4sdGhpcy5mdW5jPWl9Y29uc3QgU2U9W25ldyBFZSgwLDAsMCwwLGJlKSxuZXcgRWUoNCw0LDgsNCx4ZSksbmV3IEVlKDQsNSwxNiw4LHhlKSxuZXcgRWUoNCw2LDMyLDMyLHhlKSxuZXcgRWUoNCw0LDE2LDE2LGtlKSxuZXcgRWUoOCwxNiwzMiwzMixrZSksbmV3IEVlKDgsMTYsMTI4LDEyOCxrZSksbmV3IEVlKDgsMzIsMTI4LDI1NixrZSksbmV3IEVlKDMyLDEyOCwyNTgsMTAyNCxrZSksbmV3IEVlKDMyLDI1OCwyNTgsNDA5NixrZSldLEJlPXQ9Pnt0LndpbmRvd19zaXplPTIqdC53X3NpemUsdWUodC5oZWFkKSx0Lm1heF9sYXp5X21hdGNoPVNlW3QubGV2ZWxdLm1heF9sYXp5LHQuZ29vZF9tYXRjaD1TZVt0LmxldmVsXS5nb29kX2xlbmd0aCx0Lm5pY2VfbWF0Y2g9U2VbdC5sZXZlbF0ubmljZV9sZW5ndGgsdC5tYXhfY2hhaW5fbGVuZ3RoPVNlW3QubGV2ZWxdLm1heF9jaGFpbix0LnN0cnN0YXJ0PTAsdC5ibG9ja19zdGFydD0wLHQubG9va2FoZWFkPTAsdC5pbnNlcnQ9MCx0Lm1hdGNoX2xlbmd0aD10LnByZXZfbGVuZ3RoPVh0LTEsdC5tYXRjaF9hdmFpbGFibGU9MCx0Lmluc19oPTB9O2Z1bmN0aW9uIE9lKCl7dGhpcy5zdHJtPW51bGwsdGhpcy5zdGF0dXM9MCx0aGlzLnBlbmRpbmdfYnVmPW51bGwsdGhpcy5wZW5kaW5nX2J1Zl9zaXplPTAsdGhpcy5wZW5kaW5nX291dD0wLHRoaXMucGVuZGluZz0wLHRoaXMud3JhcD0wLHRoaXMuZ3poZWFkPW51bGwsdGhpcy5nemluZGV4PTAsdGhpcy5tZXRob2Q9SHQsdGhpcy5sYXN0X2ZsdXNoPS0xLHRoaXMud19zaXplPTAsdGhpcy53X2JpdHM9MCx0aGlzLndfbWFzaz0wLHRoaXMud2luZG93PW51bGwsdGhpcy53aW5kb3dfc2l6ZT0wLHRoaXMucHJldj1udWxsLHRoaXMuaGVhZD1udWxsLHRoaXMuaW5zX2g9MCx0aGlzLmhhc2hfc2l6ZT0wLHRoaXMuaGFzaF9iaXRzPTAsdGhpcy5oYXNoX21hc2s9MCx0aGlzLmhhc2hfc2hpZnQ9MCx0aGlzLmJsb2NrX3N0YXJ0PTAsdGhpcy5tYXRjaF9sZW5ndGg9MCx0aGlzLnByZXZfbWF0Y2g9MCx0aGlzLm1hdGNoX2F2YWlsYWJsZT0wLHRoaXMuc3Ryc3RhcnQ9MCx0aGlzLm1hdGNoX3N0YXJ0PTAsdGhpcy5sb29rYWhlYWQ9MCx0aGlzLnByZXZfbGVuZ3RoPTAsdGhpcy5tYXhfY2hhaW5fbGVuZ3RoPTAsdGhpcy5tYXhfbGF6eV9tYXRjaD0wLHRoaXMubGV2ZWw9MCx0aGlzLnN0cmF0ZWd5PTAsdGhpcy5nb29kX21hdGNoPTAsdGhpcy5uaWNlX21hdGNoPTAsdGhpcy5keW5fbHRyZWU9bmV3IFVpbnQxNkFycmF5KDIqJHQpLHRoaXMuZHluX2R0cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKlB0KzEpKSx0aGlzLmJsX3RyZWU9bmV3IFVpbnQxNkFycmF5KDIqKDIqanQrMSkpLHVlKHRoaXMuZHluX2x0cmVlKSx1ZSh0aGlzLmR5bl9kdHJlZSksdWUodGhpcy5ibF90cmVlKSx0aGlzLmxfZGVzYz1udWxsLHRoaXMuZF9kZXNjPW51bGwsdGhpcy5ibF9kZXNjPW51bGwsdGhpcy5ibF9jb3VudD1uZXcgVWludDE2QXJyYXkoS3QrMSksdGhpcy5oZWFwPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuaGVhcCksdGhpcy5oZWFwX2xlbj0wLHRoaXMuaGVhcF9tYXg9MCx0aGlzLmRlcHRoPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuZGVwdGgpLHRoaXMuc3ltX2J1Zj0wLHRoaXMubGl0X2J1ZnNpemU9MCx0aGlzLnN5bV9uZXh0PTAsdGhpcy5zeW1fZW5kPTAsdGhpcy5vcHRfbGVuPTAsdGhpcy5zdGF0aWNfbGVuPTAsdGhpcy5tYXRjaGVzPTAsdGhpcy5pbnNlcnQ9MCx0aGlzLmJpX2J1Zj0wLHRoaXMuYmlfdmFsaWQ9MH1jb25zdCBSZT10PT57aWYoIXQpcmV0dXJuIDE7Y29uc3QgZT10LnN0YXRlO3JldHVybiFlfHxlLnN0cm0hPT10fHxlLnN0YXR1cyE9PXF0JiZlLnN0YXR1cyE9PVZ0JiZlLnN0YXR1cyE9PVF0JiZlLnN0YXR1cyE9PUp0JiZlLnN0YXR1cyE9PXRlJiZlLnN0YXR1cyE9PWVlJiZlLnN0YXR1cyE9PXJlJiZlLnN0YXR1cyE9PW5lPzE6MH0sRGU9dD0+e2lmKFJlKHQpKXJldHVybiBoZSh0LFN0KTt0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9RnQ7Y29uc3QgZT10LnN0YXRlO3JldHVybiBlLnBlbmRpbmc9MCxlLnBlbmRpbmdfb3V0PTAsZS53cmFwPDAmJihlLndyYXA9LWUud3JhcCksZS5zdGF0dXM9Mj09PWUud3JhcD9WdDplLndyYXA/cXQ6cmUsdC5hZGxlcj0yPT09ZS53cmFwPzA6MSxlLmxhc3RfZmx1c2g9LTIscHQoZSksQXR9LExlPXQ9Pntjb25zdCBlPURlKHQpO3JldHVybiBlPT09QXQmJkJlKHQuc3RhdGUpLGV9LFVlPSh0LGUscixuLGksYSk9PntpZighdClyZXR1cm4gU3Q7bGV0IHM9MTtpZihlPT09UnQmJihlPTYpLG48MD8ocz0wLG49LW4pOm4+MTUmJihzPTIsbi09MTYpLGk8MXx8aT5adHx8ciE9PUh0fHxuPDh8fG4+MTV8fGU8MHx8ZT45fHxhPDB8fGE+Q3R8fDg9PT1uJiYxIT09cylyZXR1cm4gaGUodCxTdCk7OD09PW4mJihuPTkpO2NvbnN0IG89bmV3IE9lO3JldHVybiB0LnN0YXRlPW8sby5zdHJtPXQsby5zdGF0dXM9cXQsby53cmFwPXMsby5nemhlYWQ9bnVsbCxvLndfYml0cz1uLG8ud19zaXplPTE8PG8ud19iaXRzLG8ud19tYXNrPW8ud19zaXplLTEsby5oYXNoX2JpdHM9aSs3LG8uaGFzaF9zaXplPTE8PG8uaGFzaF9iaXRzLG8uaGFzaF9tYXNrPW8uaGFzaF9zaXplLTEsby5oYXNoX3NoaWZ0PX5+KChvLmhhc2hfYml0cytYdC0xKS9YdCksby53aW5kb3c9bmV3IFVpbnQ4QXJyYXkoMipvLndfc2l6ZSksby5oZWFkPW5ldyBVaW50MTZBcnJheShvLmhhc2hfc2l6ZSksby5wcmV2PW5ldyBVaW50MTZBcnJheShvLndfc2l6ZSksby5saXRfYnVmc2l6ZT0xPDxpKzYsby5wZW5kaW5nX2J1Zl9zaXplPTQqby5saXRfYnVmc2l6ZSxvLnBlbmRpbmdfYnVmPW5ldyBVaW50OEFycmF5KG8ucGVuZGluZ19idWZfc2l6ZSksby5zeW1fYnVmPW8ubGl0X2J1ZnNpemUsby5zeW1fZW5kPTMqKG8ubGl0X2J1ZnNpemUtMSksby5sZXZlbD1lLG8uc3RyYXRlZ3k9YSxvLm1ldGhvZD1yLExlKHQpfTt2YXIgQ2U9e2RlZmxhdGVJbml0Oih0LGUpPT5VZSh0LGUsSHQsTXQsTnQsVHQpLGRlZmxhdGVJbml0MjpVZSxkZWZsYXRlUmVzZXQ6TGUsZGVmbGF0ZVJlc2V0S2VlcDpEZSxkZWZsYXRlU2V0SGVhZGVyOih0LGUpPT5SZSh0KXx8MiE9PXQuc3RhdGUud3JhcD9TdDoodC5zdGF0ZS5nemhlYWQ9ZSxBdCksZGVmbGF0ZToodCxlKT0+e2lmKFJlKHQpfHxlPnp0fHxlPDApcmV0dXJuIHQ/aGUodCxTdCk6U3Q7Y29uc3Qgcj10LnN0YXRlO2lmKCF0Lm91dHB1dHx8MCE9PXQuYXZhaWxfaW4mJiF0LmlucHV0fHxyLnN0YXR1cz09PW5lJiZlIT09a3QpcmV0dXJuIGhlKHQsMD09PXQuYXZhaWxfb3V0P090OlN0KTtjb25zdCBuPXIubGFzdF9mbHVzaDtpZihyLmxhc3RfZmx1c2g9ZSwwIT09ci5wZW5kaW5nKXtpZihmZSh0KSwwPT09dC5hdmFpbF9vdXQpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZjZShlKTw9Y2UobikmJmUhPT1rdClyZXR1cm4gaGUodCxPdCk7aWYoci5zdGF0dXM9PT1uZSYmMCE9PXQuYXZhaWxfaW4pcmV0dXJuIGhlKHQsT3QpO2lmKHIuc3RhdHVzPT09cXQmJjA9PT1yLndyYXAmJihyLnN0YXR1cz1yZSksci5zdGF0dXM9PT1xdCl7bGV0IGU9SHQrKHIud19iaXRzLTg8PDQpPDw4LG49LTE7aWYobj1yLnN0cmF0ZWd5Pj1MdHx8ci5sZXZlbDwyPzA6ci5sZXZlbDw2PzE6Nj09PXIubGV2ZWw/MjozLGV8PW48PDYsMCE9PXIuc3Ryc3RhcnQmJihlfD1ZdCksZSs9MzEtZSUzMSx5ZShyLGUpLDAhPT1yLnN0cnN0YXJ0JiYoeWUocix0LmFkbGVyPj4+MTYpLHllKHIsNjU1MzUmdC5hZGxlcikpLHQuYWRsZXI9MSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9aWYoci5zdGF0dXM9PT1WdClpZih0LmFkbGVyPTAsZ2UociwzMSksZ2UociwxMzkpLGdlKHIsOCksci5nemhlYWQpZ2Uociwoci5nemhlYWQudGV4dD8xOjApKyhyLmd6aGVhZC5oY3JjPzI6MCkrKHIuZ3poZWFkLmV4dHJhPzQ6MCkrKHIuZ3poZWFkLm5hbWU/ODowKSsoci5nemhlYWQuY29tbWVudD8xNjowKSksZ2UociwyNTUmci5nemhlYWQudGltZSksZ2UocixyLmd6aGVhZC50aW1lPj44JjI1NSksZ2UocixyLmd6aGVhZC50aW1lPj4xNiYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MjQmMjU1KSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49THR8fHIubGV2ZWw8Mj80OjApLGdlKHIsMjU1JnIuZ3poZWFkLm9zKSxyLmd6aGVhZC5leHRyYSYmci5nemhlYWQuZXh0cmEubGVuZ3RoJiYoZ2UociwyNTUmci5nemhlYWQuZXh0cmEubGVuZ3RoKSxnZShyLHIuZ3poZWFkLmV4dHJhLmxlbmd0aD4+OCYyNTUpKSxyLmd6aGVhZC5oY3JjJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLDApKSxyLmd6aW5kZXg9MCxyLnN0YXR1cz1RdDtlbHNlIGlmKGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49THR8fHIubGV2ZWw8Mj80OjApLGdlKHIsbGUpLHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtpZihyLnN0YXR1cz09PVF0KXtpZihyLmd6aGVhZC5leHRyYSl7bGV0IGU9ci5wZW5kaW5nLG49KDY1NTM1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCktci5nemluZGV4O2Zvcig7ci5wZW5kaW5nK24+ci5wZW5kaW5nX2J1Zl9zaXplOyl7bGV0IGk9ci5wZW5kaW5nX2J1Zl9zaXplLXIucGVuZGluZztpZihyLnBlbmRpbmdfYnVmLnNldChyLmd6aGVhZC5leHRyYS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K2kpLHIucGVuZGluZyksci5wZW5kaW5nPXIucGVuZGluZ19idWZfc2l6ZSxyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+ZSYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1lLGUpKSxyLmd6aW5kZXgrPWksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O2U9MCxuLT1pfWxldCBpPW5ldyBVaW50OEFycmF5KHIuZ3poZWFkLmV4dHJhKTtyLnBlbmRpbmdfYnVmLnNldChpLnN1YmFycmF5KHIuZ3ppbmRleCxyLmd6aW5kZXgrbiksci5wZW5kaW5nKSxyLnBlbmRpbmcrPW4sci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4PTB9ci5zdGF0dXM9SnR9aWYoci5zdGF0dXM9PT1KdCl7aWYoci5nemhlYWQubmFtZSl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLm5hbWUubGVuZ3RoPzI1NSZyLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksci5nemluZGV4PTB9ci5zdGF0dXM9dGV9aWYoci5zdGF0dXM9PT10ZSl7aWYoci5nemhlYWQuY29tbWVudCl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLmNvbW1lbnQubGVuZ3RoPzI1NSZyLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSl9ci5zdGF0dXM9ZWV9aWYoci5zdGF0dXM9PT1lZSl7aWYoci5nemhlYWQuaGNyYyl7aWYoci5wZW5kaW5nKzI+ci5wZW5kaW5nX2J1Zl9zaXplJiYoZmUodCksMCE9PXIucGVuZGluZykpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSx0LmFkbGVyPTB9aWYoci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKDAhPT10LmF2YWlsX2lufHwwIT09ci5sb29rYWhlYWR8fGUhPT1tdCYmci5zdGF0dXMhPT1uZSl7bGV0IG49MD09PXIubGV2ZWw/YmUocixlKTpyLnN0cmF0ZWd5PT09THQ/QWUocixlKTpyLnN0cmF0ZWd5PT09VXQ/emUocixlKTpTZVtyLmxldmVsXS5mdW5jKHIsZSk7aWYobiE9PXNlJiZuIT09b2V8fChyLnN0YXR1cz1uZSksbj09PWllfHxuPT09c2UpcmV0dXJuIDA9PT10LmF2YWlsX291dCYmKHIubGFzdF9mbHVzaD0tMSksQXQ7aWYobj09PWFlJiYoZT09PWJ0P3Z0KHIpOmUhPT16dCYmKGd0KHIsMCwwLCExKSxlPT09eHQmJih1ZShyLmhlYWQpLDA9PT1yLmxvb2thaGVhZCYmKHIuc3Ryc3RhcnQ9MCxyLmJsb2NrX3N0YXJ0PTAsci5pbnNlcnQ9MCkpKSxmZSh0KSwwPT09dC5hdmFpbF9vdXQpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9cmV0dXJuIGUhPT1rdD9BdDpyLndyYXA8PTA/RXQ6KDI9PT1yLndyYXA/KGdlKHIsMjU1JnQuYWRsZXIpLGdlKHIsdC5hZGxlcj4+OCYyNTUpLGdlKHIsdC5hZGxlcj4+MTYmMjU1KSxnZShyLHQuYWRsZXI+PjI0JjI1NSksZ2UociwyNTUmdC50b3RhbF9pbiksZ2Uocix0LnRvdGFsX2luPj44JjI1NSksZ2Uocix0LnRvdGFsX2luPj4xNiYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MjQmMjU1KSk6KHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSxmZSh0KSxyLndyYXA+MCYmKHIud3JhcD0tci53cmFwKSwwIT09ci5wZW5kaW5nP0F0OkV0KX0sZGVmbGF0ZUVuZDp0PT57aWYoUmUodCkpcmV0dXJuIFN0O2NvbnN0IGU9dC5zdGF0ZS5zdGF0dXM7cmV0dXJuIHQuc3RhdGU9bnVsbCxlPT09cmU/aGUodCxCdCk6QXR9LGRlZmxhdGVTZXREaWN0aW9uYXJ5Oih0LGUpPT57bGV0IHI9ZS5sZW5ndGg7aWYoUmUodCkpcmV0dXJuIFN0O2NvbnN0IG49dC5zdGF0ZSxpPW4ud3JhcDtpZigyPT09aXx8MT09PWkmJm4uc3RhdHVzIT09cXR8fG4ubG9va2FoZWFkKXJldHVybiBTdDtpZigxPT09aSYmKHQuYWRsZXI9Y3QodC5hZGxlcixlLHIsMCkpLG4ud3JhcD0wLHI+PW4ud19zaXplKXswPT09aSYmKHVlKG4uaGVhZCksbi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKTtsZXQgdD1uZXcgVWludDhBcnJheShuLndfc2l6ZSk7dC5zZXQoZS5zdWJhcnJheShyLW4ud19zaXplLHIpLDApLGU9dCxyPW4ud19zaXplfWNvbnN0IGE9dC5hdmFpbF9pbixzPXQubmV4dF9pbixvPXQuaW5wdXQ7Zm9yKHQuYXZhaWxfaW49cix0Lm5leHRfaW49MCx0LmlucHV0PWUsbWUobik7bi5sb29rYWhlYWQ+PVh0Oyl7bGV0IHQ9bi5zdHJzdGFydCxlPW4ubG9va2FoZWFkLShYdC0xKTtkb3tuLmluc19oPWRlKG4sbi5pbnNfaCxuLndpbmRvd1t0K1h0LTFdKSxuLnByZXZbdCZuLndfbWFza109bi5oZWFkW24uaW5zX2hdLG4uaGVhZFtuLmluc19oXT10LHQrK313aGlsZSgtLWUpO24uc3Ryc3RhcnQ9dCxuLmxvb2thaGVhZD1YdC0xLG1lKG4pfXJldHVybiBuLnN0cnN0YXJ0Kz1uLmxvb2thaGVhZCxuLmJsb2NrX3N0YXJ0PW4uc3Ryc3RhcnQsbi5pbnNlcnQ9bi5sb29rYWhlYWQsbi5sb29rYWhlYWQ9MCxuLm1hdGNoX2xlbmd0aD1uLnByZXZfbGVuZ3RoPVh0LTEsbi5tYXRjaF9hdmFpbGFibGU9MCx0Lm5leHRfaW49cyx0LmlucHV0PW8sdC5hdmFpbF9pbj1hLG4ud3JhcD1pLEF0fSxkZWZsYXRlSW5mbzoicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSJ9O2NvbnN0IFRlPSh0LGUpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKTt2YXIgRmU9ZnVuY3Rpb24odCl7Y29uc3QgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKDtlLmxlbmd0aDspe2NvbnN0IHI9ZS5zaGlmdCgpO2lmKHIpe2lmKCJvYmplY3QiIT10eXBlb2Ygcil0aHJvdyBuZXcgVHlwZUVycm9yKHIrIm11c3QgYmUgbm9uLW9iamVjdCIpO2Zvcihjb25zdCBlIGluIHIpVGUocixlKSYmKHRbZV09cltlXSl9fXJldHVybiB0fSxIZT17YXNzaWduOkZlLGZsYXR0ZW5DaHVua3M6dD0+e2xldCBlPTA7Zm9yKGxldCByPTAsbj10Lmxlbmd0aDtyPG47cisrKWUrPXRbcl0ubGVuZ3RoO2NvbnN0IHI9bmV3IFVpbnQ4QXJyYXkoZSk7Zm9yKGxldCBlPTAsbj0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl7bGV0IGk9dFtlXTtyLnNldChpLG4pLG4rPWkubGVuZ3RofXJldHVybiByfX07bGV0IFplPSEwO3RyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHQpe1plPSExfWNvbnN0IE1lPW5ldyBVaW50OEFycmF5KDI1Nik7Zm9yKGxldCB0PTA7dDwyNTY7dCsrKU1lW3RdPXQ+PTI1Mj82OnQ+PTI0OD81OnQ+PTI0MD80OnQ+PTIyND8zOnQ+PTE5Mj8yOjE7TWVbMjU0XT1NZVsyNTRdPTE7Y29uc3QgTmU9KHQsZSk9PntpZihlPDY1NTM0JiZ0LnN1YmFycmF5JiZaZSlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXkoMCxlKSk7bGV0IHI9IiI7Zm9yKGxldCBuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfTt2YXIgSWU9e3N0cmluZzJidWY6dD0+e2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RW5jb2RlciYmVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSlyZXR1cm4obmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCk7bGV0IGUscixuLGksYSxzPXQubGVuZ3RoLG89MDtmb3IoaT0wO2k8cztpKyspcj10LmNoYXJDb2RlQXQoaSksNTUyOTY9PSg2NDUxMiZyKSYmaSsxPHMmJihuPXQuY2hhckNvZGVBdChpKzEpLDU2MzIwPT0oNjQ1MTImbikmJihyPTY1NTM2KyhyLTU1Mjk2PDwxMCkrKG4tNTYzMjApLGkrKykpLG8rPXI8MTI4PzE6cjwyMDQ4PzI6cjw2NTUzNj8zOjQ7Zm9yKGU9bmV3IFVpbnQ4QXJyYXkobyksYT0wLGk9MDthPG87aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxyPDEyOD9lW2ErK109cjpyPDIwNDg/KGVbYSsrXT0xOTJ8cj4+PjYsZVthKytdPTEyOHw2MyZyKTpyPDY1NTM2PyhlW2ErK109MjI0fHI+Pj4xMixlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik6KGVbYSsrXT0yNDB8cj4+PjE4LGVbYSsrXT0xMjh8cj4+PjEyJjYzLGVbYSsrXT0xMjh8cj4+PjYmNjMsZVthKytdPTEyOHw2MyZyKTtyZXR1cm4gZX0sYnVmMnN0cmluZzoodCxlKT0+e2NvbnN0IHI9ZXx8dC5sZW5ndGg7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFRleHREZWNvZGVyJiZUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKXJldHVybihuZXcgVGV4dERlY29kZXIpLmRlY29kZSh0LnN1YmFycmF5KDAsZSkpO2xldCBuLGk7Y29uc3QgYT1uZXcgQXJyYXkoMipyKTtmb3IoaT0wLG49MDtuPHI7KXtsZXQgZT10W24rK107aWYoZTwxMjgpe2FbaSsrXT1lO2NvbnRpbnVlfWxldCBzPU1lW2VdO2lmKHM+NClhW2krK109NjU1MzMsbis9cy0xO2Vsc2V7Zm9yKGUmPTI9PT1zPzMxOjM9PT1zPzE1Ojc7cz4xJiZuPHI7KWU9ZTw8Nnw2MyZ0W24rK10scy0tO3M+MT9hW2krK109NjU1MzM6ZTw2NTUzNj9hW2krK109ZTooZS09NjU1MzYsYVtpKytdPTU1Mjk2fGU+PjEwJjEwMjMsYVtpKytdPTU2MzIwfDEwMjMmZSl9fXJldHVybiBOZShhLGkpfSx1dGY4Ym9yZGVyOih0LGUpPT57KGU9ZXx8dC5sZW5ndGgpPnQubGVuZ3RoJiYoZT10Lmxlbmd0aCk7bGV0IHI9ZS0xO2Zvcig7cj49MCYmMTI4PT0oMTkyJnRbcl0pOylyLS07cmV0dXJuIHI8MHx8MD09PXI/ZTpyK01lW3Rbcl1dPmU/cjplfX07ZnVuY3Rpb24gUGUoKXt0aGlzLmlucHV0PW51bGwsdGhpcy5uZXh0X2luPTAsdGhpcy5hdmFpbF9pbj0wLHRoaXMudG90YWxfaW49MCx0aGlzLm91dHB1dD1udWxsLHRoaXMubmV4dF9vdXQ9MCx0aGlzLmF2YWlsX291dD0wLHRoaXMudG90YWxfb3V0PTAsdGhpcy5tc2c9IiIsdGhpcy5zdGF0ZT1udWxsLHRoaXMuZGF0YV90eXBlPTIsdGhpcy5hZGxlcj0wfXZhciBqZT1QZTtjb25zdCAkZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHtaX05PX0ZMVVNIOktlLFpfU1lOQ19GTFVTSDpYZSxaX0ZVTExfRkxVU0g6R2UsWl9GSU5JU0g6V2UsWl9PSzpZZSxaX1NUUkVBTV9FTkQ6cWUsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOlZlLFpfREVGQVVMVF9TVFJBVEVHWTpRZSxaX0RFRkxBVEVEOkplfT1mdDtmdW5jdGlvbiB0cih0KXt0aGlzLm9wdGlvbnM9SGUuYXNzaWduKHtsZXZlbDpWZSxtZXRob2Q6SmUsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTpRZX0sdHx8e30pO2xldCBlPXRoaXMub3B0aW9ucztlLnJhdyYmZS53aW5kb3dCaXRzPjA/ZS53aW5kb3dCaXRzPS1lLndpbmRvd0JpdHM6ZS5nemlwJiZlLndpbmRvd0JpdHM+MCYmZS53aW5kb3dCaXRzPDE2JiYoZS53aW5kb3dCaXRzKz0xNiksdGhpcy5lcnI9MCx0aGlzLm1zZz0iIix0aGlzLmVuZGVkPSExLHRoaXMuY2h1bmtzPVtdLHRoaXMuc3RybT1uZXcgamUsdGhpcy5zdHJtLmF2YWlsX291dD0wO2xldCByPUNlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sZS5sZXZlbCxlLm1ldGhvZCxlLndpbmRvd0JpdHMsZS5tZW1MZXZlbCxlLnN0cmF0ZWd5KTtpZihyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTtpZihlLmhlYWRlciYmQ2UuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sZS5oZWFkZXIpLGUuZGljdGlvbmFyeSl7bGV0IHQ7aWYodD0ic3RyaW5nIj09dHlwZW9mIGUuZGljdGlvbmFyeT9JZS5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwoZS5kaWN0aW9uYXJ5KT9uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpOmUuZGljdGlvbmFyeSxyPUNlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSx0KSxyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gZXIodCxlKXtjb25zdCByPW5ldyB0cihlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fGR0W3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9ZnVuY3Rpb24gcnIodCxlKXtyZXR1cm4oZT1lfHx7fSkucmF3PSEwLGVyKHQsZSl9ZnVuY3Rpb24gbnIodCxlKXtyZXR1cm4oZT1lfHx7fSkuZ3ppcD0hMCxlcih0LGUpfXRyLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7Y29uc3Qgcj10aGlzLnN0cm0sbj10aGlzLm9wdGlvbnMuY2h1bmtTaXplO2xldCBpLGE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtmb3IoYT1lPT09fn5lP2U6ITA9PT1lP1dlOktlLCJzdHJpbmciPT10eXBlb2YgdD9yLmlucHV0PUllLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwodCk/ci5pbnB1dD1uZXcgVWludDhBcnJheSh0KTpyLmlucHV0PXQsci5uZXh0X2luPTAsci5hdmFpbF9pbj1yLmlucHV0Lmxlbmd0aDs7KWlmKDA9PT1yLmF2YWlsX291dCYmKHIub3V0cHV0PW5ldyBVaW50OEFycmF5KG4pLHIubmV4dF9vdXQ9MCxyLmF2YWlsX291dD1uKSwoYT09PVhlfHxhPT09R2UpJiZyLmF2YWlsX291dDw9Nil0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2V7aWYoaT1DZS5kZWZsYXRlKHIsYSksaT09PXFlKXJldHVybiByLm5leHRfb3V0PjAmJnRoaXMub25EYXRhKHIub3V0cHV0LnN1YmFycmF5KDAsci5uZXh0X291dCkpLGk9Q2UuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQoaSksdGhpcy5lbmRlZD0hMCxpPT09WWU7aWYoMCE9PXIuYXZhaWxfb3V0KXtpZihhPjAmJnIubmV4dF9vdXQ+MCl0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2UgaWYoMD09PXIuYXZhaWxfaW4pYnJlYWt9ZWxzZSB0aGlzLm9uRGF0YShyLm91dHB1dCl9cmV0dXJuITB9LHRyLnByb3RvdHlwZS5vbkRhdGE9ZnVuY3Rpb24odCl7dGhpcy5jaHVua3MucHVzaCh0KX0sdHIucHJvdG90eXBlLm9uRW5kPWZ1bmN0aW9uKHQpe3Q9PT1ZZSYmKHRoaXMucmVzdWx0PUhlLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9O3ZhciBpcj10cixhcj1lcixzcj1ycixvcj1ucixscj1mdCxocj17RGVmbGF0ZTppcixkZWZsYXRlOmFyLGRlZmxhdGVSYXc6c3IsZ3ppcDpvcixjb25zdGFudHM6bHJ9O3QuRGVmbGF0ZT1pcix0LmNvbnN0YW50cz1scix0LmRlZmF1bHQ9aHIsdC5kZWZsYXRlPWFyLHQuZGVmbGF0ZVJhdz1zcix0Lmd6aXA9b3IsT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pfShhLmV4cG9ydHMpKSxhLmV4cG9ydHMpLG89e2V4cG9ydHM6e319O3ZhciBsLGg9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGMoKXtyZXR1cm4gbHx8KGw9MSxoLmV4cG9ydHM9KGU9ZXx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5jcnlwdG8mJihuPWdsb2JhbFRoaXMuY3J5cHRvKSwhbiYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5tc0NyeXB0byYmKG49d2luZG93Lm1zQ3J5cHRvKSwhbiYmdm9pZCAwIT09dCYmdC5jcnlwdG8mJihuPXQuY3J5cHRvKSwhbil0cnl7bj1yZXF1aXJlKCJjcnlwdG8iKX1jYXRjaCh0KXt9dmFyIGk9ZnVuY3Rpb24oKXtpZihuKXtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5nZXRSYW5kb21WYWx1ZXMpdHJ5e3JldHVybiBuLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdfWNhdGNoKHQpe31pZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5yYW5kb21CeXRlcyl0cnl7cmV0dXJuIG4ucmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKX1jYXRjaCh0KXt9fXRocm93IG5ldyBFcnJvcigiTmF0aXZlIGNyeXB0byBtb2R1bGUgY291bGQgbm90IGJlIHVzZWQgdG8gZ2V0IHNlY3VyZSByYW5kb20gbnVtYmVyLiIpfSxhPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPWUscj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLHM9e30sbz1zLmxpYj17fSxsPW8uQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBlPWEodGhpcyk7cmV0dXJuIHQmJmUubWl4SW4odCksZS5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1lLmluaXR8fChlLmluaXQ9ZnVuY3Rpb24oKXtlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGUuaW5pdC5wcm90b3R5cGU9ZSxlLiRzdXBlcj10aGlzLGV9LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShlKSYmKHRoaXNbZV09dFtlXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0saD1vLldvcmRBcnJheT1sLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPWUhPXI/ZTo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dSkuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKyspe3ZhciBzPXJbYT4+PjJdPj4+MjQtYSU0KjgmMjU1O2VbbithPj4+Ml18PXM8PDI0LShuK2EpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288aTtvKz00KWVbbitvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPWksdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlczt0W3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0KjgsdC5sZW5ndGg9ZS5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9bC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxyPTA7cjx0O3IrPTQpZS5wdXNoKGkoKSk7cmV0dXJuIG5ldyBoLmluaXQoZSx0KX19KSxjPXMuZW5jPXt9LHU9Yy5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgaC5pbml0KHIsZS8yKX19LF89Yy5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKylyW24+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGguaW5pdChyLGUpfX0sZD1jLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoXy5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gXy5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LGY9by5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWwuZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IGguaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1kLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbih0KXt2YXIgcixuPXRoaXMuX2RhdGEsaT1uLndvcmRzLGE9bi5zaWdCeXRlcyxzPXRoaXMuYmxvY2tTaXplLG89YS8oNCpzKSxsPShvPXQ/ZS5jZWlsKG8pOmUubWF4KCgwfG8pLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKnMsYz1lLm1pbig0KmwsYSk7aWYobCl7Zm9yKHZhciB1PTA7dTxsO3UrPXMpdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSx1KTtyPWkuc3BsaWNlKDAsbCksbi5zaWdCeXRlcy09Y31yZXR1cm4gbmV3IGguaW5pdChyLGMpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWwuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH0sX21pbkJ1ZmZlclNpemU6MH0pO28uSGFzaGVyPWYuZXh0ZW5kKHtjZmc6bC5leHRlbmQoKSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7Zi5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxibG9ja1NpemU6MTYsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHQuaW5pdChyKS5maW5hbGl6ZShlKX19LF9jcmVhdGVIbWFjSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgcC5ITUFDLmluaXQodCxyKS5maW5hbGl6ZShlKX19fSk7dmFyIHA9cy5hbGdvPXt9O3JldHVybiBzfShNYXRoKSxlKSksaC5leHBvcnRzO3ZhciBlfXZhciB1O2Z1bmN0aW9uIF8oKXtyZXR1cm4gdXx8KHU9MSxvLmV4cG9ydHM9KHQ9YygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLldvcmRBcnJheTtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIGk9W10sYT0wLHM9MDtzPGU7cysrKWlmKHMlNCl7dmFyIG89blt0LmNoYXJDb2RlQXQocy0xKV08PHMlNCoyfG5bdC5jaGFyQ29kZUF0KHMpXT4+PjYtcyU0KjI7aVthPj4+Ml18PW88PDI0LWElNCo4LGErK31yZXR1cm4gci5jcmVhdGUoaSxhKX1lLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLGE9MDthPHI7YSs9Mylmb3IodmFyIHM9KGVbYT4+PjJdPj4+MjQtYSU0KjgmMjU1KTw8MTZ8KGVbYSsxPj4+Ml0+Pj4yNC0oYSsxKSU0KjgmMjU1KTw8OHxlW2ErMj4+PjJdPj4+MjQtKGErMiklNCo4JjI1NSxvPTA7bzw0JiZhKy43NSpvPHI7bysrKWkucHVzaChuLmNoYXJBdChzPj4+NiooMy1vKSY2MykpO3ZhciBsPW4uY2hhckF0KDY0KTtpZihsKWZvcig7aS5sZW5ndGglNDspaS5wdXNoKGwpO3JldHVybiBpLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZT10Lmxlbmd0aCxyPXRoaXMuX21hcCxpPXRoaXMuX3JldmVyc2VNYXA7aWYoIWkpe2k9dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIGE9MDthPHIubGVuZ3RoO2ErKylpW3IuY2hhckNvZGVBdChhKV09YX12YXIgcz1yLmNoYXJBdCg2NCk7aWYocyl7dmFyIG89dC5pbmRleE9mKHMpOy0xIT09byYmKGU9byl9cmV0dXJuIG4odCxlLGkpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9fSgpLHQuZW5jLkJhc2U2NCkpLG8uZXhwb3J0czt2YXIgdH12YXIgZCxmPWUoXygpKSxwPXtleHBvcnRzOnt9fSxnPXtleHBvcnRzOnt9fTtmdW5jdGlvbiB5KCl7cmV0dXJuIGR8fChkPTEsZy5leHBvcnRzPSh0PWMoKSxmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLHM9ci5hbGdvLG89W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PTA7dDw2NDt0Kyspb1t0XT00Mjk0OTY3Mjk2KmUuYWJzKGUuc2luKHQrMSkpfDB9KCk7dmFyIGw9cy5NRDU9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTA7cjwxNjtyKyspe3ZhciBuPWUrcixpPXRbbl07dFtuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgYT10aGlzLl9oYXNoLndvcmRzLHM9dFtlKzBdLGw9dFtlKzFdLGQ9dFtlKzJdLGY9dFtlKzNdLHA9dFtlKzRdLGc9dFtlKzVdLHk9dFtlKzZdLHc9dFtlKzddLHY9dFtlKzhdLG09dFtlKzldLGI9dFtlKzEwXSx4PXRbZSsxMV0saz10W2UrMTJdLHo9dFtlKzEzXSxBPXRbZSsxNF0sRT10W2UrMTVdLFM9YVswXSxCPWFbMV0sTz1hWzJdLFI9YVszXTtTPWgoUyxCLE8sUixzLDcsb1swXSksUj1oKFIsUyxCLE8sbCwxMixvWzFdKSxPPWgoTyxSLFMsQixkLDE3LG9bMl0pLEI9aChCLE8sUixTLGYsMjIsb1szXSksUz1oKFMsQixPLFIscCw3LG9bNF0pLFI9aChSLFMsQixPLGcsMTIsb1s1XSksTz1oKE8sUixTLEIseSwxNyxvWzZdKSxCPWgoQixPLFIsUyx3LDIyLG9bN10pLFM9aChTLEIsTyxSLHYsNyxvWzhdKSxSPWgoUixTLEIsTyxtLDEyLG9bOV0pLE89aChPLFIsUyxCLGIsMTcsb1sxMF0pLEI9aChCLE8sUixTLHgsMjIsb1sxMV0pLFM9aChTLEIsTyxSLGssNyxvWzEyXSksUj1oKFIsUyxCLE8seiwxMixvWzEzXSksTz1oKE8sUixTLEIsQSwxNyxvWzE0XSksUz1jKFMsQj1oKEIsTyxSLFMsRSwyMixvWzE1XSksTyxSLGwsNSxvWzE2XSksUj1jKFIsUyxCLE8seSw5LG9bMTddKSxPPWMoTyxSLFMsQix4LDE0LG9bMThdKSxCPWMoQixPLFIsUyxzLDIwLG9bMTldKSxTPWMoUyxCLE8sUixnLDUsb1syMF0pLFI9YyhSLFMsQixPLGIsOSxvWzIxXSksTz1jKE8sUixTLEIsRSwxNCxvWzIyXSksQj1jKEIsTyxSLFMscCwyMCxvWzIzXSksUz1jKFMsQixPLFIsbSw1LG9bMjRdKSxSPWMoUixTLEIsTyxBLDksb1syNV0pLE89YyhPLFIsUyxCLGYsMTQsb1syNl0pLEI9YyhCLE8sUixTLHYsMjAsb1syN10pLFM9YyhTLEIsTyxSLHosNSxvWzI4XSksUj1jKFIsUyxCLE8sZCw5LG9bMjldKSxPPWMoTyxSLFMsQix3LDE0LG9bMzBdKSxTPXUoUyxCPWMoQixPLFIsUyxrLDIwLG9bMzFdKSxPLFIsZyw0LG9bMzJdKSxSPXUoUixTLEIsTyx2LDExLG9bMzNdKSxPPXUoTyxSLFMsQix4LDE2LG9bMzRdKSxCPXUoQixPLFIsUyxBLDIzLG9bMzVdKSxTPXUoUyxCLE8sUixsLDQsb1szNl0pLFI9dShSLFMsQixPLHAsMTEsb1szN10pLE89dShPLFIsUyxCLHcsMTYsb1szOF0pLEI9dShCLE8sUixTLGIsMjMsb1szOV0pLFM9dShTLEIsTyxSLHosNCxvWzQwXSksUj11KFIsUyxCLE8scywxMSxvWzQxXSksTz11KE8sUixTLEIsZiwxNixvWzQyXSksQj11KEIsTyxSLFMseSwyMyxvWzQzXSksUz11KFMsQixPLFIsbSw0LG9bNDRdKSxSPXUoUixTLEIsTyxrLDExLG9bNDVdKSxPPXUoTyxSLFMsQixFLDE2LG9bNDZdKSxTPV8oUyxCPXUoQixPLFIsUyxkLDIzLG9bNDddKSxPLFIscyw2LG9bNDhdKSxSPV8oUixTLEIsTyx3LDEwLG9bNDldKSxPPV8oTyxSLFMsQixBLDE1LG9bNTBdKSxCPV8oQixPLFIsUyxnLDIxLG9bNTFdKSxTPV8oUyxCLE8sUixrLDYsb1s1Ml0pLFI9XyhSLFMsQixPLGYsMTAsb1s1M10pLE89XyhPLFIsUyxCLGIsMTUsb1s1NF0pLEI9XyhCLE8sUixTLGwsMjEsb1s1NV0pLFM9XyhTLEIsTyxSLHYsNixvWzU2XSksUj1fKFIsUyxCLE8sRSwxMCxvWzU3XSksTz1fKE8sUixTLEIseSwxNSxvWzU4XSksQj1fKEIsTyxSLFMseiwyMSxvWzU5XSksUz1fKFMsQixPLFIscCw2LG9bNjBdKSxSPV8oUixTLEIsTyx4LDEwLG9bNjFdKSxPPV8oTyxSLFMsQixkLDE1LG9bNjJdKSxCPV8oQixPLFIsUyxtLDIxLG9bNjNdKSxhWzBdPWFbMF0rU3wwLGFbMV09YVsxXStCfDAsYVsyXT1hWzJdK098MCxhWzNdPWFbM10rUnwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JbaT4+PjVdfD0xMjg8PDI0LWklMzI7dmFyIGE9ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLHM9bjtyWzE1KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpLHJbMTQrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKHM8PDh8cz4+PjI0KXw0Mjc4MjU1MzYwJihzPDwyNHxzPj4+OCksdC5zaWdCeXRlcz00KihyLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsbD1vLndvcmRzLGg9MDtoPDQ7aCsrKXt2YXIgYz1sW2hdO2xbaF09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIG99LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2Z1bmN0aW9uIGgodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZSZyfH5lJm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBjKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmbnxyJn5uKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gdSh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlXnJebikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIF8odCxlLHIsbixpLGEscyl7dmFyIG89dCsocl4oZXx+bikpK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1yLk1ENT1hLl9jcmVhdGVIZWxwZXIobCksci5IbWFjTUQ1PWEuX2NyZWF0ZUhtYWNIZWxwZXIobCl9KE1hdGgpLHQuTUQ1KSksZy5leHBvcnRzO3ZhciB0fXZhciB3LHY9e2V4cG9ydHM6e319LG09e2V4cG9ydHM6e319O2Z1bmN0aW9uIGIoKXtyZXR1cm4gd3x8KHc9MSxtLmV4cG9ydHM9KHQ9YygpLGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5Xb3JkQXJyYXksaT1yLkhhc2hlcixhPWUuYWxnbyxzPVtdLG89YS5TSEExPWkuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IG4uaW5pdChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4LDMyODUzNzc1MjBdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0sbz1yWzNdLGw9cls0XSxoPTA7aDw4MDtoKyspe2lmKGg8MTYpc1toXT0wfHRbZStoXTtlbHNle3ZhciBjPXNbaC0zXV5zW2gtOF1ec1toLTE0XV5zW2gtMTZdO3NbaF09Yzw8MXxjPj4+MzF9dmFyIHU9KG48PDV8bj4+PjI3KStsK3NbaF07dSs9aDwyMD8xNTE4NTAwMjQ5KyhpJmF8fmkmbyk6aDw0MD8xODU5Nzc1MzkzKyhpXmFebyk6aDw2MD8oaSZhfGkmb3xhJm8pLTE4OTQwMDc1ODg6KGleYV5vKS04OTk0OTc1MTQsbD1vLG89YSxhPWk8PDMwfGk+Pj4yLGk9bixuPXV9clswXT1yWzBdK258MCxyWzFdPXJbMV0raXwwLHJbMl09clsyXSthfDAsclszXT1yWzNdK298MCxyWzRdPXJbNF0rbHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEsZT10LndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCp0LnNpZ0J5dGVzO3JldHVybiBlW24+Pj41XXw9MTI4PDwyNC1uJTMyLGVbMTQrKG4rNjQ+Pj45PDw0KV09TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGVbMTUrKG4rNjQ+Pj45PDw0KV09cix0LnNpZ0J5dGVzPTQqZS5sZW5ndGgsdGhpcy5fcHJvY2VzcygpLHRoaXMuX2hhc2h9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2UuU0hBMT1pLl9jcmVhdGVIZWxwZXIobyksZS5IbWFjU0hBMT1pLl9jcmVhdGVIbWFjSGVscGVyKG8pfSgpLHQuU0hBMSkpLG0uZXhwb3J0czt2YXIgdH12YXIgeCxrPXtleHBvcnRzOnt9fTtmdW5jdGlvbiB6KCl7cmV0dXJuIHh8fCh4PTEsay5leHBvcnRzPSh0PWMoKSxyPShlPXQpLmxpYi5CYXNlLG49ZS5lbmMuVXRmOCx2b2lkKGUuYWxnby5ITUFDPXIuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLl9oYXNoZXI9bmV3IHQuaW5pdCwic3RyaW5nIj09dHlwZW9mIGUmJihlPW4ucGFyc2UoZSkpO3ZhciByPXQuYmxvY2tTaXplLGk9NCpyO2Uuc2lnQnl0ZXM+aSYmKGU9dC5maW5hbGl6ZShlKSksZS5jbGFtcCgpO2Zvcih2YXIgYT10aGlzLl9vS2V5PWUuY2xvbmUoKSxzPXRoaXMuX2lLZXk9ZS5jbG9uZSgpLG89YS53b3JkcyxsPXMud29yZHMsaD0wO2g8cjtoKyspb1toXV49MTU0OTU1NjgyOCxsW2hdXj05MDk1MjI0ODY7YS5zaWdCeXRlcz1zLnNpZ0J5dGVzPWksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2hhc2hlcjt0LnJlc2V0KCksdC51cGRhdGUodGhpcy5faUtleSl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9oYXNoZXIscj1lLmZpbmFsaXplKHQpO3JldHVybiBlLnJlc2V0KCksZS5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19KSkpKSxrLmV4cG9ydHM7dmFyIHQsZSxyLG59dmFyIEE7ZnVuY3Rpb24gRSgpe3JldHVybiBBfHwoQT0xLHYuZXhwb3J0cz0odD1jKCksYigpLHooKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuQmFzZSxpPXIuV29yZEFycmF5LGE9ZS5hbGdvLHM9YS5NRDUsbz1hLkV2cEtERj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtrZXlTaXplOjQsaGFzaGVyOnMsaXRlcmF0aW9uczoxfSksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCl9LGNvbXB1dGU6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHIsbj10aGlzLmNmZyxhPW4uaGFzaGVyLmNyZWF0ZSgpLHM9aS5jcmVhdGUoKSxvPXMud29yZHMsbD1uLmtleVNpemUsaD1uLml0ZXJhdGlvbnM7by5sZW5ndGg8bDspe3ImJmEudXBkYXRlKHIpLHI9YS51cGRhdGUodCkuZmluYWxpemUoZSksYS5yZXNldCgpO2Zvcih2YXIgYz0xO2M8aDtjKyspcj1hLmZpbmFsaXplKHIpLGEucmVzZXQoKTtzLmNvbmNhdChyKX1yZXR1cm4gcy5zaWdCeXRlcz00Kmwsc319KTtlLkV2cEtERj1mdW5jdGlvbih0LGUscil7cmV0dXJuIG8uY3JlYXRlKHIpLmNvbXB1dGUodCxlKX19KCksdC5FdnBLREYpKSx2LmV4cG9ydHM7dmFyIHR9dmFyIFMsQj17ZXhwb3J0czp7fX07dmFyIE87dmFyIFIsRCxMPShPfHwoTz0xLHAuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxhPVtdLHM9W10sbz1bXSxsPVtdLGg9W10sYz1bXSx1PVtdLF89W10sZD1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBmPW5ebjw8MV5uPDwyXm48PDNebjw8NDtmPWY+Pj44XjI1NSZmXjk5LGlbcl09ZixhW2ZdPXI7dmFyIHA9dFtyXSxnPXRbcF0seT10W2ddLHc9MjU3KnRbZl1eMTY4NDMwMDgqZjtzW3JdPXc8PDI0fHc+Pj44LG9bcl09dzw8MTZ8dz4+PjE2LGxbcl09dzw8OHx3Pj4+MjQsaFtyXT13LHc9MTY4NDMwMDkqeV42NTUzNypnXjI1NypwXjE2ODQzMDA4KnIsY1tmXT13PDwyNHx3Pj4+OCx1W2ZdPXc8PDE2fHc+Pj4xNixfW2ZdPXc8PDh8dz4+PjI0LGRbZl09dyxyPyhyPXBedFt0W3RbeV5wXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgZj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0scD1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksYT10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/YVtzXT1lW3NdOihoPWFbcy0xXSxzJXI/cj42JiZzJXI9PTQmJihoPWlbaD4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdKTooaD1pWyhoPWg8PDh8aD4+PjI0KT4+PjI0XTw8MjR8aVtoPj4+MTYmMjU1XTw8MTZ8aVtoPj4+OCYyNTVdPDw4fGlbMjU1JmhdLGhePWZbcy9yfDBdPDwyNCksYVtzXT1hW3Mtcl1eaCk7Zm9yKHZhciBvPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGw9MDtsPG47bCsrKXtpZihzPW4tbCxsJTQpdmFyIGg9YVtzXTtlbHNlIGg9YVtzLTRdO29bbF09bDw0fHxzPD00P2g6Y1tpW2g+Pj4yNF1dXnVbaVtoPj4+MTYmMjU1XV1eX1tpW2g+Pj44JjI1NV1dXmRbaVsyNTUmaF1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxvLGwsaCxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxjLHUsXyxkLGEpLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLGEscyxvKXtmb3IodmFyIGw9dGhpcy5fblJvdW5kcyxoPXRbZV1eclswXSxjPXRbZSsxXV5yWzFdLHU9dFtlKzJdXnJbMl0sXz10W2UrM11eclszXSxkPTQsZj0xO2Y8bDtmKyspe3ZhciBwPW5baD4+PjI0XV5pW2M+Pj4xNiYyNTVdXmFbdT4+PjgmMjU1XV5zWzI1NSZfXV5yW2QrK10sZz1uW2M+Pj4yNF1eaVt1Pj4+MTYmMjU1XV5hW18+Pj44JjI1NV1ec1syNTUmaF1ecltkKytdLHk9blt1Pj4+MjRdXmlbXz4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXnNbMjU1JmNdXnJbZCsrXSx3PW5bXz4+PjI0XV5pW2g+Pj4xNiYyNTVdXmFbYz4+PjgmMjU1XV5zWzI1NSZ1XV5yW2QrK107aD1wLGM9Zyx1PXksXz13fXA9KG9baD4+PjI0XTw8MjR8b1tjPj4+MTYmMjU1XTw8MTZ8b1t1Pj4+OCYyNTVdPDw4fG9bMjU1Jl9dKV5yW2QrK10sZz0ob1tjPj4+MjRdPDwyNHxvW3U+Pj4xNiYyNTVdPDwxNnxvW18+Pj44JjI1NV08PDh8b1syNTUmaF0pXnJbZCsrXSx5PShvW3U+Pj4yNF08PDI0fG9bXz4+PjE2JjI1NV08PDE2fG9baD4+PjgmMjU1XTw8OHxvWzI1NSZjXSlecltkKytdLHc9KG9bXz4+PjI0XTw8MjR8b1toPj4+MTYmMjU1XTw8MTZ8b1tjPj4+OCYyNTVdPDw4fG9bMjU1JnVdKV5yW2QrK10sdFtlXT1wLHRbZSsxXT1nLHRbZSsyXT15LHRbZSszXT13fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIocCl9KCksdC5BRVN9KGMoKSxfKCkseSgpLEUoKSxTfHwoUz0xLEIuZXhwb3J0cz0oUj1jKCksRSgpLHZvaWQoUi5saWIuQ2lwaGVyfHxmdW5jdGlvbih0KXt2YXIgZT1SLHI9ZS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxhPXIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobSxzPWUuZW5jO3MuVXRmODt2YXIgbz1zLkJhc2U2NCxsPWUuYWxnby5FdnBLREYsaD1yLkNpcGhlcj1hLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKCksY3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSxyKXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQociksdGhpcy5feGZvcm1Nb2RlPXQsdGhpcy5fa2V5PWUsdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe2EucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHByb2Nlc3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCl9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxrZXlTaXplOjQsaXZTaXplOjQsX0VOQ19YRk9STV9NT0RFOjEsX0RFQ19YRk9STV9NT0RFOjIsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3c6Z31yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19KCl9KTtyLlN0cmVhbUNpcGhlcj1oLmV4dGVuZCh7X2RvRmluYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcHJvY2VzcyghMCl9LGJsb2NrU2l6ZToxfSk7dmFyIGM9ZS5tb2RlPXt9LHU9ci5CbG9ja0NpcGhlck1vZGU9bi5leHRlbmQoe2NyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUodCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZSh0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSl7dGhpcy5fY2lwaGVyPXQsdGhpcy5faXY9ZX19KSxfPWMuQ0JDPWZ1bmN0aW9uKCl7dmFyIGU9dS5leHRlbmQoKTtmdW5jdGlvbiByKGUscixuKXt2YXIgaSxhPXRoaXMuX2l2O2E/KGk9YSx0aGlzLl9pdj10KTppPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIHM9MDtzPG47cysrKWVbcitzXV49aVtzXX1yZXR1cm4gZS5FbmNyeXB0b3I9ZS5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplO3IuY2FsbCh0aGlzLHQsZSxpKSxuLmVuY3J5cHRCbG9jayh0LGUpLHRoaXMuX3ByZXZCbG9jaz10LnNsaWNlKGUsZStpKX19KSxlLkRlY3J5cHRvcj1lLmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemUsYT10LnNsaWNlKGUsZStpKTtuLmRlY3J5cHRCbG9jayh0LGUpLHIuY2FsbCh0aGlzLHQsZSxpKSx0aGlzLl9wcmV2QmxvY2s9YX19KSxlfSgpLGQ9KGUucGFkPXt9KS5Qa2NzNz17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGE9bjw8MjR8bjw8MTZ8bjw8OHxuLHM9W10sbz0wO288bjtvKz00KXMucHVzaChhKTt2YXIgbD1pLmNyZWF0ZShzLG4pO3QuY29uY2F0KGwpfSx1bnBhZDpmdW5jdGlvbih0KXt2YXIgZT0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1lfX07ci5CbG9ja0NpcGhlcj1oLmV4dGVuZCh7Y2ZnOmguY2ZnLmV4dGVuZCh7bW9kZTpfLHBhZGRpbmc6ZH0pLHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ7aC5yZXNldC5jYWxsKHRoaXMpO3ZhciBlPXRoaXMuY2ZnLHI9ZS5pdixuPWUubW9kZTt0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFP3Q9bi5jcmVhdGVFbmNyeXB0b3I6KHQ9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlJiZ0aGlzLl9tb2RlLl9fY3JlYXRvcj09dD90aGlzLl9tb2RlLmluaXQodGhpcyxyJiZyLndvcmRzKToodGhpcy5fbW9kZT10LmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPXQpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh0LGUpfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT8oZS5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksdD10aGlzLl9wcm9jZXNzKCEwKSk6KHQ9dGhpcy5fcHJvY2VzcyghMCksZS51bnBhZCh0KSksdH0sYmxvY2tTaXplOjR9KTt2YXIgZj1yLkNpcGhlclBhcmFtcz1uLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0KXt0aGlzLm1peEluKHQpfSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19KSxwPShlLmZvcm1hdD17fSkuT3BlblNTTD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9pLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdChlKTplKS50b1N0cmluZyhvKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGUscj1vLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09blswXSYmMTcwMTA3NjgzMT09blsxXSYmKGU9aS5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxmLmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6ZX0pfX0sZz1yLlNlcmlhbGl6YWJsZUNpcGhlcj1uLmV4dGVuZCh7Y2ZnOm4uZXh0ZW5kKHtmb3JtYXQ6cH0pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobik7dmFyIGk9dC5jcmVhdGVFbmNyeXB0b3IocixuKSxhPWkuZmluYWxpemUoZSkscz1pLmNmZztyZXR1cm4gZi5jcmVhdGUoe2NpcGhlcnRleHQ6YSxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTp0LmJsb2NrU2l6ZSxmb3JtYXR0ZXI6bi5mb3JtYXR9KX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtyZXR1cm4gbj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLG4pLmZpbmFsaXplKGUuY2lwaGVydGV4dCl9LF9wYXJzZTpmdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLnBhcnNlKHQsdGhpcyk6dH19KSx5PShlLmtkZj17fSkuT3BlblNTTD17ZXhlY3V0ZTpmdW5jdGlvbih0LGUscixuLGEpe2lmKG58fChuPWkucmFuZG9tKDgpKSxhKXM9bC5jcmVhdGUoe2tleVNpemU6ZStyLGhhc2hlcjphfSkuY29tcHV0ZSh0LG4pO2Vsc2UgdmFyIHM9bC5jcmVhdGUoe2tleVNpemU6ZStyfSkuY29tcHV0ZSh0LG4pO3ZhciBvPWkuY3JlYXRlKHMud29yZHMuc2xpY2UoZSksNCpyKTtyZXR1cm4gcy5zaWdCeXRlcz00KmUsZi5jcmVhdGUoe2tleTpzLGl2Om8sc2FsdDpufSl9fSx3PXIuUGFzc3dvcmRCYXNlZENpcGhlcj1nLmV4dGVuZCh7Y2ZnOmcuY2ZnLmV4dGVuZCh7a2RmOnl9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPShuPXRoaXMuY2ZnLmV4dGVuZChuKSkua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsbi5zYWx0LG4uaGFzaGVyKTtuLml2PWkuaXY7dmFyIGE9Zy5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIGEubWl4SW4oaSksYX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0LG4uaGFzaGVyKTtyZXR1cm4gbi5pdj1pLml2LGcuZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpKSkpKSkscC5leHBvcnRzKSxVPWUoTCksQz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gVCgpe3JldHVybiBEfHwoRD0xLEMuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI9dCxuPXIubGliLGk9bi5Xb3JkQXJyYXksYT1uLkhhc2hlcixzPXIuYWxnbyxvPVtdLGw9W107IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtmb3IodmFyIHI9ZS5zcXJ0KHQpLG49MjtuPD1yO24rKylpZighKHQlbikpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gcih0KXtyZXR1cm4gNDI5NDk2NzI5NioodC0oMHx0KSl8MH1mb3IodmFyIG49MixpPTA7aTw2NDspdChuKSYmKGk8OCYmKG9baV09cihlLnBvdyhuLC41KSkpLGxbaV09cihlLnBvdyhuLDEvMykpLGkrKyksbisrfSgpO3ZhciBoPVtdLGM9cy5TSEEyNTY9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KG8uc2xpY2UoMCkpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLGE9clsyXSxzPXJbM10sbz1yWzRdLGM9cls1XSx1PXJbNl0sXz1yWzddLGQ9MDtkPDY0O2QrKyl7aWYoZDwxNiloW2RdPTB8dFtlK2RdO2Vsc2V7dmFyIGY9aFtkLTE1XSxwPShmPDwyNXxmPj4+NyleKGY8PDE0fGY+Pj4xOCleZj4+PjMsZz1oW2QtMl0seT0oZzw8MTV8Zz4+PjE3KV4oZzw8MTN8Zz4+PjE5KV5nPj4+MTA7aFtkXT1wK2hbZC03XSt5K2hbZC0xNl19dmFyIHc9biZpXm4mYV5pJmEsdj0objw8MzB8bj4+PjIpXihuPDwxOXxuPj4+MTMpXihuPDwxMHxuPj4+MjIpLG09XysoKG88PDI2fG8+Pj42KV4obzw8MjF8bz4+PjExKV4obzw8N3xvPj4+MjUpKSsobyZjXn5vJnUpK2xbZF0raFtkXTtfPXUsdT1jLGM9byxvPXMrbXwwLHM9YSxhPWksaT1uLG49bSsodit3KXwwfXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStzfDAscls0XT1yWzRdK298MCxyWzVdPXJbNV0rY3wwLHJbNl09cls2XSt1fDAscls3XT1yWzddK198MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLHI9dC53b3JkcyxuPTgqdGhpcy5fbkRhdGFCeXRlcyxpPTgqdC5zaWdCeXRlcztyZXR1cm4gcltpPj4+NV18PTEyODw8MjQtaSUzMixyWzE0KyhpKzY0Pj4+OTw8NCldPWUuZmxvb3Iobi80Mjk0OTY3Mjk2KSxyWzE1KyhpKzY0Pj4+OTw8NCldPW4sdC5zaWdCeXRlcz00KnIubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWEuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtyLlNIQTI1Nj1hLl9jcmVhdGVIZWxwZXIoYyksci5IbWFjU0hBMjU2PWEuX2NyZWF0ZUhtYWNIZWxwZXIoYyl9KE1hdGgpLHQuU0hBMjU2fShjKCkpKSxDLmV4cG9ydHN9dmFyIEYsSD1lKFQoKSksWj17ZXhwb3J0czp7fX07dmFyIE0sTj0oRnx8KEY9MSxaLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5QnVmZmVyKXt2YXIgZT10LmxpYi5Xb3JkQXJyYXkscj1lLmluaXQsbj1lLmluaXQ9ZnVuY3Rpb24odCl7aWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYodD1uZXcgVWludDhBcnJheSh0KSksKHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fCJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhDbGFtcGVkQXJyYXkmJnQgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheXx8dCBpbnN0YW5jZW9mIEludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIEludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBVaW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkmJih0PW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCx0LmJ5dGVMZW5ndGgpKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl7Zm9yKHZhciBlPXQuYnl0ZUxlbmd0aCxuPVtdLGk9MDtpPGU7aSsrKW5baT4+PjJdfD10W2ldPDwyNC1pJTQqODtyLmNhbGwodGhpcyxuLGUpfWVsc2Ugci5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O24ucHJvdG90eXBlPWV9fSgpLHQubGliLldvcmRBcnJheX0oYygpKSksWi5leHBvcnRzKSxJPWUoTiksUD17ZXhwb3J0czp7fX07dmFyIGo9KE18fChNPTEsUC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LkhtYWNTSEEyNTZ9KGMoKSxUKCkseigpKSksUC5leHBvcnRzKSwkPWUoaik7bGV0IEssWD1mZXRjaDt7Y29uc3R7cGFyZW50UG9ydDp0fT1yZXF1aXJlKCJ3b3JrZXJfdGhyZWFkcyIpO3Qub24oIm1lc3NhZ2UiLCh0PT5mdW5jdGlvbih0KXtjb25zdHtqb2I6ZSxjbWQ6cixzZXJ2ZXI6bixwYXRoOmksYnVmZmVyOmEsa2V5QmFzZTY0Om8sZ3ppcDpsLHJlZmVycmVyOmgsaWQ6YyxhcHBJZDp1LHBlcnNpc3RlbnRJZDpfLENST1FVRVRfVkVSU0lPTjpkLGRlYnVnOnAsd2hhdDpnLG9mZmxpbmU6eX09dC5kYXRhO3kmJihYPWspO3N3aXRjaChyKXtjYXNlInVwbG9hZEVuY3J5cHRlZCI6eChpKTticmVhaztjYXNlImdldE9mZmxpbmVGaWxlIjp6KHQuZGF0YS51cmwpO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5lcnJvcigiVW5rbm93biB3b3JrZXIgY29tbWFuZCIscil9ZnVuY3Rpb24gdyh0KXtjb25zdCBlPURhdGUubm93KCkscj1JLmNyZWF0ZSh0KSxuPWYucGFyc2UobyksaT0kKHIsbiksYT1JLnJhbmRvbSgxNikse2NpcGhlcnRleHQ6c309VS5lbmNyeXB0KHIsbix7aXY6YX0pLGw9bmV3IEFycmF5QnVmZmVyKDQrYS5zaWdCeXRlcytpLnNpZ0J5dGVzK3Muc2lnQnl0ZXMpLGg9bmV3IERhdGFWaWV3KGwpO2xldCB1PTA7aC5zZXRVaW50MzIodSwxMTI5NDY4MjA5LCExKSx1Kz00O2Zvcihjb25zdCB0IG9mW2EsaSxzXSlmb3IoY29uc3QgZSBvZiB0LndvcmRzKWguc2V0SW50MzIodSxlLCExKSx1Kz00O3JldHVybiBwJiZjb25zb2xlLmxvZyhjLGAke2d9IGVuY3J5cHRlZCAoJHtsLmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLGx9ZnVuY3Rpb24gdih0KXtjb25zdCBlPURhdGUubm93KCkscj1zLmRlZmxhdGUodCx7Z3ppcDohMCxsZXZlbDoxfSk7cmV0dXJuIHAmJmNvbnNvbGUubG9nKGMsYCR7Z30gY29tcHJlc3NlZCAoJHtyLmxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCkscn1mdW5jdGlvbiBtKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPUgoSS5jcmVhdGUodCkpLG49Zi5zdHJpbmdpZnkocikucmVwbGFjZSgvPS9nLCIiKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiBwJiZjb25zb2xlLmxvZyhjLGAke2d9IGhhc2hlZCAoJHt0LmJ5dGVMZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLG59YXN5bmMgZnVuY3Rpb24gYih0KXtpZih5KXtjb25zdCBlPWBvZmZsaW5lOi8vLyR7dH1gO3JldHVybnt1cmw6ZSx1cGxvYWRVcmw6ZX19Y29uc3QgZT1EYXRlLm5vdygpLHI9YCR7bi51cmx9LyR7dH1gO2lmKCFuLmFwaUtleSlyZXR1cm57dXJsOnIsdXBsb2FkVXJsOnJ9O2NvbnN0IGk9YXdhaXQgWChyLHtoZWFkZXJzOnsiWC1Dcm9xdWV0LUF1dGgiOm4uYXBpS2V5LCJYLUNyb3F1ZXQtQXBwIjp1LCJYLUNyb3F1ZXQtSWQiOl8sIlgtQ3JvcXVldC1TZXNzaW9uIjpjLCJYLUNyb3F1ZXQtVmVyc2lvbiI6ZCwiWC1Dcm9xdWV0LVBhdGgiOm5ldyBVUkwoaCkucGF0aG5hbWV9LHJlZmVycmVyOmh9KSx7b2s6YSxzdGF0dXM6cyxzdGF0dXNUZXh0Om99PWk7aWYoIWEpdGhyb3cgRXJyb3IoYEVycm9yIGluIHNpZ25pbmcgVVJMOiAke3N9IC0gJHtvfWApO2NvbnN0e2Vycm9yOmwscmVhZDpmLHdyaXRlOnd9PWF3YWl0IGkuanNvbigpO2lmKGwpdGhyb3cgRXJyb3IobCk7cmV0dXJuIHAmJmNvbnNvbGUubG9nKGMsYCR7Z30gdXBsb2FkIGF1dGhvcml6ZWQgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSx7dXJsOmYsdXBsb2FkVXJsOnd9fWFzeW5jIGZ1bmN0aW9uIHgodCl7dHJ5e2xldCByPXcobD92KGEpOmEpO3I9bmV3IFVpbnQ4QXJyYXkociksdC5pbmNsdWRlcygiJUhBU0glIikmJih0PXQucmVwbGFjZSgiJUhBU0glIixtKHIpKSk7Y29uc3R7dXBsb2FkVXJsOm4sdXJsOml9PWF3YWl0IGIodCkscz1EYXRlLm5vdygpLHtvazpvLHN0YXR1czp1LHN0YXR1c1RleHQ6X309YXdhaXQgWChuLHttZXRob2Q6IlBVVCIsbW9kZToiY29ycyIsaGVhZGVyczp7IkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSJ9LHJlZmVycmVyOmgsYm9keTpyfSk7aWYoIW8pdGhyb3cgRXJyb3IoYHNlcnZlciByZXR1cm5lZCAke3V9ICR7X30gZm9yIFBVVCAke259YCk7cCYmY29uc29sZS5sb2coYyxgJHtnfSB1cGxvYWRlZCAoJHt1fSkgaW4gJHtEYXRlLm5vdygpLXN9bXMgJHtpfWApLEsoe2pvYjplLHVybDppLG9rOm8sc3RhdHVzOnUsc3RhdHVzVGV4dDpfLGJ5dGVzOnIubGVuZ3RofSl9Y2F0Y2godCl7cCYmY29uc29sZS5lcnJvcihgJHtjfSB1cGxvYWQgZXJyb3IgJHt0Lm1lc3NhZ2V9YCksSyh7am9iOmUsb2s6ITEsc3RhdHVzOi0xLHN0YXR1c1RleHQ6dC5tZXNzYWdlfSl9fWZ1bmN0aW9uIGsodCxlKXtyZXR1cm4gcCYmY29uc29sZS5sb2coYyxgc3RvcmluZyAke3R9YCksRy5zZXQodCxlLmJvZHkpLHtvazohMCxzdGF0dXM6MjAxLHN0YXR1c1RleHQ6Ik9mZmxpbmUgY3JlYXRlZCJ9fWZ1bmN0aW9uIHoodCl7Y29uc3Qgcj1HLmdldCh0KTtpZighcilyZXR1cm4gcCYmY29uc29sZS5lcnJvcihgJHtjfSBmaWxlIG5vdCBmb3VuZCAke3R9YCksdm9pZCBLKHtqb2I6ZSxvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIG5vdCBmb3VuZCJ9KTtwJiZjb25zb2xlLmxvZyhjLGByZXRyaWV2ZWQgJHt0fWApLEsoe2pvYjplLG9rOiEwLHN0YXR1czoyMDAsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIGZvdW5kIixib2R5OnIsYnl0ZXM6ci5sZW5ndGh9KX19KHtkYXRhOnR9KSkpLEs9ZT0+dC5wb3N0TWVzc2FnZSh7ZGF0YTplfSl9Y29uc3QgRz1uZXcgTWFwfSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD11cGxvYWQuanMubWFwCgo=");globalThis.WebSocket=n.WebSocket;const il="2.0.4",nl="https://croquet.io/files/v1",rl="https://files.croquet.io",ol=rl;let al=null;function ll(){globalThis.__MULTISYNQ__||console.log("Croquet "+il);const e=d.dev||!1!==d.dev&&false;if(al={messages:d.has("debug","messages",!1),sends:d.has("debug","sends",!1),publish:d.has("debug","publish",!1),events:d.has("debug","events",!1),ticks:d.has("debug","ticks",!1),pong:d.has("debug","pong",!1),snapshot:d.has("debug","snapshot",!1),session:d.has("debug","session",!1),initsnapshot:d.has("debug","initsnapshot",!0),reflector:d.has("debug","reflector",e),offline:d.has("debug","offline",!1)},al.offline&&K.showMessage(`${K.libName}: offline mode enabled, no multiuser`,{level:"warning"}),d.box){let e=new URL(d.box,window.location).href;e.endsWith("/")||(e+="/"),d.reflector=e+"reflector",d.files=e+"files"}}function cl(e={}){al||ll(),"string"==typeof e&&(e=Object.fromEntries(e.split(",").map((t=>[t.replace(/^no/,""),!e.startsWith("no")]))));for(const[t,s]of Object.entries(e))t in al?al[t]=s:K.showMessage(`${K.libName}: unknown debug option "${t}"`,{level:"warning",only:"once"});return al}const dl="wss://api.multisynq.io/depin",hl=dl;let ul,ml,pl="reflector";const bl=d.nocheat,fl=200,yl=[0],gl=4096;let Zl;const Xl=new sl;Xl.onerror=e=>console.error(`UploadWorker error: ${e.message}`);let wl=0;const Gl=new Set;function vl(e=""){let t=null;for(const s of Gl)if(t||(t=s),s.id===e){t=s;break}if(t){const{appId:e,persistentId:s}=t.sessionSpec;return{appId:e,persistentId:s,key:t.key,uploadEncrypted:e=>t.uploadEncrypted(e),downloadEncrypted:e=>t.downloadEncrypted(e)}}return{}}Object.defineProperty(z,"controller",{get(){return this.controllers.values().next().value}}),z.controllers=Gl;class Ll{constructor(){al||ll(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new Sl(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,z.removeAllSubscriptionsFor(this.viewId),z.addSubscription(this.viewId,"__views__",this.viewId,(e=>Y(`users now ${e}`)),"oncePerFrameWhileSynced"),this.leaving||K.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;const{codeHash:e,computedCodeHash:t}=this.sessionSpec;return e!==t}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){const{name:s,optionsFromUrl:i,persistentIdOptions:n,password:r,appId:o,apiKey:a,viewData:l,viewIdDebugSuffix:c,location:h}=e,u=o?`${o}/${s}`:s;this.key=hn(r,"",{keySize:8,hasher:qi.algo.SHA1,iterations:1}),c&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+c).slice(0,16)).replace(/[^a-z0-9]/gi,(e=>`_${"%"===e?"":e.charCodeAt(0).toString(16).toUpperCase()}`)));const m={...e.options};if(i)for(const e of i)e in d&&(m[e]=d[e]);const p={},b={};for(const[e,t]of Object.entries(m))n?.includes(e)?p[e]=t:b[e]=t;const f=al.events||al.publish;f&&(b.__debugEvents=!0),h&&(b.__location=!0);const y=d.hashOverride||e.hashOverride,g=await async function(e,s){return k(e+t(s))}(u,p),{developerId:Z,token:X}=await this.verifyApiKey(a,o,g),{id:w,codeHash:G,computedCodeHash:v}=await async function(e,s,i,n,r){let o,a;const l=I[e];let c="";l?(o=l.codeHashes,a=l.computedCodeHash,c=" (code hashing from cache)"):(o=await Promise.all(V),a=await k([r,...o].join("|")),I[e]={codeHashes:o,computedCodeHash:a});const d=n||a,h=await k(e+"|"+s+t(i)+d);if(W()&&!P.has(h)){T[a].what="Version ID",T[e].what="Persistent ID",T[h].what="Session ID",d!==a&&(o.push(a),T[a].what="Computed Version ID (replaced by overrideHash)",T[d]={what:"Version ID (as specified by overrideHash)"});const t=[...o,d,e,h].map((e=>({hash:e,...T[e]})));console.log(`${K.libName}: Debug Hashing for session ${h}${c}`,t),P.add(h)}return W()||(T={}),{id:h,persistentId:e,codeHash:d,computedCodeHash:a}}(g,Z,b,y,il);this.tove||(this.tove=await this.encrypt(w)),l&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(l)),al.session&&console.log(`${K.libName} session "${u}":\n        sessionId=${w}${o?`\n        persistentId=${g}`:""}\n        versionId=${G===v?G:`${G} (specified in hashOverride)\n        versionId=${v} (computed)`}\n        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:m,name:u,id:w,persistentId:g,developerId:Z,token:X,codeHash:G,computedCodeHash:v,debugEvents:f};const{msPerTick:L,multiplier:S}=this.getTickAndMultiplier();this.msPerTick=L,this.tickMultiplier=S,this.setUpActivityChecks()}async establishSession(){const{id:e,persistentId:t,codeHash:s}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:s,created:(new Date).toISOString()}};const i=new Promise((e=>{this.sessionSpec.sessionJoined=e}));this.checkForConnection(!1),al.session&&console.log(e,"waiting for join and SYNC"),await i,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(e){if(al.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(d.box||d.reflector)return{apiKey:"none",signServer:"none",reflector:d.reflector};const t={};for(const s of e.split(",")){const e=s.lastIndexOf(":"),i=s[-1===e?0:e+1];if(!i?.match(/^[12]$/))throw Error("Invalid API key: "+s);if(i in t)throw Error("Duplicate API key versions");t[i]={key:-1===e?s:s.slice(e+1),backend:-1===e?"":s.slice(0,e)}}let s=!t[1];s&&t[2].backend&&(s=t[2].backend),function(e){void 0===ul&&(ul="depin"in d?d.depin:e,ul&&!al.offline?(ml=!0===ul?hl:"prod"===ul?dl:"dev"===ul?"wss://api.multisynq.dev/depin":"local"===ul?"ws://localhost:8787":ul,ml.endsWith("/")&&(ml=ml.slice(0,-1)),ml=ml.replace(/^http(s):/,"ws$1:"),ml.startsWith("ws")||(ml="ws://"+ml),pl="synchronizer",al.session&&console.log(`DEPIN_API=${ml}`)):ul=!1)}(s);const i=t[ul?2:1];if(!i)throw Error(`No ${ul?"Multisynq":"Croquet"} API key provided`);const n=i.key,r=d.backend||i.backend,o=d.reflector?.includes("/");if("none"===r)return{apiKey:n,signServer:"none",reflector:"overridden"};if(ul)return{apiKey:n,signServer:`${ml.replace(/^ws/,"http")}/clients`,reflector:"depin"};return{apiKey:n,signServer:"https://api.croquet.io/sign",reflector:o?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(e,t,s){const{signServer:i,apiKey:n}=this.getBackend(e);if("none"===i)return{developerId:"unknown_dev_id"};try{const e=2,r=await this.fetchWithRetries("verifying API key",[403],e,(()=>fetch(`${i}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":n,"X-Croquet-App":t,"X-Croquet-Id":s,"X-Croquet-Version":il,"X-Croquet-Path":new URL(K.referrerURL()).pathname},referrer:K.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"}))),o=await r.json(),{developerId:a,error:l}=o;if(l)throw Error(l);return al.session&&console.log(`${ul?"Multisynq":"Croquet"}: verified API key for developer ${a}`),o}catch(e){throw Error(`${ul?"Multisynq":"Croquet"} API key validation failed for "${n}": ${e.message}`)}}async fetchWithRetries(e,t,s,i){const n=1+s;let r,o=0;for(;;){let s,a;try{if(s=await i(),s.ok)return s}catch(e){a=e}o++;let l="";const c=s&&t.includes(s.status);if(c?l="fatal ":o===n&&(l="final "),r=s?`${l}status ${s.status} ${s.statusText} - "${await s.text()}"`:`${l}error "${a?.message}"`,o===n||c)break;const d=1===o?100:2===o?1e3:5e3;console.warn(`${r} while ${e}; retrying in ${d}ms`),await new Promise((e=>{setTimeout(e,d)}))}throw console.warn(`${r} while ${e}; giving up`),Error(r)}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){const e=this.vm.snapshot(),t=this.lastKnownTime(e),s=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:s,date:(new globalThis.CroquetViewDate).toISOString(),host:"localhost",sdk:il},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,s;try{e=Ei.begin("snapshot"),s=this.takeSnapshot()}catch(e){return M("snapshot",e),null}finally{t=Ei.end("snapshot")-e}return al.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)}ms`),s}setDebug(e){return cl(e)}requestDebugSnapshot(){cl("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(e=!1){if(!this.connected||!this.vm||this.viewOnly)return;const t=this.vm.time,s=t-this.vm.lastSnapshotPoll;if(s<5e3&&!e)return void(al.snapshot&&console.log(`not requesting snapshot poll (${s}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(e){const t=Object.keys(this.vm.views);if(t.sort(),e!==this.viewId&&t[0]!==this.viewId&&t[1]!==this.viewId&&t[2]!==this.viewId)return void(al.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));al.snapshot&&console.log("forcing snapshot poll")}const i=new fc(t,0,"_","handlePollForSnapshot",[]);this.sendTagged(i,{debounce:5e3,msgID:"pollForSnapshot"}),al.snapshot&&console.log(this.id,`requesting snapshot poll via ${pl}`)}handlePollForSnapshot(e){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const t=this.triggeringCpuTime||this.cpuTime;let s,i,n;this.triggeringCpuTime=null,this.cpuTime=0;try{s=Ei.begin("snapshot"),i={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(e){return void M("snapshot",e)}finally{n=Ei.end("snapshot")-s,this.cpuTime-=n}al.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(n)}ms`),queueMicrotask((()=>this.pollForSnapshot(e,i)))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),al.snapshot&&console.log(this.id,"sending snapshot vote",t),this.sendTutti({time:e,topic:"snapshot",data:t,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(e){const{tally:t}=e;al.snapshot&&console.log(this.id,"received snapshot votes",t);const{numberOfGroups:s,shouldUpload:i,dissidentFlag:n}=this.analyzeTally(t,"cpuTime");if(s>1){this.diverged=!0;const e=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${e})! Snapshots fall into ${s} groups`)}if(!0!==this.synced)al.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(i){const e={...this.auditStats},t=this.takeSnapshotHandleErrors();t&&queueMicrotask((()=>this.uploadSnapshot(t,e,n)))}}analyzeTally(e,t){let s=!1,i=null;const n=[],r={};let o=null;Object.keys(e).forEach(((e,t)=>{const s=JSON.parse(e);n.push(s);const{hash:i,viewId:a}=s;a===this.viewId&&(o=t),r[i]||(r[i]=[]),r[i].push(t)}));const a=Object.keys(r),l=a.length;let c=0;l>1&&(a.sort(((e,t)=>r[t].length-r[e].length)),r[a[0]].length===r[a[1]].length&&(al.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==o){const e=n[o].hash,a=r[e];a.length>1&&a.sort(((e,s)=>n[e][t]-n[s][t])),a[0]===o&&(s=!0,e!==d&&(i={groupVotes:a.length,allVotes:n.length}))}return{numberOfGroups:l,shouldUpload:s,dissidentFlag:i}}snapshotPath(e,t,s){const i=Math.ceil(e).toString().padStart(10,"0"),{appId:n,persistentId:r,codeHash:o,apiKey:a}=this.sessionSpec;return a?`apps/${n}/snap/${o}/${r}.${this.id}/${i}_${t}.${s}`:`snapshots/${this.id}/${i}_${t}-${s}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise((t=>{const s={...e};delete s.meta,k(JSON.stringify(s)).then((s=>{e.meta.hash=s,delete e.meta.hashPromise,t(s)}))}))),e.meta.hashPromise)}uploadServer(e){if("string"==typeof d.files){let e=new URL(d.files,window.location).href;return e.endsWith("/")&&(e=e.slice(0,-1)),{url:e,apiKey:null}}const{apiKey:t,signServer:s}=this.getBackend(e);if("none"===s&&!al.offline)throw Error("no file server configured");return{url:s,apiKey:t}}async uploadSnapshot(e,t,s=null){await this.hashSnapshot(e);const i=Ei.begin("snapshot"),n=JSON.stringify(e),r=Ei.end("snapshot")-i;al.snapshot&&console.log(this.id,`snapshot stringified (${n.length} bytes) in ${Math.ceil(r)}ms`);const{time:o,seq:a,hash:l}=e.meta,c=this.connection.socket;try{const e=await this.uploadEncrypted({content:n,path:this.snapshotPath(o,a,l),key:this.key,gzip:!0,debug:al.snapshot,what:"snapshot"});return this.connection.socket!==c?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(o,a,l,e,t,s),!0)}catch(e){return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(e,t,s,i,n,r){if(al.snapshot){let n=`time: ${e}, seq: ${t}, hash: ${s}`;r&&(n+=", as dissident; "+JSON.stringify(r)),console.log(this.id,`sending snapshot url to ${pl} (${n}): ${i}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:e,seq:t,hash:s,url:i,auditStats:n,dissident:r}}))}catch(e){console.error("ERROR while sending",e)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${e}#${t}`,url:i,dissident:r})}async diffDivergedSnapshots(e){const t=await Promise.all(e.map((e=>this.downloadEncrypted({url:e,gzip:!0,key:this.key,debug:al.snapshot,json:!0,what:"diverged snapshot"}))));for(const e of t)delete e.meta;let s=0;!function e(t,i,n){if(typeof t!=typeof i)console.log(`${n} diverged (${typeof t} vs ${typeof i}):`,t,i),s++;else if(Array.isArray(t)!==Array.isArray(i))console.log(`${n} diverged (array vs object):`,t,i),s++;else if("object"==typeof t){const r=t?Object.keys(t):[],o=i?Object.keys(i):[],a=r.filter((e=>!o.includes(e))),l=o.filter((e=>!r.includes(e)));(a.length||l.length)&&(console.log(`${n} diverged (keys mismatch):`,a,l),s++);for(const s of r)o.includes(s)&&e(t[s],i[s],`${n}${jl(t,s)}`)}else t!==i&&(console.log(`${n} diverged (value mismatch):`,t,i),s++)}(t[0],t[1],"CROQUETVM"),s?console.log(`Total ${s} differences between diverged snapshots:`,t.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted({url:e,gzip:t,key:s,debug:i,json:n,what:r}){e.startsWith(nl)&&(e=e.replace(nl,rl));const o=e.startsWith("offline:"),a=o?1:3;let l=Date.now();const c=await this.fetchWithRetries(`fetching ${r}`,[],a,(()=>o?this.fetchOffline(e,r,i):fetch(e,{method:"GET",mode:"cors",referrer:K.referrerURL()}))),d=await c.arrayBuffer();i&&console.log(this.id,`${r} fetched (${d.byteLength} bytes) in ${-l+(l=Date.now())}ms`),Ei.addNetworkTraffic(`${r}_in`,d.byteLength);const h=this.decryptBinary(d,s);i&&console.log(this.id,`${r} decrypted (${h.length} bytes) in ${-l+(l=Date.now())}ms`);const u=t?Oa.inflate(h):h;return i&&t&&console.log(this.id,`${r} inflated (${u.length} bytes) in ${-l+(l=Date.now())}ms`),n?JSON.parse((new TextDecoder).decode(u)):u}async fetchOffline(e,t,s){const i=++wl;return new Promise(((n,r)=>{Xl.postMessage({job:i,cmd:"getOfflineFile",url:e,id:this.id,what:t,debug:s,offline:al.offline});const o=e=>{if(i!==e.data.job)return;const{ok:s,status:a,statusText:l,body:c,bytes:d}=e.data;Ei.addNetworkTraffic(`${t}_out`,d),Xl.removeListener("message",o),s?n({arrayBuffer:()=>c}):r(Error(`${a}: ${l}`))};try{Xl.addListener("message",o)}catch(e){console.log("failed to add listener",e)}}))}async uploadEncrypted({content:e,path:t,key:s,gzip:i,keep:n,debug:r,what:o}){const a="string"==typeof e?(new TextEncoder).encode(e).buffer:e,l=n?void 0:[a],c="string"==typeof s?s:Ai.stringify(s),{apiKey:d,appId:h,persistentId:u}=this.sessionSpec,m=++wl;return new Promise(((e,s)=>{Xl.postMessage({job:m,cmd:"uploadEncrypted",server:this.uploadServer(d),path:t,buffer:a,keyBase64:c,gzip:i,referrer:K.referrerURL(),id:this.id,appId:h,persistentId:u,CROQUET_VERSION:il,debug:r,what:o,offline:al.offline},l);const n=t=>{if(m!==t.data.job)return;const{url:i,ok:r,status:a,statusText:l,bytes:c}=t.data;Ei.addNetworkTraffic(`${o}_out`,c),Xl.removeListener("message",n),r?e(i):s(Error(`${a}: ${l}`))};try{Xl.addListener("message",n)}catch(e){console.log("failed to add listener",e)}}))}persistentPath(e){const{appId:t,persistentId:s}=this.sessionSpec;return`apps/${t}/${s}/save/${e}`}pollForPersist(e,t,s,i,n){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(al.offline)return;const r={viewId:this.viewId,hash:i,ms:n+.001*Math.random()},o={persistTime:t,persistentHash:i,persistentString:s};al.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,r),this.sendTutti({time:e,topic:"persist",data:r,localContext:o,tallyTarget:["handlePersistVote"]})}async handlePersistVote(e){const{tally:t,localContext:s}=e;if(al.snapshot){const e=!!s?`for time @${s.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${e}`,t)}const{numberOfGroups:i,shouldUpload:n,dissidentFlag:r}=this.analyzeTally(t,"ms");if(i>1&&console.warn(this.id,`Persistence records fall into ${i} groups`),!n||!s)return;const{persistTime:o,persistentHash:a,persistentString:l}=s;this.doPersist(o,l,a,r)}async doPersist(e,t,s,i){const n=await this.uploadEncrypted({path:this.persistentPath(s),content:t,key:this.key,gzip:!0,debug:al.snapshot,what:"persistence"});if(al.snapshot){const e=i?` (as dissident; ${JSON.stringify(i)})`:"";console.log(this.id,`sending persistent data url to ${pl}${e}: ${n}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:e,url:n,dissident:i}}))}catch(e){console.error("ERROR while sending",e)}}async forcePersist(e,t,s){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${t.length} bytes`),"alert"===d.forcePersist&&confirm("forcePersist triggered. Do it?"),await this.doPersist(e,t,s),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(e){let t="noop",s=[];switch(e[2].what){case"users":{const{joined:i,left:n,active:r,total:o}=e[2];this.users=r,this.usersTotal=o;const a="__VM__",l="__peers__",c={entered:i||[],exited:n||[],count:r,total:o};for(const e of c.entered.concat(c.exited))e.data&&(e.data=this.decryptPayload(e.data));t="publishFromModelOnly",s=[a,l,c],z.handleEvent(this.viewId+":__views__",c.count);break}case"tally":{const{tuttiSeq:i,tuttiKey:n,tally:r,tallyTarget:o,missingClients:a}=e[2];(al.messages||al.snapshot)&&a&&console.log(`${a} ${1===a?"client":"clients"} failed to participate in tally ${n||i}`),t="handleTuttiResult",s=[{tuttiSeq:i,tuttiKey:n,tally:r,tallyTarget:o}];break}case"audit":{const i=e[0];al.messages&&console.log(`audit request at time ${i}`),t="handleAuditRequest",s=[{time:i}];break}}const i=new fc(0,0,"_",t,s);e[2]=i.asState()[2]}handleTuttiResult(e){const{tuttiSeq:t,tuttiKey:s,tally:i,tallyTarget:n}=e,r=s?e=>e.tuttiKey===s:e=>e.dummyTuttiSeq===t,o=this.tuttiHistory.findIndex(r),a=-1!==o&&this.tuttiHistory.splice(o,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),n){const[e,...t]=n,s=[...t,{tally:i,localPayload:l,localContext:c}],r=new fc(0,0,"_",e,s);this.vm.verifyExternal(r),r.executeOn(this.vm,!0)}}handleAuditRequest(e){const{time:t}=e;this.vm.time!==t&&console.error(`time ${this.vm.time} cf audit time ${t}`);const{auditStats:s}=this,{lastUsers:i,minUsers:n,maxUsers:r,payloadTally:o,sessionTimeAtDispatch:a}=s;if(s.payloadTally=0,this.vm.time>a&&(s.minUsers=s.maxUsers=i),!this.fastForwardHandler){const e=Ei.networkTraffic.audit_reflector_in||0,s=Ei.networkTraffic.audit_reflector_out||0;Ei.resetAuditStats();const{clientId:a}=this.connection.socket;queueMicrotask((()=>{al.session&&console.log(this.id,`handling audit request at ${t} after ${e} bytes in, ${s} out`);const l=encodeURIComponent(JSON.stringify({time:t,clientId:a,lastUsers:i,minUsers:n,maxUsers:r,payloadTally:o,bytesIn:e,bytesOut:s})),c=`${ml}/clients/report?session=${this.id}&stats=${l}`.replace("ws","http");fetch(c,{mode:"no-cors"})}))}}handleUserTotalForAccounting(e){if(ul){const{auditStats:t}=this;if(t.lastUsers=e,this.vm.time<=t.sessionTimeAtDispatch)return;(-1===t.minUsers||e<t.minUsers)&&(t.minUsers=e),e>t.maxUsers&&(t.maxUsers=e)}}messageSizeForAccounting(e){let t="string"==typeof e[2]?e[2].length:e[2]._size||0;return t+=16,t}async receive(e,t){const s=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),Gl.add(this);const{progressReporter:e}=this.sessionSpec,s=e||(()=>{}),{messages:i,url:n,persisted:r,time:o,seq:a,snapshotSeq:l,tove:c,reflector:d,flags:h,auditStatsInitializer:u}=t;if(c&&c!==this.tove)try{if(this.decrypt(c)!==this.id)throw Error("wrong sessionId in tove?!")}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${e.message}`),4200),void s(-1)}const m=t.timeline;this.flags=h||{};const p=r?"persistence":"snapshot";al.session&&console.log(this.id,`received SYNC from ${d} ${pl}: time ${o}, ${i.length} messages, ${p} ${n||"<none>"}`);let b=!!this.vm;if(b){this.networkQueue.length=0;const e=!!m&&m===this.timeline,t=i[0],s=a,n=void 0!==l?l:t?t[1]:s;al.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${n}-#${s}`);let r=e&&bc(n,this.vm.seq)&&bc(this.vm.seq,s)&&o>=this.reflectorTime;if(r){let e=0;t&&bc(t[1],this.vm.seq)&&(e=this.vm.seq-t[1]+1>>>0);for(let t=e;r&&t<i.length;t++){const e=i[t][2];"string"!=typeof e&&"users"===e.what&&e.left&&e.left.includes(this.viewId)&&(al.session&&console.log(this.id,`${pl} reports that this view has left`),r=!1)}r&&e&&(al.messages&&console.log(this.id,`rejoin: discarding ${e} messages #${t[1]}-#${this.vm.seq}`),i.splice(0,e))}if(r){if(this.sendBuffer.length>0){const e=this.sendBuffer;this.sendBuffer=[],al.session&&console.log(this.id,`rejoin: sending ${e.length} messages buffered while disconnected`);for(const t of e)t()}}else al.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),b=!1}const f=this.networkQueue;this.networkQueue=[];for(const e of i){const t=this.messageSizeForAccounting(e);if("string"!=typeof e[2])this.convertReflectorMessage(e);else try{e[2]=this.decryptPayload(e[2])[0]}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${e.message}`),4200),void s(-1)}al.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(e)),this.networkQueue.push([e,t])}if(this.networkQueue.push(...f),o>this.reflectorTime&&this.timeFromReflector(o,"reflector"),b)return al.session&&console.log(this.id,"seamless rejoin successful"),void(this.syncCompleted=!0);let y;if(this.timeline=m||"",al.snapshot&&n&&console.log(this.id,`fetching ${p} ${n}`),n)try{y=await this.downloadEncrypted({url:n,gzip:!0,key:this.key,debug:al.snapshot,json:!0,what:p})}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${p}: ${e.message}`),4200),void s(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void s(-1);if(r){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(y)}else y&&(this.sessionSpec.snapshot=y),this.install();u&&(al.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(u)}`),this.auditStats=u),al.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${o}`);const g=this.vm.time,Z=await new Promise((e=>{const{port1:t,port2:i}=new MessageChannel;t.onmessage=()=>{let t=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(s(1),e(!0),t=!1);else{const e=(this.vm.time-g)/(this.reflectorTime-g);s(e)}else al.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),e(!1),t=!1;t&&this.stepSession("fastForward",{budget:fl})};this.fastForwardHandler=t=>{this.connected&&this.vm?"error"===t?(s(-1),e(!1)):i.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),e(!1))},queueMicrotask((()=>this.stepSession("fastForward",{budget:fl})))}));return delete this.fastForwardHandler,void(Z&&(al.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&K.showMessage(`${K.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{const e=t;e[1]>>>=0;const s=this.messageSizeForAccounting(e);if("string"!=typeof e[2])al.messages&&console.log(this.id,"received META "+JSON.stringify(e)),this.convertReflectorMessage(e),al.messages&&console.log(this.id,"converted to "+JSON.stringify(e));else try{const[t,s,i]=this.decryptPayload(e[2]);e[2]=t,s===this.viewId&&this.addToStatistics(i,this.lastReceived),al.messages&&console.log(this.id,"received "+JSON.stringify(e))}catch(e){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${e.message}`),4200)}let i;return this.networkQueue.push([e,s]),this.flags.rawtime&&(i=e[e.length-1]),this.timeFromReflector(e[0],"reflector",i),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"TICK":{if(!this.vm)return;const e="number"==typeof t?t:t.time;if(al.ticks){const t=s&&this.lastReceived-s-this.msPerTick*this.tickMultiplier|0,i=e-this.vm.time;console.log(this.id,`received TICK ${e} ${Math.abs(t)<5?"on time":t<0?"early":"late"} (${i} ms, jitter ${t>0?"+":""}${t} ms)`)}return this.timeFromReflector(e,"reflector"),this.tickMultiplier>1&&this.multiplyTick(e),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"INFO":{const{msg:e,options:s}=t,i=ul?"Multisynq Synchronizer":"Croquet Reflector";return void K.showMessage(`${i}: ${e}`,s)}case"REQU":return al.snapshot&&console.log(`received REQU (snapshot request) from ${pl}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",e,t)}}install(e){const t=Date.now(),{snapshot:s,initFn:i,options:n,debugEvents:r}=this.sessionSpec,[o,a]=s.models?["deserializ","snapshot"]:["initializ","root model"];al.session&&console.log(this.id,`${o}ing ${a}`);let l=new mc(s,r,(()=>{try{return i(n,e)}catch(e){throw M("init",e,"fatal"),e}}),this.migratingOldSnapshot);if((al.session||al.snapshot&&s.models)&&console.log(this.id,`${a} ${o}ed in ${Date.now()-t}ms`),al.initsnapshot&&!s.models){al.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let e=null;try{e=JSON.stringify(l.snapshot())}catch(e){throw M("initial snapshot",e,"fatal"),e}try{l=new mc(JSON.parse(e),r,(()=>i(n)))}catch(e){throw M("initial snapshot resume",e,"fatal"),e}}const c=this.lastKnownTime(l);this.reflectorTime=Math.max(this.reflectorTime,c),this.setVM(l)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),al.session&&console.log(this.id,"Controller sending JOIN");const{tick:e,delay:t}=this.getTickAndMultiplier(),{name:s,codeHash:i,appId:n,apiKey:r,persistentId:o,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,location:u,flags:m}=this.sessionSpec,p=ul?"hiddenName":s,b=ul?"hiddenApiKey":this.getBackend(r).apiKey,f=ul?"hiddenAppId":n,y=ul?"hiddenUrl":K.referrerURL(),g=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:u?[this.viewId]:this.viewId,Z={name:p,apiKey:b,appId:f,url:y,persistentId:o,sdk:il,developerId:a,version:1,user:g,location:u,ticks:{tick:e,delay:t},dormantDelay:d,tove:this.tove,codeHash:i};l&&Object.assign(Z,{heraldUrl:l}),c&&Object.assign(Z,{leaveDelay:c+250}),h!==i&&Object.assign(Z,{computedCodeHash:h}),m&&Object.assign(Z,{flags:m}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:Z})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{this.leaving?al.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(al.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())}),this.sessionSpec.rejoinLimit)))}leave(e=!1){const{rebootModelView:t}=this.sessionSpec;if(this.reset(),al.session&&console.log(this.id,`resetting ${e?"(but keeping)":"and discarding"} controller`),e||Gl.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");t()}async encrypt(e){const t=Z.random(16),s=xn.encrypt(e,this.key,{iv:t}),i=Cn(e,this.key);return`${Ai.stringify(t)}${Ai.stringify(i)}${s}`}get deprecatedDefaultKey(){return Zl||(Zl=hn("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:qi.algo.SHA1,iterations:1})),Zl}decrypt(e,t=this.key){const s=Ai.parse(e.slice(0,24)),i=Ai.parse(e.slice(24,68)),n=e.slice(68),r=xn.decrypt(n,t,{iv:s});let o="";try{o=nn.stringify(r)}catch(e){}const a=Cn(o,this.key);if(this.compareHmacs(i.words,a.words))return o;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(e,t){const s=(new TextDecoder).decode(new Uint8Array(e,0,4));let i,n,r,o,a;switch("string"==typeof t&&(t=Ai.parse(t)),s){case"CRQ0":i=(new TextDecoder).decode(e),n=Ai.parse(i.slice(4,28)),r=Ai.parse(i.slice(28,72)),o=i.slice(72),a=xn.decrypt(o,t,{iv:n});break;case"CRQ1":i=new Uint8Array(e),n=Z.create(i.subarray(4,20)),r=Z.create(i.subarray(20,52)),o=Z.create(i.subarray(52)),a=xn.decrypt({ciphertext:o},t,{iv:n});break;default:throw Error(`${this.id} unknown encryption version ${s}`)}a.clamp();const l=Cn(a,t);if(this.compareHmacs(r.words,l.words))return L(a);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(e,t,s){const[i,n,r]=e.asState();return[i,n,await this.encryptPayload([r,t,s])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let s=e.length===t.length;for(let i=0;i<e.length;i++)e[i]!==t[i]&&(s=!1);return s}sendMessage(e){if(this.viewOnly||!this.vm)return;const t=e.asState()[2].length;if(t>16384)return void console.warn(this.id,`Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to ${pl}.`);!this.payloadSizeWarned&&t>gl&&(console.log(this.id,`Message with payload of ${t} bytes being sent to ${pl}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const s=Date.now(),i=this.rateLimitedSendTimes,n=this.rateLimitBuffer;if(Ei.perSecondTally({requestedMessages:1}),n.length)return void this.addToRateLimitBuffer(e);let r=0;if(i.length&&this.synced){const e=i[i.length-1],t=1e3/this.eventRateLimit-(s-e);t>1&&(r=Math.ceil(t))}r?(this.addToRateLimitBuffer(e),setTimeout((()=>this.serviceRateLimitBuffer()),r)):(this.recordRateLimitedSend(s),this.socketSendMessage(e),Ei.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){const t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(this.id,`Sends to ${pl} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){Ei.perSecondTally({bundledMessages:1});const t=Date.now(),s=e.asState(),i=s[2].length,n=this.rateLimitBuffer;if(n.length){const e=n[n.length-1],{msgStates:r,totalPayload:o}=e;if(o<gl)return r.push({msgState:s,bufferTime:t}),void(e.totalPayload+=i)}Ei.perSecondTally({newBundles:1}),n.push({msgStates:[{msgState:s,bufferTime:t}],totalPayload:i});const r=n.length;al.session&&r%5==0&&r!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${r} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=r),r>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&r>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const e=this.rateLimitBuffer;if(!e.length)return;const t=Date.now(),s=1e3/this.eventRateLimit,i=this.rateLimitedSendTimes;if(i.length){const e=i[i.length-1];if(s-(t-e)>0)return}const n=e.shift(),{msgStates:r,totalPayload:o}=n,a=[];let l=0;if(r.forEach((e=>{a.push(e.msgState),l+=t-e.bufferTime})),1===a.length){const e=fc.fromState(a[0],this.vm);this.socketSendMessage(e)}else{const e=new fc(this.vm.time,0,"_","handleBundledEvents",[a]);this.socketSendMessage(e)}if(this.recordRateLimitedSend(t),Ei.perSecondTally({sentBundles:1,sentMessagesTotal:r.length,sendDelay:l,sentBundlePayload:o,sentPayloadTotal:o}),al.session&&this.connected){const t=e.length;t&&t%5==0&&t!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${t} event bundles`),this.rateLimitLastLogged=t)}e.length&&setTimeout((()=>this.serviceRateLimitBuffer()),s)}async socketSendMessage(e,t=null){const s=await this.encryptMessage(e,this.viewId,Date.now()),i=al.sends&&(t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(al.sends&&console.log(this.id,`buffering ${i}`),this.sendBuffer.push((()=>this.socketSendMessage(e,t)))));al.sends&&console.log(this.id,`sending ${i}`);const n={id:this.id,action:"SEND",args:[...s,this.latency]};t&&(n.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(n))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti({time:e,topic:s,data:i,localContext:n=null,firstMessage:r=null,wantsVote:o=!0,tallyTarget:a=null}){if(this.viewOnly)return;const l=r&&await this.encryptMessage(r,this.viewId,Date.now()),c=t(i);if(!this.connected||!this.syncCompleted)return void(this.vm&&(al.sends&&console.log(this.id,`buffering "${s}" TUTTI ${c} ${r&&r.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:e,topic:s,data:i,localContext:n,firstMessage:r,wantsVote:o,tallyTarget:a})))));al.sends&&console.log(this.id,`sending "${s}" TUTTI ${c} ${r&&r.asState()}`),this.lastSent=Date.now();const d=`${s}@${e}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[e,0,c,l,o,a,d]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:e,tuttiKey:d,dummyTuttiSeq:0,payload:c,localContext:n})}sendLog(...e){this.connected&&this.syncCompleted?(al.sends&&console.log(this.id,"sending LOG"),e.length<2&&(e=e[0]),this.connection.send(JSON.stringify({action:"LOG",args:e}))):this.vm&&(al.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push((()=>this.sendLog(...e))))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const e=this.sessionSpec.options,t=["number","string"].includes(typeof e.tps)?e.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[s,i]=(t+"x").split("x").map((e=>Number.parseFloat("0"+e))),n=1e3/Math.max(1/30,Math.min(60,s)),r=Math.max(1,i);let o=n,a=0;return r>1&&!bl&&(o=n/r,a=Math.ceil(o*(r-1))),{msPerTick:o,multiplier:r,tick:n,delay:a}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{const s=Ei.begin("simulate");for(;t;){const s=this.networkQueue[0];if(!s)break;const[i,n]=s;if(t=this.vm.advanceTo(i[0],e),!t)break;this.networkQueue.shift(),ul&&(this.auditStats.payloadTally+=n);const r=this.vm.scheduleExternalMessage(i);t=this.vm.advanceTo(r.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,Ei.end("simulate")-s)}Ei.backlog(this.backlog);const s=this.lag,i=Math.max(200,.1*this.msPerTick),n=Math.max(2e3,.2*this.msPerTick);if("boolean"==typeof this.synced&&this.viewed&&(this.synced&&s>n||!this.synced&&s<i)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<i&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}if(!al.offline)if(this.synced&&t&&this.vm.time-this.lastSnapshotRequest>5e3){let e=!1;this.cpuTime>5e3?(al.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),e=!0):ul&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(al.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),e=!0),e&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return t}catch(e){return M("simulate",e),this.connection.closeConnectionWithError("simulate",e),"error"}}stepSession(e,t={}){const s=Ei.stepSession(t.frameTime,!0);s&&console.log(s);const{backlog:i,latency:n,starvation:r,activity:o}=this;if("animation"===e){Ei.animationFrame(t.frameTime,{backlog:i,starvation:r,latency:n,activity:o,users:this.users});const e=Date.now();if(this.lastAnimationEnd){const t=e-this.lastAnimationEnd;if(!0===this.animationGapCheck&&t>200&&(this.animationGapCheck=[],al.session&&console.log(this.id,"animation has stopped (too long between steps)")),!0!==this.animationGapCheck){const e=this.animationGapCheck;e.push(t),e.length>4&&e.shift(),4===e.length&&e.reduce(((e,t)=>e+t),0)<=400&&(this.animationGapCheck=!0,al.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=e}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(e){case"animation":{const e=t.expectedSimFPS,s=Date.now(),i=yl.reduce(((e,t)=>e+t),0)/yl.length;if(a=this.simulate(s+Math.min(i,fl)),!1===a){const t=0===e?0:1e3/e*4;this.backlog>t&&(a=this.simulate(s+fl-i))}"error"!==a&&(yl.push(Date.now()-s),yl.length>4&&yl.shift());break}case"fastForward":case"background":a=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(a),"error"!==a&&(Ei.begin("update"),this.processModelViewEvents("animation"===e),Ei.end("update"),this.vm&&(this.serviceRateLimitBuffer(),"animation"===e&&(t.view&&(Ei.begin("render"),this.inViewRealm((()=>t.view.update(t.frameTime))),Ei.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(e){al.session&&console.log(this.id,`synced=${e}`),this.synced=e,K.showSyncWait(!e),this.vm.publishFromView(this.viewId,"synced",e)}inViewRealm(e){return E(this.vm,(()=>e(this.vm)))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,s){e<this.reflectorTime?("controller"!==t||al.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&Ei.backlog(this.backlog),this.tickHook&&this.tickHook(e,s))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);const t=this.msPerTick,s=this.tickMultiplier;let i=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(e+i*t),"controller"),al.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,i),++i>=s&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),t)}startStepping(e){const t=s=>{this.leaving||(this.isOutOfSight()||e(s),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){this.isOutOfSight=()=>!1,this.isBeingAnimated=()=>{const e=!0===this.animationGapCheck,t=Date.now()-this.lastAnimationEnd<200;return e&&!t&&(this.animationGapCheck=[],al.session&&console.log(this.id,"animation has stopped (too long since last step)")),e&&t},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated();const e=this.sessionSpec.autoSleep;let t;if(e){const s=1e3*e;let i=0,n=0;t=()=>{const e=Date.now();e-i<980||(i=e,this.isOutOfSight()?n?e-n>s&&(this.dormantDisconnect(),n=0):n=e:n=0)}}const s=()=>{this.leaving?i&&(clearInterval(i),i=null):this.connected&&this.vm&&(t&&t(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let i=setInterval(s,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(s(),!this.fastForwardHandler&&this.connected)){let t=.9*this.msPerTick;e&&(t=Math.min(t,fl));const s=this.synced?"background":"fastForward";this.stepSession(s,{budget:t})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class Sl{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let e;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;const t=()=>{al.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,Ei.connected(!0),this.controller.sendJoin()};if(al.offline)e=new Ba,e.isConnected=()=>e.readyState===WebSocket.OPEN;else if(ul){const{synchSpec:s,developSpec:i}=d;if(s&&i)throw Error("Cannot handle both synchSpec and developSpec options");let n="";const r=s||i;r&&(n+=`&synch=${encodeURIComponent(r)}`);const o=this.id,{persistentId:a,appId:l,developerId:c}=this.controller.sessionSpec;e=new Aa(`${ml}/clients/connect?session=${o}&persist=${a}&app=${encodeURIComponent(l)}&developer=${c}${n}`),e.isConnected=()=>"open"===e.dataChannel?.readyState,e.onconnected=t}else{let t=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector;const s=void 0,i={},n=this.controller.sessionSpec.token;if(n&&(i.token=n),d.reflector){const e=d.reflector.toUpperCase();"CF"===e||e.match(/^[A-Z]{3}$/)?(t=al.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",3===e.length&&(i.colo=e)):d.reflector.match(/^[-a-z0-9]+$/i)?i.region=d.reflector:t=new URL(d.reflector,s).href.replace(/^http/,"ws")}if(!t.match(/^wss?:/))throw Error("Cannot interpret reflector address "+t);t.endsWith("/")||(t+="/");const r=new URL(t+this.id,s);for(const[e,t]of Object.entries(i))r.searchParams.append(e,t);e=new WebSocket(r),e.isConnected=()=>e.readyState===WebSocket.OPEN}e.onopen=s=>{const i=this.socket;i&&(i.onopen=i.onmessage=i.onerror=i.onclose=null),this.socket=e,this.connectHasBeenCalled=!1,e.twoStageConnection||t()},e.onmessage=t=>{if(e!==this.socket)return;const{data:s}=t,i="_CHUNK";if(s.startsWith(i)){const t="1"===s.charAt(6),i="1"===s.charAt(7),n=s.slice(8);if(t&&(e.chunkCollector=[]),e.chunkCollector.push(n),i){const t="".concat(...e.chunkCollector);e.chunkCollector=[],Ei.addNetworkTraffic("reflector_in",t.length,!!ul),this.receive(t)}}else Ei.addNetworkTraffic("reflector_in",s.length,!!ul),this.receive(s)},e.onerror=t=>{al.session&&console.log(this.id,e.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},e.onclose=t=>{this.socket&&e!==this.socket||this.socketClosed(t.code,t.reason)}}socketClosed(e,t){al.session&&console.log(this.id,`socketClosed with code=${e} message="${t}"`),e>=4100&&4110!==e&&(al.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);const s=!!!this.controller.leaving&&1e3!==e&&e<4100,i=4110===e;i||1e3===e||this.reconnectDelay||setTimeout((()=>{if(this.connected||this.socket?.isConnecting?.())return;const i=s?"Reconnecting":"Connection closed";K.showMessage(`${i}: ${e} ${t}`,{level:s?"warning":"fatal"})}),500),al.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${e} ${t}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),Ei.connected(!1),Ei.resetAuditStats(),i?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),s&&(al.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e),Ei.addNetworkTraffic("reflector_out",e.length,!!ul)}receive(e){this.lastReceived=Date.now();const{id:t,action:s,args:i}=JSON.parse(e);if(t)try{this.controller.receive(s,i)}catch(e){this.closeConnectionWithError("receive",e)}else if("PONG"===s){if(al.pong&&console.log("PONG after",Date.now()-i,"ms"),this.pongHook)try{this.pongHook(i)}catch(e){console.error(e)}}else console.warn("Unknown action",s)}dormantDisconnect(){this.connected&&(al.session&&console.log(this.id,`dormant; disconnecting from ${pl}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(e,t,s=4e3){console.error(s,t),this.closeConnection(s,`Error in ${e}: ${t.message||t}`)}closeConnection(e,t){if(this.socket){this.socket.onclose=null;try{this.socket.close(e,t)}catch(s){console.error(`Error in socket.close(${e}, ${JSON.stringify(t)}):`,s)}}this.socketClosed(e,t)}PULSE(e){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){0!==this.lastReceived&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((ul?"Synchronizer":"Reflector")+" has gone away")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(e=Date.now()){this.connected&&this.send(JSON.stringify({action:"PING",args:e}))}}globalThis.setInterval((()=>{for(const e of Gl)e.connected&&e.vm&&e.connection.keepAlive(Date.now())}),100);const xl=Symbol("hash"),Wl=Symbol("key"),Tl=Symbol("url"),Cl=new Map;let kl=0;function Vl(e){return d.has("debug",e,!1)}function Il(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Pl(e){return e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+3&-4,"=")}function Rl(e,t){return e||(e="*"),t.replace(/[\s\S]/g,(t=>String.fromCharCode(t.charCodeAt(0)^e.charCodeAt(0))))}class Yl{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(e,t,s){if(mc.hasCurrent())throw Error(`${K.libName}.Data.store() called from Model code`);let i,n,r;if("string"==typeof e?(i=e,e=t,n=!0,r=s):(i=t&&t.sessionId,n=t&&t.shareable,r=t&&t.keep),!(e instanceof ArrayBuffer))throw Error(`${K.libName}.Data.store() called with non-ArrayBuffer data`);const{appId:o,persistentId:a,key:l,uploadEncrypted:c}=vl(i),d=n?Z.random(32).toString(Ai):Ai.stringify(l),h=`apps/${o}/${a}/data/%HASH%`,u="data#"+ ++kl;Vl("data")&&console.log(`${K.libName}.Data: storing ${u} ${e.byteLength} bytes`);const m=await c({path:h,content:e,key:d,keep:r,debug:Vl("data"),what:u}),p=function(e){return e.replace(/.*\//,"")}(m),b=new Ml(p,n&&d,m);return Vl("data")&&console.log(`${K.libName}.Data: stored ${u} as ${this.toId(b)}`),b}static async fetch(e,t){let s;if(t&&t[Tl]?(s=e,e=t):s=t&&t.sessionId,mc.hasCurrent())throw Error(`${K.libName}.Data.fetch() called from Model code`);const{downloadEncrypted:i,key:n}=vl(s),r=e&&e[xl],o=e&&e[Wl]||Ai.stringify(n),a=e&&e[Tl];if("string"!=typeof r||"string"!=typeof o||"string"!=typeof a)throw Error(`${K.libName}.Data.fetch() called with invalid handle`);const l="data#"+ ++kl;return Vl("data")&&console.log(`${K.libName}.Data: fetching ${l} ${this.toId(e)}`),i({url:a,key:o,debug:Vl("data"),what:l})}static hash(e,s="base64url"){"function"==typeof e&&(e=Function.prototype.toString.call(e)),"string"==typeof e?e=(new TextEncoder).encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=(new TextEncoder).encode(t(e)));const i=G(Z.create(e));switch(s){case"hex":return i.toString();case"base64":return i.toString(Ai);case"base64url":return Il(i.toString(Ai));default:throw Error(`${K.libName}.Data: unknown hash output "${s}", expected "hex"/"base64"/"base64url"`)}}static fromId(e){const t=e.slice(0,1);let s,i,n,r;switch(t){case"0":s=e.slice(1,44),i=e.slice(44),n=`${ol}/sessiondata/${s}`;break;case"1":s=e.slice(1,44),i=e.slice(44,87)+"=",r=e.slice(87),n=`${ol}/apps/${r}/data/${s}`;break;case"2":s=e.slice(1,44),i=Pl(e.slice(44,87)),r=Rl(i,atob(Pl(e.slice(87)))),n=`${ol}/apps/${r}/data/${s}`;break;case"3":i=Pl(e.slice(1,44)),n=Rl(i,atob(Pl(e.slice(44)))),s=n.slice(-43);break;case"4":i=null,n=Rl(i,atob(Pl(e.slice(1)))),s=n.slice(-43);break;default:throw Error(`${K.libName}.Data expected handle v0-v4 got v${t}`)}return new this(s,i,n)}static toId(e){if(!e)return"";const t=e[xl],s=e[Wl],i=e[Tl];if(i.slice(-43)!==t)throw Error(`${K.libName} Data: malformed URL`);const n=s&&Il(s),r=Il(btoa(Rl(s,i)));return s?`3${n}${r}`:`4${r}`}constructor(e,t=null,s){const i=Cl.get(e);if(i)return i;if(s.slice(-43)!==e)throw Error(`${K.libName} Data: malformed URL`);Object.defineProperty(this,xl,{value:e}),t&&Object.defineProperty(this,Wl,{value:t}),Object.defineProperty(this,Tl,{value:s}),Cl.set(e,this)}}class Ml extends Yl{}const Kl={cls:Ml,write:e=>Ml.toId(e),read:e=>Ml.fromId(e)};let Hl=null,Nl=null;const zl=Symbol("DEBUG_WRITE_TARGET");let Fl=null;function jl(e,t){return Array.isArray(e)||"string"!=typeof t?`[${t}]`:t.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${t}`:`["${t}"]`}class _l extends Error{}function Jl(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>Hl.random(),globalThis.CroquetViewMath={};for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[e]=t.value;for(const[s,i]of Object.entries(globalThis.CroquetMath)){const n=Math[s];Math[s]=1===i.length?e=>Hl?i(e):n(e):(e,t)=>Hl?i(e,t):n(e,t)}}if(!globalThis.CroquetViewDate){const r=globalThis.Date;let o=!1;function a(e,t){return o||(o=!0,console.warn(new _l(`${e} used in Model code`))),t}function l(e,t,s,i,n,o,c){const d=this instanceof l,h=[e,t,s,i,n,o,c];if(h.length=arguments.length,Hl)switch(a(d?"new Date()":"Date()"),arguments.length){case 0:h.push(Hl.time);break;case 1:break;default:h[0]=r.UTC(...h),h.length=1}const u=new r(...h);return d?u:""+u}l.prototype=r.prototype,l.UTC=r.UTC,l.now=()=>Hl?a("Date.now()",Hl.time):r.now(),l.parse=(...e)=>Hl?a("Date.parse()",0):r.parse(...e),globalThis.CroquetViewDate=r,globalThis.Date=l}}Object.defineProperty(_l.prototype,"name",{value:`${K.libName}Warning`});const Ul=Symbol("QFUNC");function Ql(e,t,s,i){const n=new Dl(e,t,s,i),r=n.compile();return r[Ul]=n,r}function El(e,t,s,i){const n=[],r=[];let o,a,l,c;if(s){if("this"in s){for(t=s.this,o="_this";o in s;)o="_"+o;delete(s={...s,[o]:t}).this}if(l=[...Object.keys(s).sort()],c=[...l.map((e=>s[e]))],l.length){for(a="env";a in s||a===i;)a="_"+a;n.push(a),r.push(c)}}e.match(/\bCroquet\b/)&&!l?.includes("Croquet")&&(n.push("Croquet"),r.push(Vc.Croquet)),e.match(/\bMultisynq\b/)&&!l?.includes("Multisynq")&&(n.push("Multisynq"),r.push(Vc.Croquet));let d=i||"qFunc";for(;l?.includes(d);)d="_"+d;let h='"use strict"\n\n';h+="// Croquet QFunc Compiler by Codefrau\n\n",h+="//////////////// Start Compiler /////////////////\n",h+="try { const ",l?.length&&(h+=`[${l.join(", ")}] = ${a}, `);let u=e.split("\n");const m=u.slice(1),p=Math.min(...m.map((e=>e.match(/^\s*/)[0].length)));if(p>0){u.some((e=>(e.match(/`/g)||[]).length%2==1))||(u=[u[0],...m.map((e=>e.slice(p)))],e=u.join("\n"))}const b=u[u.length-1].match(/^\s*/)[0];b&&(e=b+e),h+=`${d} =\n`,h+="//////////////// Start User Code ////////////////\n\n",h+=e,h+="\n\n///////////////// End User Code /////////////////\n",h+=`return ${d}`,o&&(h+=`.bind(${o})`),h+=" } catch (compileError) { return compileError; }\n",h+="///////////////// End Compiler //////////////////";try{const e=new Function(...n,h).call(t,...r);if(e instanceof Error)throw console.warn("rethrowing error",e),e;return e}catch(t){throw console.warn(`createQFunc compiling:\n\n${e}`),Error(`createQFunc(): ${t.message}`)}}class Dl{constructor(e,t,s,i){if(this.thisVal=e,this.env=t,this.selfRef=i,this.source=s,void 0===i){this.selfRef="","function"==typeof s&&(this.source=s.toString());const e=Object.keys(t);for(const i of e)if(s===t[i]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${i} cannot both reference the function`);this.selfRef=i}this.selfRef&&(this.env={...t},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return El(this.source,this.thisVal,this.env,this.selfRef)}}const Ol={cls:Ul,write:({[Ul]:{thisVal:e,env:t,source:s,selfRef:i}})=>[e,s,i,...Object.entries(t).flat()],read:([e,t,s,...i])=>{const n={};for(let e=0;e<i.length;e+=2)n[i[e]]=i[e+1];return Ql(e,n,t,s)}},Bl="future message",$l="message in cancelFuture",Al="subscription handler";function ql(e){return`qFunc~${e.split(" ")[0]}~`}const ec=ql(Bl),tc=ql(Al);function sc(e){return e===Bl||e===Al}function ic(e){return e.startsWith(ec)}function nc(e){return`${tc}${e}`}function rc(e,t){return!!e.startsWith(tc)&&e.slice(tc.length)===t}function oc(e,t){if(Hl)throw Error("VirtualMachine confusion");if(!(e instanceof mc))throw Error("not a VM: "+e);const s=Hl;try{Hl=e,globalThis.CROQUETVM=e,t()}finally{Hl=s}}const ac="#reflected",lc=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],cc={};for(let e=0;e<lc.length;e++)cc[lc[e]]=e;const dc=new WeakMap;function hc(e){dc.set(e,null)}class uc{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}}class mc{static current(){return Hl||console.warn("VirtualMachine.current() called from outside the vm!"),Hl}static hasCurrent(){return!!Hl}static evaluate(e){if(Hl)return e();Jl();const t=Hl;try{return Hl=new uc,e()}finally{Hl=t}}constructor(e,t,s,i){Jl(),Nl={snapshot:d.has("debug","snapshot",!1),session:d.has("debug","session",!1),write:d.has("debug","write",!1)},hc(this),oc(this,(()=>{Q(this,(()=>{if(this.models={},this.namedModels={},this.messages=new zi(((e,t)=>e.before(t))),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=t,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,e.models){const t=wc.newOrRecycled(this).readVM(e,"VM",i);let s=[],n=[];for(const e of Object.keys(t))"meta"!==e&&("staticInitializers"===e?s=t[e]:e in this?"_random"===e?this[e]=new q(null,{state:t[e]}):"messages"===e?n=t.messages:this[e]=t[e]:console.warn(`Ignoring property snapshot.${e}`));for(const e of s)e();for(const e of n)this.messages.add(e);for(const[e,t]of Object.entries(this.subscriptions))for(const s of t){const[t]=s.split(".");let i=this.subscribers.get(t);i||this.subscribers.set(t,i=new Set),i.add(e)}}else this._random=new q(e.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),s(this)}))}))}registerModel(e,t){if(Hl!==this)throw Error("You can only create models from model code!");return t||(t="M"+ ++this.modelsId),this.models[t]=e,t}deregisterModel(e){if(Hl!==this)throw Error("You can only destroy models from model code!");const t=this.models;delete this.models[e];for(const[e,s]of Object.entries(this.namedModels))t===s&&delete this.namedModels[e];this.messages.removeMany((t=>t.hasReceiver(e)))}lookUpModel(e){if("_"===e)return this;let t=this.models[e];if(t)return t;const[s,i,n]=e.match(/^([^#]+)#(.*)$/)||[];return t=this.models[i],t&&t.lookUp(n)}get(e){const t=this.namedModels[e];return Hl!==this&&Nl.write&&t?this.debugWriteProxy(this,t,t.id):t}set(e,t){if(Hl!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[e]=t}debugWriteProxy(e,t,s){if("object"!=typeof t||null===t||t[zl])return t;if(t instanceof Vc&&(s=t.id),!this.$debugWriteProxyHandler){function n(e,t,s){s&&(e+=` ${s} of`);const i=Fl.get(t).path;if(console.warn(`write-debug: non-model code is ${e} ${i}:`,t),s&&"$"!==s[0])throw Error(`write-debug: Attempt to modify ${K.libName} model state from outside!`)}Fl||(Fl=new WeakMap),this.$debugWriteProxyHandler={set(t,s,i){Hl!==e?n("assigning",t,s):console.warn(`${K.libName} debug write protection inside model - this should not happen!`),t[s]=i},deleteProperty(t,s){Hl!==e?n("deleting",t,s):console.warn(`${K.libName} debug write protection inside model - this should not happen!`),delete t[s]},get(t,s){if(s===zl)return t;const i=t[s];if(i&&i[zl])return i;if(Hl!==e){if("object"==typeof i&&null!==i){const r=Fl.get(t).path;if(i instanceof Map){const t=new Map([...i.entries()].map((([t,s],i)=>[e.debugWriteProxy(e,t,`${r}.key#${i}`),e.debugWriteProxy(e,s,`${r}.value#${i}`)])));return t[zl]=i,t.set=()=>n("setting an item in",i),t.delete=()=>n("deleting from",i),t.clear=()=>n("clearing",i),Fl.set(i,{proxy:t,path:r+jl(i,s)}),t}if(i instanceof Set){const t=new Set([...i.values()].map(((t,s)=>e.debugWriteProxy(e,t,`${r}.item#${s}`))));return t[zl]=i,t.add=()=>n("adding to",i),t.delete=()=>n("deleting from",i),t.clear=()=>n("clearing",i),Fl.set(i,{proxy:t,path:r+jl(i,s)}),t}return e.debugWriteProxy(e,i,r+jl(i,s))}}else console.warn(`${K.libName} debug write protection inside model - this should not happen!`);return i}}}let i=Fl.get(t);return i||(i={proxy:new Proxy(t,this.$debugWriteProxyHandler),path:s},Fl.set(t,i)),i.proxy}noop(){}generateJoinExit({entered:e,exited:t,count:s,total:i}){this.controller.handleUserTotalForAccounting(i);const n={};for(const t of e){if("string"==typeof t)continue;let e,s,i;Array.isArray(t)?[e,s]=t:(e=t.id,i=t.data,s=t.location),n[e]={},i&&(n[e].data=i),s&&(s.region&&(s.country=s.region.slice(0,2),s.region=s.region.slice(2)),n[e].loc=s)}if(e=e.map((e=>"string"==typeof e?e:Array.isArray(e)?e[0]:e.id)),t=t.map((e=>"string"==typeof e?e:Array.isArray(e)?e[0]:e.id)),e.length===s){t=Object.keys(this.views);for(const e of t)this.views[e].extraConnections=0}if(e.length>0&&t.length>0&&e.some((e=>t.includes(e)))){for(let s=0;s<e.length;s++){const i=e[s],n=t.indexOf(i);n>=0&&(e.splice(s,1),t.splice(n,1),s--)}if(e.length+t.length===0)return}const r=e=>{const{data:t,loc:s}=this.views[e];if(!t)return e;const i={viewId:e,viewData:t};return s&&(i.location=s),i};for(const e of t)if(this.views[e]){if(this.views[e].extraConnections){this.views[e].extraConnections--,Nl.session&&console.log(this.id,`@${this.time}#${this.seq} view ${e} closed extra connection`);continue}const t=r(e);delete this.views[e],this.publishFromModelOnly(this.id,"view-exit",t)}else{const{time:t,seq:s}=this;console.error(`${this.id} @${t}#${s} view ${e} exited without being present - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${t}#${s} ${e} left without being present`)}))}for(const t of e)if(this.views[t])Nl.session&&console.log(this.id,`@${this.time}#${this.seq} view ${t} opened another connection`),this.views[t].extraConnections=(this.views[t].extraConnections||0)+1;else{this.views[t]=n[t]||{};const e=r(t);this.publishFromModelOnly(this.id,"view-join",e)}const o=Object.values(this.views).reduce(((e,t)=>e+1+(t.extraConnections||0)),0);if(s!==o){const{time:e,seq:t}=this;console.error(`@${e}#${t} view count mismatch (model: ${o}, reflector: ${s}) - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${e}#${t} connections model: ${o} reflector: ${s}`)}))}}scheduleExternalMessage(e){const t=fc.fromState(e,this);if(t.time<this.time)throw Error("past message from reflector "+e);const s=this.externalSeq+1>>>0;if(t.seq!==s)throw Error(`External message error. Expected message #${s} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if("_"!==e.receiver)throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in cc))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,s,i){if(e.every)return this.futureRepeat(e.every,t,s,i);if(e<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const n=new fc(this.time+e,2*this.futureSeq,t,s,i);return this.messages.add(n),{time:n.time,seq:n.seq}}cancelFuture(e,t){const s=this.messages;let i;if("number"==typeof t.time){const{time:e,seq:n}=t;i=s.removeOne((t=>t.time===e&&t.seq===n))}else{if("*"===t)return i=s.removeMany((t=>t.receiver===e.id)),i.length>0;{const n=this.asMethodName(e,t,$l),r=e.id;i=s.removeOne((e=>e.receiver===r&&e.selector===n||"_"===e.receiver&&"futureExecAndRepeat"===e.selector&&e.args[1]===r&&e.args[2]===n)),ic(n)&&delete e[n]}}return void 0!==i}futureRepeat(e,t,s,i){this.futureSend(e,"_","futureExecAndRepeat",[e,t,s,i])}futureExecAndRepeat(e,t,s,i){const n=this.lookUpModel(t);if(n){if("function"==typeof n[s])try{n[s](...i)}catch(e){M(`future message ${n}.${s}`,e)}else{const e=this.compileFuncString(s,n);try{e(...i)}catch(t){M(`future message ${n} ${e}`,t)}}this.futureRepeat(e,t,s,i)}}future(e,t,s,i){if(!this.lookUpModel(e.id))throw Error(`future send to unregistered model ${e}`);if(void 0===s){const s=this;return new Proxy(e,{get:(i,n)=>(...i)=>s.future(e,t,n,i)})}const n=this.asMethodName(e,s,Bl);if("string"!=typeof n)throw Error(`future message to ${e} ${n} is not a string`);if("function"!=typeof e[n]&&n.indexOf(".")<0&&"{"!==n[0])throw Error(`future send to ${e} with unknown method ${n}()`);return this.futureSend(t,e.id,n,i)}advanceTo(e,t){if(Hl)throw Error("cannot advance time from model code");let s;for(;(s=this.messages.peek())&&s.time<=e;){const{time:e,seq:i}=s;if(e<this.time)throw Error("past message encountered: "+s);if(1&i&&(this.seq=this.seq+1>>>0,i/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${i/2>>>0} in ${s}`);if(this.messages.poll(),this.time=s.time,s.executeOn(this),globalThis.CroquetViewDate.now()>=t)return!1}return this.time=e,!0}asMethodName(e,t,s,i=null){if("string"==typeof t)return t;if("function"==typeof t){if(e[t.name]===t)return t.name;if(t[Ul]&&i){const s=nc(i);if(e[s]===t)return s}let r=e;for(;null!==r;){for(const[e,i]of Object.entries(Object.getOwnPropertyDescriptors(r)))if(i.value===t){if(t[Ul]&&((n=s)!==Bl&&n!==$l||!ic(e)))continue;return e}if(r===e&&t[Ul]){if(!sc(s))return R(`${s} is not a registered QFunc: ${t}`,{only:"once"}),null;let n;if(i)n=nc(i);else{const t=ec;let s=0;do{n=`${t}${s++}`}while(e[n])}return e[n]=t,n}r=Object.getPrototypeOf(r)}R(`${s} is not a method of ${e} and not a QFunc: ${t}\n`,{only:"once"});const o=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,a=t.toString().match(o);return!a||a[3]&&a[3]!==a[1]?this.asFuncString(t):a[2]}var n;return null}asFuncString(e){const t=e.toString();return`{${btoa(JSON.stringify(t))}}`}compileFuncString(e,t){this.$compiledFuncs||(this.$compiledFuncs={});const s=t.id+":"+e;let i=this.$compiledFuncs[s];if(!i){const n=JSON.parse(atob(e.slice(1,-1)));i=El(n,t),n.startsWith("function")&&(i=i.bind(t)),this.$compiledFuncs[s]=i}return i}addSubscription(e,t,s,i){if(Hl!==this)throw Error("Cannot add a model subscription from outside model code");if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);const n=t+":"+s,r=this.asMethodName(e,i,Al,n);if("string"!=typeof r)throw Error(`Subscription handler for "${s}" must be a method name`);if(r.indexOf(".")<0&&"function"!=typeof e[r]&&"{"!==r[0])throw Error(`Subscriber method for "${s}" not found: ${e}.${r}()`);const o=e===this?"_":e.id,a=o+"."+r;if("*"===t||"*"===s)return void this.addGenericSubscription(n,a);if(this.subscriptions[n]){if(-1!==this.subscriptions[n].indexOf(a))throw Error(`${e}.${r} already subscribed to ${s}`)}else this.subscriptions[n]=[];this.subscriptions[n].push(a);let l=this.subscribers.get(o);l||this.subscribers.set(o,l=new Set),l.add(n)}removeSubscription(e,t,s,i="*"){if(Hl!==this)throw Error("Cannot remove a model subscription from outside model code");if("*"===t||"*"===s)return void this.removeGenericSubscription(e,t,s,i);const n=t+":"+s,r=this.subscriptions[n];if(r){const t=e.id+".";if("*"===i){for(let s=r.length-1;s>=0;s--)if(r[s].startsWith(t)){const i=r[s].slice(t.length);rc(i,n)&&delete e[i],r.splice(s,1)}0===r.length&&delete this.subscriptions[n]}else{const o=this.asMethodName(e,i,"unsubscribe argument",n);if("string"!=typeof o)throw Error(`Invalid unsubscribe args for "${s}" in ${e}: ${i}`);const a=t+o,l=r.indexOf(a);if(-1!==l&&(r.splice(l,1),0===r.length&&delete this.subscriptions[n],rc(o,n)&&delete e[o]),r.find((e=>e.startsWith(t))))return}const o=this.subscribers.get(e.id);o.delete(n),0===o.size&&this.subscribers.delete(e.id)}}addGenericSubscription(e,t){this.genericSubscriptions.push({topic:e,handler:t})}removeGenericSubscription(e,t,s,i="*"){const n=t+":"+s,r=e.id+".";for(let t=this.genericSubscriptions.length-1;t>=0;t--){const s=this.genericSubscriptions[t];s.topic===n&&s.handler.startsWith(r)&&("*"!==i&&s.handler!==r+i||(this.genericSubscriptions.splice(t,1),rc(i,n)&&delete e[i]))}}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e.id);if(t){const s=e.id+".";for(const i of t){const t=this.subscriptions[i];for(let n=t.length-1;n>=0;n--)if(t[n].startsWith(s)){const r=t[n].slice(s.length);rc(r,i)&&delete e[r],t.splice(n,1)}0===t.length&&delete this.subscriptions[i]}this.subscribers.delete(e.id)}}publishFromModel(e,t,s){if(Hl!==this)throw Error("Cannot publish a model event from outside model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);const i=t.endsWith(ac);i&&(t=t.slice(0,t.length-10));const n=this.currentEventFromModel;this.currentEventFromModel=!0;const r=e+":"+t;this.handleModelEventInModel(r,s,i),this.handleModelEventInView(r,s),this.currentEventFromModel=n}publishFromModelOnly(e,t,s){if(Hl!==this)throw Error("Cannot publish a model event from outside model code");const i=e+":"+t;this.handleModelEventInModel(i,s)}publishFromView(e,t,s){if(Hl)throw Error("Cannot publish a view event from model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);const i=e+":"+t;this.handleViewEventInModel(i,s),this.handleViewEventInView(i,s)}handleBundledEvents(e){for(const t of e){const e=fc.fromState(t,this);this.verifyExternal(e),e.executeOn(this,!0)}}handleModelEventInModel(e,t,s=!1){if(Hl!==this)throw Error("handleModelEventInModel called from outside model code");if(s){if(!0!==this.controller.synced)return;const s=e+"#__vote",i=e+"#divergence",n=!!z.subscriptions[s],r=!!this.subscriptions[e],o=!!this.subscriptions[i];n&&o&&console.log(`divergence subscription for ${e} overridden by vote subscription`);const a=r?new fc(this.time,0,"_","handleModelEventInModel",[e,t]):null;let l;l=n?["handleModelEventInView",s]:["handleTuttiDivergence",i],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:a,wantsVote:n,tallyTarget:l})))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(e,t),this.subscriptions[e]&&this.invokeHandlers(this.subscriptions[e],e,t)}invokeHandlers(e,t,s){const i=e.slice();for(let n=0;n<i.length;n++){const r=i[n];(r===e[n]||e.includes(r))&&this.invokeHandler(r,t,s)}}invokeGenericHandlers(e,t){const[s,i]=e.split(":");if(!(s.startsWith("__")&&s.endsWith("__")||i.startsWith("__")&&i.endsWith("__")))for(const n of this.genericSubscriptions){const[r,o]=n.topic.split(":");("*"===r&&o===i||r===s&&"*"===o||"*"===r&&"*"===o)&&this.invokeHandler(n.handler,e,t)}}invokeHandler(e,t,s){const i=this.currentEvent;this.currentEvent=t;try{const[i,...n]=e.split("."),r=n.join("."),o=this.lookUpModel(i);if(!o)return void R(`event ${t} .${r}(): subscriber not found`);if("{"===r[0]){const e=this.compileFuncString(r,o);try{e(s)}catch(s){M(`event ${t} ${o} ${e}`,s)}return}if(r.indexOf(".")>=0){const e=r.indexOf("."),i=r.slice(0,e),n=r.slice(e+1);try{o.call(i,n,s)}catch(e){M(`event ${t} ${o}.call(${JSON.stringify(i)}, ${JSON.stringify(n)})`,e)}return}if("function"!=typeof o[r])return void M(`event ${t} ${o}.${r}(): method not found`);try{o[r](s)}catch(e){M(`event ${t} ${o}.${r}()`,e)}}finally{this.currentEvent=i}}handleViewEventInModel(e,t){if(this.subscriptions[e]){const s=[e];void 0!==t&&s.push(t);const i=new fc(this.time,0,"_","handleModelEventInModel",s);this.controller.sendMessage(i)}}handleModelEventInView(e,t){Nl.write&&(t=this.debugWriteProxy(this,t,`event ${e} arg`)),z.handleEvent(e,t,(e=>function(e){if(!Hl)throw Error("VirtualMachine confusion");const t=Hl;try{Hl=null,e()}finally{Hl=t}}((()=>E(this,e,!0)))))}handleViewEventInView(e,t){z.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{const s=e.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${s}:`,t)}}handleSessionDiverged(e){const{key:t,url:s}=e;this.diverged||(this.diverged=new Map);let i=this.diverged.get(t);i||this.diverged.set(t,i=[]),i.push(s),2===i.length&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(t)}debugDiverged(e){e||(e=this.diverged.keys().next().value);const t=this.diverged.get(e);if(!t||t.length<2)throw Error(`no diverged urls for snapshot ${e}`);Promise.resolve().then((()=>this.controller.diffDivergedSnapshots(t)))}processModelViewEvents(e){if(Hl)throw Error("cannot process view events in model code");return E(this,(()=>z.processFrameEvents(e,!!this.controller.synced)))}handlePollForSnapshot(){const e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}handleAuditRequest(e){this.controller.handleAuditRequest(e)}snapshot(){return Zc.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return t((new gc).getHash(this))}debug(e){return this.controller.setDebug(e)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(e,s){this.controller&&"no.appId"===this.controller.sessionSpec.appId&&console.warn(`${K.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);const i=Ei.begin("snapshot"),n="function"==typeof s?s.call(e):s;if("object"!=typeof n)throw Error(`${K.libName}: persistSession() can only persist objects (got ${typeof n})`);const r=t(n),o=Ml.hash(r),a=Ei.end("snapshot")-i,l=this.persisted===o,c=this.time;var h,u;if(Nl.snapshot&&console.log(this.id,`persistent data @${c} collected, stringified and hashed in ${Math.ceil(a)}ms${l?" (unchanged, ignoring)":""}`),d.forcePersist&&queueMicrotask((()=>this.controller.forcePersist(c,r,o))),!l)if(h=this,u={persistTime:c,persistentString:r,persistentHash:o,ms:a},dc.set(h,u),this.persisted=o,this.inPersistenceCoolOff)Nl.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{const e=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;e>0?(Nl.snapshot&&console.log(this.id,`postponing persistence poll by ${e}ms`),this.futureSend(e,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const e=(t=this,dc.get(t));var t;if(!e)return;const{persistTime:s,persistentString:i,persistentHash:n,ms:r}=e;if(hc(this),this.controller&&this.controller.synced){Nl.snapshot&&console.log(this.id,`asking controller to poll for persistence @${s}`);const e=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(e,s,i,n,r)))}}random(){if(Hl!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(Hl!==this)throw Error("synchronized random accessed from outside the model");let e="";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function pc(e,t,s){let i;if("_"===e){const e=cc[t];"number"==typeof e&&(i=e.toString(36))}if(void 0===i&&(i=`${e}>${t}`),s.length>0){const e=Gc.newOrRecycled();i+=JSON.stringify(e.encode(s))}return i}function bc(e,t){return(t-e|0)>=0}class fc{constructor(e,t,s,i,n){this.time=e,this.seq=t,this.receiver=s,this.selector=i,this.args=n}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?bc(this.externalSeq,e.externalSeq):bc(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,pc(this.receiver,this.selector,this.args)]}static fromState(e,t){const[s,i,n]=e,{receiver:r,selector:o,args:a}=function(e,t){let s,i,n;if(1===e.length||"["===e[1]){const t=parseInt(e[0],36);s="_",i=lc[t],n=e.slice(1)}else{const t=e.indexOf(">");let r=e.indexOf("[");-1===r&&(r=e.length),s=e.slice(0,t),i=e.slice(t+1,r),n=e.slice(r)}let r=[];n&&(r=vc.newOrRecycled(t).decode(JSON.parse(n)));return{receiver:s,selector:i,args:r}}(n,t);return new fc(s,i,r,o,a)}executeOn(e,t=!1){e.currentEventFromModel=!this.isExternal();const s=t?e=>e():t=>oc(e,(()=>Q(e,t))),{receiver:i,selector:n,args:r}=this,o=e.lookUpModel(i);if(o)if("{"===n[0]){const t=e.compileFuncString(n,o);s((()=>{try{t(...r)}catch(e){M(`${this.shortString()} ${t}`,e)}}))}else n.indexOf(".")>=0?s((()=>{const e=n.indexOf("."),t=n.slice(0,e),s=n.slice(e+1);try{o.call(t,s,...r)}catch(e){M(`${this.shortString()} ${o}.call(${JSON.stringify(t)}, ${JSON.stringify(s)})`,e)}})):"function"!=typeof o[n]?R(`${this.shortString()} ${o}.${n}(): method not found`):s((()=>{try{if(ic(n)){const e=o[n];delete o[n],e(...r)}else o[n](...r)}catch(e){M(`${this.shortString()} ${o}.${n}()`,e)}}));else R(`${this.shortString()} ${n}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){const{receiver:e,selector:t,args:s}=this,i=this.isExternal(),n=i?this.externalSeq:this.internalSeq;return`${i?"External":"Future"}Message[${this.time}${":#"[+i]}${n} ${e}.${t}(${s.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const yc=(()=>{const e=new ArrayBuffer(8),t=new DataView(e);return e=>(t.setFloat64(0,e,!0),t.getInt32(0,!0)+t.getInt32(4,!0))})();class gc{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",fc),this.addHasher("Teatime:Data",Kl),this.addHasher("Teatime:QFunc",Ol);for(const[e,t]of Vc.allClassTypes())this.addHasher(e,t)}addHasher(e,t){const{cls:s,write:i}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};i&&this.hashers.set(s,(e=>this.hashStructure(e,i(e))))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[t,s]of Object.entries(e))if("controller"!==t&&"meta"!==t)if("_random"===t)this.hash(s.state(),!1);else if("messages"===t){const e=s.asArray();(this.hashState.fC=e.length)&&this.hash(e,!1)}else this.hashEntry(t,s);return this.hashDeferred(),this.hashState}hashDeferred(){let e=0;for(;e<this.todo.length;){const{key:t,value:s}=this.todo[e++];this.hashEntry(t,s,!1)}this.todo.length=0}hash(e,t=!0){switch(typeof e){case"number":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?0===e?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=yc(e)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=e.length);case"boolean":case"undefined":return;case"bigint":if(0n===e)this.hashState.zC++;else{this.hashState.nC++;const t=e<0?-1n:0n;for(;e!==t;)this.hashState.nH+=Number(0xFFFFFFFFn&e),e>>=32n}return;default:{if(this.done.has(e))return;if(null===e)return;if(this.hashers.has(e.constructor))return void this.hashers.get(e.constructor)(e);const s=Object.prototype.toString.call(e).slice(8,-1);if(this.hashers.has(s))return void this.hashers.get(s)(e);switch(s){case"Array":return void this.hashArray(e,t);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(e));case"Set":return void this.hashStructure(e,[...e]);case"Map":return void this.hashStructure(e,[...e],!1);case"DataView":return void this.hashIntArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(e);case"Float32Array":case"Float64Array":return void this.hashArray(e,!1);case"Object":e instanceof Vc?this.hashModel(e):e.constructor===Object&&this.hashObject(e,t)}}}}hashModel(e){this.hashState.mC++,this.done.add(e);for(const[t,s]of Object.entries(e))"__realm"!==t&&void 0!==s&&this.hashEntry(t,s)}hashObject(e,t=!0){this.hashState.oC++,this.done.add(e);for(const[s,i]of Object.entries(e))void 0!==i&&this.hashEntry(s,i,t)}hashArray(e,t=!0){this.done.add(e);for(let s=0;s<e.length;s++)this.hashEntry(s,e[s],t)}hashIntArray(e){this.done.add(e);for(let t=0;t<e.length;t++){const s=e[t];0===s?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=s)}}hashStructure(e,t,s=!0){void 0!==t&&(this.done.add(e),this.hash(t,s))}hashEntry(e,t,s=!0){"$"!==e[0]&&(s&&"object"==typeof t?this.todo.push({key:e,value:t}):this.hash(t,s))}}class Zc{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",fc),this.addWriter("Teatime:Data",Kl),this.addWriter("Teatime:QFunc",Ol);for(const[e,t]of Vc.allClassTypes())this.addWriter(e,t);this.okayToIgnore={$debugWriteProxyHandler:!0};for(const e of Vc.allClasses())if(Object.prototype.hasOwnProperty.call(e,"okayToIgnore")){const t=e.okayToIgnore();if(!Array.isArray(t))throw new Error("okayToIgnore() must return an array");for(const e of t){if("$"!==e[0])throw Error(`okayToIgnore: ignored prop "${e}" must start with '$'`);this.okayToIgnore[e]=!0}}}addWriter(e,t){const s=Object.getPrototypeOf(t)===Object.prototype,{cls:i,write:n}=s?t:{cls:t,write:e=>({...e})};if(i===Object)throw Error(`${K.libName} types: '${e}' is the Object class itself, must be a user class`);if(i===Array)throw Error(`${K.libName} types: '${e}' is the Array class, must be a user class`);n?this.writers.set(i,((t,r)=>this.writeAs(e,t,n(t),s?`${r}.write(${i.name})`:r))):t.writeStatic||console.warn(`${K.libName} types: ${e} does not implement write() or writeStatic()`)}snapshot(e,t){const s={_random:e._random.state(),messages:this.write(e.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(s);for(const[i,n]of Object.entries(e))i in s||this.writeInto(s,i,n,t);return this.writeDeferred(),delete s.controller,delete s.subscribers,delete s.$compiledFuncs,s}writeAllStaticInto(e){for(const t of Vc.allClasses())if(t!==Vc)for(const[s,i]of Object.entries(t)){if("$"===s[0])continue;const n=Vc.classToID(t);e.staticModelProps||(e.staticModelProps={}),n in e.staticModelProps||(e.staticModelProps[n]={}),this.writeInto(e.staticModelProps[n],s,i,`Model(${n}).static`),xc("Model",n)}for(const[t,s]of Vc.allClassTypes())if("object"==typeof s){const{writeStatic:i}=s;if(i){const s=i();s&&(e.staticTypeProps||(e.staticTypeProps={}),e.staticTypeProps[t]=this.write(s,`Type(${t}).writeStatic()`),xc("Type",t))}}}writeDeferred(){let e=0;for(;e<this.todo.length;){const{state:t,key:s,value:i,path:n}=this.todo[e++];this.writeInto(t,s,i,n,!1)}this.todo.length=0}write(e,t,s=!0){switch(typeof e){case"number":return Object.is(e,-0)?{$class:"NegZero"}:Number.isFinite(e)?e:Number.isNaN(e)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(e)};case"string":case"boolean":return e;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:e.toString()};default:{if(this.refs.has(e))return this.writeRef(e);if(null===e)return e;if(this.writers.has(e.constructor))return this.writers.get(e.constructor)(e,t);const i=Object.prototype.toString.call(e).slice(8,-1);if(this.writers.has(i))return this.writers.get(i)(e,t);switch(i){case"Array":return this.writeArray(e,t,s);case"ArrayBuffer":return this.writeArrayBuffer(e);case"Set":return this.writeAs(i,e,[...e],t);case"Map":return this.writeAs(i,e,[...e].flat(),t);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(i,e);case"Object":if(e instanceof Vc)return this.writeModel(e,t);if(e.constructor===Object||"function"!=typeof e.constructor)return this.writeObject(e,t,s);throw console.warn(`${K.libName}: unknown class at ${t}:`,e),Error(`${K.libName}: class not registered in Model.types(): ${e.constructor.name}`);case"Function":if(e[Ul])return this.writers.get(Ul)(e,t);throw console.warn(`${K.libName}: found function at ${t}:`,e),Error(`${K.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${K.libName}: unsupported property at ${t}:`,e),Error(`${K.libName}: serialization of ${i}s is not supported`)}}}}writeModel(e,t){const s={};this.refs.set(e,s);try{s.$model=Vc.classToID(e.constructor)}catch(s){throw console.error(`unregistered model class at ${t}:`,e),s}for(const t of Object.keys(e).sort()){if("__realm"===t)continue;const i=e[t];("number"==typeof i&&Number.isFinite(i)&&!Object.is(i,-0)||"string"==typeof i||"boolean"==typeof i)&&"$"!==t[0]?s[t]=i:this.writeInto(s,t,i,`${e}`,!0)}return s}writeObject(e,t,s=!0){const i={};this.refs.set(e,i);for(const n of Object.keys(e).sort()){const r=e[n];("number"==typeof r&&Number.isFinite(r)&&!Object.is(r,-0)||"string"==typeof r||"boolean"==typeof r)&&"$"!==n[0]?i[n]=r:this.writeInto(i,n,r,t,s)}return i}writeArray(e,t,s=!0){const i=[];this.refs.set(e,i);for(let n=0;n<e.length;n++){const r=e[n];"number"==typeof r&&Number.isFinite(r)&&!Object.is(r,-0)||"string"==typeof r||"boolean"==typeof r?i[n]=r:this.writeInto(i,n,r,t,s)}return i}writeArrayBuffer(e){const t={$class:"ArrayBuffer",$value:Wc(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){const s={$class:e,$value:[this.write(t.buffer),t.byteOffset,"DataView"===e?t.byteLength:t.length]};return this.refs.set(t,s),s}writeAs(e,t,s,i){const n={$class:e};this.refs.set(t,n);const r=this.write(s,i,!1);return"object"!=typeof r||null===r||r.$class||Array.isArray(r)?n.$value=r:Object.assign(n,r),n}writeRef(e){const t=this.refs.get(e);if("object"!=typeof t)throw Error("Non-object in refs: "+e);Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}});return{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,s,i,n=!0){if("$"===t[0])return void(this.okayToIgnore[t]||(R(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[t]=!0));if(n&&"object"==typeof s)return void this.todo.push({state:e,key:t,value:s,path:i});const r=this.write(s,i+jl(e,t));e[t]=r}}const Xc=Symbol("croquet:unresolved");class wc{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[],t.postprocess=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",fc),this.addReader("Teatime:Data",Kl),this.addReader("Teatime:QFunc",Ol),this.readers.set("Undefined",(()=>{})),this.readers.set("NaN",(()=>NaN)),this.readers.set("Infinity",(e=>e*(1/0))),this.readers.set("NegZero",(()=>-0)),this.readers.set("BigInt",(e=>BigInt(e))),this.readers.set("ArrayBuffer",(e=>function(e){const t=globalThis.atob(e),s=t.length,i=new Uint8Array(s);for(let e=0;e<s;e++)i[e]=t.charCodeAt(e);return i.buffer}(e))),this.readers.set("DataView",(e=>new DataView(...e))),this.readers.set("Int8Array",(e=>new Int8Array(...e))),this.readers.set("Uint8Array",(e=>new Uint8Array(...e))),this.readers.set("Uint8ClampedArray",(e=>new Uint8ClampedArray(...e))),this.readers.set("Int16Array",(e=>new Int16Array(...e))),this.readers.set("Uint16Array",(e=>new Uint16Array(...e))),this.readers.set("Int32Array",(e=>new Int32Array(...e))),this.readers.set("Uint32Array",(e=>new Uint32Array(...e))),this.readers.set("Float32Array",(e=>new Float32Array(...e))),this.readers.set("Float64Array",(e=>new Float64Array(...e)));for(const[e,t]of Vc.allClassTypes())this.addReader(e,t)}addReader(e,t){let s=e=>Object.assign(Object.create(t.prototype),e);"object"==typeof t&&(s=t.read),this.readers.set(e,s)}enableBackwardCompatibility(e){const t=e?.meta?.sdk;if(!t)return;const[s,i,n,r]=t.split(/[-.+]/).map((e=>+e));let o=`${s}.${i}`;n&&(o+=`.${n}`),r&&(o+=`-${r}`),console.warn(`${K.libName}: reading snapshot version ${o}`),this.compatMaps=s<1||1===s&&(i<1||1===i&&n<7)}readVM(e,t,s){if("VM"!==t)throw Error("VirtualMachine must be root object");s&&this.enableBackwardCompatibility(e);const i=this.read(e,t,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(i),i}readDeferred(){let e=0;for(;e<this.todo.length;){const{object:t,key:s,value:i,path:n}=this.todo[e++];this.readInto(t,s,i,n,!1)}this.todo.length=0}resolveRefs(){for(const{object:e,key:t,ref:s,path:i}of this.unresolved){if(!this.refs.has(s))throw Error(`Unresolved ref: ${s} at ${i}[${JSON.stringify(t)}]`);e[t]=this.refs.get(s)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(const e of this.postprocess)e();this.postprocess.length=0}readAllStatic(e){const{staticModelProps:t,staticTypeProps:s}=e,i=[];if(t){for(const[e,s]of Object.entries(t)){const t=Vc.classFromID(e);i.push((()=>Object.assign(t,s))),xc("Model",e)}delete e.staticModelProps}if(s){const t=Object.fromEntries(Vc.allClassTypes());for(const[e,n]of Object.entries(s)){const s=t[e];if("object"==typeof s){const e=s;i.push((()=>e.readStatic(n)))}else{const e=s;i.push((()=>Object.assign(e,n)))}xc("Type",e)}delete e.staticTypeProps}i.length&&(e.staticInitializers=i)}read(e,t,s=!0){switch(typeof e){case"number":case"string":case"boolean":return e;default:{const i=Object.prototype.toString.call(e).slice(8,-1);switch(i){case"Array":return this.readArray(e,t,s);case"Null":return null;case"Object":{const{$class:i,$model:n,$ref:r}=e;if(r)throw Error("refs should have been handled in readInto()");return n?this.readModel(e,t):i?this.readAs(i,e,t):this.readObject(Object,e,t,s)}default:throw Error(`Don't know how to deserialize ${i} at ${t}`)}}}}readModel(e,t){const s=Vc.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,s);for(const[i,n]of Object.entries(e))"id"!==i&&"$"!==i[0]&&this.readInto(s,i,n,t);return s}readObject(e,t,s,i=!0){const n=new e;t.$id&&this.refs.set(t.$id,n);for(const[e,r]of Object.entries(t))"$"!==e[0]&&this.readInto(n,e,r,s,i);return n}readArray(e,t,s=!0){const i=[];e.$id&&this.refs.set(e.$id,i);for(let n=0;n<e.length;n++)void 0!==e[n]&&this.readInto(i,n,e[n],t,s);return i}readAsArray(e,t,s=!0){const i=e.$value;return e.$id&&(i.$id=e.$id),this.readArray(i,t,s)}readAsSet(e,t){const s=new Set;e.$id&&this.refs.set(e.$id,s);const i=this.unresolved.length,n=this.read(e.$value,t,!1),r=()=>{for(const e of n)s.add(e)};return this.unresolved.length===i?r():this.postprocess.push(r),s}readAsMap(e,t){const s=new Map;e.$id&&this.refs.set(e.$id,s);const i=this.unresolved.length,n=this.read(e.$value,t,!1),r=this.compatMaps?()=>{if(n.some((e=>2!==e.length)))console.warn("Deferring map resolution at",t),this.postprocess.push(r);else for(const[e,t]of n)s.set(e,t)}:()=>{for(let e=0;e<n.length;e+=2)s.set(n[e],n[e+1])};return this.unresolved.length===i?r():this.postprocess.push(r),s}readAsClass(e,t,s){let i={};const n=new Map;if("$value"in t)i=this.read(t.$value,s,!1);else for(const[e,r]of Object.entries(t)){if("$"===e[0])continue;const t=r&&r.$ref;t?this.refs.has(t)?i[e]=this.refs.get(t):(i[e]=Xc,n.set(t,e)):this.readInto(i,e,r,s,!1)}const r=this.readers.get(e)(i,s);r||"Undefined"===e||"BigInt"===e||"NaN"===e||"NegZero"===e||console.warn(`Reading "${e}" returned ${r} at ${s}`),t.$id&&this.refs.set(t.$id,r);for(const[e,t]of n.entries())this.unresolved.push({object:r,key:t,ref:e,path:s});return r}readAs(e,t,s){switch(e){case"Array":return this.readAsArray(t,s);case"Set":return this.readAsSet(t,s);case"Map":return this.readAsMap(t,s);default:return this.readAsClass(e,t,s)}}readRef(e,t,s,i){if(!s||!s.$ref)return!1;const n=s.$ref;return this.refs.has(n)?e[t]=this.refs.get(n):(e[t]=Xc,this.unresolved.push({object:e,key:t,ref:n,path:i})),!0}readInto(e,t,s,i,n=!0){this.readRef(e,t,s,i)||(n&&"object"==typeof s?this.todo.push({object:e,key:t,value:s,path:i}):e[t]=this.read(s,i+jl(e,t)))}}class Gc extends Zc{encode(e){const t=this.writeArray(e,"args");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}}class vc extends wc{decode(e){const t=this.readArray(e,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),t}resolveRefs(){for(const{object:e,key:t,ref:s,path:i}of this.unresolved)if(this.refs.has(s))e[t]=this.refs.get(s);else{const n=this.vm.lookUpModel(s);if(!n)throw Error(`Unresolved ref: ${s} at ${i}[${JSON.stringify(t)}]`);e[t]=n}}}const Lc=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function Sc(e,t,s,i){const n=Array.isArray(e)?e:e.constructor===Set?e.values():e.constructor===Map?e.entries():Object.values(e),r=[];for(const e of n)"object"!=typeof e||null===e||i.has(e)||(i.add(e),r.push(e));for(const e of r){if(Lc.includes(e.constructor))continue;const i=t+"."+e.constructor.name;if(s[i]){if(s[i]!==e.constructor)throw new Error("Class with name "+i+" already gathered, but new one has different identity")}else s[i]=e.constructor}for(const e of r)Sc(e,t,s,i)}function xc(e,t){const s=z.controllers.size;s>1&&R(`Static properties in shared ${e} ${t} can lead to divergence because ${s} ${K.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function Wc(e){const t=new Uint8Array(e),s=[];for(let e=0;e<t.byteLength;e+=4096){const i=t.subarray(e,e+4096);s.push(String.fromCharCode.apply(null,i))}return globalThis.btoa(s.join(""))}const Tc={classes:d.has("debug","classes")};let Cc=Symbol("SECRET");const kc=new WeakSet;class Vc{static create(...e){if(!Yc(this))throw Error(`Model class "${this.name}" not registered`);const t=this,s=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(s.beWellKnownAs("modelRoot"),s.__realm.vm.debugEvents&&this.eventDebugInit(s)),kc.add(s),s.init(...e),kc.has(s)&&(kc.delete(s),Object.getPrototypeOf(t)!==Vc&&console.warn(`${s} did not call super.init(options)`)),s}static createNoInit(e){const t=U(),s=new this(Cc);return e||(e=t.register(s)),void 0===Tc.write&&(Tc.write=d.has("debug","write"),Tc.publish=d.has("debug","publish"),Tc.events=d.has("debug","events")),Object.defineProperty(s,"__realm",{value:t,writable:Tc.write}),Object.defineProperty(s,"id",{value:e,enumerable:!0}),s}static allowConstructors(){Cc=void 0,console.warn("disabling error reporting for Model constructors")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),wc.resetInstance(),Zc.resetInstance(),Gc.resetInstance(),vc.resetInstance(),function(e,t){const s=S(e),i=k(`${t}:${s}`);V.push(i),i.then((e=>T[e].what=`Class ${t}`))}(this,e),function(e,t){const s=Ic[t];if(s&&s!==e)throw Error(`Registering model class ${e.name} failed, id "${t}" already used by ${s.name}`);Yc(e)?Tc.classes&&!s&&console.warn(`ignoring re-exported model class ${t}`):(Tc.classes&&console.log(`registering model class ${t}`),e[Pc]=t);Ic[t]=e}(this,e),Vc.lastRegistered=this,this}static wellKnownModel(e){if(!mc.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return mc.current().get(e)}static evaluate(e){return mc.evaluate(e)}static isExecuting(){return mc.hasCurrent()}static types(){return{}}static gatherClassTypes(e,t){const s={};return Sc({root:e},t,s,new Set),s}static eventDebugOptions(){return Tc}static eventDebugInit(e){e.subscribe("*","*",e.createQFunc('\n        function logEvents(data) {\n            // do this now to have no side effects below\n            const { scope, event, source } = this.activeSubscription;\n            // below stuff is outside the model. Must not have any side effects!\n            const debug = this.constructor.eventDebugOptions();\n            if (!debug.events && !debug.publish) return;\n            const action = source === "model" ? "publish" : "receive";\n            const emoji = source === "model" ? "🔮" : "📬";\n            console.log(`${emoji} @${this.now()} Model ${action} ${scope}:${event}`, data);\n        }\n        '))}static okayToIgnore(){return[]}static classToID(e){return function(e){if(Yc(e))return e[Pc];const t=e.name||"ClassName";throw Error(`Model class not registered, did you call ${t}.register("${t}")?`)}(e)}static classFromID(e){return Mc(e)}static allClasses(){return Rc()}static allClassTypes(){return function(){const e={};for(const t of Rc())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return Mc(e).createNoInit(t)}constructor(e){if(e!==Cc)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(e,t){kc.delete(this)}destroy(){U().unsubscribeAll(this),U().deregister(this)}publish(e,t,s){this.__realm||this.__realmError(),this.__realm.publish(t,s,e)}subscribe(e,t,s){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,s)}unsubscribe(e,t,s="*"){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,s)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!mc.hasCurrent())return;const{currentEvent:e,currentEventFromModel:t}=mc.current();if(!e)return;const[s,i]=e.split(":");return{scope:s,event:i,source:t?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(e=0,t=void 0,...s){return this.__realm||this.__realmError(),this.__realm.future(this,e,t,s)}cancelFuture(e){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,e)}random(){return U().random()}now(){return U().now()}beWellKnownAs(e){U().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(mc.current()===this.__realm.vm)return!0;const t=Error(e||`${this}.modelOnly() called from outside a model!`);throw M("view code",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(e,t){return void 0===t&&(t=e,e={}),Ql(this,e,t)}persistSession(e){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){return`${this.constructor[Pc]||this.constructor.name}#${this.id}`}}const Ic={},Pc=Symbol("CLASS_ID");function Rc(){return Object.values(Ic)}function Yc(e){return Object.prototype.hasOwnProperty.call(e,Pc)}function Mc(e){if(Ic[e])return Ic[e];throw Error(`Model class "${e}" in snapshot, but not registered?`)}const Kc="Croquet.Model";let Hc;Vc[Pc]=Kc,Ic[Kc]=Vc;class Nc{static displayStatus(e,t){return Y(e,t)}static displayWarning(e,t){return R(e,t)}static displayError(e,t){return function(e,t={}){return e&&K.showMessage(e,{...t,level:"error"})}(e,t)}constructor(e){"object"==typeof e&&"__realm"in e||console.warn(`${K.libName}: argument to View constructor needs to be a Model`);let t=U("");t&&t.isViewRealm()||(t=E(e.__realm.vm,(()=>U()),!0)),Object.defineProperty(this,"realm",{value:t}),Object.defineProperty(this,"id",{value:t.register(this),configurable:!0});const s=t.controller.session;if(s.view||(s.view=this),Hc||(Hc={events:d.has("debug","events"),publish:d.has("debug","publish")}),s.view===this&&(Hc.events||Hc.publish)){const e=e=>{if(!t.vm.debugEvents)return;const{scope:s,event:i,source:n,subscribed:r}=this.activeSubscription;if(!r&&!Hc.publish)return;const o="view"===n?"publish":"receive",a="view"===n?"📮":"👁️",l=r||"publish"===o?"":" (no subscribers)";console.log(`${a} View ${o} ${s}:${i}${l}`,e)},s=t=>"view"===this.activeSubscription.source&&e(t),i=t=>"model"===this.activeSubscription.source&&e(t);s.__CROQUET__=!0,i.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},i),this.subscribe("*",{event:"*",handling:"immediate"},s)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(e,t,s){this.realm.publish(t,s,e)}subscribe(e,t,s){if("string"==typeof s&&(s=this[s]),"function"!=typeof s)throw Error(`${K.libName}: subscribe() handler is not a function`);const i=s;(s=i.bind(this)).unbound=i;const{event:n,handling:r}=t.event?t:{event:t};this.realm.subscribe(n,this.id,s,e,r)}unsubscribe(e,t,s=null){"string"==typeof s&&(s=this[s]),this.realm.unsubscribe(t,this.id,s,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){const{currentEvent:e,currentEventFromModel:t,currentEventOnlyGeneric:s}=z;if(!e)return;const[i,n]=e.split(":");return{scope:i,event:n,source:t?"model":"view",subscribed:!s}}future(e=0){return this.realm.future(this,e)}random(){return U().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){const e=this.constructor.name;return e.includes("View")?e:`${e}[View]`}}const zc=new class{constructor(){this.ready=!1}setReceiver(e){}setIframeEnumerator(e){}on(e,t){}detach(){}removeSubscription(e,t){}removeAllSubscriptions(){}receive(e){}handleEvent(e,t,s){}send(e,t,s){}startPublishingPointerMove(){}stopPublishingPointerMove(){}};let Fc=60;class jc{static async join(e){try{return await this.join_impl(e)}catch(e){throw K.showMessage(e.message||e,{level:"fatal"}),e}}static async join_impl(e){e.appId||(e.appId="no.appId"),e.name||(e.name=K.autoSession(),e.password||(e.password=K.autoPassword())),e.model||(e.model=Vc.lastRegistered),e.view||(e.view=Nc);const s=[];for(const[p,b]of Object.entries(e))b instanceof Promise&&s.push(b.then((t=>e[p]=t)));function i(e,t){return e===t||e.prototype instanceof t}if(await Promise.all(s),e.box){if("string"!=typeof e.box)throw Error(`${K.libName}: box must be a string in Session.join()!`);if(!e.box.includes("/"))throw Error(`${K.libName}: box must be a (partial) URL in Session.join()!`)}else if(!e.reflector||!e.files){if("string"!=typeof e.apiKey)throw Error(`${K.libName}: no apiKey provided in Session.join()!`);if(e.apiKey.length>128)throw Error(`${K.libName}: apiKey > 128 characters in Session.join()!`)}if("string"!=typeof e.name)throw Error(`${K.libName}: no session name provided in Session.join()!`);if(e.name.length>128)throw Error(`${K.libName}: session name > 128 characters in Session.join()!`);const n=e.model;if("function"!=typeof n||!i(n,Vc))throw Error(`${K.libName}: bad model class in Session.join()`);const r=e.view||Nc;if("function"!=typeof r||!i(r,Nc))throw Error(`${K.libName}: bad view class in Session.join()`);if("string"!=typeof e.appId)throw Error(`${K.libName}: no appId provided in Session.join()`);if(!e.appId.length>128)throw Error(`${K.libName}: appId > 128 characters in Session.join()`);if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${K.libName}: malformed appId in Session.join()`);if("string"!=typeof e.password||!e.password)throw Error(`${K.libName}: no password provided in Session.join()`);for(const f of["reflector","synchronizer","files","backend","box"]){const y=d[f]||e[f];void 0!==y&&(d[f]=y)}if("manual"!==e.step)throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in e){if("number"!=typeof e.rejoinLimit||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else e.rejoinLimit=1e3;if("eventRateLimit"in e){if("number"!=typeof e.eventRateLimit||e.eventRateLimit<1||e.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!e.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(e.hashOverride){if(43!==e.hashOverride.length)throw Error("hashOverride must be 43 characters");if(-1!==e.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error("hashOverride must be base64url encoded")}if(e.debug){function g(e){return"string"==typeof e&&(e=e.split(",")),e?Array.isArray(e)?e:[e]:[]}d.debug=[...g(e.debug),...g(d.debug)].join(",")}if("autoSleep"in e){const Z=e.autoSleep,X=typeof Z;if("number"===X){if(Z<0)throw Error("an autoSleep value must be >= 0")}else{if("boolean"!==X)throw Error("autoSleep must be numeric or boolean");e.autoSleep=Z?10:0}}else e.autoSleep=10;if(e.flags){let w=e.flags;"string"==typeof w&&(w=w.split(",")),w=w?Array.isArray(w)?w:[w]:[],w=w.filter((e=>"object"!=typeof e)),w.length?(e.flags={},w.forEach((t=>e.flags[t]=!0))):e.flags=null}"expectedSimFPS"in e&&(Fc=Math.min(e.expectedSimFPS,120));const o=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];!function(){if(Object.isFrozen(_c))return;Jc(_c),function(e){const s=JSON.stringify(e,((e,t)=>"function"==typeof t?S(t):t));if("{}"===s)return;const i=JSON.parse(s),n=k(t(i));V.push(n),n.then((e=>T[e].what=`${K.libName} Constants`))}(_c)}();const a=new Ll,l=JSON.parse(JSON.stringify({...e.options}));if(e.persistentIdOptions){if(!Array.isArray(e.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(const G of e.persistentIdOptions)if(!(G in l))throw Error(`persistentIdOptions key "${G}" not found in options`)}const c={id:"",persistentId:"",versionId:"",name:e.name,model:null,view:null,step(e){a.stepSession("animation",{frameTime:e,view:c.view,expectedSimFPS:Fc})},leave:()=>jc.leave(c.id),data:{store:(e,t)=>Ml.store(e,{...t,sessionId:c.id}),fetch:(e,t)=>Ml.fetch(e,{...t,sessionId:c.id}),hash:e=>Ml.hash(e),toId:e=>Ml.toId(e),fromId:e=>Ml.fromId(e)},get latency(){return a.latency},get latencies(){return a.latencies}};"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:c,controller:a}}));const h={options:l,initFn:(e,t)=>n.create(e,t),rebootModelView:m};for(const[v,L]of Object.entries(e))o.includes(v)&&(h[v]=L);await a.initFromSessionSpec(h);let u=!1;return await m(),"manual"!==e.step&&a.startStepping(c.step),c;async function m(){!function(){c.model=null,c.view&&(d.has("debug","session",!1)&&console.log(c.id,"detaching root view"),c.view.detach(),""!==c.view.id&&console.warn(`${K.libName}: ${c.view} did not call super.detach()`),c.view=null);K.clearSessionMoniker(),zc.ready&&zc.detach()}(),a.leaving?a.leaving(!0):u||(u=!0,await a.establishSession(h),u=!1,c.model=a.vm.get("modelRoot"),c.id=a.id,c.persistentId=a.persistentId,c.versionId=a.versionId,a.session=c,K.makeSessionWidgets(c.id),a.inViewRealm((()=>{d.has("debug","session",!1)&&console.log(c.id,"creating root view"),new r(c.model,h.viewOptions)})))}}static async leave(e){const t=function(e){for(const t of Gl)if(t.id===e)return t;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);const s=new Promise((e=>t.leaving=e)),i=t.connection;return!!i.connected&&(i.closeConnection(1e3),s)}static thisSession(){const e=mc.current();return e?e.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(e){}leave(){}}const _c={};function Jc(e){if(!Object.isFrozen(e)){Object.freeze(e);for(const t of Object.values(e))!t||"object"!=typeof t&&"function"!=typeof t||Jc(t)}}const Uc={Model:Vc,View:Nc,Session:jc,Data:Ml,Constants:_c,App:K,Messenger:zc,VERSION:il};Vc.Croquet=Uc,Nc.Croquet=Uc,"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:il}})),"undefined"!=typeof globalThis&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=il),exports.App=K,exports.Constants=_c,exports.Data=Ml,exports.Messenger=zc,exports.Model=Vc,exports.Session=jc,exports.VERSION=il,exports.View=Nc;
//# sourceMappingURL=croquet-croquet-node.js.map
